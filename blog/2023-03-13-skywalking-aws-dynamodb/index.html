<!doctype html>
<html lang="en" class="no-js">
  <head>
    <meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<meta name="twitter:site" content="skywalking.apache.org">
<meta name="twitter:image:src" content="https://skywalking.apache.org/images/skywalking_400x400.png">
<meta property="og:image" content="https://skywalking.apache.org/images/skywalking_400x400.png">

<meta name="generator" content="Hugo 0.80.0" />


<script async src="https://www.googletagmanager.com/gtag/js?id=G-GR8N6PGRJ3"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);};
  gtag('js', new Date());gtag('config', 'G-GR8N6PGRJ3');
</script>
<META NAME="ROBOTS" CONTENT="INDEX, FOLLOW">
<link rel="stylesheet" href="//at.alicdn.com/t/c/font_3007530_pvozs1rz2wn.css">



<link rel="apple-touch-icon" sizes="180x180" href="/favicons/apple-touch-icon.png">
<link rel="icon" type="image/png" sizes="32x32" href="/favicons/favicon-32x32.png">
<link rel="icon" type="image/png" sizes="16x16" href="/favicons/favicon-16x16.png">
<link rel="manifest" href="/favicons/site.webmanifest">
<link rel="mask-icon" href="/favicons/safari-pinned-tab.svg" color="#5bbad5">
<meta name="msapplication-TileColor" content="#da532c">
<meta name="theme-color" content="#ffffff">

<title>Monitoring DynamoDB with SkyWalking | Apache SkyWalking</title><meta property="og:title" content="Monitoring DynamoDB with SkyWalking" />
<meta property="og:description" content="This article shows how to use SkyWalking to monitor DynamoDB." />
<meta property="og:type" content="article" />
<meta property="og:url" content="/blog/2023-03-13-skywalking-aws-dynamodb/" />
<meta property="article:published_time" content="2023-03-13T00:00:00+00:00" />
<meta property="article:modified_time" content="2024-03-22T00:20:00+00:00" />
<meta itemprop="name" content="Monitoring DynamoDB with SkyWalking">
<meta itemprop="description" content="This article shows how to use SkyWalking to monitor DynamoDB.">
<meta itemprop="datePublished" content="2023-03-13T00:00:00+00:00" />
<meta itemprop="dateModified" content="2024-03-22T00:20:00+00:00" />
<meta itemprop="wordCount" content="1826">



<meta itemprop="keywords" content="" />
<meta name="twitter:card" content="summary"/>
<meta name="twitter:title" content="Monitoring DynamoDB with SkyWalking"/>
<meta name="twitter:description" content="This article shows how to use SkyWalking to monitor DynamoDB."/>



<link rel="preload" href="/scss/main.min.592235942cb3c9f3dd697382a4e7a1fad8e1c182dad2841bdce6b43b4a346ae8.css" as="style">
<link href="/scss/main.min.592235942cb3c9f3dd697382a4e7a1fad8e1c182dad2841bdce6b43b4a346ae8.css" rel="stylesheet" integrity="">



<link rel="stylesheet" href="/css/docSearch.css" />


<script src="/js/jquery-3.6.0.min.js"></script>





    <title>Monitoring DynamoDB with SkyWalking | Apache SkyWalking</title>
  </head>
  <body class="td-page td-blog">
    <header>
      
<nav class="js-navbar-scroll navbar navbar-expand  flex-column flex-md-row td-navbar">
    <div class="sidebar-button">
      <i class="iconfont icon-menu"></i>
    </div>
    <a class="navbar-brand" href="/">
        <span class="navbar-logo"><img width="130" src="/images/logo.svg" alt="SkyWalking"></span> 
    </a>
    <div class="td-navbar-nav-scroll navbar-nav-wrapper" id="navigation">
        <ul class="navbar-nav mt-lg-0">
             
            
            
            <li class="nav-item mr-3 mb-lg-0">
				
				
				
				
				<a class="nav-link" href="/docs" ><span>Projects and Docs</span></a>
			</li>
            
            
            
            
            <li class="nav-item mr-3 mb-lg-0">
				
				
				
				
				<a class="nav-link" href="/events" ><span>Events</span></a>
			</li>
            
            
            
            
            <li class="nav-item mr-3 mb-lg-0">
				
				
				
				
				<a class="nav-link" href="/blog" ><span>Blogs</span></a>
			</li>
            
            
            
            
            <li class="nav-item mr-3 mb-lg-0">
				
				
				
				
				<a class="nav-link" href="/downloads" ><span>Downloads</span></a>
			</li>
            
            
            
            
            <li class="nav-item mr-3 mb-lg-0">
				
				
				
				
				<a class="nav-link" href="/team" ><span>Team</span></a>
			</li>
            
            
            
            
            <li class="nav-item mr-3 mb-lg-0">
				
				
				
				
				<a class="nav-link" href="/users" ><span>Users</span></a>
			</li>
            
            
            
            
            
            <li class="nav-item mr-3 mb-lg-0">
                <span class="link dropdown blog">
                    <a class="link-name nav-link dropdown-toggle" href="#" role="button" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">中文资料</a>
                    <div class="dropdown-menu">
                        <a class="dropdown-item" href="/zh/">博客</a>
                        <a class="dropdown-item" href="https://space.bilibili.com/390683219" target="_blank" rel="noopener noreferrer">
                            B站
                        </a>
                        <a class="dropdown-item" href="https://juejin.cn/user/13673577331607" target="_blank" rel="noopener noreferrer">
                            掘金
                        </a>
                    </div>
                </span>
            </li>

            
			
        </ul>
    </div>
    <div class="navbar-nav d-none d-lg-block search-input-box">
         
            
        
            
        
            
        
            
        
            
        
            
        
            
            <span class="link dropdown">
                <a class="link-name dropdown-toggle" href="#" role="button" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
                    Links
                </a>
                <div class="dropdown-menu">
                    
                    <a class="dropdown-item" href="http://www.apache.org/">Apache Software Foundation</a> 
                    <a class="dropdown-item" href="https://github.com/apache/skywalking/issues">GitHub Issue Tracker</a> 
                    <a class="dropdown-item" href="https://github.com/apache/skywalking/discussions">Discussion</a> 
                    <a class="dropdown-item" href="https://lists.apache.org/list.html?dev@skywalking.apache.org">Dev Mailing List</a> 
                    <a class="dropdown-item" href="https://cwiki.apache.org/confluence/display/SKYWALKING/Home">WIKI</a> 
                    <a class="dropdown-item" href="http://www.apache.org/licenses/">License</a> 
                    <a class="dropdown-item" href="http://www.apache.org/events/current-event">Apache Events</a> 
                    <a class="dropdown-item" href="http://www.apache.org/security/">Security</a> 
                    <a class="dropdown-item" href="http://www.apache.org/foundation/sponsorship.html">Sponsor and Donate</a> 
                    <a class="dropdown-item" href="http://www.apache.org/foundation/thanks.html">Thanks</a> 
                    <a class="dropdown-item" href="https://apache.org/foundation/policies/privacy.html">Privacy</a> 
                </div>
            </span>
            
        
        
<div id="docsearch"></div>


    </div>
</nav>

    </header>
    <div class="container-fluid td-outer">
      <div class="td-main">
        <div class="row container container-center">

          <main class="col-12 col-md-12 col-xl-10 pl-md-4 pr-md-4" role="main">
            
<div class="td-content">
	<h1>Monitoring DynamoDB with SkyWalking</h1>
	<div class="lead">This article shows how to use SkyWalking to monitor DynamoDB.</div>
	<div class="td-byline mb-4">
		By <b>Yueqin Zhang</b> |
		<time datetime="2023-03-13" class="text-muted">Monday, March 13, 2023</time>


		


	</div>
	<p><img src="./icon.png" alt="icon.png"></p>
<h2 id="background">Background</h2>
<p><a href="https://skywalking.apache.org/">Apache SkyWalking</a> is an open-source application performance management system that helps users collect and aggregate logs, traces, metrics, and events, and display them on the UI. Starting from OAP 9.4.0, SkyWalking has added <a href="https://skywalking.apache.org/docs/main/next/en/setup/backend/aws-firehose-receiver/">AWS Firehose receiver</a>, which is used to receive and calculate the data of CloudWatch metrics. In this article, we will take DynamoDB as an example to show how to use SkyWalking to receive and calculate CloudWatch metrics data for monitoring Amazon Web Services.</p>
<h2 id="what-are-amazon-cloudwatch-and-amazon-kinesis-data-firehose">What are Amazon CloudWatch and Amazon Kinesis Data Firehose？</h2>
<p><a href="https://aws.amazon.com/cloudwatch/">Amazon CloudWatch</a> is a metrics repository, this tool can collect raw data from AWS (e.g. DynamoDB) and process it into readable metrics in near real-time. Also, we can use <strong>Metric Stream</strong> to continuously stream CloudWatch metrics to a selected target location for near real-time delivery and low latency. SkyWalking takes advantage of this feature to create metric streams and direct them to Amazon Kinesis Data Firehose transport streams for further transport processing.</p>
<p><a href="https://aws.amazon.com/kinesis/data-firehose/">Amazon Kinesis Data Firehose</a>is an extract, transform, and load (ETL) service that reliably captures, transforms, and delivers streaming data to data lakes, data stores, and analytics services. SkyWalking takes advantage of this feature to eventually direct the metrics stream to the aws-firehose-receiver for OAP to calculate and ultimately display the metrics.</p>
<p>The flow chart is as follows.</p>
<p><img src="./aws-service.png" alt="aws-service.png"></p>
<h6 id="notice">Notice</h6>
<ul>
<li>Due to Kinesis Data Firehose specifications, the URL of the HTTP endpoint must use the HTTPS protocol and must use port 443. Also, this URL must be proxied by Gateway and forwarded to the real aws-firehose-receiver.</li>
<li>The TLS certificate must be signed by a CA and the self-signed certificate will not be trusted by Kinesis Data Firehose.</li>
</ul>
<h2 id="setting-up-dynamodb-monitoring">Setting up DynamoDB monitoring</h2>
<p>Next, let&rsquo;s take DynamoDB as an example to illustrate the necessary settings in aws before using OAP to collect CloudWatch metrics:</p>
<ol>
<li>Go to <a href="https://console.aws.amazon.com/kinesis/home">Kinesis Console</a>, create a data stream, and select <code>Direct PUT</code> for <code>Source</code> and <code>HTTP Endpoint</code> for <code>Destination</code>. And set <code>HTTP Endpoint URL</code> to <code>Gateway URL</code>. The rest of the configuration options can be configured as needed.</li>
</ol>
<p><img src="./kinesis.png" alt="image.png"></p>
<ol start="2">
<li>Go to the <a href="https://console.aws.amazon.com/cloudwatch/home">CloudWatch Console</a>, select <code>Metrics-Stream</code> in the left control panel, and click Create metric stream. Select <code>AWS/DynamoDB</code> for <code>namespace</code>. Also, you can add other namespaces as needed. <code>Kinesis Data Firehose</code> selects the data stream created in the first step. Finally, set the output format to opentelemetry0.7. The rest of the configuration options can be configured as needed.</li>
</ol>
<p><img src="./cloudwatch.png" alt="cloudwatch.png"></p>
<p>At this point, the AWS side of DynamoDB monitoring configuration is set up.</p>
<h2 id="skywalking-oap-metrics-processing-analysis">SkyWalking OAP metrics processing analysis</h2>
<p>SkyWalking uses aws-firehose-receiver to receive and decode AWS metrics streams forwarded by Gateway, and send it to <a href="https://github.com/apache/skywalking/tree/master/oap-server/server-receiver-plugin/otel-receiver-plugin">Opentelemetry-receiver</a> for processing and transforming into SkyWalking metrics. Then, the metrics are analyzed and aggregated by <a href="https://skywalking.apache.org/docs/main/next/en/concepts-and-designs/mal/">Meter Analysis Language (MAL)</a> and finally presented on the UI.</p>
<p>The MAL part and the UI part of SkyWalking support users' customization, to display the metrics data in a more diversified way. For details, please refer to <a href="https://skywalking.apache.org/docs/main/next/en/concepts-and-designs/mal/">MAL doc</a> and <a href="https://skywalking.apache.org/docs/main/next/en/ui/readme/">UI doc</a>.</p>
<p><img src="./gateway_to_ui.png" alt="gateway_to_ui.png"></p>
<h2 id="typical-metrics-analysis">Typical metrics analysis</h2>
<h3 id="scope">Scope</h3>
<p>In SkyWalking, there is the concept of scope. By using scopes, we can classify and aggregate metrics more rationally. In the monitoring of DynamoDB, two of these scopes are used - Service and Endpoint.</p>
<p>Service represents a set of workloads that provide the same behavior for incoming requests. Commonly used as cluster-level scopes for services, user accounts are closer to the concept of clusters in AWS. So SkyWalking uses AWS account id as a key to map AWS accounts to Service types.</p>
<p>Similarly, Endpoint represents a logical concept, often used in services for the path of incoming requests, such as HTTP URI path or gRPC service class + method signature, and can also represent the table structure in the database. So SkyWalking maps DynamoDB tables to Endpoint type.</p>
<h3 id="metrics">Metrics</h3>
<table>
<thead>
<tr>
<th>Metric Name</th>
<th>Meaning</th>
</tr>
</thead>
<tbody>
<tr>
<td>AccountMaxReads / AccountMaxWrites</td>
<td>The maximum number of read/write capacity units that can be used by an account.</td>
</tr>
<tr>
<td>AccountMaxTableLevelReads / AccountMaxTableLevelWrites</td>
<td>The maximum number of read/write capacity units that can be used by a table or global secondary index of an account.</td>
</tr>
<tr>
<td>AccountProvisionedReadCapacityUtilization / AccountProvisionedWriteCapacityUtilization</td>
<td>The percentage of provisioned read/write capacity units utilized by an account.</td>
</tr>
<tr>
<td>MaxProvisionedTableReadCapacityUtilization / MaxProvisionedTableWriteCapacityUtilization</td>
<td>The percentage of provisioned read/write capacity utilized by the highest provisioned read table or global secondary index of an account.</td>
</tr>
</tbody>
</table>
<p>Above are some common account metrics (Serivce scope). They are various configuration information in DynamoDB, and SkyWalking can show a complete picture of the database configuration changes by monitoring these metrics.</p>
<table>
<thead>
<tr>
<th>Metric Name</th>
<th>Meaning</th>
</tr>
</thead>
<tbody>
<tr>
<td>ConsumedReadCapacityUnits / ConsumedWriteCapacityUnits</td>
<td>The number of read/write capacity units consumed over the specified time period.</td>
</tr>
<tr>
<td>ReturnedItemCount</td>
<td>The number of items returned by Query, Scan or ExecuteStatement (select) operations during the specified time period.</td>
</tr>
<tr>
<td>SuccessfulRequestLatency</td>
<td>The latency of successful requests to DynamoDB or Amazon DynamoDB Streams during the specified time period.</td>
</tr>
<tr>
<td>TimeToLiveDeletedItemCount</td>
<td>The number of items deleted by Time to Live (TTL) during the specified time period.</td>
</tr>
</tbody>
</table>
<p>The above are some common table metrics (Endpoint scope), which will also be aggregated into account metrics. These metrics are generally used to analyze the performance of the database, and users can use them to determine the reasonable level of database configuration. For example, users can track how much of their provisioned throughput is used through ConsumedReadCapicityUnits / ConsumedReadCapicityUnits to determine the reasonableness of the preconfigured throughput of a table or account. For more information about provisioned throughput, see <a href="https://docs.aws.amazon.com/amazondynamodb/latest/developerguide/ProvisionedThroughputIntro.html">Provisioned Throughput Intro</a>.</p>
<table>
<thead>
<tr>
<th>Metric Name</th>
<th>Meaning</th>
</tr>
</thead>
<tbody>
<tr>
<td>UserErrors</td>
<td>Requests to DynamoDB or Amazon DynamoDB Streams that generate an HTTP 400 status code during the specified time period.</td>
</tr>
<tr>
<td>SystemErrors</td>
<td>The requests to DynamoDB or Amazon DynamoDB Streams that generate an HTTP 500 status code during the specified time period.</td>
</tr>
<tr>
<td>ThrottledRequests</td>
<td>Requests to DynamoDB that exceed the provisioned throughput limits on a resource.</td>
</tr>
<tr>
<td>TransactionConflict</td>
<td>Rejected item-level requests due to transactional conflicts between concurrent requests on the same items.</td>
</tr>
</tbody>
</table>
<p>The above are some common error metrics, among which UserErrors are account-level metrics and the rest are table-level metrics. Users can set alarms on these metrics, and if warnings appear, then it may indicate that there are some problems with the use of the database, and users need to check and verify by themselves.</p>
<h3 id="notice-1">Notice</h3>
<p>SkyWalking&rsquo;s metrics selection for DynamoDB comes directly from CloudWatch metrics, which can also be found at <a href="https://docs.aws.amazon.com/amazondynamodb/latest/developerguide/metrics-dimensions.html">CloudWatch metrics doc</a> to get metrics details.</p>
<h2 id="demo">Demo</h2>
<p>In this section, we will demonstrate how to use terraform to create a DynamoDB table and other AWS services that can generate metrics streams, and deploy Skywalking to complete the metrics collection.</p>
<p>First, you need a running gateway instance, such as <a href="https://www.nginx.com/">NGINX</a>, which is responsible for receiving metrics streams from AWS and forwarding them to the aws-firehose-receiver. Note that the gateway needs to be configured with certificates to accept HTTPS protocol requests.</p>
<p>Below is an example configuration for NGINX. The configuration does not need to be identical, as long as it can send incoming HTTPS requests to <code>oap host:12801/aws/firehose/metrics</code>.</p>
<pre><code>server {
        listen       443 ssl;
        
        ssl_certificate     /crt/test.pem;
        ssl_certificate_key  /crt/test.key; 
        
        ssl_session_timeout  5m;   
        ssl_ciphers ECDHE-RSA-AES128-GCM-SHA256:ECDHE:ECDH:AES:HIGH:!NULL:!aNULL:!MD5:!ADH:!RC4; 
        ssl_protocols TLSv1 TLSv1.1 TLSv1.2;  
        ssl_prefer_server_ciphers on; 
    
        location /aws/firehose/metrics {
            proxy_pass http://test.xyz:12801/aws/firehose/metrics;
        }
    }
</code></pre><h3 id="deploying-skywalking">Deploying SkyWalking</h3>
<p>There are various ways to deploy SkyWalking, and you can get them directly from the <a href="https://github.com/apache/skywalking/releases/tag/v9.4.0">release page</a>.</p>
<p>Of course, if you are more comfortable with Kubernetes, you can also find the appropriate deployment method from <a href="https://github.com/apache/skywalking-kubernetes">SkyWalking-kubernetes</a>.</p>
<p>Please note that no matter which deployment method you use, please make sure that the OAP and UI version is 9.4.0 or higher and that port 12801 needs to be open.</p>
<p>The following is an example of a deployment using the helm command.</p>
<pre><code>export SKYWALKING_RELEASE_VERSION=4.3.0 
export SKYWALKING_RELEASE_NAME=skywalking  
export SKYWALKING_RELEASE_NAMESPACE=default

helm install &quot;${SKYWALKING_RELEASE_NAME}&quot; \
  oci://registry-1.docker.io/apache/skywalking-helm \
  --version &quot;${SKYWALKING_RELEASE_VERSION}&quot; \
  -n &quot;${SKYWALKING_RELEASE_NAMESPACE}&quot; \
  --set oap.image.tag=9.4.0 \
  --set oap.storageType=elasticsearch \
  --set ui.image.tag=9.4.0 \
  --set oap.ports.firehose=12801
</code></pre><h3 id="start-the-corresponding-aws-service">Start the corresponding AWS service</h3>
<p>The terraform configuration file is as follows (example modified in<a href="https://registry.terraform.io/providers/hashicorp/aws/latest/docs/resources/kinesis_firehose_delivery_stream">Terraform Registry - kinesis_firehose_delivery_stream</a>）：</p>
<details>
<summary>terraform configuration file </summary>
<pre><code>provider &quot;aws&quot; {
  region = &quot;ap-northeast-1&quot;
  access_key = &quot;[need change]your access_key&quot;
  secret_key = &quot;[need change]your secret_key&quot;
}
resource &quot;aws_dynamodb_table&quot; &quot;basic-dynamodb-table&quot; {
  name           = &quot;GameScores&quot;
  billing_mode   = &quot;PROVISIONED&quot;
  read_capacity  = 20
  write_capacity = 20
  hash_key       = &quot;UserId&quot;
  range_key      = &quot;GameTitle&quot;

  attribute {
    name = &quot;UserId&quot;
    type = &quot;S&quot;
  }

  attribute {
    name = &quot;GameTitle&quot;
    type = &quot;S&quot;
  }

  attribute {
    name = &quot;TopScore&quot;
    type = &quot;N&quot;
  }

  ttl {
    attribute_name = &quot;TimeToExist&quot;
    enabled        = true
  }

  global_secondary_index {
    name               = &quot;GameTitleIndex&quot;
    hash_key           = &quot;GameTitle&quot;
    range_key          = &quot;TopScore&quot;
    write_capacity     = 10
    read_capacity      = 10
    projection_type    = &quot;INCLUDE&quot;
    non_key_attributes = [&quot;UserId&quot;]
  }

  tags = {
    Name        = &quot;dynamodb-table-1&quot;
    Environment = &quot;production&quot;
  }
}

resource &quot;aws_cloudwatch_metric_stream&quot; &quot;main&quot; {
  name          = &quot;my-metric-stream&quot;
  role_arn      = aws_iam_role.metric_stream_to_firehose.arn
  firehose_arn  = aws_kinesis_firehose_delivery_stream.http_stream.arn
  output_format = &quot;opentelemetry0.7&quot;

  include_filter {
    namespace = &quot;AWS/DynamoDB&quot;
  }
}

# https://docs.aws.amazon.com/AmazonCloudWatch/latest/monitoring/CloudWatch-metric-streams-trustpolicy.html
data &quot;aws_iam_policy_document&quot; &quot;streams_assume_role&quot; {
  statement {
    effect = &quot;Allow&quot;

    principals {
      type        = &quot;Service&quot;
      identifiers = [&quot;streams.metrics.cloudwatch.amazonaws.com&quot;]
    }

    actions = [&quot;sts:AssumeRole&quot;]
  }
}

resource &quot;aws_iam_role&quot; &quot;metric_stream_to_firehose&quot; {
  name               = &quot;metric_stream_to_firehose_role&quot;
  assume_role_policy = data.aws_iam_policy_document.streams_assume_role.json
}

# https://docs.aws.amazon.com/AmazonCloudWatch/latest/monitoring/CloudWatch-metric-streams-trustpolicy.html
data &quot;aws_iam_policy_document&quot; &quot;metric_stream_to_firehose&quot; {
  statement {
    effect = &quot;Allow&quot;

    actions = [
      &quot;firehose:PutRecord&quot;,
      &quot;firehose:PutRecordBatch&quot;,
    ]

    resources = [aws_kinesis_firehose_delivery_stream.http_stream.arn]
  }
}
resource &quot;aws_iam_role_policy&quot; &quot;metric_stream_to_firehose&quot; {
  name   = &quot;default&quot;
  role   = aws_iam_role.metric_stream_to_firehose.id
  policy = data.aws_iam_policy_document.metric_stream_to_firehose.json
}

resource &quot;aws_s3_bucket&quot; &quot;bucket&quot; {
  bucket = &quot;metric-stream-test-bucket&quot;
}

resource &quot;aws_s3_bucket_acl&quot; &quot;bucket_acl&quot; {
  bucket = aws_s3_bucket.bucket.id
  acl    = &quot;private&quot;
}

data &quot;aws_iam_policy_document&quot; &quot;firehose_assume_role&quot; {
  statement {
    effect = &quot;Allow&quot;

    principals {
      type        = &quot;Service&quot;
      identifiers = [&quot;firehose.amazonaws.com&quot;]
    }

    actions = [&quot;sts:AssumeRole&quot;]
  }
}

resource &quot;aws_iam_role&quot; &quot;firehose_to_s3&quot; {
  assume_role_policy = data.aws_iam_policy_document.firehose_assume_role.json
}

data &quot;aws_iam_policy_document&quot; &quot;firehose_to_s3&quot; {
  statement {
    effect = &quot;Allow&quot;

    actions = [
      &quot;s3:AbortMultipartUpload&quot;,
      &quot;s3:GetBucketLocation&quot;,
      &quot;s3:GetObject&quot;,
      &quot;s3:ListBucket&quot;,
      &quot;s3:ListBucketMultipartUploads&quot;,
      &quot;s3:PutObject&quot;,
    ]

    resources = [
      aws_s3_bucket.bucket.arn,
      &quot;${aws_s3_bucket.bucket.arn}/*&quot;,
    ]
  }
}

resource &quot;aws_iam_role_policy&quot; &quot;firehose_to_s3&quot; {
  name   = &quot;default&quot;
  role   = aws_iam_role.firehose_to_s3.id
  policy = data.aws_iam_policy_document.firehose_to_s3.json
}

resource &quot;aws_kinesis_firehose_delivery_stream&quot; &quot;http_stream&quot; {
  name        = &quot;metric-stream-test-stream&quot;
  destination = &quot;http_endpoint&quot;

  http_endpoint_configuration {
    name       = &quot;test_http_endpoint&quot;
    url        = &quot;[need change]Gateway url&quot;
    role_arn   = aws_iam_role.firehose_to_s3.arn
  }
  s3_configuration {
    role_arn   = aws_iam_role.firehose_to_s3.arn
    bucket_arn = aws_s3_bucket.bucket.arn
  }
}
</code></pre></details>
<p>Steps to use.</p>
<ol>
<li>
<p>Get the access_key and secret_key of the AWS account.( For how to get them, please refer to <a href="https://aws.amazon.com/premiumsupport/knowledge-center/create-access-key/">create-access-key</a> )</p>
</li>
<li>
<p>Fill in the access_key and secret_key you got in the previous step, and fill in the corresponding URL of your gateway in the corresponding location of <code>aws_kinesis_firehose_delivery_stream</code> configuration.</p>
</li>
<li>
<p>Copy the above content and save it to the main.tf file.</p>
</li>
<li>
<p>Execute the following code in the corresponding path.</p>
</li>
</ol>
<pre><code>terraform init
terraform apply
</code></pre><p>At this point, all the required AWS services have been successfully created, and you can check your console to see if the services were successfully created.</p>
<h3 id="done">Done!</h3>
<p>If all the above steps were successful, please wait for about five minutes. After that, you can visit the SkyWalking UI to see the metrics.</p>
<p>Currently, the metrics collected by SkyWalking by default are displayed as follows.</p>
<p><strong>account metrics:</strong></p>
<p><img src="./service.png" alt="service.png"></p>
<p><strong>table metrics：</strong></p>
<p><img src="./endpoint.png" alt="endpoint.png"></p>
<h3 id="other-services">Other services</h3>
<p>Currently, SkyWalking officially supports EKS, S3, DynamoDB monitoring. Users also refer to <a href="https://skywalking.apache.org/docs/main/next/en/setup/backend/opentelemetry-receiver/">the OpenTelemetry receiver</a> to configure OTel rules to collect and analyze CloudWatch metrics of other AWS services and display them through <a href="https://skywalking.apache.org/docs/main/next/en/ui/readme/">a custom dashboard</a>.</p>
<h3 id="material">Material</h3>
<ul>
<li><a href="https://docs.aws.amazon.com/AmazonS3/latest/userguide/cloudwatch-monitoring.html">Monitoring S3 metrics with Amazon CloudWatch</a></li>
<li><a href="https://docs.aws.amazon.com/amazondynamodb/latest/developerguide/monitoring-cloudwatch.html">Monitoring DynamoDB metrics with Amazon CloudWatch</a></li>
<li><a href="https://skywalking.apache.org/docs/main/next/en/setup/backend/aws-firehose-receiver/">Supported metrics in AWS Firehose receiver of OAP</a></li>
<li><a href="https://skywalking.apache.org/docs/main/next/en/setup/backend/configuration-vocabulary/">Configuration Vocabulary | Apache SkyWalking</a></li>
</ul>

	

	<ul class="list-unstyled d-flex justify-content-between align-items-center mb-0 pt-5">
  <li>
    <a href="/blog/2023-03-12-skywalking-aws-s3-eks/" class="btn btn-primary "><span class="mr-1">←</span> Previous</a>
  </li>
    <a href="/blog/2023-03-17-build-grafana-dashboards-for-apache-skywalking-native-promql-support/" class="btn btn-primary ">Next <span class="ml-1">→</span></a>
  </li>
</ul>

</div>


          </main>
          <div class="d-none d-xl-block col-xl-2 td-toc d-print-none">

            <div class="tags-wrapper">
    <div class="font-weight-bold post-meta ">
        <i class="iconfont icon-tags pr-1" aria-hidden="true"></i>
        Tags
    </div>
    <ul class="tags-box">
        
        <li>
            <a href="/tags/agent/" class="tag-link">Agent</a>
            <span class="count">10</span>
        </li>
        
        <li>
            <a href="/tags/apache-shenyu-incubating/" class="tag-link">Apache ShenYu (incubating)</a>
            <span class="count">1</span>
        </li>
        
        <li>
            <a href="/tags/apisix/" class="tag-link">APISIX</a>
            <span class="count">1</span>
        </li>
        
        <li>
            <a href="/tags/apm/" class="tag-link">APM</a>
            <span class="count">1</span>
        </li>
        
        <li>
            <a href="/tags/arthas/" class="tag-link">Arthas</a>
            <span class="count">1</span>
        </li>
        
        <li>
            <a href="/tags/aurora/" class="tag-link">Aurora</a>
            <span class="count">2</span>
        </li>
        
        <li>
            <a href="/tags/aws/" class="tag-link">AWS</a>
            <span class="count">2</span>
        </li>
        
        <li>
            <a href="/tags/browser/" class="tag-link">Browser</a>
            <span class="count">1</span>
        </li>
        
        <li>
            <a href="/tags/chaos-engineering/" class="tag-link">Chaos Engineering</a>
            <span class="count">1</span>
        </li>
        
        <li>
            <a href="/tags/chaos-mesh/" class="tag-link">Chaos Mesh</a>
            <span class="count">1</span>
        </li>
        
        <li>
            <a href="/tags/clickhouse/" class="tag-link">ClickHouse</a>
            <span class="count">2</span>
        </li>
        
        <li>
            <a href="/tags/conference/" class="tag-link">Conference</a>
            <span class="count">6</span>
        </li>
        
        <li>
            <a href="/tags/database/" class="tag-link">Database</a>
            <span class="count">1</span>
        </li>
        
        <li>
            <a href="/tags/demo/" class="tag-link">Demo</a>
            <span class="count">3</span>
        </li>
        
        <li>
            <a href="/tags/design/" class="tag-link">Design</a>
            <span class="count">2</span>
        </li>
        
        <li>
            <a href="/tags/dotnetcore/" class="tag-link">DotNetCore</a>
            <span class="count">1</span>
        </li>
        
        <li>
            <a href="/tags/ebpf/" class="tag-link">eBPF</a>
            <span class="count">6</span>
        </li>
        
        <li>
            <a href="/tags/golang/" class="tag-link">Golang</a>
            <span class="count">5</span>
        </li>
        
        <li>
            <a href="/tags/grafana/" class="tag-link">Grafana</a>
            <span class="count">2</span>
        </li>
        
        <li>
            <a href="/tags/http/" class="tag-link">HTTP</a>
            <span class="count">2</span>
        </li>
        
        <li>
            <a href="/tags/infrastructure-monitoring/" class="tag-link">Infrastructure Monitoring</a>
            <span class="count">1</span>
        </li>
        
        <li>
            <a href="/tags/iotdb/" class="tag-link">IoTDB</a>
            <span class="count">2</span>
        </li>
        
        <li>
            <a href="/tags/istio/" class="tag-link">Istio</a>
            <span class="count">2</span>
        </li>
        
        <li>
            <a href="/tags/java/" class="tag-link">Java</a>
            <span class="count">2</span>
        </li>
        
        <li>
            <a href="/tags/kafka/" class="tag-link">Kafka</a>
            <span class="count">1</span>
        </li>
        
        <li>
            <a href="/tags/kong/" class="tag-link">Kong</a>
            <span class="count">1</span>
        </li>
        
        <li>
            <a href="/tags/lal/" class="tag-link">LAL</a>
            <span class="count">1</span>
        </li>
        
        <li>
            <a href="/tags/license/" class="tag-link">License</a>
            <span class="count">5</span>
        </li>
        
        <li>
            <a href="/tags/logging/" class="tag-link">Logging</a>
            <span class="count">3</span>
        </li>
        
        <li>
            <a href="/tags/logs/" class="tag-link">Logs</a>
            <span class="count">2</span>
        </li>
        
        <li>
            <a href="/tags/metric/" class="tag-link">Metric</a>
            <span class="count">6</span>
        </li>
        
        <li>
            <a href="/tags/metrics/" class="tag-link">Metrics</a>
            <span class="count">2</span>
        </li>
        
        <li>
            <a href="/tags/nginx/" class="tag-link">Nginx</a>
            <span class="count">5</span>
        </li>
        
        <li>
            <a href="/tags/observability/" class="tag-link">Observability</a>
            <span class="count">10</span>
        </li>
        
        <li>
            <a href="/tags/ospp/" class="tag-link">OSPP</a>
            <span class="count">1</span>
        </li>
        
        <li>
            <a href="/tags/performance/" class="tag-link">Performance</a>
            <span class="count">3</span>
        </li>
        
        <li>
            <a href="/tags/profiling/" class="tag-link">Profiling</a>
            <span class="count">5</span>
        </li>
        
        <li>
            <a href="/tags/promql/" class="tag-link">PromQL</a>
            <span class="count">2</span>
        </li>
        
        <li>
            <a href="/tags/python/" class="tag-link">Python</a>
            <span class="count">1</span>
        </li>
        
        <li>
            <a href="/tags/rds/" class="tag-link">RDS</a>
            <span class="count">2</span>
        </li>
        
        <li>
            <a href="/tags/release-blog/" class="tag-link">Release Blog</a>
            <span class="count">4</span>
        </li>
        
        <li>
            <a href="/tags/rocketmq/" class="tag-link">RocketMQ</a>
            <span class="count">1</span>
        </li>
        
        <li>
            <a href="/tags/satellite/" class="tag-link">Satellite</a>
            <span class="count">1</span>
        </li>
        
        <li>
            <a href="/tags/service-mesh/" class="tag-link">Service Mesh</a>
            <span class="count">6</span>
        </li>
        
        <li>
            <a href="/tags/sharding-sphere/" class="tag-link">Sharding-Sphere</a>
            <span class="count">1</span>
        </li>
        
        <li>
            <a href="/tags/sharding-sphere-proxy/" class="tag-link">Sharding-Sphere-proxy</a>
            <span class="count">1</span>
        </li>
        
        <li>
            <a href="/tags/skywalking/" class="tag-link">SkyWalking</a>
            <span class="count">5</span>
        </li>
        
        <li>
            <a href="/tags/spring/" class="tag-link">Spring</a>
            <span class="count">1</span>
        </li>
        
        <li>
            <a href="/tags/storage/" class="tag-link">Storage</a>
            <span class="count">2</span>
        </li>
        
        <li>
            <a href="/tags/testing/" class="tag-link">Testing</a>
            <span class="count">3</span>
        </li>
        
        <li>
            <a href="/tags/trace/" class="tag-link">Trace</a>
            <span class="count">4</span>
        </li>
        
        <li>
            <a href="/tags/tracing/" class="tag-link">Tracing</a>
            <span class="count">10</span>
        </li>
        
        <li>
            <a href="/tags/tutorial/" class="tag-link">Tutorial</a>
            <span class="count">1</span>
        </li>
        
        <li>
            <a href="/tags/user-manual/" class="tag-link">User Manual</a>
            <span class="count">2</span>
        </li>
        
        <li>
            <a href="/tags/video/" class="tag-link">Video</a>
            <span class="count">8</span>
        </li>
        
        <li>
            <a href="/tags/web-performance/" class="tag-link">Web-performance</a>
            <span class="count">1</span>
        </li>
        
    </ul>
</div>



            




<div class="td-page-meta ml-2 pb-1 pt-2 mb-0">











</div>






<nav id="TableOfContents">
  <ul>
    <li>
      <ul>
        <li><a href="#background">Background</a></li>
        <li><a href="#what-are-amazon-cloudwatch-and-amazon-kinesis-data-firehose">What are Amazon CloudWatch and Amazon Kinesis Data Firehose？</a>
          <ul>
            <li></li>
          </ul>
        </li>
        <li><a href="#setting-up-dynamodb-monitoring">Setting up DynamoDB monitoring</a></li>
        <li><a href="#skywalking-oap-metrics-processing-analysis">SkyWalking OAP metrics processing analysis</a></li>
        <li><a href="#typical-metrics-analysis">Typical metrics analysis</a>
          <ul>
            <li><a href="#scope">Scope</a></li>
            <li><a href="#metrics">Metrics</a></li>
            <li><a href="#notice-1">Notice</a></li>
          </ul>
        </li>
        <li><a href="#demo">Demo</a>
          <ul>
            <li><a href="#deploying-skywalking">Deploying SkyWalking</a></li>
            <li><a href="#start-the-corresponding-aws-service">Start the corresponding AWS service</a></li>
            <li><a href="#done">Done!</a></li>
            <li><a href="#other-services">Other services</a></li>
            <li><a href="#material">Material</a></li>
          </ul>
        </li>
      </ul>
    </li>
  </ul>
</nav>




<script>
  $(function () {
    var $toc = $("#TableOfContents");
    if (!$toc || !$toc.length) {
      return;
    }
    var top = $toc.offset().top;
    $(window).on("scroll", debounce(setTop, 100))
    $(window).on("scroll", debounce(addActive, 30))

    function addActive() {
      var scrollValue = $(window).scrollTop();
      var topEle = null;
      $.each($('main h1, main h2, main h3'), function (index, item) {
        if ($(item).offset().top - 70 > scrollValue) {
          return
        }
        if (!topEle) {
          topEle = item
        } else if ($(item).offset().top >= $(topEle).offset().top) {
          topEle = item
        }
        if (topEle) {
          var id = $(item).attr('id');
          $toc.find('a').removeClass("active").end().find('a[href="' + '#' + id + '"]').addClass("active")
        }
      })
    }

    function setTop() {
      var scrollValue = $(window).scrollTop();
      if (scrollValue >= top - 70) {
        $toc.addClass('fixed')
      } else {
        $toc.removeClass('fixed')
      }
    }

    function debounce(fn, wait) {
      var timeout = null;
      return function () {
        clearTimeout(timeout);
        timeout = setTimeout(() => {
          fn.apply(this, arguments);
        }, wait);
      };
    }
  })

</script>

          </div>
        </div>
      </div>
      
<footer class="py-5 sky-row">
  <div class="container-fluid text-center">
    <div class="">
        
        
        
<ul class="list-inline mb-0">
  
  <li class="list-inline-item mx-2 h3" data-toggle="tooltip" data-placement="top" title="Twitter" aria-label="Twitter">
    <a class="text-color" target="_blank" href="https://twitter.com/asfskywalking">
      <i class="iconfont icon-twitter"></i>
    </a>
  </li>
  
  <li class="list-inline-item mx-2 h3" data-toggle="tooltip" data-placement="top" title="Slack" aria-label="Slack">
    <a class="text-color" target="_blank" href="http://s.apache.org/slack-invite">
      <i class="iconfont icon-slack"></i>
    </a>
  </li>
  
  <li class="list-inline-item mx-2 h3" data-toggle="tooltip" data-placement="top" title="Mailing list" aria-label="Mailing list">
    <a class="text-color" target="_blank" href="https://lists.apache.org/list.html?dev@skywalking.apache.org">
      <i class="iconfont icon-email"></i>
    </a>
  </li>
  
  <li class="list-inline-item mx-2 h3" data-toggle="tooltip" data-placement="top" title="GitHub" aria-label="GitHub">
    <a class="text-color" target="_blank" href="https://github.com/apache/skywalking">
      <i class="iconfont icon-github"></i>
    </a>
  </li>
  
</ul>

        
        
    </div>
    <div class="">

        <small class="text-color">&copy; 2017 - 2024 The Apache Software Foundation All Rights Reserved</small>
        
	
    </div>
    <div class="">
      <small class="text-color mt-4">Apache SkyWalking, SkyWalking, Apache, the Apache feather logo, and the Apache SkyWalking project logo are either registered trademarks or trademarks of the Apache Software Foundation.</small>
    </div>
  </div>
</footer>


    </div>
    















































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































    
<div id="popup">
    <div class="mask">
        <img src=""/>
    </div>
</div>

    <div class="sidebar-mask"></div>
<div class="sidebar">
    <nav class="nav-links">
        <div class="nav-item"><a href="/docs/" class="nav-link">Projects and Documentation</a></div>
        <div class="nav-item"><a href="/events/" class="nav-link">Events</a></div>
        <div class="nav-item"><a href="/blog/" class="nav-link router-link-exact-active router-link-active">Blog</a>
        </div>
        <div class="nav-item"><a href="/downloads/" class="nav-link">Downloads</a></div>
        <div class="nav-item"><a href="/team/" class="nav-link">Team</a></div>
        <div class="nav-item"><a href="/users/" class="nav-link">Users</a></div>
        <div class="nav-item">
            <div class="dropdown-wrapper open">
                <a class="dropdown-title"><span>中文资料</span>
                    <span class="arrow down"></span>
                </a>
                <ul class="nav-dropdown">
                    <li class="dropdown-item">
                        <a href="/zh/" class="nav-link external">博客</a>
                    </li>
                    <li class="dropdown-item">
                        <a href="https://space.bilibili.com/390683219" target="_blank"
                           rel="noopener noreferrer" class="nav-link external">B站</a>
                    </li>
                    <li class="dropdown-item">
                        <a href="https://juejin.cn/user/13673577331607" target="_blank"
                           rel="noopener noreferrer" class="nav-link external">掘金</a>
                    </li>
                </ul>
            </div>
        </div>
        <div class="nav-item">
            <div class="dropdown-wrapper open">
                <a class="dropdown-title">
                    <span>Links</span>
                    <span class="arrow down"></span>
                </a>
                <ul class="nav-dropdown">
                    <li class="dropdown-item">
                        <a href="http://www.apache.org/" target="_blank"
                           rel="noopener noreferrer" class="nav-link external">
                            Apache Software Foundation
                        </a>
                    </li>
                    <li class="dropdown-item">
                        <a href="https://github.com/apache/skywalking/issues"
                           target="_blank" rel="noopener noreferrer"
                           class="nav-link external">
                            GitHub Issue Tracker
                        </a>
                    </li>
                    <li class="dropdown-item">
                        <a href="https://lists.apache.org/list.html?dev@skywalking.apache.org" target="_blank"
                           rel="noopener noreferrer" class="nav-link external">
                            Dev Mailing List
                        </a>
                    </li>
                    <li class="dropdown-item">
                        <a href="http://www.apache.org/licenses/" target="_blank"
                           rel="noopener noreferrer" class="nav-link external">
                            License
                        </a>
                    </li>
                    <li class="dropdown-item">
                        <a href="http://www.apache.org/events/current-event"
                           target="_blank" rel="noopener noreferrer"
                           class="nav-link external">
                            Apache Events
                        </a>
                    </li>
                    <li class="dropdown-item">
                        <a href="http://www.apache.org/security/" target="_blank"
                           rel="noopener noreferrer" class="nav-link external">
                            Security
                        </a>
                    </li>
                    <li class="dropdown-item">
                        <a href="http://www.apache.org/foundation/sponsorship.html"
                           target="_blank" rel="noopener noreferrer"
                           class="nav-link external">
                            Sponsorship and Donate
                        </a>
                    </li>
                    <li class="dropdown-item">
                        <a href="http://www.apache.org/foundation/thanks.html"
                           target="_blank" rel="noopener noreferrer"
                           class="nav-link external">
                            Thanks
                        </a>
                    </li>
                </ul>
            </div>
        </div>
    </nav>
</div>

    <script src="/js/bootstrap.bundle.min.js"></script>

<script src="https://cdn.jsdelivr.net/npm/@docsearch/js@3"></script>









<script src="/js/main.min.dc00f5ca911ee5aa105ea6de6b3b7e8d8169ba5a3bf156b1fcfe23dfe3e62b0a.js" integrity="sha256-3AD1ypEe5aoQXqbeazt&#43;jYFpulo78Vax/P4j3&#43;PmKwo=" crossorigin="anonymous"></script>


<script src="/js/mermaid.min.js"></script>
<script>
    window.onload = () => mermaid.init(undefined, ".language-mermaid");
</script>


<script defer
src="https://widget.kapa.ai/kapa-widget.bundle.js"
data-website-id="8a08392b-9c4d-4816-8bc4-f93e0ecdd2a7"
data-project-name="SkyWalking"
data-project-color="#2B74B8"
data-button-text="Ask AI"
data-search-mode-enabled="true"
data-modal-open-on-command-k="true"
data-modal-disclaimer="The AI supports multiple languages, but it may not be accessible in China, a proxy is required."
data-project-logo="https://miro.medium.com/v2/resize:fit:2400/0*kmS-5BQ8ShAhZ_F4.jpg"
data-modal-example-questions="What is Apache SkyWalking?,How to deploy SkyWalking?,How to inject agents non-intrusively?,How to setup trace sampling?"
data-button-position-top=""
data-button-position-right="20px"
data-button-position-bottom="200px"
data-button-position-left=""
></script>




  </body>
</html>
