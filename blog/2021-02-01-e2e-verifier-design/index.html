<!doctype html>
<html lang="en" class="no-js">
  <head>
    <meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<meta name="twitter:site" content="skywalking.apache.org">
<meta name="twitter:image:src" content="https://skywalking.apache.org/images/skywalking_400x400.png">
<meta property="og:image" content="https://skywalking.apache.org/images/skywalking_400x400.png">

<meta name="generator" content="Hugo 0.80.0" />


<script async src="https://www.googletagmanager.com/gtag/js?id=G-GR8N6PGRJ3"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);};
  gtag('js', new Date());gtag('config', 'G-GR8N6PGRJ3');
</script>
<META NAME="ROBOTS" CONTENT="INDEX, FOLLOW">
<link rel="stylesheet" href="//at.alicdn.com/t/c/font_3007530_pvozs1rz2wn.css">



<link rel="apple-touch-icon" sizes="180x180" href="/favicons/apple-touch-icon.png">
<link rel="icon" type="image/png" sizes="32x32" href="/favicons/favicon-32x32.png">
<link rel="icon" type="image/png" sizes="16x16" href="/favicons/favicon-16x16.png">
<link rel="manifest" href="/favicons/site.webmanifest">
<link rel="mask-icon" href="/favicons/safari-pinned-tab.svg" color="#5bbad5">
<meta name="msapplication-TileColor" content="#da532c">
<meta name="theme-color" content="#ffffff">

<title>[Design] The Verifier of NGE2E | Apache SkyWalking</title><meta property="og:title" content="[Design] The Verifier of NGE2E" />
<meta property="og:description" content="The design of Next Generation End-to-End Testing Framework  Verifier" />
<meta property="og:type" content="article" />
<meta property="og:url" content="/blog/2021-02-01-e2e-verifier-design/" />
<meta property="article:published_time" content="2021-02-01T00:00:00+00:00" />
<meta property="article:modified_time" content="2024-03-22T00:20:00+00:00" />
<meta itemprop="name" content="[Design] The Verifier of NGE2E">
<meta itemprop="description" content="The design of Next Generation End-to-End Testing Framework  Verifier">
<meta itemprop="datePublished" content="2021-02-01T00:00:00+00:00" />
<meta itemprop="dateModified" content="2024-03-22T00:20:00+00:00" />
<meta itemprop="wordCount" content="556">



<meta itemprop="keywords" content="Testing," />
<meta name="twitter:card" content="summary"/>
<meta name="twitter:title" content="[Design] The Verifier of NGE2E"/>
<meta name="twitter:description" content="The design of Next Generation End-to-End Testing Framework  Verifier"/>



<link rel="preload" href="/scss/main.min.592235942cb3c9f3dd697382a4e7a1fad8e1c182dad2841bdce6b43b4a346ae8.css" as="style">
<link href="/scss/main.min.592235942cb3c9f3dd697382a4e7a1fad8e1c182dad2841bdce6b43b4a346ae8.css" rel="stylesheet" integrity="">



<link rel="stylesheet" href="/css/docSearch.css" />


<script src="/js/jquery-3.6.0.min.js"></script>





    <title>[Design] The Verifier of NGE2E | Apache SkyWalking</title>
  </head>
  <body class="td-page td-blog">
    <header>
      
<nav class="js-navbar-scroll navbar navbar-expand  flex-column flex-md-row td-navbar">
    <div class="sidebar-button">
      <i class="iconfont icon-menu"></i>
    </div>
    <a class="navbar-brand" href="/">
        <span class="navbar-logo"><img width="130" src="/images/logo.svg" alt="SkyWalking"></span> 
    </a>
    <div class="td-navbar-nav-scroll navbar-nav-wrapper" id="navigation">
        <ul class="navbar-nav mt-lg-0">
             
            
            
            <li class="nav-item mr-3 mb-lg-0">
				
				
				
				
				<a class="nav-link" href="/docs" ><span>Projects and Docs</span></a>
			</li>
            
            
            
            
            <li class="nav-item mr-3 mb-lg-0">
				
				
				
				
				<a class="nav-link" href="/events" ><span>Events</span></a>
			</li>
            
            
            
            
            <li class="nav-item mr-3 mb-lg-0">
				
				
				
				
				<a class="nav-link" href="/blog" ><span>Blogs</span></a>
			</li>
            
            
            
            
            <li class="nav-item mr-3 mb-lg-0">
				
				
				
				
				<a class="nav-link" href="/downloads" ><span>Downloads</span></a>
			</li>
            
            
            
            
            <li class="nav-item mr-3 mb-lg-0">
				
				
				
				
				<a class="nav-link" href="/team" ><span>Team</span></a>
			</li>
            
            
            
            
            <li class="nav-item mr-3 mb-lg-0">
				
				
				
				
				<a class="nav-link" href="/users" ><span>Users</span></a>
			</li>
            
            
            
            
            
            <li class="nav-item mr-3 mb-lg-0">
                <span class="link dropdown blog">
                    <a class="link-name nav-link dropdown-toggle" href="#" role="button" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">中文资料</a>
                    <div class="dropdown-menu">
                        <a class="dropdown-item" href="/zh/">博客</a>
                        <a class="dropdown-item" href="https://space.bilibili.com/390683219" target="_blank" rel="noopener noreferrer">
                            B站
                        </a>
                        <a class="dropdown-item" href="https://juejin.cn/user/13673577331607" target="_blank" rel="noopener noreferrer">
                            掘金
                        </a>
                    </div>
                </span>
            </li>

            
			
        </ul>
    </div>
    <div class="navbar-nav d-none d-lg-block search-input-box">
         
            
        
            
        
            
        
            
        
            
        
            
        
            
            <span class="link dropdown">
                <a class="link-name dropdown-toggle" href="#" role="button" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
                    Links
                </a>
                <div class="dropdown-menu">
                    
                    <a class="dropdown-item" href="http://www.apache.org/">Apache Software Foundation</a> 
                    <a class="dropdown-item" href="https://github.com/apache/skywalking/issues">GitHub Issue Tracker</a> 
                    <a class="dropdown-item" href="https://github.com/apache/skywalking/discussions">Discussion</a> 
                    <a class="dropdown-item" href="https://lists.apache.org/list.html?dev@skywalking.apache.org">Dev Mailing List</a> 
                    <a class="dropdown-item" href="https://cwiki.apache.org/confluence/display/SKYWALKING/Home">WIKI</a> 
                    <a class="dropdown-item" href="http://www.apache.org/licenses/">License</a> 
                    <a class="dropdown-item" href="http://www.apache.org/events/current-event">Apache Events</a> 
                    <a class="dropdown-item" href="http://www.apache.org/security/">Security</a> 
                    <a class="dropdown-item" href="http://www.apache.org/foundation/sponsorship.html">Sponsor and Donate</a> 
                    <a class="dropdown-item" href="http://www.apache.org/foundation/thanks.html">Thanks</a> 
                    <a class="dropdown-item" href="https://apache.org/foundation/policies/privacy.html">Privacy</a> 
                </div>
            </span>
            
        
        
<div id="docsearch"></div>


    </div>
</nav>

    </header>
    <div class="container-fluid td-outer">
      <div class="td-main">
        <div class="row container container-center">

          <main class="col-12 col-md-12 col-xl-10 pl-md-4 pr-md-4" role="main">
            
<div class="td-content">
	<h1>[Design] The Verifier of NGE2E</h1>
	<div class="lead">The design of Next Generation End-to-End Testing Framework  Verifier</div>
	<div class="td-byline mb-4">
		By <b><a href="https://github.com/kezhenxu94">Zhenxu Ke</a>, Tetrate.io; <a href="http://github.com/fgksgf">Huaxi Jiang</a>, Committer; <a href="http://github.com/HumbertZhang">Ke Zhang</a>, Committer</b> |
		<time datetime="2021-02-01" class="text-muted">Monday, February 01, 2021</time>


		
		<p class="mt-1 tags-box">
			<i class="iconfont icon-tags"></i>Tags |
			
			<span> <a href="/tags/testing">Testing</a></span>
			
		</p>
		


	</div>
	<h2 id="background">Background</h2>
<p>The verifier is an important part of the next generation End-to-End Testing framework (NGE2E), which is responsible for verifying whether the actual output satisfies the expected template.</p>
<h2 id="design-thinking">Design Thinking</h2>
<p>We will implement the verifier with <a href="https://golang.org/pkg/text/template/">Go template</a>, plus some enhancements. Firstly, users need to write a Go template file with provided functions and actions to describe how the expected data looks like. Then the verifer renders the template with the actual data object. Finally, the verifier compares the rendered output with the actual data. If the rendered output is not the same with the actual output, it means the actual data is inconsist with the expected data. Otherwise, it means the actual data match the expected data. On failure, the verifier will also print out what are different between expected and actual data.</p>
<h2 id="branches--actions">Branches / Actions</h2>
<p>The verifier inherits all the actions from the standard Go template, such as <code>if</code>, <code>with</code>, <code>range</code>, etc. In addition, we also provide some custom actions to satisfy our own needs.</p>
<h3 id="list-elements-match">List Elements Match</h3>
<p><code>contains</code> checks if the actual list contains elements that match the given template.</p>
<p>Examples:</p>
<div class="highlight"><pre style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-yaml" data-lang="yaml"><span style="color:#000080">metrics</span>:<span style="color:#bbb">
</span><span style="color:#bbb"></span>{{- contains .metrics }}<span style="color:#bbb">
</span><span style="color:#bbb">  </span>- <span style="color:#000080">name</span>:<span style="color:#bbb"> </span>{{<span style="color:#bbb"> </span>notEmpty .name }}<span style="color:#bbb">
</span><span style="color:#bbb">    </span><span style="color:#000080">id</span>:<span style="color:#bbb"> </span>{{<span style="color:#bbb"> </span>notEmpty .id }}<span style="color:#bbb">
</span><span style="color:#bbb">    </span><span style="color:#000080">value</span>:<span style="color:#bbb"> </span>{{<span style="color:#bbb"> </span>gt .value 0 }}<span style="color:#bbb">
</span><span style="color:#bbb"></span>{{- end }}<span style="color:#bbb">
</span></code></pre></div><p>It means that the list <code>metrics</code> must contain an element whose <code>name</code> and <code>id</code> are not empty, and <code>value</code> is greater than <code>0</code>.</p>
<div class="highlight"><pre style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-yaml" data-lang="yaml"><span style="color:#000080">metrics</span>:<span style="color:#bbb">
</span><span style="color:#bbb"></span>{{- contains .metrics }}<span style="color:#bbb">
</span><span style="color:#bbb">  </span>- <span style="color:#000080">name</span>:<span style="color:#bbb"> </span>p95<span style="color:#bbb">
</span><span style="color:#bbb">    </span><span style="color:#000080">value</span>:<span style="color:#bbb"> </span>{{<span style="color:#bbb"> </span>gt .value 0 }}<span style="color:#bbb">
</span><span style="color:#bbb">  </span>- <span style="color:#000080">name</span>:<span style="color:#bbb"> </span>p99<span style="color:#bbb">
</span><span style="color:#bbb">    </span><span style="color:#000080">value</span>:<span style="color:#bbb"> </span>{{<span style="color:#bbb"> </span>gt .value 0 }}<span style="color:#bbb">
</span><span style="color:#bbb"></span>{{- end }}<span style="color:#bbb">
</span></code></pre></div><p>This means that the list <code>metrics</code> must contain an element named <code>p95</code> with a <code>value</code> greater than 0, and an element named <code>p95</code> with a <code>value</code> greater than 0. Besides the two element, the list <code>metrics</code> may or may not have other random elements.</p>
<h2 id="functions">Functions</h2>
<p>Users can use these provided functions in the template to describe the expected data.</p>
<h3 id="not-empty">Not Empty</h3>
<p><code>notEmpty</code> checks if the string <code>s</code> is empty.</p>
<p>Example:</p>
<div class="highlight"><pre style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-yaml" data-lang="yaml"><span style="color:#000080">id</span>:<span style="color:#bbb"> </span>{{<span style="color:#bbb"> </span>notEmpty .id }}<span style="color:#bbb">
</span></code></pre></div><h3 id="regexp-match">Regexp match</h3>
<p><code>regexp</code> checks if string <code>s</code> matches the regular expression pattern.</p>
<p>Examples:</p>
<div class="highlight"><pre style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-yaml" data-lang="yaml"><span style="color:#000080">label</span>:<span style="color:#bbb"> </span>{{<span style="color:#bbb"> </span>regexp .label &#34;ratings.*&#34; }}<span style="color:#bbb">
</span></code></pre></div><h3 id="base64">Base64</h3>
<p><code>b64enc s</code> returns the Base64 encoded string of s.</p>
<p>Examples:</p>
<div class="highlight"><pre style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-yaml" data-lang="yaml"><span style="color:#000080">id</span>:<span style="color:#bbb"> </span>{{<span style="color:#bbb"> </span>b64enc &#34;User&#34; }}.static-suffix<span style="color:#bbb"> </span><span style="color:#998;font-style:italic"># this evalutes the base64 encoded string of &#34;User&#34;, concatenated with a static suffix &#34;.static-suffix&#34;</span><span style="color:#bbb">
</span></code></pre></div><p>Result:</p>
<div class="highlight"><pre style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-yaml" data-lang="yaml"><span style="color:#000080">id</span>:<span style="color:#bbb"> </span>VXNlcg==.static-suffix<span style="color:#bbb">
</span></code></pre></div><h2 id="full-example">Full Example</h2>
<p>Here is an example of expected data:</p>
<div class="highlight"><pre style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-yaml" data-lang="yaml"><span style="color:#998;font-style:italic"># expected.data.yaml</span><span style="color:#bbb">
</span><span style="color:#bbb"></span><span style="color:#000080">nodes</span>:<span style="color:#bbb">
</span><span style="color:#bbb">  </span>- <span style="color:#000080">id</span>:<span style="color:#bbb"> </span>{{<span style="color:#bbb"> </span>b64enc &#34;User&#34; }}.0<span style="color:#bbb">
</span><span style="color:#bbb">    </span><span style="color:#000080">name</span>:<span style="color:#bbb"> </span>User<span style="color:#bbb">
</span><span style="color:#bbb">    </span><span style="color:#000080">type</span>:<span style="color:#bbb"> </span>USER<span style="color:#bbb">
</span><span style="color:#bbb">    </span><span style="color:#000080">isReal</span>:<span style="color:#bbb"> </span><span style="color:#000;font-weight:bold">false</span><span style="color:#bbb">
</span><span style="color:#bbb">  </span>- <span style="color:#000080">id</span>:<span style="color:#bbb"> </span>{{<span style="color:#bbb"> </span>b64enc &#34;Your_ApplicationName&#34; }}.1<span style="color:#bbb">
</span><span style="color:#bbb">    </span><span style="color:#000080">name</span>:<span style="color:#bbb"> </span>Your_ApplicationName<span style="color:#bbb">
</span><span style="color:#bbb">    </span><span style="color:#000080">type</span>:<span style="color:#bbb"> </span>Tomcat<span style="color:#bbb">
</span><span style="color:#bbb">    </span><span style="color:#000080">isReal</span>:<span style="color:#bbb"> </span><span style="color:#000;font-weight:bold">true</span><span style="color:#bbb">
</span><span style="color:#bbb">  </span>- <span style="color:#000080">id</span>:<span style="color:#bbb"> </span>{{<span style="color:#bbb"> </span>$h2ID := (index .nodes 2).id }}{{ notEmpty $h2ID }}<span style="color:#bbb"> </span><span style="color:#998;font-style:italic"># We assert that nodes[2].id is not empty and save it to variable `h2ID` for later use</span><span style="color:#bbb">
</span><span style="color:#bbb">    </span><span style="color:#000080">name</span>:<span style="color:#bbb"> </span>localhost:-1<span style="color:#bbb">
</span><span style="color:#bbb">    </span><span style="color:#000080">type</span>:<span style="color:#bbb"> </span>H2<span style="color:#bbb">
</span><span style="color:#bbb">    </span><span style="color:#000080">isReal</span>:<span style="color:#bbb"> </span><span style="color:#000;font-weight:bold">false</span><span style="color:#bbb">
</span><span style="color:#bbb"></span><span style="color:#000080">calls</span>:<span style="color:#bbb">
</span><span style="color:#bbb">  </span>- <span style="color:#000080">id</span>:<span style="color:#bbb"> </span>{{<span style="color:#bbb"> </span>notEmpty (index .calls 0).id }}<span style="color:#bbb">
</span><span style="color:#bbb">    </span><span style="color:#000080">source</span>:<span style="color:#bbb"> </span>{{<span style="color:#bbb"> </span>b64enc &#34;Your_ApplicationName&#34; }}.1<span style="color:#bbb">
</span><span style="color:#bbb">    </span><span style="color:#000080">target</span>:<span style="color:#bbb"> </span>{{<span style="color:#bbb"> </span>$h2ID }}<span style="color:#bbb"> </span><span style="color:#998;font-style:italic"># We use the previously assigned variable `h2Id` to asert that the `target` is equal to the `id` of the nodes[2]</span><span style="color:#bbb">
</span><span style="color:#bbb">    </span><span style="color:#000080">detectPoints</span>:<span style="color:#bbb">
</span><span style="color:#bbb">      </span>- CLIENT<span style="color:#bbb">
</span><span style="color:#bbb">  </span>- <span style="color:#000080">id</span>:<span style="color:#bbb"> </span>{{<span style="color:#bbb"> </span>b64enc &#34;User&#34; }}.0-{{ b64enc &#34;Your_ApplicationName&#34; }}.1<span style="color:#bbb">
</span><span style="color:#bbb">    </span><span style="color:#000080">source</span>:<span style="color:#bbb"> </span>{{<span style="color:#bbb"> </span>b64enc &#34;User&#34; }}.0<span style="color:#bbb">
</span><span style="color:#bbb">    </span><span style="color:#000080">target</span>:<span style="color:#bbb"> </span>{{<span style="color:#bbb"> </span>b64enc &#34;Your_ApplicationName&#34; }}.1<span style="color:#bbb">
</span><span style="color:#bbb">    </span><span style="color:#000080">detectPoints</span>:<span style="color:#bbb">
</span><span style="color:#bbb">      </span>- SERVER<span style="color:#bbb">
</span></code></pre></div><p>will validate this data:</p>
<div class="highlight"><pre style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-yaml" data-lang="yaml"><span style="color:#998;font-style:italic"># actual.data.yaml</span><span style="color:#bbb">
</span><span style="color:#bbb"></span><span style="color:#000080">nodes</span>:<span style="color:#bbb">
</span><span style="color:#bbb">  </span>- <span style="color:#000080">id</span>:<span style="color:#bbb"> </span>VXNlcg==.0<span style="color:#bbb">
</span><span style="color:#bbb">    </span><span style="color:#000080">name</span>:<span style="color:#bbb"> </span>User<span style="color:#bbb">
</span><span style="color:#bbb">    </span><span style="color:#000080">type</span>:<span style="color:#bbb"> </span>USER<span style="color:#bbb">
</span><span style="color:#bbb">    </span><span style="color:#000080">isReal</span>:<span style="color:#bbb"> </span><span style="color:#000;font-weight:bold">false</span><span style="color:#bbb">
</span><span style="color:#bbb">  </span>- <span style="color:#000080">id</span>:<span style="color:#bbb"> </span>WW91cl9BcHBsaWNhdGlvbk5hbWU=.1<span style="color:#bbb">
</span><span style="color:#bbb">    </span><span style="color:#000080">name</span>:<span style="color:#bbb"> </span>Your_ApplicationName<span style="color:#bbb">
</span><span style="color:#bbb">    </span><span style="color:#000080">type</span>:<span style="color:#bbb"> </span>Tomcat<span style="color:#bbb">
</span><span style="color:#bbb">    </span><span style="color:#000080">isReal</span>:<span style="color:#bbb"> </span><span style="color:#000;font-weight:bold">true</span><span style="color:#bbb">
</span><span style="color:#bbb">  </span>- <span style="color:#000080">id</span>:<span style="color:#bbb"> </span>bG9jYWxob3N0Oi0x.0<span style="color:#bbb">
</span><span style="color:#bbb">    </span><span style="color:#000080">name</span>:<span style="color:#bbb"> </span>localhost:-1<span style="color:#bbb">
</span><span style="color:#bbb">    </span><span style="color:#000080">type</span>:<span style="color:#bbb"> </span>H2<span style="color:#bbb">
</span><span style="color:#bbb">    </span><span style="color:#000080">isReal</span>:<span style="color:#bbb"> </span><span style="color:#000;font-weight:bold">false</span><span style="color:#bbb">
</span><span style="color:#bbb"></span><span style="color:#000080">calls</span>:<span style="color:#bbb">
</span><span style="color:#bbb">  </span>- <span style="color:#000080">id</span>:<span style="color:#bbb"> </span>WW91cl9BcHBsaWNhdGlvbk5hbWU=.1-bG9jYWxob3N0Oi0x.0<span style="color:#bbb">
</span><span style="color:#bbb">    </span><span style="color:#000080">source</span>:<span style="color:#bbb"> </span>WW91cl9BcHBsaWNhdGlvbk5hbWU=.1<span style="color:#bbb">
</span><span style="color:#bbb">    </span><span style="color:#000080">detectPoints</span>:<span style="color:#bbb">
</span><span style="color:#bbb">      </span>- CLIENT<span style="color:#bbb">
</span><span style="color:#bbb">    </span><span style="color:#000080">target</span>:<span style="color:#bbb"> </span>bG9jYWxob3N0Oi0x.0<span style="color:#bbb">
</span><span style="color:#bbb">  </span>- <span style="color:#000080">id</span>:<span style="color:#bbb"> </span>VXNlcg==.0-WW91cl9BcHBsaWNhdGlvbk5hbWU=.1<span style="color:#bbb">
</span><span style="color:#bbb">    </span><span style="color:#000080">source</span>:<span style="color:#bbb"> </span>VXNlcg==.0<span style="color:#bbb">
</span><span style="color:#bbb">    </span><span style="color:#000080">detectPoints</span>:<span style="color:#bbb">
</span><span style="color:#bbb">      </span>- SERVER<span style="color:#bbb">
</span><span style="color:#bbb">    </span><span style="color:#000080">target</span>:<span style="color:#bbb"> </span>WW91cl9BcHBsaWNhdGlvbk5hbWU=.1<span style="color:#bbb">
</span></code></pre></div><div class="highlight"><pre style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-yaml" data-lang="yaml"><span style="color:#998;font-style:italic"># expected.data.yaml</span><span style="color:#bbb">
</span><span style="color:#bbb"></span><span style="color:#000080">metrics</span>:<span style="color:#bbb">
</span><span style="color:#bbb"></span>{{- contains .metrics }}<span style="color:#bbb">
</span><span style="color:#bbb">  </span>- <span style="color:#000080">name</span>:<span style="color:#bbb"> </span>{{<span style="color:#bbb"> </span>notEmpty .name }}<span style="color:#bbb">
</span><span style="color:#bbb">    </span><span style="color:#000080">id</span>:<span style="color:#bbb"> </span>{{<span style="color:#bbb"> </span>notEmpty .id }}<span style="color:#bbb">
</span><span style="color:#bbb">    </span><span style="color:#000080">value</span>:<span style="color:#bbb"> </span>{{<span style="color:#bbb"> </span>gt .value 0 }}<span style="color:#bbb">
</span><span style="color:#bbb"></span>{{- end }}<span style="color:#bbb">
</span></code></pre></div><p>will validate this data:</p>
<div class="highlight"><pre style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-yaml" data-lang="yaml"><span style="color:#998;font-style:italic"># actual.data.yaml</span><span style="color:#bbb">
</span><span style="color:#bbb"></span><span style="color:#000080">metrics</span>:<span style="color:#bbb">
</span><span style="color:#bbb">  </span>- <span style="color:#000080">name</span>:<span style="color:#bbb"> </span>business-zone::projectA<span style="color:#bbb">
</span><span style="color:#bbb">    </span><span style="color:#000080">id</span>:<span style="color:#bbb"> </span>YnVzaW5lc3Mtem9uZTo6cHJvamVjdEE=.1<span style="color:#bbb">
</span><span style="color:#bbb">    </span><span style="color:#000080">value</span>:<span style="color:#bbb"> </span><span style="color:#099">1</span><span style="color:#bbb">
</span><span style="color:#bbb">  </span>- <span style="color:#000080">name</span>:<span style="color:#bbb"> </span>system::load balancer1<span style="color:#bbb">
</span><span style="color:#bbb">    </span><span style="color:#000080">id</span>:<span style="color:#bbb"> </span>c3lzdGVtOjpsb2FkIGJhbGFuY2VyMQ==.1<span style="color:#bbb">
</span><span style="color:#bbb">    </span><span style="color:#000080">value</span>:<span style="color:#bbb"> </span><span style="color:#099">0</span><span style="color:#bbb">
</span><span style="color:#bbb">  </span>- <span style="color:#000080">name</span>:<span style="color:#bbb"> </span>system::load balancer2<span style="color:#bbb">
</span><span style="color:#bbb">    </span><span style="color:#000080">id</span>:<span style="color:#bbb"> </span>c3lzdGVtOjpsb2FkIGJhbGFuY2VyMg==.1<span style="color:#bbb">
</span><span style="color:#bbb">    </span><span style="color:#000080">value</span>:<span style="color:#bbb"> </span><span style="color:#099">0</span><span style="color:#bbb">
</span></code></pre></div><p>and will report an error when validating this data, because there is no element with a value greater than 0:</p>
<div class="highlight"><pre style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-yaml" data-lang="yaml"><span style="color:#998;font-style:italic"># actual.data.yaml</span><span style="color:#bbb">
</span><span style="color:#bbb"></span><span style="color:#000080">metrics</span>:<span style="color:#bbb">
</span><span style="color:#bbb">  </span>- <span style="color:#000080">name</span>:<span style="color:#bbb"> </span>business-zone::projectA<span style="color:#bbb">
</span><span style="color:#bbb">    </span><span style="color:#000080">id</span>:<span style="color:#bbb"> </span>YnVzaW5lc3Mtem9uZTo6cHJvamVjdEE=.1<span style="color:#bbb">
</span><span style="color:#bbb">    </span><span style="color:#000080">value</span>:<span style="color:#bbb"> </span><span style="color:#099">0</span><span style="color:#bbb">
</span><span style="color:#bbb">  </span>- <span style="color:#000080">name</span>:<span style="color:#bbb"> </span>system::load balancer1<span style="color:#bbb">
</span><span style="color:#bbb">    </span><span style="color:#000080">id</span>:<span style="color:#bbb"> </span>c3lzdGVtOjpsb2FkIGJhbGFuY2VyMQ==.1<span style="color:#bbb">
</span><span style="color:#bbb">    </span><span style="color:#000080">value</span>:<span style="color:#bbb"> </span><span style="color:#099">0</span><span style="color:#bbb">
</span><span style="color:#bbb">  </span>- <span style="color:#000080">name</span>:<span style="color:#bbb"> </span>system::load balancer2<span style="color:#bbb">
</span><span style="color:#bbb">    </span><span style="color:#000080">id</span>:<span style="color:#bbb"> </span>c3lzdGVtOjpsb2FkIGJhbGFuY2VyMg==.1<span style="color:#bbb">
</span><span style="color:#bbb">    </span><span style="color:#000080">value</span>:<span style="color:#bbb"> </span><span style="color:#099">0</span><span style="color:#bbb">
</span></code></pre></div><p>The <code>contains</code> does an unordered list verification, in order to do list verifications including orders, you can simply use the basic ruls like this:</p>
<div class="highlight"><pre style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-yaml" data-lang="yaml"><span style="color:#998;font-style:italic"># expected.data.yaml</span><span style="color:#bbb">
</span><span style="color:#bbb"></span><span style="color:#000080">metrics</span>:<span style="color:#bbb">
</span><span style="color:#bbb">  </span>- <span style="color:#000080">name</span>:<span style="color:#bbb"> </span>p99<span style="color:#bbb">
</span><span style="color:#bbb">    </span><span style="color:#000080">value</span>:<span style="color:#bbb"> </span>{{<span style="color:#bbb"> </span>gt (index .metrics 0).value 0 }}<span style="color:#bbb">
</span><span style="color:#bbb">  </span>- <span style="color:#000080">name</span>:<span style="color:#bbb"> </span>p95<span style="color:#bbb">
</span><span style="color:#bbb">    </span><span style="color:#000080">value</span>:<span style="color:#bbb"> </span>{{<span style="color:#bbb"> </span>gt (index .metrics 1).value 0 }}<span style="color:#bbb">
</span></code></pre></div><p>which expects the actual <code>metrics</code> list to be exactly ordered, with first element named <code>p99</code> and <code>value</code> greater 0, second element named <code>p95</code> and <code>value</code> greater 0.</p>

	

	<ul class="list-unstyled d-flex justify-content-between align-items-center mb-0 pt-5">
  <li>
    <a href="/blog/2021-01-23-tencent-cloud-violates-aplv2/" class="btn btn-primary "><span class="mr-1">←</span> Previous</a>
  </li>
    <a href="/blog/skywalking8-4-release/" class="btn btn-primary ">Next <span class="ml-1">→</span></a>
  </li>
</ul>

</div>


          </main>
          <div class="d-none d-xl-block col-xl-2 td-toc d-print-none">

            <div class="tags-wrapper">
    <div class="font-weight-bold post-meta ">
        <i class="iconfont icon-tags pr-1" aria-hidden="true"></i>
        Tags
    </div>
    <ul class="tags-box">
        
        <li>
            <a href="/tags/agent/" class="tag-link">Agent</a>
            <span class="count">10</span>
        </li>
        
        <li>
            <a href="/tags/apache-shenyu-incubating/" class="tag-link">Apache ShenYu (incubating)</a>
            <span class="count">1</span>
        </li>
        
        <li>
            <a href="/tags/apisix/" class="tag-link">APISIX</a>
            <span class="count">1</span>
        </li>
        
        <li>
            <a href="/tags/apm/" class="tag-link">APM</a>
            <span class="count">1</span>
        </li>
        
        <li>
            <a href="/tags/arthas/" class="tag-link">Arthas</a>
            <span class="count">1</span>
        </li>
        
        <li>
            <a href="/tags/aurora/" class="tag-link">Aurora</a>
            <span class="count">2</span>
        </li>
        
        <li>
            <a href="/tags/aws/" class="tag-link">AWS</a>
            <span class="count">2</span>
        </li>
        
        <li>
            <a href="/tags/browser/" class="tag-link">Browser</a>
            <span class="count">1</span>
        </li>
        
        <li>
            <a href="/tags/chaos-engineering/" class="tag-link">Chaos Engineering</a>
            <span class="count">1</span>
        </li>
        
        <li>
            <a href="/tags/chaos-mesh/" class="tag-link">Chaos Mesh</a>
            <span class="count">1</span>
        </li>
        
        <li>
            <a href="/tags/clickhouse/" class="tag-link">ClickHouse</a>
            <span class="count">2</span>
        </li>
        
        <li>
            <a href="/tags/conference/" class="tag-link">Conference</a>
            <span class="count">6</span>
        </li>
        
        <li>
            <a href="/tags/database/" class="tag-link">Database</a>
            <span class="count">1</span>
        </li>
        
        <li>
            <a href="/tags/demo/" class="tag-link">Demo</a>
            <span class="count">3</span>
        </li>
        
        <li>
            <a href="/tags/design/" class="tag-link">Design</a>
            <span class="count">2</span>
        </li>
        
        <li>
            <a href="/tags/dotnetcore/" class="tag-link">DotNetCore</a>
            <span class="count">1</span>
        </li>
        
        <li>
            <a href="/tags/ebpf/" class="tag-link">eBPF</a>
            <span class="count">6</span>
        </li>
        
        <li>
            <a href="/tags/golang/" class="tag-link">Golang</a>
            <span class="count">5</span>
        </li>
        
        <li>
            <a href="/tags/grafana/" class="tag-link">Grafana</a>
            <span class="count">2</span>
        </li>
        
        <li>
            <a href="/tags/http/" class="tag-link">HTTP</a>
            <span class="count">2</span>
        </li>
        
        <li>
            <a href="/tags/infrastructure-monitoring/" class="tag-link">Infrastructure Monitoring</a>
            <span class="count">1</span>
        </li>
        
        <li>
            <a href="/tags/iotdb/" class="tag-link">IoTDB</a>
            <span class="count">2</span>
        </li>
        
        <li>
            <a href="/tags/istio/" class="tag-link">Istio</a>
            <span class="count">2</span>
        </li>
        
        <li>
            <a href="/tags/java/" class="tag-link">Java</a>
            <span class="count">2</span>
        </li>
        
        <li>
            <a href="/tags/kafka/" class="tag-link">Kafka</a>
            <span class="count">1</span>
        </li>
        
        <li>
            <a href="/tags/kong/" class="tag-link">Kong</a>
            <span class="count">1</span>
        </li>
        
        <li>
            <a href="/tags/lal/" class="tag-link">LAL</a>
            <span class="count">1</span>
        </li>
        
        <li>
            <a href="/tags/license/" class="tag-link">License</a>
            <span class="count">5</span>
        </li>
        
        <li>
            <a href="/tags/logging/" class="tag-link">Logging</a>
            <span class="count">3</span>
        </li>
        
        <li>
            <a href="/tags/logs/" class="tag-link">Logs</a>
            <span class="count">2</span>
        </li>
        
        <li>
            <a href="/tags/metric/" class="tag-link">Metric</a>
            <span class="count">6</span>
        </li>
        
        <li>
            <a href="/tags/metrics/" class="tag-link">Metrics</a>
            <span class="count">2</span>
        </li>
        
        <li>
            <a href="/tags/nginx/" class="tag-link">Nginx</a>
            <span class="count">5</span>
        </li>
        
        <li>
            <a href="/tags/observability/" class="tag-link">Observability</a>
            <span class="count">10</span>
        </li>
        
        <li>
            <a href="/tags/ospp/" class="tag-link">OSPP</a>
            <span class="count">1</span>
        </li>
        
        <li>
            <a href="/tags/performance/" class="tag-link">Performance</a>
            <span class="count">3</span>
        </li>
        
        <li>
            <a href="/tags/profiling/" class="tag-link">Profiling</a>
            <span class="count">5</span>
        </li>
        
        <li>
            <a href="/tags/promql/" class="tag-link">PromQL</a>
            <span class="count">2</span>
        </li>
        
        <li>
            <a href="/tags/python/" class="tag-link">Python</a>
            <span class="count">1</span>
        </li>
        
        <li>
            <a href="/tags/rds/" class="tag-link">RDS</a>
            <span class="count">2</span>
        </li>
        
        <li>
            <a href="/tags/release-blog/" class="tag-link">Release Blog</a>
            <span class="count">4</span>
        </li>
        
        <li>
            <a href="/tags/rocketmq/" class="tag-link">RocketMQ</a>
            <span class="count">1</span>
        </li>
        
        <li>
            <a href="/tags/satellite/" class="tag-link">Satellite</a>
            <span class="count">1</span>
        </li>
        
        <li>
            <a href="/tags/service-mesh/" class="tag-link">Service Mesh</a>
            <span class="count">6</span>
        </li>
        
        <li>
            <a href="/tags/sharding-sphere/" class="tag-link">Sharding-Sphere</a>
            <span class="count">1</span>
        </li>
        
        <li>
            <a href="/tags/sharding-sphere-proxy/" class="tag-link">Sharding-Sphere-proxy</a>
            <span class="count">1</span>
        </li>
        
        <li>
            <a href="/tags/skywalking/" class="tag-link">SkyWalking</a>
            <span class="count">5</span>
        </li>
        
        <li>
            <a href="/tags/spring/" class="tag-link">Spring</a>
            <span class="count">1</span>
        </li>
        
        <li>
            <a href="/tags/storage/" class="tag-link">Storage</a>
            <span class="count">2</span>
        </li>
        
        <li>
            <a href="/tags/testing/" class="tag-link">Testing</a>
            <span class="count">3</span>
        </li>
        
        <li>
            <a href="/tags/trace/" class="tag-link">Trace</a>
            <span class="count">4</span>
        </li>
        
        <li>
            <a href="/tags/tracing/" class="tag-link">Tracing</a>
            <span class="count">10</span>
        </li>
        
        <li>
            <a href="/tags/tutorial/" class="tag-link">Tutorial</a>
            <span class="count">1</span>
        </li>
        
        <li>
            <a href="/tags/user-manual/" class="tag-link">User Manual</a>
            <span class="count">2</span>
        </li>
        
        <li>
            <a href="/tags/video/" class="tag-link">Video</a>
            <span class="count">8</span>
        </li>
        
        <li>
            <a href="/tags/web-performance/" class="tag-link">Web-performance</a>
            <span class="count">1</span>
        </li>
        
    </ul>
</div>



            




<div class="td-page-meta ml-2 pb-1 pt-2 mb-0">











</div>






<nav id="TableOfContents">
  <ul>
    <li>
      <ul>
        <li><a href="#background">Background</a></li>
        <li><a href="#design-thinking">Design Thinking</a></li>
        <li><a href="#branches--actions">Branches / Actions</a>
          <ul>
            <li><a href="#list-elements-match">List Elements Match</a></li>
          </ul>
        </li>
        <li><a href="#functions">Functions</a>
          <ul>
            <li><a href="#not-empty">Not Empty</a></li>
            <li><a href="#regexp-match">Regexp match</a></li>
            <li><a href="#base64">Base64</a></li>
          </ul>
        </li>
        <li><a href="#full-example">Full Example</a></li>
      </ul>
    </li>
  </ul>
</nav>




<script>
  $(function () {
    var $toc = $("#TableOfContents");
    if (!$toc || !$toc.length) {
      return;
    }
    var top = $toc.offset().top;
    $(window).on("scroll", debounce(setTop, 100))
    $(window).on("scroll", debounce(addActive, 30))

    function addActive() {
      var scrollValue = $(window).scrollTop();
      var topEle = null;
      $.each($('main h1, main h2, main h3'), function (index, item) {
        if ($(item).offset().top - 70 > scrollValue) {
          return
        }
        if (!topEle) {
          topEle = item
        } else if ($(item).offset().top >= $(topEle).offset().top) {
          topEle = item
        }
        if (topEle) {
          var id = $(item).attr('id');
          $toc.find('a').removeClass("active").end().find('a[href="' + '#' + id + '"]').addClass("active")
        }
      })
    }

    function setTop() {
      var scrollValue = $(window).scrollTop();
      if (scrollValue >= top - 70) {
        $toc.addClass('fixed')
      } else {
        $toc.removeClass('fixed')
      }
    }

    function debounce(fn, wait) {
      var timeout = null;
      return function () {
        clearTimeout(timeout);
        timeout = setTimeout(() => {
          fn.apply(this, arguments);
        }, wait);
      };
    }
  })

</script>

          </div>
        </div>
      </div>
      
<footer class="py-5 sky-row">
  <div class="container-fluid text-center">
    <div class="">
        
        
        
<ul class="list-inline mb-0">
  
  <li class="list-inline-item mx-2 h3" data-toggle="tooltip" data-placement="top" title="Twitter" aria-label="Twitter">
    <a class="text-color" target="_blank" href="https://twitter.com/asfskywalking">
      <i class="iconfont icon-twitter"></i>
    </a>
  </li>
  
  <li class="list-inline-item mx-2 h3" data-toggle="tooltip" data-placement="top" title="Slack" aria-label="Slack">
    <a class="text-color" target="_blank" href="http://s.apache.org/slack-invite">
      <i class="iconfont icon-slack"></i>
    </a>
  </li>
  
  <li class="list-inline-item mx-2 h3" data-toggle="tooltip" data-placement="top" title="Mailing list" aria-label="Mailing list">
    <a class="text-color" target="_blank" href="https://lists.apache.org/list.html?dev@skywalking.apache.org">
      <i class="iconfont icon-email"></i>
    </a>
  </li>
  
  <li class="list-inline-item mx-2 h3" data-toggle="tooltip" data-placement="top" title="GitHub" aria-label="GitHub">
    <a class="text-color" target="_blank" href="https://github.com/apache/skywalking">
      <i class="iconfont icon-github"></i>
    </a>
  </li>
  
</ul>

        
        
    </div>
    <div class="">

        <small class="text-color">&copy; 2017 - 2024 The Apache Software Foundation All Rights Reserved</small>
        
	
    </div>
    <div class="">
      <small class="text-color mt-4">Apache SkyWalking, SkyWalking, Apache, the Apache feather logo, and the Apache SkyWalking project logo are either registered trademarks or trademarks of the Apache Software Foundation.</small>
    </div>
  </div>
</footer>


    </div>
    















































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































    
<div id="popup">
    <div class="mask">
        <img src=""/>
    </div>
</div>

    <div class="sidebar-mask"></div>
<div class="sidebar">
    <nav class="nav-links">
        <div class="nav-item"><a href="/docs/" class="nav-link">Projects and Documentation</a></div>
        <div class="nav-item"><a href="/events/" class="nav-link">Events</a></div>
        <div class="nav-item"><a href="/blog/" class="nav-link router-link-exact-active router-link-active">Blog</a>
        </div>
        <div class="nav-item"><a href="/downloads/" class="nav-link">Downloads</a></div>
        <div class="nav-item"><a href="/team/" class="nav-link">Team</a></div>
        <div class="nav-item"><a href="/users/" class="nav-link">Users</a></div>
        <div class="nav-item">
            <div class="dropdown-wrapper open">
                <a class="dropdown-title"><span>中文资料</span>
                    <span class="arrow down"></span>
                </a>
                <ul class="nav-dropdown">
                    <li class="dropdown-item">
                        <a href="/zh/" class="nav-link external">博客</a>
                    </li>
                    <li class="dropdown-item">
                        <a href="https://space.bilibili.com/390683219" target="_blank"
                           rel="noopener noreferrer" class="nav-link external">B站</a>
                    </li>
                    <li class="dropdown-item">
                        <a href="https://juejin.cn/user/13673577331607" target="_blank"
                           rel="noopener noreferrer" class="nav-link external">掘金</a>
                    </li>
                </ul>
            </div>
        </div>
        <div class="nav-item">
            <div class="dropdown-wrapper open">
                <a class="dropdown-title">
                    <span>Links</span>
                    <span class="arrow down"></span>
                </a>
                <ul class="nav-dropdown">
                    <li class="dropdown-item">
                        <a href="http://www.apache.org/" target="_blank"
                           rel="noopener noreferrer" class="nav-link external">
                            Apache Software Foundation
                        </a>
                    </li>
                    <li class="dropdown-item">
                        <a href="https://github.com/apache/skywalking/issues"
                           target="_blank" rel="noopener noreferrer"
                           class="nav-link external">
                            GitHub Issue Tracker
                        </a>
                    </li>
                    <li class="dropdown-item">
                        <a href="https://lists.apache.org/list.html?dev@skywalking.apache.org" target="_blank"
                           rel="noopener noreferrer" class="nav-link external">
                            Dev Mailing List
                        </a>
                    </li>
                    <li class="dropdown-item">
                        <a href="http://www.apache.org/licenses/" target="_blank"
                           rel="noopener noreferrer" class="nav-link external">
                            License
                        </a>
                    </li>
                    <li class="dropdown-item">
                        <a href="http://www.apache.org/events/current-event"
                           target="_blank" rel="noopener noreferrer"
                           class="nav-link external">
                            Apache Events
                        </a>
                    </li>
                    <li class="dropdown-item">
                        <a href="http://www.apache.org/security/" target="_blank"
                           rel="noopener noreferrer" class="nav-link external">
                            Security
                        </a>
                    </li>
                    <li class="dropdown-item">
                        <a href="http://www.apache.org/foundation/sponsorship.html"
                           target="_blank" rel="noopener noreferrer"
                           class="nav-link external">
                            Sponsorship and Donate
                        </a>
                    </li>
                    <li class="dropdown-item">
                        <a href="http://www.apache.org/foundation/thanks.html"
                           target="_blank" rel="noopener noreferrer"
                           class="nav-link external">
                            Thanks
                        </a>
                    </li>
                </ul>
            </div>
        </div>
    </nav>
</div>

    <script src="/js/bootstrap.bundle.min.js"></script>

<script src="https://cdn.jsdelivr.net/npm/@docsearch/js@3"></script>









<script src="/js/main.min.dc00f5ca911ee5aa105ea6de6b3b7e8d8169ba5a3bf156b1fcfe23dfe3e62b0a.js" integrity="sha256-3AD1ypEe5aoQXqbeazt&#43;jYFpulo78Vax/P4j3&#43;PmKwo=" crossorigin="anonymous"></script>


<script src="/js/mermaid.min.js"></script>
<script>
    window.onload = () => mermaid.init(undefined, ".language-mermaid");
</script>


<script defer
src="https://widget.kapa.ai/kapa-widget.bundle.js"
data-website-id="8a08392b-9c4d-4816-8bc4-f93e0ecdd2a7"
data-project-name="SkyWalking"
data-project-color="#2B74B8"
data-button-text="Ask AI"
data-search-mode-enabled="true"
data-modal-open-on-command-k="true"
data-modal-disclaimer="The AI supports multiple languages, but it may not be accessible in China, a proxy is required."
data-project-logo="https://miro.medium.com/v2/resize:fit:2400/0*kmS-5BQ8ShAhZ_F4.jpg"
data-modal-example-questions="What is Apache SkyWalking?,How to deploy SkyWalking?,How to inject agents non-intrusively?,How to setup trace sampling?"
data-button-position-top=""
data-button-position-right="20px"
data-button-position-bottom="200px"
data-button-position-left=""
></script>




  </body>
</html>
