<!doctype html>
<html lang="en" class="no-js">
  <head>
    <meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<meta name="twitter:site" content="skywalking.apache.org">
<meta name="twitter:image:src" content="https://skywalking.apache.org/images/skywalking_400x400.png">
<meta property="og:image" content="https://skywalking.apache.org/images/skywalking_400x400.png">

<meta name="generator" content="Hugo 0.80.0" />


<script async src="https://www.googletagmanager.com/gtag/js?id=G-GR8N6PGRJ3"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);};
  gtag('js', new Date());gtag('config', 'G-GR8N6PGRJ3');
</script>
<META NAME="ROBOTS" CONTENT="INDEX, FOLLOW">
<link rel="stylesheet" href="//at.alicdn.com/t/c/font_3007530_pvozs1rz2wn.css">



<link rel="apple-touch-icon" sizes="180x180" href="/favicons/apple-touch-icon.png">
<link rel="icon" type="image/png" sizes="32x32" href="/favicons/favicon-32x32.png">
<link rel="icon" type="image/png" sizes="16x16" href="/favicons/favicon-16x16.png">
<link rel="manifest" href="/favicons/site.webmanifest">
<link rel="mask-icon" href="/favicons/safari-pinned-tab.svg" color="#5bbad5">
<meta name="msapplication-TileColor" content="#da532c">
<meta name="theme-color" content="#ffffff">

<title>Activating Automatical Performance Analysis -- Continuous Profiling | Apache SkyWalking</title><meta property="og:title" content="Activating Automatical Performance Analysis -- Continuous Profiling" />
<meta property="og:description" content="Introduce and demonstrate how SkyWalking implements eBPF-based process monitoring with few manual engagements. The profiling could be automatically activated driven by the preset conditions." />
<meta property="og:type" content="article" />
<meta property="og:url" content="/blog/2023-06-25-intruducing-continuous-profiling-skywalking-with-ebpf/" />
<meta property="article:published_time" content="2023-06-25T00:00:00+00:00" />
<meta property="article:modified_time" content="2024-03-22T00:20:00+00:00" />
<meta itemprop="name" content="Activating Automatical Performance Analysis -- Continuous Profiling">
<meta itemprop="description" content="Introduce and demonstrate how SkyWalking implements eBPF-based process monitoring with few manual engagements. The profiling could be automatically activated driven by the preset conditions.">
<meta itemprop="datePublished" content="2023-06-25T00:00:00+00:00" />
<meta itemprop="dateModified" content="2024-03-22T00:20:00+00:00" />
<meta itemprop="wordCount" content="2037">



<meta itemprop="keywords" content="eBPF,Profiling,Tracing," />
<meta name="twitter:card" content="summary"/>
<meta name="twitter:title" content="Activating Automatical Performance Analysis -- Continuous Profiling"/>
<meta name="twitter:description" content="Introduce and demonstrate how SkyWalking implements eBPF-based process monitoring with few manual engagements. The profiling could be automatically activated driven by the preset conditions."/>



<link rel="preload" href="/scss/main.min.592235942cb3c9f3dd697382a4e7a1fad8e1c182dad2841bdce6b43b4a346ae8.css" as="style">
<link href="/scss/main.min.592235942cb3c9f3dd697382a4e7a1fad8e1c182dad2841bdce6b43b4a346ae8.css" rel="stylesheet" integrity="">



<link rel="stylesheet" href="/css/docSearch.css" />


<script src="/js/jquery-3.6.0.min.js"></script>





    <title>Activating Automatical Performance Analysis -- Continuous Profiling | Apache SkyWalking</title>
  </head>
  <body class="td-page td-blog">
    <header>
      
<nav class="js-navbar-scroll navbar navbar-expand  flex-column flex-md-row td-navbar">
    <div class="sidebar-button">
      <i class="iconfont icon-menu"></i>
    </div>
    <a class="navbar-brand" href="/">
        <span class="navbar-logo"><img width="130" src="/images/logo.svg" alt="SkyWalking"></span> 
    </a>
    <div class="td-navbar-nav-scroll navbar-nav-wrapper" id="navigation">
        <ul class="navbar-nav mt-lg-0">
             
            
            
            <li class="nav-item mr-3 mb-lg-0">
				
				
				
				
				<a class="nav-link" href="/docs" ><span>Projects and Docs</span></a>
			</li>
            
            
            
            
            <li class="nav-item mr-3 mb-lg-0">
				
				
				
				
				<a class="nav-link" href="/events" ><span>Events</span></a>
			</li>
            
            
            
            
            <li class="nav-item mr-3 mb-lg-0">
				
				
				
				
				<a class="nav-link" href="/blog" ><span>Blogs</span></a>
			</li>
            
            
            
            
            <li class="nav-item mr-3 mb-lg-0">
				
				
				
				
				<a class="nav-link" href="/downloads" ><span>Downloads</span></a>
			</li>
            
            
            
            
            <li class="nav-item mr-3 mb-lg-0">
				
				
				
				
				<a class="nav-link" href="/team" ><span>Team</span></a>
			</li>
            
            
            
            
            <li class="nav-item mr-3 mb-lg-0">
				
				
				
				
				<a class="nav-link" href="/users" ><span>Users</span></a>
			</li>
            
            
            
            
            
            <li class="nav-item mr-3 mb-lg-0">
                <span class="link dropdown blog">
                    <a class="link-name nav-link dropdown-toggle" href="#" role="button" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">中文资料</a>
                    <div class="dropdown-menu">
                        <a class="dropdown-item" href="/zh/">博客</a>
                        <a class="dropdown-item" href="https://space.bilibili.com/390683219" target="_blank" rel="noopener noreferrer">
                            B站
                        </a>
                        <a class="dropdown-item" href="https://juejin.cn/user/13673577331607" target="_blank" rel="noopener noreferrer">
                            掘金
                        </a>
                    </div>
                </span>
            </li>

            
			
        </ul>
    </div>
    <div class="navbar-nav d-none d-lg-block search-input-box">
         
            
        
            
        
            
        
            
        
            
        
            
        
            
            <span class="link dropdown">
                <a class="link-name dropdown-toggle" href="#" role="button" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
                    Links
                </a>
                <div class="dropdown-menu">
                    
                    <a class="dropdown-item" href="http://www.apache.org/">Apache Software Foundation</a> 
                    <a class="dropdown-item" href="https://github.com/apache/skywalking/issues">GitHub Issue Tracker</a> 
                    <a class="dropdown-item" href="https://github.com/apache/skywalking/discussions">Discussion</a> 
                    <a class="dropdown-item" href="https://lists.apache.org/list.html?dev@skywalking.apache.org">Dev Mailing List</a> 
                    <a class="dropdown-item" href="https://cwiki.apache.org/confluence/display/SKYWALKING/Home">WIKI</a> 
                    <a class="dropdown-item" href="http://www.apache.org/licenses/">License</a> 
                    <a class="dropdown-item" href="http://www.apache.org/events/current-event">Apache Events</a> 
                    <a class="dropdown-item" href="http://www.apache.org/security/">Security</a> 
                    <a class="dropdown-item" href="http://www.apache.org/foundation/sponsorship.html">Sponsor and Donate</a> 
                    <a class="dropdown-item" href="http://www.apache.org/foundation/thanks.html">Thanks</a> 
                    <a class="dropdown-item" href="https://apache.org/foundation/policies/privacy.html">Privacy</a> 
                </div>
            </span>
            
        
        
<div id="docsearch"></div>


    </div>
</nav>

    </header>
    <div class="container-fluid td-outer">
      <div class="td-main">
        <div class="row container container-center">

          <main class="col-12 col-md-12 col-xl-10 pl-md-4 pr-md-4" role="main">
            
<div class="td-content">
	<h1>Activating Automatical Performance Analysis -- Continuous Profiling</h1>
	<div class="lead">Introduce and demonstrate how SkyWalking implements eBPF-based process monitoring with few manual engagements. The profiling could be automatically activated driven by the preset conditions.</div>
	<div class="td-byline mb-4">
		By <b>Han Liu</b> |
		<time datetime="2023-06-25" class="text-muted">Sunday, June 25, 2023</time>


		
		<p class="mt-1 tags-box">
			<i class="iconfont icon-tags"></i>Tags |
			
			<span> <a href="/tags/ebpf">eBPF</a></span>
			
			<span> <a href="/tags/profiling">Profiling</a></span>
			
			<span> <a href="/tags/tracing">Tracing</a></span>
			
		</p>
		


	</div>
	<h1 id="background">Background</h1>
<p>In previous articles, We have discussed how to use SkyWalking and eBPF for performance problem detection within <a href="/blog/2022-07-05-pinpoint-service-mesh-critical-performance-impact-by-using-ebpf">processes</a> and <a href="blog/diagnose-service-mesh-network-performance-with-ebpf">networks</a>.
They are good methods to locate issues, but still there are some challenges:</p>
<ol>
<li><strong>The timing of the task initiation</strong>: It&rsquo;s always challenging to address the processes that require performance monitoring when problems occur.
Typically, manual engagement is required to identify processes and the types of performance analysis necessary, which cause extra time during the crash recovery.
The root cause locating and the time of crash recovery conflict with each other from time to time.
In the real case, rebooting would be the first choice of recovery, meanwhile, it destroys the site of crashing.</li>
<li><strong>Resource consumption of tasks</strong>: The difficulties to determine the profiling scope. Wider profiling causes more resources than it should.
We need a method to manage resource consumption and understand which processes necessitate performance analysis.</li>
<li><strong>Engineer capabilities</strong>: On-call is usually covered by the whole team, which have junior and senior engineers, even senior engineers have their understanding limitation of the complex distributed system,
it is nearly impossible to understand the whole system by a single one person.</li>
</ol>
<p>The <strong>Continuous Profiling</strong> is a new created mechanism to resolve the above issues.</p>
<h1 id="automate-profiling">Automate Profiling</h1>
<p>As profiling is resource costing and high experience required, how about introducing a method to narrow the scope and automate the profiling driven by polices creates by senior SRE engineer?
So, in 9.5.0, SkyWalking first introduced preset policy rules for specific services to be monitored by the eBPF Agent in a low-energy manner, and run profiling when necessary automatically.</p>
<h2 id="policy">Policy</h2>
<p>Policy rules specify how to monitor target processes and determine the type of profiling task to initiate when certain threshold conditions are met.</p>
<p>These policy rules primarily consist of the following configuration information:</p>
<ol>
<li><strong>Monitoring type</strong>: This specifies what kind of monitoring should be implemented on the target process.</li>
<li><strong>Threshold determination</strong>: This defines how to determine whether the target process requires the initiation of a profiling task.</li>
<li><strong>Trigger task</strong>: This specifies what kind of performance analysis task should be initiated.</li>
</ol>
<h3 id="monitoring-type">Monitoring type</h3>
<p>The type of monitoring is determined by observing the data values of a specified process to generate corresponding metrics.
These metric values can then facilitate subsequent threshold judgment operations.
In eBPF observation, we believe the following metrics can most directly reflect the current performance of the program:</p>
<table>
<thead>
<tr>
<th>Monitor Type</th>
<th>Unit</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td>System Load</td>
<td>Load</td>
<td>System load average over a specified period.</td>
</tr>
<tr>
<td>Process CPU</td>
<td>Percentage</td>
<td>The CPU usage of the process as a percentage.</td>
</tr>
<tr>
<td>Process Thread Count</td>
<td>Count</td>
<td>The number of threads in the process.</td>
</tr>
<tr>
<td>HTTP Error Rate</td>
<td>Percentage</td>
<td>The percentage of HTTP requests that result in error responses (e.g., 4xx or 5xx status codes).</td>
</tr>
<tr>
<td>HTTP Avg Response Time</td>
<td>Millisecond</td>
<td>The average response time for HTTP requests.</td>
</tr>
</tbody>
</table>
<h4 id="network-related-monitoring">Network related monitoring</h4>
<p>Monitoring network type metrics is not as simple as obtaining basic process information.
It requires the initiation of eBPF programs and attaching them to the target process for observation.
This is similar to the principles of <a href="blog/diagnose-service-mesh-network-performance-with-ebpf">network profiling task we introduced in the previous article</a>,
except that we no longer collect the full content of the data packets. Instead, we only collect the content of messages that match specified HTTP prefixes.</p>
<p>By using this method, we can significantly reduce the number of times the kernel sends data to the user space,
and the user-space program can parse the data content with less system resource usage. This ultimately helps in conserving system resources.</p>
<h4 id="metrics-collector">Metrics collector</h4>
<p>The eBPF agent would report metrics of processes periodically as follows to indicate the process performance in time.</p>
<table>
<thead>
<tr>
<th>Name</th>
<th>Unit</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td>process_cpu</td>
<td>(0-100)%</td>
<td>The CPU usage percent</td>
</tr>
<tr>
<td>process_thread_count</td>
<td>count</td>
<td>The thread count of process</td>
</tr>
<tr>
<td>system_load</td>
<td>count</td>
<td>The average system load for the last minute, each process have same value</td>
</tr>
<tr>
<td>http_error_rate</td>
<td>(0-100)%</td>
<td>The network request error rate percentage</td>
</tr>
<tr>
<td>http_avg_response_time</td>
<td>ms</td>
<td>The network average response duration</td>
</tr>
</tbody>
</table>
<h3 id="threshold-determination">Threshold determination</h3>
<p>For the threshold determination, the judgement is made by the eBPF Agent based on the target monitoring process in its own memory,
rather than relying on calculations performed by the SkyWalking backend.
The advantage of this approach is that it doesn&rsquo;t have to wait for the results of complex backend computations,
and it reduces potential issues brought about by complicated interactions.</p>
<p>By using this method, the eBPF Agent can swiftly initiate tasks immediately after conditions are met, without any delay.</p>
<p>It includes the following configuration items:</p>
<ol>
<li><strong>Threshold</strong>: Check if the monitoring value meets the specified expectations.</li>
<li><strong>Period</strong>: The time period(seconds) for monitoring data, which can also be understood as the most recent duration.</li>
<li><strong>Count</strong>: The number of times(seconds) the threshold is triggered within the detection period, which can also be understood as the total number of times the specified threshold rule is triggered in the most recent duration(seconds). Once the count check is met, the specified Profiling task will be started.</li>
</ol>
<h3 id="trigger-task">Trigger task</h3>
<p>When the eBPF Agent detects that the threshold determination in the specified policy meets the rules, it can initiate the corresponding task according to pre-configured rules.
For each different target performance task, their task initiation parameters are different:</p>
<ul>
<li><strong>On/Off CPU Profiling</strong>: It automatically performs performance analysis on processes that meet the conditions, defaulting to <code>10</code> minutes of monitoring.</li>
<li><strong>Network Profiling</strong>: It performs network performance analysis on all processes in the same <strong>Service Instance on the current machine</strong>,
to prevent the cause of the issue from being unrealizable due to too few process being collected, defaulting to <code>10</code> minutes of monitoring.</li>
</ul>
<p>Once the task is initiated, no new profiling tasks would be started for the current process for a certain period.
The main reason for this is to prevent frequent task creation due to low threshold settings, which could affect program execution. The default time period is <code>20</code> minutes.</p>
<h2 id="data-flow">Data Flow</h2>
<p>The figure 1 illustrates the data flow of the continuous profiling feature:</p>
<p><img src="./data-flow.png" alt="Figure 1: Data Flow of Continuous Profiling"></p>
<p><em>Figure 1: Data Flow of Continuous Profiling</em></p>
<h3 id="ebpf-agent-with-process">eBPF Agent with Process</h3>
<p>Firstly, we need to ensure that the eBPF Agent and the process to be monitored are deployed on the same host machine,
so that we can collect relevant data from the process. When the eBPF Agent detects a threshold validation rule that conforms to the policy,
it immediately triggers the profiling task for the target process, thereby reducing any intermediate steps and accelerating the ability to pinpoint performance issues.</p>
<h4 id="sliding-window">Sliding window</h4>
<p>The sliding window plays a crucial role in the eBPF Agent&rsquo;s threshold determination process, as illustrated in the figure 2:</p>
<p><img src="./sliding-window.png" alt="Figure 2: Sliding Window in eBPF Agent"></p>
<p><em>Figure 2: Sliding Window in eBPF Agent</em></p>
<p>Each element in the array represents the data value for a specified second in time.
When the sliding window needs to verify whether it is responsible for a rule,
it fetches the content of each element from a certain number of recent elements (period parameter).
If an element exceeds the threshold, it is marked in red and counted. If the number of red elements exceeds a certain number, it is deemed to trigger a task.</p>
<p>Using a sliding window offers the following two advantages:</p>
<ol>
<li><strong>Fast retrieval of recent content</strong>: With a sliding window, complex calculations are unnecessary.
You can know the data by simply reading a certain number of recent array elements.</li>
<li><strong>Solving data spikes issues</strong>: Validation through count prevents situations where a data point suddenly spikes and then quickly returns to normal.
Verification with multiple values can reveal whether exceeding the threshold is frequent or occasional.</li>
</ol>
<h3 id="ebpf-agent-with-skywalking-backend">eBPF Agent with SkyWalking Backend</h3>
<p>The eBPF Agent communicates periodically with the SkyWalking backend, involving three most crucial operations:</p>
<ol>
<li><strong>Policy synchronization</strong>: Through periodic policy synchronization, the eBPF Agent can keep processes on the local machine updated with the latest policy rules as much as possible.</li>
<li><strong>Metrics sending</strong>: For processes that are already being monitored, the eBPF Agent periodically sends the collected data to the backend program.
This facilitates real-time query of current data values by users, who can also compare this data with historical values or thresholds when problems arise.</li>
<li><strong>Profiling task reporting</strong>: When the eBPF detects that a certain process has triggered a policy rule, it automatically initiates a performance task,
collects relevant information from the current process, and reports it to the SkyWalking backend. This allows users to know <strong>when, why, and what</strong> type of profiling task was triggered from the interface.</li>
</ol>
<h1 id="demo">Demo</h1>
<p>Next, let&rsquo;s quickly demonstrate the continuous profiling feature, so you can understand more specifically what it accomplishes.</p>
<h2 id="deploy-skywalking-showcase">Deploy SkyWalking Showcase</h2>
<p>SkyWalking Showcase contains a complete set of example services and can be monitored using SkyWalking.
For more information, please check the <a href="https://skywalking.apache.org/docs/skywalking-showcase/next/readme/">official documentation</a>.</p>
<p>In this demo, we only deploy service, the latest released SkyWalking OAP, and UI.</p>
<div class="highlight"><pre style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-shell" data-lang="shell"><span style="color:#0086b3">export</span> <span style="color:#008080">SW_OAP_IMAGE</span><span style="color:#000;font-weight:bold">=</span>apache/skywalking-oap-server:9.5.0
<span style="color:#0086b3">export</span> <span style="color:#008080">SW_UI_IMAGE</span><span style="color:#000;font-weight:bold">=</span>apache/skywalking-ui:9.5.0
<span style="color:#0086b3">export</span> <span style="color:#008080">SW_ROVER_IMAGE</span><span style="color:#000;font-weight:bold">=</span>apache/skywalking-rover:0.5.0

<span style="color:#0086b3">export</span> <span style="color:#008080">FEATURE_FLAGS</span><span style="color:#000;font-weight:bold">=</span>mesh-with-agent,single-node,elasticsearch,rover
make deploy.kubernetes
</code></pre></div><p>After deployment is complete, please run the following script to open SkyWalking UI: http://localhost:8080/.</p>
<div class="highlight"><pre style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-shell" data-lang="shell">kubectl port-forward svc/ui 8080:8080 --namespace default
</code></pre></div><h2 id="create-continuous-profiling-policy">Create Continuous Profiling Policy</h2>
<p>Currently, continues profiling feature is set by default in the <strong>Service Mesh</strong> panel at the <strong>Service</strong> level.</p>
<p><img src="./continuous-profiling.png" alt="Figure 3: Continuous Policy Tab"></p>
<p><em>Figure 3: Continuous Policy Tab</em></p>
<p>By clicking on the edit button aside from the <code>Policy List</code>, the polices of current service could be created or updated.</p>
<p><img src="./edit-continuous-profiling-polocy.png" alt="Figure 4: Edit Continuous Profiling Policy"></p>
<p><em>Figure 4: Edit Continuous Profiling Policy</em></p>
<p>Multiple polices are supported. Every policy has the following configurations.</p>
<ol>
<li><strong>Target Type</strong>: Specifies the type of profiling task to be triggered when the threshold determination is met.</li>
<li><strong>Items</strong>: For profiling task of the same target, one or more validation items can be specified.
As long as one validation item meets the threshold determination, the corresponding performance analysis task will be launched.
<ol>
<li><strong>Monitor Type</strong>: Specifies the type of monitoring to be carried out for the target process.</li>
<li><strong>Threshold</strong>: Depending on the type of monitoring, you need to fill in the corresponding threshold to complete the verification work.</li>
<li><strong>Period</strong>: Specifies the number of recent seconds of data you want to monitor.</li>
<li><strong>Count</strong>: Determines the total number of seconds triggered within the recent period.</li>
<li><strong>URI Regex/List</strong>: This is applicable to HTTP monitoring types, allowing URL filtering.</li>
</ol>
</li>
</ol>
<h2 id="done">Done</h2>
<p>After clicking the save button, you can see the currently created monitoring rules, as shown in the figure 5:</p>
<p><img src="./continuous-profiling-monitoring.png" alt="Figure 5: Continuous Profiling Monitoring Processes"></p>
<p><em>Figure 5: Continuous Profiling Monitoring Processes</em></p>
<p>The data can be divided into the following parts:</p>
<ol>
<li><strong>Policy list</strong>: On the left, you can see the rule list you have created.</li>
<li><strong>Monitoring Summary List</strong>: Once a rule is selected, you can see which pods and processes would be monitored by this rule.
It also summarizes how many profiling tasks have been triggered in the <strong>last 48 hours</strong> by the current pod or process, as well as the last trigger time.
This list is also sorted in descending order by the number of triggers to facilitate your quick review.</li>
</ol>
<p>When you click on a specific process, a new dashboard would show to list metrics and triggered profiling results.</p>
<p><img src="./continuous-profiling-tasks.png" alt="Figure 6: Continuous Profiling Triggered Tasks"></p>
<p><em>Figure 6: Continuous Profiling Triggered Tasks</em></p>
<p>The current figure contains the following data contents:</p>
<ol>
<li><strong>Task Timeline</strong>: It lists all profiling tasks in the <strong>past 48 hours</strong>. And when the mouse hovers over a task, it would also display detailed information:
<ol>
<li><strong>Task start and end time</strong>: It indicates when the current performance analysis task was triggered.</li>
<li><strong>Trigger reason</strong>: It would display the reason why the current process was profiled and list out the value of the metric exceeding the threshold when the profiling was triggered.
so you can quickly understand the reason.</li>
</ol>
</li>
<li><strong>Task Detail</strong>: Similar to the CPU Profiling and Network Profiling introduced in previous articles, this would display the flame graph or process topology map of the current task,
depending on the profiling type.</li>
</ol>
<p>Meanwhile, on the <strong>Metrics</strong> tab, metrics relative to profiling policies are collected to retrieve the historical trend, in order to provide a comprehensive explanation of the trigger point about the profiling.</p>
<p><img src="./continuous-profiling-metrics.png" alt="Figure 7: Continuous Profiling Metrics"></p>
<p><em>Figure 7: Continuous Profiling Metrics</em></p>
<h1 id="conclusion">Conclusion</h1>
<p>In this article, I have detailed how the continuous profiling feature in SkyWalking and eBPF works.
In general, it involves deploying the eBPF Agent service on the same machine where the process to be monitored resides,
and monitoring the target process with low resource consumption. When it meets the threshold conditions,
it would initiate more complex CPU Profiling and Network Profiling tasks.</p>
<p>In the future, we will offer even more features. Stay tuned!</p>
<ul>
<li>Twitter, <a href="https://twitter.com/AsfSkyWalking">ASFSkyWalking</a></li>
<li>Slack. Send <code>Request to join SkyWalking slack</code> mail to the mail list(<code>dev@skywalking.apache.org</code>), we will invite you in.</li>
<li>Subscribe to our <a href="https://medium.com/@AsfSkyWalking">medium list</a>.</li>
</ul>

	

	<ul class="list-unstyled d-flex justify-content-between align-items-center mb-0 pt-5">
  <li>
    <a href="/blog/2023-06-13-celebrate-22k-stars/" class="btn btn-primary "><span class="mr-1">←</span> Previous</a>
  </li>
    <a href="/blog/2023-07-31-skywalking-go-0.2.0-release/" class="btn btn-primary ">Next <span class="ml-1">→</span></a>
  </li>
</ul>

</div>


          </main>
          <div class="d-none d-xl-block col-xl-2 td-toc d-print-none">

            <div class="tags-wrapper">
    <div class="font-weight-bold post-meta ">
        <i class="iconfont icon-tags pr-1" aria-hidden="true"></i>
        Tags
    </div>
    <ul class="tags-box">
        
        <li>
            <a href="/tags/agent/" class="tag-link">Agent</a>
            <span class="count">10</span>
        </li>
        
        <li>
            <a href="/tags/apache-shenyu-incubating/" class="tag-link">Apache ShenYu (incubating)</a>
            <span class="count">1</span>
        </li>
        
        <li>
            <a href="/tags/apisix/" class="tag-link">APISIX</a>
            <span class="count">1</span>
        </li>
        
        <li>
            <a href="/tags/apm/" class="tag-link">APM</a>
            <span class="count">1</span>
        </li>
        
        <li>
            <a href="/tags/arthas/" class="tag-link">Arthas</a>
            <span class="count">1</span>
        </li>
        
        <li>
            <a href="/tags/aurora/" class="tag-link">Aurora</a>
            <span class="count">2</span>
        </li>
        
        <li>
            <a href="/tags/aws/" class="tag-link">AWS</a>
            <span class="count">2</span>
        </li>
        
        <li>
            <a href="/tags/browser/" class="tag-link">Browser</a>
            <span class="count">1</span>
        </li>
        
        <li>
            <a href="/tags/chaos-engineering/" class="tag-link">Chaos Engineering</a>
            <span class="count">1</span>
        </li>
        
        <li>
            <a href="/tags/chaos-mesh/" class="tag-link">Chaos Mesh</a>
            <span class="count">1</span>
        </li>
        
        <li>
            <a href="/tags/clickhouse/" class="tag-link">ClickHouse</a>
            <span class="count">2</span>
        </li>
        
        <li>
            <a href="/tags/conference/" class="tag-link">Conference</a>
            <span class="count">6</span>
        </li>
        
        <li>
            <a href="/tags/database/" class="tag-link">Database</a>
            <span class="count">1</span>
        </li>
        
        <li>
            <a href="/tags/demo/" class="tag-link">Demo</a>
            <span class="count">3</span>
        </li>
        
        <li>
            <a href="/tags/design/" class="tag-link">Design</a>
            <span class="count">2</span>
        </li>
        
        <li>
            <a href="/tags/dotnetcore/" class="tag-link">DotNetCore</a>
            <span class="count">1</span>
        </li>
        
        <li>
            <a href="/tags/ebpf/" class="tag-link">eBPF</a>
            <span class="count">6</span>
        </li>
        
        <li>
            <a href="/tags/golang/" class="tag-link">Golang</a>
            <span class="count">5</span>
        </li>
        
        <li>
            <a href="/tags/grafana/" class="tag-link">Grafana</a>
            <span class="count">2</span>
        </li>
        
        <li>
            <a href="/tags/http/" class="tag-link">HTTP</a>
            <span class="count">2</span>
        </li>
        
        <li>
            <a href="/tags/infrastructure-monitoring/" class="tag-link">Infrastructure Monitoring</a>
            <span class="count">1</span>
        </li>
        
        <li>
            <a href="/tags/iotdb/" class="tag-link">IoTDB</a>
            <span class="count">2</span>
        </li>
        
        <li>
            <a href="/tags/istio/" class="tag-link">Istio</a>
            <span class="count">2</span>
        </li>
        
        <li>
            <a href="/tags/java/" class="tag-link">Java</a>
            <span class="count">2</span>
        </li>
        
        <li>
            <a href="/tags/kafka/" class="tag-link">Kafka</a>
            <span class="count">1</span>
        </li>
        
        <li>
            <a href="/tags/kong/" class="tag-link">Kong</a>
            <span class="count">1</span>
        </li>
        
        <li>
            <a href="/tags/lal/" class="tag-link">LAL</a>
            <span class="count">1</span>
        </li>
        
        <li>
            <a href="/tags/license/" class="tag-link">License</a>
            <span class="count">5</span>
        </li>
        
        <li>
            <a href="/tags/logging/" class="tag-link">Logging</a>
            <span class="count">3</span>
        </li>
        
        <li>
            <a href="/tags/logs/" class="tag-link">Logs</a>
            <span class="count">2</span>
        </li>
        
        <li>
            <a href="/tags/metric/" class="tag-link">Metric</a>
            <span class="count">6</span>
        </li>
        
        <li>
            <a href="/tags/metrics/" class="tag-link">Metrics</a>
            <span class="count">2</span>
        </li>
        
        <li>
            <a href="/tags/nginx/" class="tag-link">Nginx</a>
            <span class="count">5</span>
        </li>
        
        <li>
            <a href="/tags/observability/" class="tag-link">Observability</a>
            <span class="count">10</span>
        </li>
        
        <li>
            <a href="/tags/ospp/" class="tag-link">OSPP</a>
            <span class="count">1</span>
        </li>
        
        <li>
            <a href="/tags/performance/" class="tag-link">Performance</a>
            <span class="count">3</span>
        </li>
        
        <li>
            <a href="/tags/profiling/" class="tag-link">Profiling</a>
            <span class="count">5</span>
        </li>
        
        <li>
            <a href="/tags/promql/" class="tag-link">PromQL</a>
            <span class="count">2</span>
        </li>
        
        <li>
            <a href="/tags/python/" class="tag-link">Python</a>
            <span class="count">1</span>
        </li>
        
        <li>
            <a href="/tags/rds/" class="tag-link">RDS</a>
            <span class="count">2</span>
        </li>
        
        <li>
            <a href="/tags/release-blog/" class="tag-link">Release Blog</a>
            <span class="count">4</span>
        </li>
        
        <li>
            <a href="/tags/rocketmq/" class="tag-link">RocketMQ</a>
            <span class="count">1</span>
        </li>
        
        <li>
            <a href="/tags/satellite/" class="tag-link">Satellite</a>
            <span class="count">1</span>
        </li>
        
        <li>
            <a href="/tags/service-mesh/" class="tag-link">Service Mesh</a>
            <span class="count">6</span>
        </li>
        
        <li>
            <a href="/tags/sharding-sphere/" class="tag-link">Sharding-Sphere</a>
            <span class="count">1</span>
        </li>
        
        <li>
            <a href="/tags/sharding-sphere-proxy/" class="tag-link">Sharding-Sphere-proxy</a>
            <span class="count">1</span>
        </li>
        
        <li>
            <a href="/tags/skywalking/" class="tag-link">SkyWalking</a>
            <span class="count">5</span>
        </li>
        
        <li>
            <a href="/tags/spring/" class="tag-link">Spring</a>
            <span class="count">1</span>
        </li>
        
        <li>
            <a href="/tags/storage/" class="tag-link">Storage</a>
            <span class="count">2</span>
        </li>
        
        <li>
            <a href="/tags/testing/" class="tag-link">Testing</a>
            <span class="count">3</span>
        </li>
        
        <li>
            <a href="/tags/trace/" class="tag-link">Trace</a>
            <span class="count">4</span>
        </li>
        
        <li>
            <a href="/tags/tracing/" class="tag-link">Tracing</a>
            <span class="count">10</span>
        </li>
        
        <li>
            <a href="/tags/tutorial/" class="tag-link">Tutorial</a>
            <span class="count">1</span>
        </li>
        
        <li>
            <a href="/tags/user-manual/" class="tag-link">User Manual</a>
            <span class="count">2</span>
        </li>
        
        <li>
            <a href="/tags/video/" class="tag-link">Video</a>
            <span class="count">8</span>
        </li>
        
        <li>
            <a href="/tags/web-performance/" class="tag-link">Web-performance</a>
            <span class="count">1</span>
        </li>
        
    </ul>
</div>



            




<div class="td-page-meta ml-2 pb-1 pt-2 mb-0">











</div>






<nav id="TableOfContents">
  <ul>
    <li><a href="#background">Background</a></li>
    <li><a href="#automate-profiling">Automate Profiling</a>
      <ul>
        <li><a href="#policy">Policy</a>
          <ul>
            <li><a href="#monitoring-type">Monitoring type</a></li>
            <li><a href="#threshold-determination">Threshold determination</a></li>
            <li><a href="#trigger-task">Trigger task</a></li>
          </ul>
        </li>
        <li><a href="#data-flow">Data Flow</a>
          <ul>
            <li><a href="#ebpf-agent-with-process">eBPF Agent with Process</a></li>
            <li><a href="#ebpf-agent-with-skywalking-backend">eBPF Agent with SkyWalking Backend</a></li>
          </ul>
        </li>
      </ul>
    </li>
    <li><a href="#demo">Demo</a>
      <ul>
        <li><a href="#deploy-skywalking-showcase">Deploy SkyWalking Showcase</a></li>
        <li><a href="#create-continuous-profiling-policy">Create Continuous Profiling Policy</a></li>
        <li><a href="#done">Done</a></li>
      </ul>
    </li>
    <li><a href="#conclusion">Conclusion</a></li>
  </ul>
</nav>




<script>
  $(function () {
    var $toc = $("#TableOfContents");
    if (!$toc || !$toc.length) {
      return;
    }
    var top = $toc.offset().top;
    $(window).on("scroll", debounce(setTop, 100))
    $(window).on("scroll", debounce(addActive, 30))

    function addActive() {
      var scrollValue = $(window).scrollTop();
      var topEle = null;
      $.each($('main h1, main h2, main h3'), function (index, item) {
        if ($(item).offset().top - 70 > scrollValue) {
          return
        }
        if (!topEle) {
          topEle = item
        } else if ($(item).offset().top >= $(topEle).offset().top) {
          topEle = item
        }
        if (topEle) {
          var id = $(item).attr('id');
          $toc.find('a').removeClass("active").end().find('a[href="' + '#' + id + '"]').addClass("active")
        }
      })
    }

    function setTop() {
      var scrollValue = $(window).scrollTop();
      if (scrollValue >= top - 70) {
        $toc.addClass('fixed')
      } else {
        $toc.removeClass('fixed')
      }
    }

    function debounce(fn, wait) {
      var timeout = null;
      return function () {
        clearTimeout(timeout);
        timeout = setTimeout(() => {
          fn.apply(this, arguments);
        }, wait);
      };
    }
  })

</script>

          </div>
        </div>
      </div>
      
<footer class="py-5 sky-row">
  <div class="container-fluid text-center">
    <div class="">
        
        
        
<ul class="list-inline mb-0">
  
  <li class="list-inline-item mx-2 h3" data-toggle="tooltip" data-placement="top" title="Twitter" aria-label="Twitter">
    <a class="text-color" target="_blank" href="https://twitter.com/asfskywalking">
      <i class="iconfont icon-twitter"></i>
    </a>
  </li>
  
  <li class="list-inline-item mx-2 h3" data-toggle="tooltip" data-placement="top" title="Slack" aria-label="Slack">
    <a class="text-color" target="_blank" href="http://s.apache.org/slack-invite">
      <i class="iconfont icon-slack"></i>
    </a>
  </li>
  
  <li class="list-inline-item mx-2 h3" data-toggle="tooltip" data-placement="top" title="Mailing list" aria-label="Mailing list">
    <a class="text-color" target="_blank" href="https://lists.apache.org/list.html?dev@skywalking.apache.org">
      <i class="iconfont icon-email"></i>
    </a>
  </li>
  
  <li class="list-inline-item mx-2 h3" data-toggle="tooltip" data-placement="top" title="GitHub" aria-label="GitHub">
    <a class="text-color" target="_blank" href="https://github.com/apache/skywalking">
      <i class="iconfont icon-github"></i>
    </a>
  </li>
  
</ul>

        
        
    </div>
    <div class="">

        <small class="text-color">&copy; 2017 - 2024 The Apache Software Foundation All Rights Reserved</small>
        
	
    </div>
    <div class="">
      <small class="text-color mt-4">Apache SkyWalking, SkyWalking, Apache, the Apache feather logo, and the Apache SkyWalking project logo are either registered trademarks or trademarks of the Apache Software Foundation.</small>
    </div>
  </div>
</footer>


    </div>
    















































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































    
<div id="popup">
    <div class="mask">
        <img src=""/>
    </div>
</div>

    <div class="sidebar-mask"></div>
<div class="sidebar">
    <nav class="nav-links">
        <div class="nav-item"><a href="/docs/" class="nav-link">Projects and Documentation</a></div>
        <div class="nav-item"><a href="/events/" class="nav-link">Events</a></div>
        <div class="nav-item"><a href="/blog/" class="nav-link router-link-exact-active router-link-active">Blog</a>
        </div>
        <div class="nav-item"><a href="/downloads/" class="nav-link">Downloads</a></div>
        <div class="nav-item"><a href="/team/" class="nav-link">Team</a></div>
        <div class="nav-item"><a href="/users/" class="nav-link">Users</a></div>
        <div class="nav-item">
            <div class="dropdown-wrapper open">
                <a class="dropdown-title"><span>中文资料</span>
                    <span class="arrow down"></span>
                </a>
                <ul class="nav-dropdown">
                    <li class="dropdown-item">
                        <a href="/zh/" class="nav-link external">博客</a>
                    </li>
                    <li class="dropdown-item">
                        <a href="https://space.bilibili.com/390683219" target="_blank"
                           rel="noopener noreferrer" class="nav-link external">B站</a>
                    </li>
                    <li class="dropdown-item">
                        <a href="https://juejin.cn/user/13673577331607" target="_blank"
                           rel="noopener noreferrer" class="nav-link external">掘金</a>
                    </li>
                </ul>
            </div>
        </div>
        <div class="nav-item">
            <div class="dropdown-wrapper open">
                <a class="dropdown-title">
                    <span>Links</span>
                    <span class="arrow down"></span>
                </a>
                <ul class="nav-dropdown">
                    <li class="dropdown-item">
                        <a href="http://www.apache.org/" target="_blank"
                           rel="noopener noreferrer" class="nav-link external">
                            Apache Software Foundation
                        </a>
                    </li>
                    <li class="dropdown-item">
                        <a href="https://github.com/apache/skywalking/issues"
                           target="_blank" rel="noopener noreferrer"
                           class="nav-link external">
                            GitHub Issue Tracker
                        </a>
                    </li>
                    <li class="dropdown-item">
                        <a href="https://lists.apache.org/list.html?dev@skywalking.apache.org" target="_blank"
                           rel="noopener noreferrer" class="nav-link external">
                            Dev Mailing List
                        </a>
                    </li>
                    <li class="dropdown-item">
                        <a href="http://www.apache.org/licenses/" target="_blank"
                           rel="noopener noreferrer" class="nav-link external">
                            License
                        </a>
                    </li>
                    <li class="dropdown-item">
                        <a href="http://www.apache.org/events/current-event"
                           target="_blank" rel="noopener noreferrer"
                           class="nav-link external">
                            Apache Events
                        </a>
                    </li>
                    <li class="dropdown-item">
                        <a href="http://www.apache.org/security/" target="_blank"
                           rel="noopener noreferrer" class="nav-link external">
                            Security
                        </a>
                    </li>
                    <li class="dropdown-item">
                        <a href="http://www.apache.org/foundation/sponsorship.html"
                           target="_blank" rel="noopener noreferrer"
                           class="nav-link external">
                            Sponsorship and Donate
                        </a>
                    </li>
                    <li class="dropdown-item">
                        <a href="http://www.apache.org/foundation/thanks.html"
                           target="_blank" rel="noopener noreferrer"
                           class="nav-link external">
                            Thanks
                        </a>
                    </li>
                </ul>
            </div>
        </div>
    </nav>
</div>

    <script src="/js/bootstrap.bundle.min.js"></script>

<script src="https://cdn.jsdelivr.net/npm/@docsearch/js@3"></script>









<script src="/js/main.min.dc00f5ca911ee5aa105ea6de6b3b7e8d8169ba5a3bf156b1fcfe23dfe3e62b0a.js" integrity="sha256-3AD1ypEe5aoQXqbeazt&#43;jYFpulo78Vax/P4j3&#43;PmKwo=" crossorigin="anonymous"></script>


<script src="/js/mermaid.min.js"></script>
<script>
    window.onload = () => mermaid.init(undefined, ".language-mermaid");
</script>


<script defer
src="https://widget.kapa.ai/kapa-widget.bundle.js"
data-website-id="8a08392b-9c4d-4816-8bc4-f93e0ecdd2a7"
data-project-name="SkyWalking"
data-project-color="#2B74B8"
data-button-text="Ask AI"
data-search-mode-enabled="true"
data-modal-open-on-command-k="true"
data-modal-disclaimer="The AI supports multiple languages, but it may not be accessible in China, a proxy is required."
data-project-logo="https://miro.medium.com/v2/resize:fit:2400/0*kmS-5BQ8ShAhZ_F4.jpg"
data-modal-example-questions="What is Apache SkyWalking?,How to deploy SkyWalking?,How to inject agents non-intrusively?,How to setup trace sampling?"
data-button-position-top=""
data-button-position-right="20px"
data-button-position-bottom="200px"
data-button-position-left=""
></script>




  </body>
</html>
