<!doctype html>
<html lang="en" class="no-js">
  <head>
    <meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<meta name="twitter:site" content="skywalking.apache.org">
<meta name="twitter:image:src" content="https://skywalking.apache.org/images/skywalking_400x400.png">
<meta property="og:image" content="https://skywalking.apache.org/images/skywalking_400x400.png">

<meta name="generator" content="Hugo 0.80.0" />

<META NAME="ROBOTS" CONTENT="INDEX, FOLLOW">
<link rel="stylesheet" href="//at.alicdn.com/t/c/font_3007530_pvozs1rz2wn.css">



<link rel="apple-touch-icon" sizes="180x180" href="/favicons/apple-touch-icon.png">
<link rel="icon" type="image/png" sizes="32x32" href="/favicons/favicon-32x32.png">
<link rel="icon" type="image/png" sizes="16x16" href="/favicons/favicon-16x16.png">
<link rel="manifest" href="/favicons/site.webmanifest">
<link rel="mask-icon" href="/favicons/safari-pinned-tab.svg" color="#5bbad5">
<meta name="msapplication-TileColor" content="#da532c">
<meta name="theme-color" content="#ffffff">

<title>Profiling Java application with SkyWalking bundled async-profiler | Apache SkyWalking</title><meta property="og:title" content="Profiling Java application with SkyWalking bundled async-profiler" />
<meta property="og:description" content="This document presents an introduction to and usage of the async-profiler in SkyWalking." />
<meta property="og:type" content="article" />
<meta property="og:url" content="/blog/2024-12-09-skywalking-async-profiler/" />
<meta property="article:published_time" content="2024-12-09T00:00:00+00:00" />
<meta property="article:modified_time" content="2025-02-23T21:10:50+08:00" />
<meta itemprop="name" content="Profiling Java application with SkyWalking bundled async-profiler">
<meta itemprop="description" content="This document presents an introduction to and usage of the async-profiler in SkyWalking.">
<meta itemprop="datePublished" content="2024-12-09T00:00:00+00:00" />
<meta itemprop="dateModified" content="2025-02-23T21:10:50+08:00" />
<meta itemprop="wordCount" content="1209">



<meta itemprop="keywords" content="" />
<meta name="twitter:card" content="summary"/>
<meta name="twitter:title" content="Profiling Java application with SkyWalking bundled async-profiler"/>
<meta name="twitter:description" content="This document presents an introduction to and usage of the async-profiler in SkyWalking."/>



<link rel="preload" href="/scss/main.min.1fe260c8ca23282a8c8a99d7aac14fce66676b2720ae8855a90668565b416088.css" as="style">
<link href="/scss/main.min.1fe260c8ca23282a8c8a99d7aac14fce66676b2720ae8855a90668565b416088.css" rel="stylesheet" integrity="">



<link rel="stylesheet" href="/css/docSearch.css" />
<link rel="stylesheet" href="/css/highlight-github.css" />


<script src="/js/jquery-3.6.0.min.js"></script>





    <title>Profiling Java application with SkyWalking bundled async-profiler | Apache SkyWalking</title>
  </head>
  <body class="td-page td-blog">
    <header>
      
<nav class="js-navbar-scroll navbar navbar-expand  flex-column flex-md-row td-navbar">
    <div class="sidebar-button">
      <i class="iconfont icon-menu"></i>
    </div>
    <a class="navbar-brand" href="/">
        <span class="navbar-logo"><img width="130" src="/images/logo.svg" alt="SkyWalking"></span> 
    </a>
    <div class="td-navbar-nav-scroll navbar-nav-wrapper" id="navigation">
        <ul class="navbar-nav mt-lg-0">
             
            
            
            <li class="nav-item mr-3 mb-lg-0">
				
				
				
				
				<a class="nav-link" href="/docs" ><span>Projects and Docs</span></a>
			</li>
            
            
            
            
            <li class="nav-item mr-3 mb-lg-0">
				
				
				
				
				<a class="nav-link" href="/events" ><span>Events</span></a>
			</li>
            
            
            
            
            <li class="nav-item mr-3 mb-lg-0">
				
				
				
				
				<a class="nav-link" href="/blog" ><span>Blogs</span></a>
			</li>
            
            
            
            
            <li class="nav-item mr-3 mb-lg-0">
				
				
				
				
				<a class="nav-link" href="/downloads" ><span>Downloads</span></a>
			</li>
            
            
            
            
            <li class="nav-item mr-3 mb-lg-0">
				
				
				
				
				<a class="nav-link" href="/team" ><span>Team</span></a>
			</li>
            
            
            
            
            <li class="nav-item mr-3 mb-lg-0">
				
				
				
				
				<a class="nav-link" href="/users" ><span>Users</span></a>
			</li>
            
            
            
            
            
            <li class="nav-item mr-3 mb-lg-0">
                <span class="link dropdown blog">
                    <a class="link-name nav-link dropdown-toggle" href="#" role="button" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">中文资料</a>
                    <div class="dropdown-menu">
                        <a class="dropdown-item" href="/zh/">博客</a>
                        <a class="dropdown-item" href="https://space.bilibili.com/390683219" target="_blank" rel="noopener noreferrer">
                            B站
                        </a>
                        <a class="dropdown-item" href="https://juejin.cn/user/13673577331607" target="_blank" rel="noopener noreferrer">
                            掘金
                        </a>
                    </div>
                </span>
            </li>

            
			
        </ul>
    </div>
    <div class="navbar-nav d-none d-lg-block search-input-box">
         
            
        
            
        
            
        
            
        
            
        
            
        
            
            <span class="link dropdown">
                <a class="link-name dropdown-toggle" href="#" role="button" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
                    Links
                </a>
                <div class="dropdown-menu">
                    
                    <a class="dropdown-item" href="http://www.apache.org/">Apache Software Foundation</a> 
                    <a class="dropdown-item" href="https://github.com/apache/skywalking/issues">GitHub Issue Tracker</a> 
                    <a class="dropdown-item" href="https://github.com/apache/skywalking/discussions">Discussion</a> 
                    <a class="dropdown-item" href="https://lists.apache.org/list.html?dev@skywalking.apache.org">Dev Mailing List</a> 
                    <a class="dropdown-item" href="https://cwiki.apache.org/confluence/display/SKYWALKING/Home">WIKI</a> 
                    <a class="dropdown-item" href="http://www.apache.org/licenses/">License</a> 
                    <a class="dropdown-item" href="http://www.apache.org/events/current-event">Apache Events</a> 
                    <a class="dropdown-item" href="http://www.apache.org/security/">Security</a> 
                    <a class="dropdown-item" href="http://www.apache.org/foundation/sponsorship.html">Sponsor and Donate</a> 
                    <a class="dropdown-item" href="http://www.apache.org/foundation/thanks.html">Thanks</a> 
                    <a class="dropdown-item" href="https://apache.org/foundation/policies/privacy.html">Privacy</a> 
                </div>
            </span>
            
        
        
<div id="docsearch"></div>


    </div>
</nav>

    </header>
    <div class="container-fluid td-outer">
      <div class="td-main">
        <div class="row container container-center">

          <main class="col-12 col-md-12 col-xl-10 pl-md-4 pr-md-4" role="main">
            
<div class="td-content">
	<h1>Profiling Java application with SkyWalking bundled async-profiler</h1>
	<div class="lead">This document presents an introduction to and usage of the async-profiler in SkyWalking.</div>
	<div class="td-byline mb-4">
		By <b>zhengziyi0117</b> |
		<time datetime="2024-12-09" class="text-muted">Monday, December 09, 2024</time>


		


	</div>
	<h2 id="background">Background</h2>
<p><a href="https://skywalking.apache.org/">Apache SkyWalking</a> is an open-source Application Performance Management system that helps users gather logs, traces, metrics, and events from various platforms and display them on the UI.
In version 10.1.0, Apache SkyWalking can perform CPU analysis through eBPF, which supports multiple languages, but not Java. This article discusses how Apache SkyWalking 10.2.0 uses async-profiler to collect CPU, memory allocation, and locks for analysis, solving this limitation, and also provides memory allocation and occupancy analysis.</p>
<h2 id="why-use-async-profiler">Why use async-profiler</h2>
<p>The async-profiler is a low overhead sampling profiler for Java that does not suffer from the <a href="http://psy-lob-saw.blogspot.ru/2016/02/why-most-sampling-java-profilers-are.html">Safepoint bias problem</a>. It features HotSpot-specific API to collect stack traces and to track memory allocations. The profiler works with OpenJDK and other Java runtimes based on the HotSpot JVM. The async-profiler also officially supports the instruction set architectures commonly used on Linux and Mac platforms, and the sampling data can be stored in the JFR format. Compared with the JFR tool officially provided by JDK, it supports lower JDK versions (JDK 6).</p>
<h2 id="architecture-diagram">Architecture diagram</h2>
<p><img src="./arch.jpg" alt="img"></p>
<h3 id="the-processes-of-running-a-profiling-task">The processes of running a profiling task</h3>
<ol>
<li>A user submits a async-profiler task in the UI</li>
<li>The Java agent retrieves the task from the OAP Server</li>
<li>Java agent excuses the task to collect profiling data sampling through async-profiler</li>
<li>After the profiling is completed, the agent uploads the JFR file to the OAP server.</li>
<li>The server parses the JFR file to generate profiling results and marks the task as completed status.</li>
<li>The user could check the performance analysis result from the UI side.</li>
</ol>
<h2 id="demo">Demo</h2>
<p>You can setup SkyWalking showcase locally to preview this feature. In this demo, we only deploy service, the latest released SkyWalking OAP, and UI.</p>
<div class="highlight"><pre style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-sh" data-lang="sh"><span style="color:#0086b3">export</span> <span style="color:#008080">FEATURE_FLAGS</span><span style="color:#000;font-weight:bold">=</span>java-agent-injector,single-node,elasticsearch
make deploy.kubernetes
</code></pre></div><p>After deployment is complete, please run the following script to open SkyWalking UI: http://localhost:8080/.</p>
<div class="highlight"><pre style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-sh" data-lang="sh">kubectl port-forward svc/ui 8080:8080 --namespace default
</code></pre></div><h3 id="run-the-async-profiling-task-step-by-step">Run the Async Profiling Task Step by Step</h3>
<p>After the deployment is complete, users can navigate to the service page where the Java agent is configured. Upon entering the service page, users will be able to see the <code>Async Profiling</code> component. By clicking on this component, users will gain access to the relevant functionality page, where they can perform some operations.</p>
<p><img src="./facade.jpg" alt="img"></p>
<h3 id="create-a-new-task">Create a New Task</h3>
<p>Clicking <strong>New Task</strong> on the <strong>Async Profiling</strong> page will direct you to the following configuration page. The usage of each parameter is explained as follows:</p>
<ul>
<li><strong>Instance</strong>: This parameter allows you to select the instance of the service that will execute the profiling. It supports selecting multiple instances simultaneously for performance analysis.</li>
<li><strong>Duration</strong>: Specifies the duration for the task. The default duration is conservatively set to a maximum of 20 minutes, but this can be adjusted through the <a href="(https://github.com/apache/skywalking-java/blob/7e200bbbb052f0e03e5b2db09e1b0a4c6cf1d71c/apm-sniffer/config/agent.config#L170)">Java agent configuration</a>.</li>
<li><strong>Async Profiling Events</strong>: The profiling events are categorized into three types of sampling, which will be explained below:
<ul>
<li><strong>CPU Sampling</strong>: CPU, WALL, CTIMER, ITIMER. <a href="#Differences-in-CPU-sampling-during-task-creation">See the differences between these four CPU sampling types</a>.</li>
<li><strong>Memory Allocation Sampling</strong>: ALLOC.</li>
<li><strong>Lock Occupancy Sampling</strong>: LOCK.</li>
</ul>
</li>
<li><strong>ExecArgs</strong>: Extended parameters for <strong>async-profiler</strong>. Detailed <a href="#ExecArgs-in-task-creation">usage instructions</a> are available.</li>
</ul>
<p><img src="./create_task.jpg" alt="img"></p>
<h3 id="check-the-progresses-of-the-task">Check the Progresses Of the Task</h3>
<p>By clicking the task details icon, users can view the <strong>task status logs, relevant parameters, as well as instances where data collection has either failed or been successfully completed</strong>. Instances that have successfully completed data collection will be available for subsequent performance analysis.</p>
<blockquote>
<p>It is important to note that, in containerized deployments where users have not configured volume mounts, there may be cases where JFR files cannot be received. To address this, the OAP Server by default uses memory to receive and parse JFR files. The maximum acceptable size for JFR files is conservatively set to 30MB by default.</p>
<p>Users can customize the default JFR file size in the OAP configuration and opt to store the files on the filesystem before parsing them, enabling the platform to handle larger JFR files and ensuring smoother memory allocation.</p>
<p>Currently, the JFR parser requires approximately 1GB of memory to process a 200MB JFR file. (Note that this refers only to memory allocation, not the actual memory required for parsing.) Users can use this as a reference when configuring their OAP Server</p>
</blockquote>
<p><img src="./progress.jpg" alt="img"></p>
<h3 id="performance-analysis">Performance Analysis</h3>
<p>Users can select a task and choose the instances they wish to analyze for performance (multiple instances can be selected for aggregated flame graph analysis). After selecting the desired JFR event type for analysis, users can click the <strong>Analyze</strong> button to display the corresponding flame graph.</p>
<p><img src="./performance.jpg" alt="img"></p>
<h2 id="some-details">Some Details</h2>
<h3 id="differences-in-cpu-sampling-during-task-creation">Differences in CPU sampling during task creation</h3>
<p>The CPU sampling mechanism supports several modes, each representing a different sampling engine implemented by async-profiler. These modes include CPU, WALL, CTIMER, and ITIMER, and differ primarily in how they collect and generate sampling signals. The following provides a detailed description of each sampling:</p>
<ul>
<li><strong>CPU</strong>: cpu mode relies on <a href="https://man7.org/linux/man-pages/man2/perf_event_open.2.html">perf_events</a>. The idea is the same - to generate a signal every N nanoseconds of CPU time, which in this case is achieved by configuring PMU to generate an interrupt every K CPU cycles.</li>
<li><strong>WALL</strong>: Same as CPU sampling, but also samples threads in non-runnable state, such as threads in sleep</li>
<li><strong>ITIMER</strong>:  itimer mode is based on <a href="https://man7.org/linux/man-pages/man2/setitimer.2.html">setitimer(ITIMER_PROF)</a> syscall, which ideally generates a signal every given interval of the CPU time consumed by the process.</li>
<li><strong>CTIMER</strong>: ctimer aims to address these limitations of <a href="https://man7.org/linux/man-pages/man2/perf_event_open.2.html">perf_events</a> and itimer. ctimer relies on <a href="https://man7.org/linux/man-pages/man2/timer_create.2.html">timer_create</a>. It combines benefits of cpu and itimer, except that it does not allow collecting kernel stacks.</li>
</ul>
<p>For details, please refer to <a href="https://github.com/async-profiler/async-profiler/blob/master/docs/CpuSamplingEngines.md">async-profiler</a></p>
<h3 id="execargs-in-task-creation">ExecArgs in task creation</h3>
<p>By default, task parameters are separated by commas. When creating a task, users should refer to the following example format for input: <code>lock=10us,interval=10ms</code>.</p>
<p>Currently, the following parameters are supported by default:</p>
<table>
<thead>
<tr>
<th style="text-align:left">Option</th>
<th style="text-align:left">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left">chunksize=N</td>
<td style="text-align:left">approximate size of JFR chunk in bytes (default: 100 MB)</td>
</tr>
<tr>
<td style="text-align:left">chunktime=N</td>
<td style="text-align:left">duration of JFR chunk in seconds (default: 1 hour)</td>
</tr>
<tr>
<td style="text-align:left">lock[=DURATION]</td>
<td style="text-align:left">profile contended locks overflowing the DURATION ns bucket</td>
</tr>
<tr>
<td style="text-align:left">jstackdepth=N</td>
<td style="text-align:left">maximum Java stack depth (default: 2048)</td>
</tr>
<tr>
<td style="text-align:left">interval=N</td>
<td style="text-align:left">sampling interval in ns (default: 10'000'000, i.e. 10 ms)</td>
</tr>
<tr>
<td style="text-align:left">alloc[=BYTES]</td>
<td style="text-align:left">profile allocations with BYTES interval</td>
</tr>
</tbody>
</table>
<p>For other parameters, please refer to <a href="https://github.com/async-profiler/async-profiler/blob/master/src/arguments.cpp#L44">async-profiler</a> and need to be tested by yourself</p>
<h3 id="comparison-table-between-sampling-types-and-jfr-events-in-task-analysis">Comparison table between sampling types and JFR events in task analysis</h3>
<table>
<thead>
<tr>
<th style="text-align:left">Task sample type</th>
<th style="text-align:left">JFR event type</th>
<th style="text-align:left">Description</th>
<th style="text-align:left">Unit</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left">CPU<br />WALL<br /><br />ITIMER<br />CTIMER</td>
<td style="text-align:left">EXECUTION_SAMPLE</td>
<td style="text-align:left">Multiple <strong>AsyncProfilerEventType</strong> types correspond to the <strong>EXECUTION_SAMPLE</strong> event. This is primarily due to the fact that different sampling types employ distinct underlying mechanisms and have varying sampling scopes.</td>
<td style="text-align:left">Sample times. <br />The execution time can be calculated based on the sampling interval. For instance, if the number of samples is 10 and the interval is set to 10ms, the total execution time can be estimated as 100ms (the default interval is 10ms)</td>
</tr>
<tr>
<td style="text-align:left">LOCK</td>
<td style="text-align:left">THREAD_PARK<br />JAVA_MONITOR_ENTER</td>
<td style="text-align:left">Empty</td>
<td style="text-align:left">ns</td>
</tr>
<tr>
<td style="text-align:left">ALLOC</td>
<td style="text-align:left">OBJECT_ALLOCATION_IN_NEW_TLAB<br />OBJECT_ALLOCATION_OUTSIDE_TLAB</td>
<td style="text-align:left">Empty</td>
<td style="text-align:left">byte</td>
</tr>
<tr>
<td style="text-align:left">Add <code>live</code> option to extended parameters</td>
<td style="text-align:left">PROFILER_LIVE_OBJECT</td>
<td style="text-align:left">Because it is not in the event parameter of async-profiler, it is not selected separately in the task sampling type of the UI during implementation, but is used as an extended parameter</td>
<td style="text-align:left">byte</td>
</tr>
</tbody>
</table>
<h3 id="performance-expenses">Performance expenses</h3>
<p><strong>There is no performance overhead when an instance is not receiving an async-profiler task.</strong> Performance impact is only introduced once the async-profiler performance analysis is initiated. The extent of this overhead depends on the specific configuration parameters. When using the default settings, the performance impact typically ranges from 0.3% to 10%. For more detailed information, please refer to the <a href="https://github.com/async-profiler/async-profiler/issues/14">issue</a>.</p>

	

	<ul class="list-unstyled d-flex justify-content-between align-items-center mb-0 pt-5">
  <li>
    <a href="/blog/2024-10-20-skywalking-go-toolkit-metrics-log/" class="btn btn-primary "><span class="mr-1">←</span> Previous</a>
  </li>
    <a  class="btn btn-primary  disabled">Next <span class="ml-1">→</span></a>
  </li>
</ul>

</div>


          </main>
          <div class="d-none d-xl-block col-xl-2 td-toc d-print-none">

            <div class="tags-wrapper">
    <div class="font-weight-bold post-meta ">
        <i class="iconfont icon-tags pr-1" aria-hidden="true"></i>
        Tags
    </div>
    <ul class="tags-box">
        
        <li>
            <a href="/tags/activemq/" class="tag-link">ActiveMQ</a>
            <span class="count">2</span>
        </li>
        
        <li>
            <a href="/tags/agent/" class="tag-link">Agent</a>
            <span class="count">10</span>
        </li>
        
        <li>
            <a href="/tags/apache-shenyu-incubating/" class="tag-link">Apache ShenYu (incubating)</a>
            <span class="count">1</span>
        </li>
        
        <li>
            <a href="/tags/apisix/" class="tag-link">APISIX</a>
            <span class="count">1</span>
        </li>
        
        <li>
            <a href="/tags/apm/" class="tag-link">APM</a>
            <span class="count">1</span>
        </li>
        
        <li>
            <a href="/tags/arthas/" class="tag-link">Arthas</a>
            <span class="count">1</span>
        </li>
        
        <li>
            <a href="/tags/aurora/" class="tag-link">Aurora</a>
            <span class="count">2</span>
        </li>
        
        <li>
            <a href="/tags/aws/" class="tag-link">AWS</a>
            <span class="count">2</span>
        </li>
        
        <li>
            <a href="/tags/banyandb/" class="tag-link">BanyanDB</a>
            <span class="count">4</span>
        </li>
        
        <li>
            <a href="/tags/browser/" class="tag-link">Browser</a>
            <span class="count">1</span>
        </li>
        
        <li>
            <a href="/tags/chaos-engineering/" class="tag-link">Chaos Engineering</a>
            <span class="count">1</span>
        </li>
        
        <li>
            <a href="/tags/chaos-mesh/" class="tag-link">Chaos Mesh</a>
            <span class="count">1</span>
        </li>
        
        <li>
            <a href="/tags/clickhouse/" class="tag-link">ClickHouse</a>
            <span class="count">2</span>
        </li>
        
        <li>
            <a href="/tags/conference/" class="tag-link">Conference</a>
            <span class="count">6</span>
        </li>
        
        <li>
            <a href="/tags/database/" class="tag-link">Database</a>
            <span class="count">1</span>
        </li>
        
        <li>
            <a href="/tags/demo/" class="tag-link">Demo</a>
            <span class="count">3</span>
        </li>
        
        <li>
            <a href="/tags/design/" class="tag-link">Design</a>
            <span class="count">2</span>
        </li>
        
        <li>
            <a href="/tags/dotnetcore/" class="tag-link">DotNetCore</a>
            <span class="count">1</span>
        </li>
        
        <li>
            <a href="/tags/ebpf/" class="tag-link">eBPF</a>
            <span class="count">8</span>
        </li>
        
        <li>
            <a href="/tags/golang/" class="tag-link">Golang</a>
            <span class="count">5</span>
        </li>
        
        <li>
            <a href="/tags/grafana/" class="tag-link">Grafana</a>
            <span class="count">2</span>
        </li>
        
        <li>
            <a href="/tags/http/" class="tag-link">HTTP</a>
            <span class="count">2</span>
        </li>
        
        <li>
            <a href="/tags/infrastructure-monitoring/" class="tag-link">Infrastructure Monitoring</a>
            <span class="count">1</span>
        </li>
        
        <li>
            <a href="/tags/iotdb/" class="tag-link">IoTDB</a>
            <span class="count">2</span>
        </li>
        
        <li>
            <a href="/tags/istio/" class="tag-link">Istio</a>
            <span class="count">2</span>
        </li>
        
        <li>
            <a href="/tags/java/" class="tag-link">Java</a>
            <span class="count">2</span>
        </li>
        
        <li>
            <a href="/tags/kafka/" class="tag-link">Kafka</a>
            <span class="count">1</span>
        </li>
        
        <li>
            <a href="/tags/kong/" class="tag-link">Kong</a>
            <span class="count">1</span>
        </li>
        
        <li>
            <a href="/tags/kubernetes/" class="tag-link">Kubernetes</a>
            <span class="count">2</span>
        </li>
        
        <li>
            <a href="/tags/lal/" class="tag-link">LAL</a>
            <span class="count">1</span>
        </li>
        
        <li>
            <a href="/tags/license/" class="tag-link">License</a>
            <span class="count">5</span>
        </li>
        
        <li>
            <a href="/tags/logging/" class="tag-link">Logging</a>
            <span class="count">3</span>
        </li>
        
        <li>
            <a href="/tags/logs/" class="tag-link">Logs</a>
            <span class="count">2</span>
        </li>
        
        <li>
            <a href="/tags/metric/" class="tag-link">Metric</a>
            <span class="count">6</span>
        </li>
        
        <li>
            <a href="/tags/metrics/" class="tag-link">Metrics</a>
            <span class="count">2</span>
        </li>
        
        <li>
            <a href="/tags/nginx/" class="tag-link">Nginx</a>
            <span class="count">5</span>
        </li>
        
        <li>
            <a href="/tags/observability/" class="tag-link">Observability</a>
            <span class="count">10</span>
        </li>
        
        <li>
            <a href="/tags/ospp/" class="tag-link">OSPP</a>
            <span class="count">2</span>
        </li>
        
        <li>
            <a href="/tags/performance/" class="tag-link">Performance</a>
            <span class="count">3</span>
        </li>
        
        <li>
            <a href="/tags/profiling/" class="tag-link">Profiling</a>
            <span class="count">5</span>
        </li>
        
        <li>
            <a href="/tags/promql/" class="tag-link">PromQL</a>
            <span class="count">2</span>
        </li>
        
        <li>
            <a href="/tags/python/" class="tag-link">Python</a>
            <span class="count">1</span>
        </li>
        
        <li>
            <a href="/tags/r3/" class="tag-link">R3</a>
            <span class="count">2</span>
        </li>
        
        <li>
            <a href="/tags/rds/" class="tag-link">RDS</a>
            <span class="count">2</span>
        </li>
        
        <li>
            <a href="/tags/release-blog/" class="tag-link">Release Blog</a>
            <span class="count">8</span>
        </li>
        
        <li>
            <a href="/tags/restful/" class="tag-link">RESTFul</a>
            <span class="count">2</span>
        </li>
        
        <li>
            <a href="/tags/rocketmq/" class="tag-link">RocketMQ</a>
            <span class="count">1</span>
        </li>
        
        <li>
            <a href="/tags/satellite/" class="tag-link">Satellite</a>
            <span class="count">1</span>
        </li>
        
        <li>
            <a href="/tags/service-hierarchy/" class="tag-link">Service Hierarchy</a>
            <span class="count">2</span>
        </li>
        
        <li>
            <a href="/tags/service-mesh/" class="tag-link">Service Mesh</a>
            <span class="count">6</span>
        </li>
        
        <li>
            <a href="/tags/sharding-sphere/" class="tag-link">Sharding-Sphere</a>
            <span class="count">1</span>
        </li>
        
        <li>
            <a href="/tags/sharding-sphere-proxy/" class="tag-link">Sharding-Sphere-proxy</a>
            <span class="count">1</span>
        </li>
        
        <li>
            <a href="/tags/skywalking/" class="tag-link">SkyWalking</a>
            <span class="count">5</span>
        </li>
        
        <li>
            <a href="/tags/spring/" class="tag-link">Spring</a>
            <span class="count">1</span>
        </li>
        
        <li>
            <a href="/tags/storage/" class="tag-link">Storage</a>
            <span class="count">4</span>
        </li>
        
        <li>
            <a href="/tags/testing/" class="tag-link">Testing</a>
            <span class="count">3</span>
        </li>
        
        <li>
            <a href="/tags/trace/" class="tag-link">Trace</a>
            <span class="count">4</span>
        </li>
        
        <li>
            <a href="/tags/tracing/" class="tag-link">Tracing</a>
            <span class="count">10</span>
        </li>
        
        <li>
            <a href="/tags/tutorial/" class="tag-link">Tutorial</a>
            <span class="count">1</span>
        </li>
        
        <li>
            <a href="/tags/user-manual/" class="tag-link">User Manual</a>
            <span class="count">2</span>
        </li>
        
        <li>
            <a href="/tags/video/" class="tag-link">Video</a>
            <span class="count">8</span>
        </li>
        
        <li>
            <a href="/tags/web-performance/" class="tag-link">Web-performance</a>
            <span class="count">1</span>
        </li>
        
    </ul>
</div>



            




<div class="td-page-meta ml-2 pb-1 pt-2 mb-0">











</div>






<nav id="TableOfContents">
  <ul>
    <li>
      <ul>
        <li><a href="#background">Background</a></li>
        <li><a href="#why-use-async-profiler">Why use async-profiler</a></li>
        <li><a href="#architecture-diagram">Architecture diagram</a>
          <ul>
            <li><a href="#the-processes-of-running-a-profiling-task">The processes of running a profiling task</a></li>
          </ul>
        </li>
        <li><a href="#demo">Demo</a>
          <ul>
            <li><a href="#run-the-async-profiling-task-step-by-step">Run the Async Profiling Task Step by Step</a></li>
            <li><a href="#create-a-new-task">Create a New Task</a></li>
            <li><a href="#check-the-progresses-of-the-task">Check the Progresses Of the Task</a></li>
            <li><a href="#performance-analysis">Performance Analysis</a></li>
          </ul>
        </li>
        <li><a href="#some-details">Some Details</a>
          <ul>
            <li><a href="#differences-in-cpu-sampling-during-task-creation">Differences in CPU sampling during task creation</a></li>
            <li><a href="#execargs-in-task-creation">ExecArgs in task creation</a></li>
            <li><a href="#comparison-table-between-sampling-types-and-jfr-events-in-task-analysis">Comparison table between sampling types and JFR events in task analysis</a></li>
            <li><a href="#performance-expenses">Performance expenses</a></li>
          </ul>
        </li>
      </ul>
    </li>
  </ul>
</nav>




<script>
  $(function () {
    var $toc = $("#TableOfContents");
    if (!$toc || !$toc.length) {
      return;
    }
    var top = $toc.offset().top;
    $(window).on("scroll", debounce(setTop, 100))
    $(window).on("scroll", debounce(addActive, 30))

    function addActive() {
      var scrollValue = $(window).scrollTop();
      var topEle = null;
      $.each($('main h1, main h2, main h3'), function (index, item) {
        if ($(item).offset().top - 70 > scrollValue) {
          return
        }
        if (!topEle) {
          topEle = item
        } else if ($(item).offset().top >= $(topEle).offset().top) {
          topEle = item
        }
        if (topEle) {
          var id = $(item).attr('id');
          $toc.find('a').removeClass("active").end().find('a[href="' + '#' + id + '"]').addClass("active")
        }
      })
    }

    function setTop() {
      var scrollValue = $(window).scrollTop();
      if (scrollValue >= top - 70) {
        $toc.addClass('fixed')
      } else {
        $toc.removeClass('fixed')
      }
    }

    function debounce(fn, wait) {
      var timeout = null;
      return function () {
        clearTimeout(timeout);
        timeout = setTimeout(() => {
          fn.apply(this, arguments);
        }, wait);
      };
    }
  })

</script>

          </div>
        </div>
      </div>
      
<footer class="py-5 sky-row">
  <div class="container-fluid text-center">
    <div class="">
        
        
        
<ul class="list-inline mb-0">
  
  <li class="list-inline-item mx-2 h3" data-toggle="tooltip" data-placement="top" title="Twitter" aria-label="Twitter">
    <a class="text-color" target="_blank" href="https://twitter.com/asfskywalking">
      <i class="iconfont icon-twitter"></i>
    </a>
  </li>
  
  <li class="list-inline-item mx-2 h3" data-toggle="tooltip" data-placement="top" title="Slack" aria-label="Slack">
    <a class="text-color" target="_blank" href="http://s.apache.org/slack-invite">
      <i class="iconfont icon-slack"></i>
    </a>
  </li>
  
  <li class="list-inline-item mx-2 h3" data-toggle="tooltip" data-placement="top" title="Mailing list" aria-label="Mailing list">
    <a class="text-color" target="_blank" href="https://lists.apache.org/list.html?dev@skywalking.apache.org">
      <i class="iconfont icon-email"></i>
    </a>
  </li>
  
  <li class="list-inline-item mx-2 h3" data-toggle="tooltip" data-placement="top" title="GitHub" aria-label="GitHub">
    <a class="text-color" target="_blank" href="https://github.com/apache/skywalking">
      <i class="iconfont icon-github"></i>
    </a>
  </li>
  
</ul>

        
        
    </div>
    <div class="">

        <small class="text-color">&copy; 2017 - 2025 The Apache Software Foundation All Rights Reserved</small>
        
	
    </div>
    <div class="">
      <small class="text-color mt-4">Apache SkyWalking, SkyWalking, Apache, the Apache feather logo, and the Apache SkyWalking project logo are either registered trademarks or trademarks of the Apache Software Foundation.</small>
    </div>
  </div>
</footer>


    </div>
    

















































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































    
<div id="popup">
    <div class="mask">
        <img src=""/>
    </div>
</div>

    <div class="sidebar-mask"></div>
<div class="sidebar">
    <nav class="nav-links">
        <div class="nav-item"><a href="/docs/" class="nav-link">Projects and Documentation</a></div>
        <div class="nav-item"><a href="/events/" class="nav-link">Events</a></div>
        <div class="nav-item"><a href="/blog/" class="nav-link router-link-exact-active router-link-active">Blog</a>
        </div>
        <div class="nav-item"><a href="/downloads/" class="nav-link">Downloads</a></div>
        <div class="nav-item"><a href="/team/" class="nav-link">Team</a></div>
        <div class="nav-item"><a href="/users/" class="nav-link">Users</a></div>
        <div class="nav-item">
            <div class="dropdown-wrapper open">
                <a class="dropdown-title"><span>中文资料</span>
                    <span class="arrow down"></span>
                </a>
                <ul class="nav-dropdown">
                    <li class="dropdown-item">
                        <a href="/zh/" class="nav-link external">博客</a>
                    </li>
                    <li class="dropdown-item">
                        <a href="https://space.bilibili.com/390683219" target="_blank"
                           rel="noopener noreferrer" class="nav-link external">B站</a>
                    </li>
                    <li class="dropdown-item">
                        <a href="https://juejin.cn/user/13673577331607" target="_blank"
                           rel="noopener noreferrer" class="nav-link external">掘金</a>
                    </li>
                </ul>
            </div>
        </div>
        <div class="nav-item">
            <div class="dropdown-wrapper open">
                <a class="dropdown-title">
                    <span>Links</span>
                    <span class="arrow down"></span>
                </a>
                <ul class="nav-dropdown">
                    <li class="dropdown-item">
                        <a href="http://www.apache.org/" target="_blank"
                           rel="noopener noreferrer" class="nav-link external">
                            Apache Software Foundation
                        </a>
                    </li>
                    <li class="dropdown-item">
                        <a href="https://github.com/apache/skywalking/issues"
                           target="_blank" rel="noopener noreferrer"
                           class="nav-link external">
                            GitHub Issue Tracker
                        </a>
                    </li>
                    <li class="dropdown-item">
                        <a href="https://lists.apache.org/list.html?dev@skywalking.apache.org" target="_blank"
                           rel="noopener noreferrer" class="nav-link external">
                            Dev Mailing List
                        </a>
                    </li>
                    <li class="dropdown-item">
                        <a href="http://www.apache.org/licenses/" target="_blank"
                           rel="noopener noreferrer" class="nav-link external">
                            License
                        </a>
                    </li>
                    <li class="dropdown-item">
                        <a href="http://www.apache.org/events/current-event"
                           target="_blank" rel="noopener noreferrer"
                           class="nav-link external">
                            Apache Events
                        </a>
                    </li>
                    <li class="dropdown-item">
                        <a href="http://www.apache.org/security/" target="_blank"
                           rel="noopener noreferrer" class="nav-link external">
                            Security
                        </a>
                    </li>
                    <li class="dropdown-item">
                        <a href="http://www.apache.org/foundation/sponsorship.html"
                           target="_blank" rel="noopener noreferrer"
                           class="nav-link external">
                            Sponsorship and Donate
                        </a>
                    </li>
                    <li class="dropdown-item">
                        <a href="http://www.apache.org/foundation/thanks.html"
                           target="_blank" rel="noopener noreferrer"
                           class="nav-link external">
                            Thanks
                        </a>
                    </li>
                </ul>
            </div>
        </div>
    </nav>
</div>

    <script src="/js/bootstrap.bundle.min.js"></script>

<script src="https://cdn.jsdelivr.net/npm/@docsearch/js@3"></script>









<script src="/js/main.min.d00d7a99f9e61382b1db35fac38e0e7bdd97f8d3c663a4c4b8d02c3f1d78d894.js" integrity="sha256-0A16mfnmE4Kx2zX6w44Oe92X&#43;NPGY6TEuNAsPx142JQ=" crossorigin="anonymous"></script>


<script src="/js/highlight.min.js"></script>
<script src="/js/mermaid.min.js"></script>
<script>
    window.onload = () => mermaid.init(undefined, ".language-mermaid");
</script>
<script>
  document.addEventListener('DOMContentLoaded', () => {
    document.querySelectorAll('pre code.language-json5').forEach((block) => {
      if (block.classList.contains('language-json5')) {
        try {
          hljs.registerLanguage('json5', function(hljs) {
            return hljs.getLanguage('json');
          });
          hljs.highlightElement(block);
        } catch (error) {
          console.error("Error parsing JSON5:", error);
        }
      }
    });
  });
</script>





  </body>
</html>
