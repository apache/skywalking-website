<!doctype html>
<html lang="en" class="no-js">
  <head>
    <meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<meta name="twitter:site" content="skywalking.apache.org">
<meta name="twitter:image:src" content="https://skywalking.apache.org/images/skywalking_400x400.png">
<meta property="og:image" content="https://skywalking.apache.org/images/skywalking_400x400.png">

<meta http-equiv="Content-Security-Policy" content="frame-src 'self' https://www.google.com https://app.netlify.com;">

<meta name="generator" content="Hugo 0.80.0" />


<script async src="https://www.googletagmanager.com/gtag/js?id=G-GR8N6PGRJ3"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);};
  gtag('js', new Date());gtag('config', 'G-GR8N6PGRJ3');
</script>
<META NAME="ROBOTS" CONTENT="INDEX, FOLLOW">
<link rel="stylesheet" href="//at.alicdn.com/t/c/font_3007530_pvozs1rz2wn.css">



<link rel="apple-touch-icon" sizes="180x180" href="/favicons/apple-touch-icon.png">
<link rel="icon" type="image/png" sizes="32x32" href="/favicons/favicon-32x32.png">
<link rel="icon" type="image/png" sizes="16x16" href="/favicons/favicon-16x16.png">
<link rel="manifest" href="/favicons/site.webmanifest">
<link rel="mask-icon" href="/favicons/safari-pinned-tab.svg" color="#5bbad5">
<meta name="msapplication-TileColor" content="#da532c">
<meta name="theme-color" content="#ffffff">

<title>Plugin Development Guide | Apache SkyWalking</title><meta property="og:title" content="Plugin Development Guide" />
<meta property="og:description" content="Plugin Development Guide This documentation introduces how developers can create a plugin.
All plugins must follow these steps:
 Create a new plugin module: Create a new project in the specified directory and import the plugin API module. Define the enhancement object: Define the description for the plugin. Invoke the plugin API: Call the API provided by the core to complete the core invocation. Import the plugin module: Import the plugin into the management module for users to use." />
<meta property="og:type" content="article" />
<meta property="og:url" content="/docs/skywalking-go/latest/en/development-and-contribution/development-guide/" />

<meta itemprop="name" content="Plugin Development Guide">
<meta itemprop="description" content="Plugin Development Guide This documentation introduces how developers can create a plugin.
All plugins must follow these steps:
 Create a new plugin module: Create a new project in the specified directory and import the plugin API module. Define the enhancement object: Define the description for the plugin. Invoke the plugin API: Call the API provided by the core to complete the core invocation. Import the plugin module: Import the plugin into the management module for users to use.">

<meta itemprop="wordCount" content="3111">



<meta itemprop="keywords" content="" />
<meta name="twitter:card" content="summary"/>
<meta name="twitter:title" content="Plugin Development Guide"/>
<meta name="twitter:description" content="Plugin Development Guide This documentation introduces how developers can create a plugin.
All plugins must follow these steps:
 Create a new plugin module: Create a new project in the specified directory and import the plugin API module. Define the enhancement object: Define the description for the plugin. Invoke the plugin API: Call the API provided by the core to complete the core invocation. Import the plugin module: Import the plugin into the management module for users to use."/>



<link rel="preload" href="/scss/main.min.592235942cb3c9f3dd697382a4e7a1fad8e1c182dad2841bdce6b43b4a346ae8.css" as="style">
<link href="/scss/main.min.592235942cb3c9f3dd697382a4e7a1fad8e1c182dad2841bdce6b43b4a346ae8.css" rel="stylesheet" integrity="">



<link rel="stylesheet" href="/css/docSearch.css" />


<script src="/js/jquery-3.6.0.min.js"></script>





    <title>Plugin Development Guide | Apache SkyWalking</title>
  </head>
  <body class="td-page  project-doc">
    <header>
      
<nav class="js-navbar-scroll navbar navbar-expand  flex-column flex-md-row td-navbar">
    <div class="sidebar-button">
      <i class="iconfont icon-menu"></i>
    </div>
    <a class="navbar-brand" href="/">
        <span class="navbar-logo"><img width="130" src="/images/logo.svg" alt="SkyWalking"></span> 
    </a>
    <div class="td-navbar-nav-scroll navbar-nav-wrapper" id="navigation">
        <ul class="navbar-nav mt-lg-0">
             
            
            
            <li class="nav-item mr-3 mb-lg-0">
				
				
				
				
				<a class="nav-link" href="/docs" ><span>Projects and Docs</span></a>
			</li>
            
            
            
            
            <li class="nav-item mr-3 mb-lg-0">
				
				
				
				
				<a class="nav-link" href="/events" ><span>Events</span></a>
			</li>
            
            
            
            
            <li class="nav-item mr-3 mb-lg-0">
				
				
				
				
				<a class="nav-link" href="/blog" ><span>Blogs</span></a>
			</li>
            
            
            
            
            <li class="nav-item mr-3 mb-lg-0">
				
				
				
				
				<a class="nav-link" href="/downloads" ><span>Downloads</span></a>
			</li>
            
            
            
            
            <li class="nav-item mr-3 mb-lg-0">
				
				
				
				
				<a class="nav-link" href="/team" ><span>Team</span></a>
			</li>
            
            
            
            
            <li class="nav-item mr-3 mb-lg-0">
				
				
				
				
				<a class="nav-link" href="/users" ><span>Users</span></a>
			</li>
            
            
            
            
            
            <li class="nav-item mr-3 mb-lg-0">
                <span class="link dropdown blog">
                    <a class="link-name nav-link dropdown-toggle" href="#" role="button" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">中文资料</a>
                    <div class="dropdown-menu">
                        <a class="dropdown-item" href="/zh/">博客</a>
                        <a class="dropdown-item" href="https://space.bilibili.com/390683219" target="_blank" rel="noopener noreferrer">
                            B站
                        </a>
                        <a class="dropdown-item" href="https://juejin.cn/user/13673577331607" target="_blank" rel="noopener noreferrer">
                            掘金
                        </a>
                    </div>
                </span>
            </li>

            
			
        </ul>
    </div>
    <div class="navbar-nav d-none d-lg-block search-input-box">
         
            
        
            
        
            
        
            
        
            
        
            
        
            
            <span class="link dropdown">
                <a class="link-name dropdown-toggle" href="#" role="button" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
                    Links
                </a>
                <div class="dropdown-menu">
                    
                    <a class="dropdown-item" href="http://www.apache.org/">Apache Software Foundation</a> 
                    <a class="dropdown-item" href="https://github.com/apache/skywalking/issues">GitHub Issue Tracker</a> 
                    <a class="dropdown-item" href="https://github.com/apache/skywalking/discussions">Discussion</a> 
                    <a class="dropdown-item" href="https://lists.apache.org/list.html?dev@skywalking.apache.org">Dev Mailing List</a> 
                    <a class="dropdown-item" href="https://cwiki.apache.org/confluence/display/SKYWALKING/Home">WIKI</a> 
                    <a class="dropdown-item" href="http://www.apache.org/licenses/">License</a> 
                    <a class="dropdown-item" href="http://www.apache.org/events/current-event">Apache Events</a> 
                    <a class="dropdown-item" href="http://www.apache.org/security/">Security</a> 
                    <a class="dropdown-item" href="http://www.apache.org/foundation/sponsorship.html">Sponsor and Donate</a> 
                    <a class="dropdown-item" href="http://www.apache.org/foundation/thanks.html">Thanks</a> 
                    <a class="dropdown-item" href="https://apache.org/foundation/policies/privacy.html">Privacy</a> 
                </div>
            </span>
            
        
        
<div id="docsearch"></div>


    </div>
</nav>

    </header>
    <div class="container-fluid td-outer">

      <div class="td-main">
        <div class="row flex-xl-nowrap">
          <div class="col-12 col-md-3 col-xl-2 d-print-none scroll-bar td-sidebar">























                  <div class="description-wrapper">
                    <h5>
                    <img width="26" height="26" src="/images/project/skywalking-go.svg">
                    Go Agent
                    </h5>
                    <p>The Go Agent for Apache SkyWalking, which provides the native tracing/metrics/logging abilities for Golang projects.</p>
                  </div>
                  
                  <div class="version-wrapper">Version: 
                  <select class="version-select">
                  
                    
                    
                    <option ZgotmplZ value="next">
                    
                      next
                    
                    </option>
                  
                    
                    
                    <option selected value="latest">
                    
                      latest
                    
                    </option>
                  
                    
                    
                    <option ZgotmplZ value="v0.3.0">
                    
                      v0.3.0
                    
                    </option>
                  
                  </select>
                  </div>
                  
                  <ul class="sidebar-menu">
    
    <li>
        
            
            <a href="#">Concepts and Designs<i class="iconfont icon-arrow-right pull-right"></i></a>
            

            
<ul class="sidebar-submenu">
    

    <li>
        
            <a href="/docs/skywalking-go/latest/en/concepts-and-designs/hybrid-compilation">Hybrid Compilation</a>
        
    </li>

    

    <li>
        
            <a href="/docs/skywalking-go/latest/en/concepts-and-designs/key-principles">How SkyWalking Agent Works</a>
        
    </li>

    

    <li>
        
            <a href="/docs/skywalking-go/latest/en/concepts-and-designs/project-structure">Project Structure</a>
        
    </li>

    

</ul>

        
    </li>
    
    <li>
        
            
            <a href="#">Setup<i class="iconfont icon-arrow-right pull-right"></i></a>
            

            
<ul class="sidebar-submenu">
    

    <li>
        
            <a href="/docs/skywalking-go/latest/en/setup/gobuild">Quick Start</a>
        
    </li>

    

    <li>
        
            <a href="/docs/skywalking-go/latest/en/setup/docker">Docker</a>
        
    </li>

    

</ul>

        
    </li>
    
    <li>
        
            
            <a href="#">Advanced Features<i class="iconfont icon-arrow-right pull-right"></i></a>
            

            
<ul class="sidebar-submenu">
    

    <li>
        
            <a href="/docs/skywalking-go/latest/en/advanced-features/settings-override">Setting Override</a>
        
    </li>

    

    <li>
        
            <a href="/docs/skywalking-go/latest/en/advanced-features/logging-setup">Logging Setup</a>
        
    </li>

    

    <li>
        
            <a href="/docs/skywalking-go/latest/en/advanced-features/plugin-exclusion">Plugin Exclusion</a>
        
    </li>

    

    <li>
        
            <a href="/docs/skywalking-go/latest/en/agent/plugin-configurations">Plugin Configuration</a>
        
    </li>

    

    <li>
        
            <a href="/docs/skywalking-go/latest/en/advanced-features/grpc-tls">Transport Layer Security (TLS)</a>
        
    </li>

    

    <li>
        

            
            <a href="#">Manual APIs<i class="iconfont icon-arrow-right pull-right"></i></a>
            

            
<ul class="sidebar-submenu">
    

    <li>
        
            <a href="/docs/skywalking-go/latest/en/advanced-features/manual-apis/toolkit-trace.md">Tracing APIs</a>
        
    </li>

    

</ul>

        
    </li>

    

</ul>

        
    </li>
    
    <li>
        
            
            <a href="#">Plugins<i class="iconfont icon-arrow-right pull-right"></i></a>
            

            
<ul class="sidebar-submenu">
    

    <li>
        
            <a href="/docs/skywalking-go/latest/en/agent/support-plugins">Supported Libraries</a>
        
    </li>

    

    <li>
        
            <a href="/docs/skywalking-go/latest/en/agent/tracing-metrics-logging">Tracing, Metrics and Logging</a>
        
    </li>

    

    <li>
        
            <a href="/docs/skywalking-go/latest/en/agent/performance-tests">Go Agent Performance Test</a>
        
    </li>

    

</ul>

        
    </li>
    
    <li>
        
            
            <a href="#">Development and Contribution<i class="iconfont icon-arrow-right pull-right"></i></a>
            

            
<ul class="sidebar-submenu">
    

    <li>
        
            <a href="/docs/skywalking-go/latest/en/development-and-contribution/development-guide">Plugin Development Guide</a>
        
    </li>

    

    <li>
        
            <a href="/docs/skywalking-go/latest/en/development-and-contribution/write-plugin-testing">Write Plugin Testing</a>
        
    </li>

    

    <li>
        
            <a href="/docs/skywalking-go/latest/en/development-and-contribution/running-and-debugging">Running And Debugging</a>
        
    </li>

    

    <li>
        
            <a href="/docs/skywalking-go/latest/en/development-and-contribution/build-and-use-agent">Build and Use Agent from source codes</a>
        
    </li>

    

    <li>
        
            <a href="/docs/skywalking-go/latest/en/development-and-contribution/how-to-release">How to Release</a>
        
    </li>

    

</ul>

        
    </li>
    
</ul>
<script src="/js/sidebar-menu.js"></script>
<script>
  (function (){
    $.sidebarMenu($('.sidebar-menu'))
    var path = window.location.pathname;
    var hash = window.location.hash;
    var $a = $('.sidebar-menu a')
    $a.each(function (e){
      if($(this).attr('href')+'/' === path || $(this).attr('href').replace('#','/#') === path+hash){
        $(this).parents('li').addClass('active').show()
      }
    })
    $a.on('click',function (){
      var url = $(this).attr('href')
      if(url!=='#'){
        window.location.href = url
      }
    })
  })()
</script>

                  <div class="commit-id">Commit Id: 316433e</div>
                




















</div>
            <main class="col-12 col-md-9 col-xl-8 pl-md-5 pr-md-4" role="main">
              <i class="iconfont icon-menu-doc doc-menu-button"></i>
              
<div class="td-content">











	<h1 id="plugin-development-guide">Plugin Development Guide</h1>
<p>This documentation introduces how developers can create a plugin.</p>
<p>All plugins must follow these steps:</p>
<ol>
<li><strong>Create a new plugin module</strong>: Create a new project in the specified directory and import the plugin API module.</li>
<li><strong>Define the enhancement object</strong>: Define the description for the plugin.</li>
<li><strong>Invoke the plugin API</strong>: Call the API provided by the core to complete the core invocation.</li>
<li><strong>Import the plugin module</strong>: Import the plugin into the management module for users to use.</li>
</ol>
<h2 id="create-a-new-plugin-module">Create a new plugin module</h2>
<p>The plugin must create a new module, which is currently stored in the project&rsquo;s <a href="https://github.com/apache/skywalking-go/tree/316433e71808ec6a130e81c287caa8b2a98f45a5/plugins">plugins directory</a>.</p>
<p>Plugins can import the following two modules:</p>
<ol>
<li><strong>Agent core</strong>: This module provides all the dependencies needed for the plugin, including the plugin API, enhancement declaration objects, etc.
Agent core plugin should be <code>github.com/apache/skywalking-go/plugins/core</code> and replaced by the relative location.</li>
<li><strong>Framework to be enhanced</strong>: Import the framework you wish to enhance.</li>
</ol>
<p>Note: Plugins should <strong>NOT</strong> import and use any other modules, as this may cause compilation issues for users. If certain tools are needed, they should be provided by the agent core.</p>
<h2 id="define-the-enhancement-object">Define the enhancement object</h2>
<p>In the root directory of the project, <strong>create a new go file</strong> to define the basic information of the plugin.
The basic information includes the following methods, corresponding to the <a href="https://github.com/apache/skywalking-go/tree/316433e71808ec6a130e81c287caa8b2a98f45a5/plugins/core/instrument/declare.go">Instrument interface</a>:</p>
<ol>
<li><strong>Name</strong>: The name of the plugin. Please keep this name consistent with the newly created project name. The reason will be explained later.</li>
<li><strong>Base Package</strong>: Declare which package this plugin intercepts. For example, if you want to intercept gin, you can write: &ldquo;github.com/gin-gonic/gin&rdquo;.</li>
<li><strong>Version Checker</strong>: This method passes the version number to the enhancement object to verify whether the specified version of the framework is supported. If not, the enhancement program will not be executed.</li>
<li><strong>Points</strong>: A plugin can define one or more enhancement points. This will be explained in more detail in the following sections.</li>
<li><strong>File System</strong>: Use <code>//go:embed *</code> in the current file to import all files in this module, which will be used for file copying during the mixed compilation process.</li>
</ol>
<p>Note: Please declare <code>//skywalking:nocopy</code> at any position in this file to indicate that the file would not be copied. This file is only used for guidance during hybrid compilation.
Also, this file involves the use of the <code>embed</code> package, and if the target framework does not import the package <code>embed</code>, a compilation error may occur.</p>
<h3 id="manage-instrument-and-interceptor-codes-in-hierarchy-structure">Manage Instrument and Interceptor codes in hierarchy structure</h3>
<p>Instrument and interceptor codes are placed in root by default.
In complex instrumentation scenarios, there could be dozens of interceptors, we provide <code>PluginSourceCodePath</code> to build a hierarchy folder structure to manage those codes.</p>
<p>Notice: The instrumentation still works without proper setting of this, but the debug tool would lose the location of the source codes.</p>
<h4 id="example">Example</h4>
<p>For example, the framework needs to enhance two packages, as shown in the following directory structure:</p>
<pre><code>- plugins
  - test
    - go.mod
    - package1
      - instrument.go
      - interceptor.go
    - package2
      - instrument.go
      - interceptor.go
    ...
</code></pre><p>In the above directory structure, the <strong>test</strong> framework needs to provide multiple different enhancement objects.
In this case, a <code>PluginSourceCodePath</code> Source Code Path** method needs to be added for each enhancement object, the values of this method should be <code>package1</code> and <code>package2</code>.</p>
<h3 id="instrument-point">Instrument Point</h3>
<p>Instrument points are used to declare that which methods and structs in the current package should be instrumented. They mainly include the following information:</p>
<ol>
<li><strong>Package path</strong>: If the interception point that needs to be intercepted is not in the root directory of the current package, you need to fill in the relative path to the package.
For example, if this interception point wants to instrument content in the <code>github.com/gin-gonic/gin/render</code> directory, you need to fill in <code>render</code> here.</li>
<li><strong>Package Name</strong>(optional): Define the package name of the current package. If the package name is not defined, the package name of the current package would be used by default.
It&rsquo;s used when the package path and package name are not same, such as the name of <code>github.com/emicklei/go-restful/v3</code> is <code>restful</code>.</li>
<li><strong>Matcher(At)</strong>: Specify which eligible content in the current package path needs to be enhanced.</li>
<li><strong>Interceptor</strong>: If the current method is being intercepted (whether it&rsquo;s a static method or an instance method), the name of the interceptor must be specified.</li>
</ol>
<h4 id="method-matcher">Method Matcher</h4>
<p>Method matchers are used to intercept both static and non-static methods. The specific definitions are as follows:</p>
<div class="highlight"><pre style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-go" data-lang="go"><span style="color:#998;font-style:italic">// NewStaticMethodEnhance creates a new EnhanceMatcher for static method.
</span><span style="color:#998;font-style:italic">// name: method name needs to be enhanced.(Public and private methods are supported)
</span><span style="color:#998;font-style:italic">// filters: filters for method.
</span><span style="color:#998;font-style:italic"></span><span style="color:#000;font-weight:bold">func</span> <span style="color:#900;font-weight:bold">NewStaticMethodEnhance</span>(name <span style="color:#458;font-weight:bold">string</span>, filters <span style="color:#000;font-weight:bold">...</span>MethodFilterOption)

<span style="color:#998;font-style:italic">// NewMethodEnhance creates a new EnhanceMatcher for method.
</span><span style="color:#998;font-style:italic">// receiver: receiver type name of method needs to be enhanced.
</span><span style="color:#998;font-style:italic">// name: method name needs to be enhanced.(Public and private methods are supported)
</span><span style="color:#998;font-style:italic">// filters: filters for method.
</span><span style="color:#998;font-style:italic"></span><span style="color:#000;font-weight:bold">func</span> <span style="color:#900;font-weight:bold">NewMethodEnhance</span>(receiver, name <span style="color:#458;font-weight:bold">string</span>, filters <span style="color:#000;font-weight:bold">...</span>MethodFilterOption)
</code></pre></div><h5 id="filter-option">Filter Option</h5>
<p>Filter Options are used to validate the parameters or return values in the method.
If the method name matches but the Options validation fails, the enhancement would not be performed.</p>
<div class="highlight"><pre style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-go" data-lang="go"><span style="color:#998;font-style:italic">// WithArgsCount filter methods with specific count of arguments. 
</span><span style="color:#998;font-style:italic"></span><span style="color:#000;font-weight:bold">func</span> <span style="color:#900;font-weight:bold">WithArgsCount</span>(argsCount <span style="color:#458;font-weight:bold">int</span>)

<span style="color:#998;font-style:italic">// WithResultCount filter methods with specific count of results.
</span><span style="color:#998;font-style:italic"></span><span style="color:#000;font-weight:bold">func</span> <span style="color:#900;font-weight:bold">WithResultCount</span>(resultCount <span style="color:#458;font-weight:bold">int</span>)

<span style="color:#998;font-style:italic">// WithArgType filter methods with specific type of the index of the argument.
</span><span style="color:#998;font-style:italic"></span><span style="color:#000;font-weight:bold">func</span> <span style="color:#900;font-weight:bold">WithArgType</span>(argIndex <span style="color:#458;font-weight:bold">int</span>, dataType <span style="color:#458;font-weight:bold">string</span>)

<span style="color:#998;font-style:italic">// WithResultType filter methods with specific type of the index of the result.
</span><span style="color:#998;font-style:italic"></span><span style="color:#000;font-weight:bold">func</span> <span style="color:#900;font-weight:bold">WithResultType</span>(argIndex <span style="color:#458;font-weight:bold">int</span>, dataType <span style="color:#458;font-weight:bold">string</span>)
</code></pre></div><h5 id="demo">Demo</h5>
<p>For example, if you have the following method that needs to be intercepted:</p>
<div class="highlight"><pre style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-go" data-lang="go"><span style="color:#000;font-weight:bold">func</span> (c <span style="color:#000;font-weight:bold">*</span>Context) <span style="color:#900;font-weight:bold">HandleMethod</span>(name <span style="color:#458;font-weight:bold">string</span>) <span style="color:#458;font-weight:bold">bool</span>
</code></pre></div><p>you can describe it using this condition:</p>
<div class="highlight"><pre style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-go" data-lang="go">instrument.<span style="color:#900;font-weight:bold">NewMethodEnhance</span>(<span style="color:#d14">&#34;*Context&#34;</span>, <span style="color:#d14">&#34;HandleMethod&#34;</span>, 
	instrument.<span style="color:#900;font-weight:bold">WithArgsCount</span>(<span style="color:#099">1</span>), instrument.<span style="color:#900;font-weight:bold">WithArgType</span>(<span style="color:#099">0</span>, <span style="color:#d14">&#34;string&#34;</span>), 
	instrument.<span style="color:#900;font-weight:bold">WithResultCount</span>(<span style="color:#099">1</span>), instrument.<span style="color:#900;font-weight:bold">WithResultType</span>(<span style="color:#099">0</span>, <span style="color:#d14">&#34;bool&#34;</span>))
</code></pre></div><h4 id="struct-matcher">Struct Matcher</h4>
<p>Enhancement structures can embed enhanced fields within specified structs.
After the struct is instantiated, custom data content can be added to the specified struct in the method interceptor.</p>
<p>Struct matchers are used to intercept struct methods. The specific definitions are as follows:</p>
<div class="highlight"><pre style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-go" data-lang="go"><span style="color:#998;font-style:italic">// NewStructEnhance creates a new EnhanceMatcher for struct.
</span><span style="color:#998;font-style:italic">// name: struct name needs to be enhanced.(Public and private structs are supported)
</span><span style="color:#998;font-style:italic">// filters: filters for struct.
</span><span style="color:#998;font-style:italic"></span><span style="color:#000;font-weight:bold">func</span> <span style="color:#900;font-weight:bold">NewStructEnhance</span>(name <span style="color:#458;font-weight:bold">string</span>, filters <span style="color:#000;font-weight:bold">...</span>StructFilterOption)
</code></pre></div><h5 id="filter-option-1">Filter Option</h5>
<p>Filter Options are used to validate the fields in the structure.</p>
<div class="highlight"><pre style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-go" data-lang="go"><span style="color:#998;font-style:italic">// WithFieldExists filter the struct has the field with specific name.
</span><span style="color:#998;font-style:italic"></span><span style="color:#000;font-weight:bold">func</span> <span style="color:#900;font-weight:bold">WithFieldExists</span>(fieldName <span style="color:#458;font-weight:bold">string</span>)

<span style="color:#998;font-style:italic">// WithFiledType filter the struct has the field with specific name and type.
</span><span style="color:#998;font-style:italic"></span><span style="color:#000;font-weight:bold">func</span> <span style="color:#900;font-weight:bold">WithFiledType</span>(filedName, filedType <span style="color:#458;font-weight:bold">string</span>)
</code></pre></div><h5 id="enhanced-instance">Enhanced Instance</h5>
<p>After completing the definition of the struct enhancement, you can convert the specified instance into the following interface when intercepting methods,
and get or set custom field information. The interface definition is as follows:</p>
<div class="highlight"><pre style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-go" data-lang="go"><span style="color:#000;font-weight:bold">type</span> EnhancedInstance <span style="color:#000;font-weight:bold">interface</span> {
	<span style="color:#998;font-style:italic">// GetSkyWalkingDynamicField get the customized data from instance
</span><span style="color:#998;font-style:italic"></span>	<span style="color:#900;font-weight:bold">GetSkyWalkingDynamicField</span>() <span style="color:#000;font-weight:bold">interface</span>{}
	<span style="color:#998;font-style:italic">// SetSkyWalkingDynamicField set the customized data into the instance
</span><span style="color:#998;font-style:italic"></span>	<span style="color:#900;font-weight:bold">SetSkyWalkingDynamicField</span>(<span style="color:#000;font-weight:bold">interface</span>{})
}
</code></pre></div><h5 id="demo-1">Demo</h5>
<p>For example, if you have the following struct that needs to be enhanced:</p>
<div class="highlight"><pre style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-go" data-lang="go"><span style="color:#000;font-weight:bold">type</span> Test <span style="color:#000;font-weight:bold">struct</span> {
	value <span style="color:#000;font-weight:bold">*</span>Context
}
</code></pre></div><p>you can describe it using this condition:</p>
<div class="highlight"><pre style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-go" data-lang="go">instrument.<span style="color:#900;font-weight:bold">NewStructEnhance</span>(<span style="color:#d14">&#34;Test&#34;</span>, instrument.<span style="color:#900;font-weight:bold">WithFieldExists</span>(<span style="color:#d14">&#34;value&#34;</span>), instrument.<span style="color:#900;font-weight:bold">WithFiledType</span>(<span style="color:#d14">&#34;value&#34;</span>, <span style="color:#d14">&#34;*Context&#34;</span>))
</code></pre></div><p>Next, you can set custom content for the specified enhanced instance when intercepting methods.</p>
<div class="highlight"><pre style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-go" data-lang="go">ins <span style="color:#000;font-weight:bold">:=</span> testInstance.(instrument.EnhancedInstance)
<span style="color:#998;font-style:italic">// setting custom content
</span><span style="color:#998;font-style:italic"></span>ins.<span style="color:#900;font-weight:bold">SetSkyWalkingDynamicField</span>(<span style="color:#d14">&#34;custom content&#34;</span>)
<span style="color:#998;font-style:italic">// getting custom content
</span><span style="color:#998;font-style:italic"></span>res <span style="color:#000;font-weight:bold">:=</span> ins.<span style="color:#900;font-weight:bold">GetSkyWalkingDynamicField</span>()
</code></pre></div><h4 id="interceptor">Interceptor</h4>
<p>Interceptors are used to define custom business logic before and after method execution,
allowing you to access data from before and after method execution and interact with the Agent Core by using the Agent API.</p>
<p>The interceptor definition is as follows, you need to create a new structure and implement it:</p>
<div class="highlight"><pre style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-go" data-lang="go"><span style="color:#000;font-weight:bold">type</span> Interceptor <span style="color:#000;font-weight:bold">interface</span> {
    <span style="color:#998;font-style:italic">// BeforeInvoke would be called before the target method invocation.
</span><span style="color:#998;font-style:italic"></span>    <span style="color:#900;font-weight:bold">BeforeInvoke</span>(invocation Invocation) <span style="color:#458;font-weight:bold">error</span>
    <span style="color:#998;font-style:italic">// AfterInvoke would be called after the target method invocation.
</span><span style="color:#998;font-style:italic"></span>    <span style="color:#900;font-weight:bold">AfterInvoke</span>(invocation Invocation, result <span style="color:#000;font-weight:bold">...</span><span style="color:#000;font-weight:bold">interface</span>{}) <span style="color:#458;font-weight:bold">error</span>
}
</code></pre></div><p>Within the interface, you can see the <code>Invocation</code> interface, which defines the context of an interception. The specific definition is as follows:</p>
<div class="highlight"><pre style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-go" data-lang="go"><span style="color:#000;font-weight:bold">type</span> Invocation <span style="color:#000;font-weight:bold">interface</span> {
    <span style="color:#998;font-style:italic">// CallerInstance is the instance of the caller, nil if the method is static method.
</span><span style="color:#998;font-style:italic"></span>    <span style="color:#900;font-weight:bold">CallerInstance</span>() <span style="color:#000;font-weight:bold">interface</span>{}
    <span style="color:#998;font-style:italic">// Args is get the arguments of the method, please cast to the specific type to get more information.
</span><span style="color:#998;font-style:italic"></span>    <span style="color:#900;font-weight:bold">Args</span>() []<span style="color:#000;font-weight:bold">interface</span>{}

    <span style="color:#998;font-style:italic">// ChangeArg is change the argument value of the method
</span><span style="color:#998;font-style:italic"></span>    <span style="color:#900;font-weight:bold">ChangeArg</span>(<span style="color:#458;font-weight:bold">int</span>, <span style="color:#000;font-weight:bold">interface</span>{})

    <span style="color:#998;font-style:italic">// IsContinue is the flag to control the method invocation, if it is true, the target method would not be invoked.
</span><span style="color:#998;font-style:italic"></span>    <span style="color:#900;font-weight:bold">IsContinue</span>() <span style="color:#458;font-weight:bold">bool</span>
    <span style="color:#998;font-style:italic">// DefineReturnValues are defined the return value of the method, and continue the method invoked
</span><span style="color:#998;font-style:italic"></span>    <span style="color:#900;font-weight:bold">DefineReturnValues</span>(<span style="color:#000;font-weight:bold">...</span><span style="color:#000;font-weight:bold">interface</span>{})

    <span style="color:#998;font-style:italic">// SetContext is the customized context of the method invocation, it should be propagated the tracing span.
</span><span style="color:#998;font-style:italic"></span>    <span style="color:#900;font-weight:bold">SetContext</span>(<span style="color:#000;font-weight:bold">interface</span>{})
    <span style="color:#998;font-style:italic">// GetContext is get the customized context of the method invocation
</span><span style="color:#998;font-style:italic"></span>    <span style="color:#900;font-weight:bold">GetContext</span>() <span style="color:#000;font-weight:bold">interface</span>{}
}
</code></pre></div><h5 id="thread-safe">Thread safe</h5>
<p>The <code>Interceptor</code> instance would <strong>define new instance at the current package level</strong>,
rather than creating a new instance each time a method is intercepted.</p>
<p>Therefore, do not declare objects in the interceptor, and instead use <code>Invocation.Context</code> to pass data.</p>
<h5 id="package-path">Package Path</h5>
<p>If the method you want to intercept is not located in the root directory of the framework,
place your interceptor code in the relative location within the plugin. <strong>The Agent would only copy files from the same package directory</strong>.</p>
<p>For example, if you want to intercept a method in <code>github.com/gin-gonic/gin/render</code>, create a <strong>render</strong> directory in the root of your plugin, and <strong>put the interceptor inside it</strong>.
This ensures that the interceptor is properly included during the copy operation and can be correctly applied to the target package.</p>
<h3 id="plugin-configuration">Plugin Configuration</h3>
<p>Plugin configuration is used to add custom configuration parameters to a specified plugin.
When users specify configuration items, the plugin can dynamically adapt the content needed in the plugin according to the user&rsquo;s configuration items.</p>
<h4 id="declaration">Declaration</h4>
<p>Please declare the configuration file you need in the package you want to use.
Declare it using <code>var</code>, and add the <code>//skywalking:config</code> directive to specify that this variable requires dynamic updating.</p>
<p>By default, the configuration item belongs to the configuration of the current plugin.
For example, if the name of my current plugin is <code>gin</code>, then this configuration item is under the <code>gin</code> plugin.
Of course, you can also change it to the <code>http</code> plugin to reference the configuration information of the relevant plugin,
in which case you need to specify it as <code>//skywalking:config http</code>.</p>
<h4 id="item">Item</h4>
<p>Each configuration item needs to add a <code>config</code> tag. This is used to specify the name of the current configuration content.
By default, it would lowercase all letters and add an <code>_</code> identifier before each uppercase letter.</p>
<p>Currently, it supports basic data types and struct types, and it also supports obtaining data values through environment variables.</p>
<h4 id="demo-2">Demo</h4>
<p>For example, I have declared the following configuration item:</p>
<div class="highlight"><pre style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-go" data-lang="go"><span style="color:#998;font-style:italic">//skywalking:config http
</span><span style="color:#998;font-style:italic"></span><span style="color:#000;font-weight:bold">var</span> config <span style="color:#000;font-weight:bold">struct</span> {
    ServerCollectParameters <span style="color:#458;font-weight:bold">bool</span> <span style="color:#d14">`config:&#34;server_collect_parameters&#34;`</span>
	
    Client <span style="color:#000;font-weight:bold">struct</span>{
        CollectParameters <span style="color:#458;font-weight:bold">bool</span> <span style="color:#d14">`config:&#34;collect_parameters&#34;`</span>
    } <span style="color:#d14">`config:&#34;client&#34;`</span>
}
</code></pre></div><p>In the above example, I created a plugin configuration for <code>http</code>, which includes two configuration items.</p>
<ol>
<li><code>config.ServerCollectParameters</code>: Its configuration is located at <code>http.server_collect_parameters</code>.</li>
<li><code>config.Client.CollectParameter</code>: Its configuration is located at <code>http.client.collect_parameter</code>.</li>
</ol>
<p>When the plugin needs to be used, it can be accessed directly by reading the config configuration.</p>
<h2 id="agent-api">Agent API</h2>
<p>The Agent API is used when a method is intercepted and interacts with the Agent Core.</p>
<h3 id="tracing-api">Tracing API</h3>
<p>The Tracing API is used for building distributed tracing, and currently supports the following methods:</p>
<div class="highlight"><pre style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-go" data-lang="go"><span style="color:#998;font-style:italic">// CreateEntrySpan creates a new entry span.
</span><span style="color:#998;font-style:italic">// operationName is the name of the span.
</span><span style="color:#998;font-style:italic">// extractor is the extractor to extract the context from the carrier.
</span><span style="color:#998;font-style:italic">// opts is the options to create the span.
</span><span style="color:#998;font-style:italic"></span><span style="color:#000;font-weight:bold">func</span> <span style="color:#900;font-weight:bold">CreateEntrySpan</span>(operationName <span style="color:#458;font-weight:bold">string</span>, extractor Extractor, opts <span style="color:#000;font-weight:bold">...</span>SpanOption)

<span style="color:#998;font-style:italic">// CreateLocalSpan creates a new local span.
</span><span style="color:#998;font-style:italic">// operationName is the name of the span.
</span><span style="color:#998;font-style:italic">// opts is the options to create the span.
</span><span style="color:#998;font-style:italic"></span><span style="color:#000;font-weight:bold">func</span> <span style="color:#900;font-weight:bold">CreateLocalSpan</span>(operationName <span style="color:#458;font-weight:bold">string</span>, opts <span style="color:#000;font-weight:bold">...</span>SpanOption)

<span style="color:#998;font-style:italic">// CreateExitSpan creates a new exit span.
</span><span style="color:#998;font-style:italic">// operationName is the name of the span.
</span><span style="color:#998;font-style:italic">// peer is the peer address of the span.
</span><span style="color:#998;font-style:italic">// injector is the injector to inject the context into the carrier.
</span><span style="color:#998;font-style:italic">// opts is the options to create the span.
</span><span style="color:#998;font-style:italic"></span><span style="color:#000;font-weight:bold">func</span> <span style="color:#900;font-weight:bold">CreateExitSpan</span>(operationName, peer <span style="color:#458;font-weight:bold">string</span>, injector Injector, opts <span style="color:#000;font-weight:bold">...</span>SpanOption)

<span style="color:#998;font-style:italic">// ActiveSpan returns the current active span, it can be got the current span in the current goroutine.
</span><span style="color:#998;font-style:italic">// If the current goroutine is not in the context of the span, it will return nil.
</span><span style="color:#998;font-style:italic">// If get the span from other goroutine, it can only get information but cannot be operated.
</span><span style="color:#998;font-style:italic"></span><span style="color:#000;font-weight:bold">func</span> <span style="color:#900;font-weight:bold">ActiveSpan</span>()

<span style="color:#998;font-style:italic">// GetRuntimeContextValue returns the value of the key in the runtime context, which is current goroutine.
</span><span style="color:#998;font-style:italic">// The value can also read from the goroutine which is created by the current goroutine
</span><span style="color:#998;font-style:italic"></span><span style="color:#000;font-weight:bold">func</span> <span style="color:#900;font-weight:bold">GetRuntimeContextValue</span>(key <span style="color:#458;font-weight:bold">string</span>)

<span style="color:#998;font-style:italic">// SetRuntimeContextValue sets the value of the key in the runtime context.
</span><span style="color:#998;font-style:italic"></span><span style="color:#000;font-weight:bold">func</span> <span style="color:#900;font-weight:bold">SetRuntimeContextValue</span>(key <span style="color:#458;font-weight:bold">string</span>, val <span style="color:#000;font-weight:bold">interface</span>{})
</code></pre></div><h4 id="context-carrier">Context Carrier</h4>
<p>The context carrier is used to pass the context between the difference application.</p>
<p>When creating an Entry Span, you need to obtain the context carrier from the request.
When creating an Exit Span, you need to write the context carrier into the target RPC request.</p>
<div class="highlight"><pre style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-go" data-lang="go"><span style="color:#998;font-style:italic">// Extractor is a tool specification which define how to
</span><span style="color:#998;font-style:italic">// extract trace parent context from propagation context
</span><span style="color:#998;font-style:italic"></span><span style="color:#000;font-weight:bold">type</span> Extractor <span style="color:#000;font-weight:bold">func</span>(headerKey <span style="color:#458;font-weight:bold">string</span>) (<span style="color:#458;font-weight:bold">string</span>, <span style="color:#458;font-weight:bold">error</span>)

<span style="color:#998;font-style:italic">// Injector is a tool specification which define how to
</span><span style="color:#998;font-style:italic">// inject trace context into propagation context
</span><span style="color:#998;font-style:italic"></span><span style="color:#000;font-weight:bold">type</span> Injector <span style="color:#000;font-weight:bold">func</span>(headerKey, headerValue <span style="color:#458;font-weight:bold">string</span>) <span style="color:#458;font-weight:bold">error</span>
</code></pre></div><p>The following demo demonstrates how to pass the Context Carrier in the Tracing API:</p>
<div class="highlight"><pre style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-go" data-lang="go"><span style="color:#998;font-style:italic">// create a new entry span and extract the context carrier from the request
</span><span style="color:#998;font-style:italic"></span>tracing.<span style="color:#900;font-weight:bold">CreateEntrySpan</span>(fmt.<span style="color:#900;font-weight:bold">Sprintf</span>(<span style="color:#d14">&#34;%s:%s&#34;</span>, request.Method, request.URL.Path), <span style="color:#000;font-weight:bold">func</span>(headerKey <span style="color:#458;font-weight:bold">string</span>) (<span style="color:#458;font-weight:bold">string</span>, <span style="color:#458;font-weight:bold">error</span>) {
    <span style="color:#000;font-weight:bold">return</span> request.Header.<span style="color:#900;font-weight:bold">Get</span>(headerKey), <span style="color:#000;font-weight:bold">nil</span>
})

<span style="color:#998;font-style:italic">// create a new exit span and inject the context carrier into the request
</span><span style="color:#998;font-style:italic"></span>tracing.<span style="color:#900;font-weight:bold">CreateExitSpan</span>(fmt.<span style="color:#900;font-weight:bold">Sprintf</span>(<span style="color:#d14">&#34;%s:%s&#34;</span>, request.Method, request.URL.Path), request.Host, <span style="color:#000;font-weight:bold">func</span>(headerKey, headerValue <span style="color:#458;font-weight:bold">string</span>) <span style="color:#458;font-weight:bold">error</span> {
    request.Header.<span style="color:#900;font-weight:bold">Add</span>(headerKey, headerValue)
    <span style="color:#000;font-weight:bold">return</span> <span style="color:#000;font-weight:bold">nil</span>
}
</code></pre></div><h4 id="span-option">Span Option</h4>
<p>Span Options can be passed when creating a Span to configure the information in the Span.</p>
<p>The following options are currently supported:</p>
<div class="highlight"><pre style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-go" data-lang="go"><span style="color:#998;font-style:italic">// WithLayer set the SpanLayer of the Span
</span><span style="color:#998;font-style:italic"></span><span style="color:#000;font-weight:bold">func</span> <span style="color:#900;font-weight:bold">WithLayer</span>(layer SpanLayer)

<span style="color:#998;font-style:italic">// WithComponent set the component id of the Span
</span><span style="color:#998;font-style:italic"></span><span style="color:#000;font-weight:bold">func</span> <span style="color:#900;font-weight:bold">WithComponent</span>(componentID <span style="color:#458;font-weight:bold">int32</span>)

<span style="color:#998;font-style:italic">// WithTag set the Tag of the Span
</span><span style="color:#998;font-style:italic"></span><span style="color:#000;font-weight:bold">func</span> <span style="color:#900;font-weight:bold">WithTag</span>(key Tag, value <span style="color:#458;font-weight:bold">string</span>)
</code></pre></div><h5 id="span-component">Span Component</h5>
<p>The Component ID in Span is used to identify the current component, with its data <a href="https://github.com/apache/skywalking/blob/master/oap-server/server-starter/src/main/resources/component-libraries.yml">defined in SkyWalking OAP</a>.
If the framework you are writing does not exist in this file, please submit a PR in the SkyWalking project to add the definition of this plugin.</p>
<h4 id="span-operation">Span Operation</h4>
<p>After creating a Span, you can perform additional operations on it.</p>
<div class="highlight"><pre style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-go" data-lang="go"><span style="color:#998;font-style:italic">// Span for plugin API
</span><span style="color:#998;font-style:italic"></span><span style="color:#000;font-weight:bold">type</span> Span <span style="color:#000;font-weight:bold">interface</span> {
	<span style="color:#998;font-style:italic">// AsyncSpan for the async API
</span><span style="color:#998;font-style:italic"></span>	AsyncSpan
	<span style="color:#998;font-style:italic">// Tag set the Tag of the Span
</span><span style="color:#998;font-style:italic"></span>	<span style="color:#900;font-weight:bold">Tag</span>(Tag, <span style="color:#458;font-weight:bold">string</span>)
	<span style="color:#998;font-style:italic">// SetSpanLayer set the SpanLayer of the Span
</span><span style="color:#998;font-style:italic"></span>	<span style="color:#900;font-weight:bold">SetSpanLayer</span>(SpanLayer)
	<span style="color:#998;font-style:italic">// SetOperationName re-set the operation name of the Span
</span><span style="color:#998;font-style:italic"></span>	<span style="color:#900;font-weight:bold">SetOperationName</span>(<span style="color:#458;font-weight:bold">string</span>)
	<span style="color:#998;font-style:italic">// SetPeer re-set the peer address of the Span
</span><span style="color:#998;font-style:italic"></span>	<span style="color:#900;font-weight:bold">SetPeer</span>(<span style="color:#458;font-weight:bold">string</span>)
	<span style="color:#998;font-style:italic">// Log add log to the Span
</span><span style="color:#998;font-style:italic"></span>	<span style="color:#900;font-weight:bold">Log</span>(<span style="color:#000;font-weight:bold">...</span><span style="color:#458;font-weight:bold">string</span>)
	<span style="color:#998;font-style:italic">// Error add error log to the Span
</span><span style="color:#998;font-style:italic"></span>	<span style="color:#900;font-weight:bold">Error</span>(<span style="color:#000;font-weight:bold">...</span><span style="color:#458;font-weight:bold">string</span>)
	<span style="color:#998;font-style:italic">// End end the Span
</span><span style="color:#998;font-style:italic"></span>	<span style="color:#900;font-weight:bold">End</span>()
}
</code></pre></div><h4 id="async-span">Async Span</h4>
<p>There is a set of advanced APIs in Span which is specifically designed for async use cases.
When setting name, tags, logs, and other operations (including end span) of the span in another goroutine, you should use these APIs.</p>
<div class="highlight"><pre style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-go" data-lang="go"><span style="color:#000;font-weight:bold">type</span> AsyncSpan <span style="color:#000;font-weight:bold">interface</span> {
    <span style="color:#998;font-style:italic">// PrepareAsync the span finished at current tracing context, but current span is still alive until AsyncFinish called
</span><span style="color:#998;font-style:italic"></span>    <span style="color:#900;font-weight:bold">PrepareAsync</span>()
    <span style="color:#998;font-style:italic">// AsyncFinish to finished current async span
</span><span style="color:#998;font-style:italic"></span>    <span style="color:#900;font-weight:bold">AsyncFinish</span>()
}
</code></pre></div><p>Following the previous API define, you should following these steps to use the async API:</p>
<ol>
<li>Call <code>span.PrepareAsync()</code> to prepare the span to do any operation in another goroutine.</li>
<li>Use <code>Span.End()</code> in the original goroutine when your job in the current goroutine is complete.</li>
<li>Propagate the span to any other goroutine in your plugin.</li>
<li>Once the above steps are all set, call <code>span.AsyncFinish()</code> in any goroutine.</li>
<li>When the <code>span.AsyncFinish()</code> is complete for all spans, the all spans would be finished and report to the backend.</li>
</ol>
<h4 id="tracing-context-operation">Tracing Context Operation</h4>
<p>In the Go Agent, Trace Context would continue cross goroutines automatically by default.
However, in some cases, goroutine would be context sharing due to be scheduled by the pool mechanism. Consider these advanced APIs to manipulate context and switch the current context.</p>
<div class="highlight"><pre style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-go" data-lang="go"><span style="color:#998;font-style:italic">// CaptureContext capture current tracing context in the current goroutine.
</span><span style="color:#998;font-style:italic"></span><span style="color:#000;font-weight:bold">func</span> <span style="color:#900;font-weight:bold">CaptureContext</span>() ContextSnapshot

<span style="color:#998;font-style:italic">// ContinueContext continue the tracing context in the current goroutine.
</span><span style="color:#998;font-style:italic"></span><span style="color:#000;font-weight:bold">func</span> <span style="color:#900;font-weight:bold">ContinueContext</span>(ctx ContextSnapshot)

<span style="color:#998;font-style:italic">// CleanContext clean the tracing context in the current goroutine.
</span><span style="color:#998;font-style:italic"></span><span style="color:#000;font-weight:bold">func</span> <span style="color:#900;font-weight:bold">CleanContext</span>()
</code></pre></div><p>Typically, use APIs as following to control or switch the context:</p>
<ol>
<li>Use <code>tracing.CaptureContext()</code> to get the ContextSnapshot object.</li>
<li>Propagate the snapshot context to any other goroutine in your plugin.</li>
<li>Use <code>tracing.ContinueContext(snapshot)</code> to continue the snapshot context in the target goroutine.</li>
</ol>
<h3 id="meter-api">Meter API</h3>
<p>The Meter API is used to record the metrics of the target program, and currently supports the following methods:</p>
<div class="highlight"><pre style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-go" data-lang="go"><span style="color:#998;font-style:italic">// NewCounter creates a new counter metrics.
</span><span style="color:#998;font-style:italic">// name is the name of the metrics
</span><span style="color:#998;font-style:italic">// opts is the options for the metrics
</span><span style="color:#998;font-style:italic"></span><span style="color:#000;font-weight:bold">func</span> <span style="color:#900;font-weight:bold">NewCounter</span>(name <span style="color:#458;font-weight:bold">string</span>, opts <span style="color:#000;font-weight:bold">...</span>Opt) Counter

<span style="color:#998;font-style:italic">// NewGauge creates a new gauge metrics.
</span><span style="color:#998;font-style:italic">// name is the name of the metrics
</span><span style="color:#998;font-style:italic">// getter is the function to get the value of the gauge meter
</span><span style="color:#998;font-style:italic">// opts is the options for the metrics
</span><span style="color:#998;font-style:italic"></span><span style="color:#000;font-weight:bold">func</span> <span style="color:#900;font-weight:bold">NewGauge</span>(name <span style="color:#458;font-weight:bold">string</span>, getter <span style="color:#000;font-weight:bold">func</span>() <span style="color:#458;font-weight:bold">float64</span>, opts <span style="color:#000;font-weight:bold">...</span>Opt) Gauge

<span style="color:#998;font-style:italic">// NewHistogram creates a new histogram metrics.
</span><span style="color:#998;font-style:italic">// name is the name of the metrics
</span><span style="color:#998;font-style:italic">// steps is the buckets of the histogram
</span><span style="color:#998;font-style:italic">// opts is the options for the metrics
</span><span style="color:#998;font-style:italic"></span><span style="color:#000;font-weight:bold">func</span> <span style="color:#900;font-weight:bold">NewHistogram</span>(name <span style="color:#458;font-weight:bold">string</span>, steps []<span style="color:#458;font-weight:bold">float64</span>, opts <span style="color:#000;font-weight:bold">...</span>Opt) Histogram

<span style="color:#998;font-style:italic">// NewHistogramWithMinValue creates a new histogram metrics.
</span><span style="color:#998;font-style:italic">// name is the name of the metrics
</span><span style="color:#998;font-style:italic">// minVal is the min value of the histogram bucket
</span><span style="color:#998;font-style:italic">// steps is the buckets of the histogram
</span><span style="color:#998;font-style:italic">// opts is the options for the metrics
</span><span style="color:#998;font-style:italic"></span><span style="color:#000;font-weight:bold">func</span> <span style="color:#900;font-weight:bold">NewHistogramWithMinValue</span>(name <span style="color:#458;font-weight:bold">string</span>, minVal <span style="color:#458;font-weight:bold">float64</span>, steps []<span style="color:#458;font-weight:bold">float64</span>, opts <span style="color:#000;font-weight:bold">...</span>Opt) Histogram

<span style="color:#998;font-style:italic">// RegisterBeforeCollectHook registers a hook function which will be called before metrics collect.
</span><span style="color:#998;font-style:italic"></span><span style="color:#000;font-weight:bold">func</span> <span style="color:#900;font-weight:bold">RegisterBeforeCollectHook</span>(f <span style="color:#000;font-weight:bold">func</span>())
</code></pre></div><h4 id="meter-option">Meter Option</h4>
<p>The Meter Options can be passed when creating a Meter to configure the information in the Meter.</p>
<div class="highlight"><pre style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-go" data-lang="go"><span style="color:#998;font-style:italic">// WithLabel adds a label to the metrics.
</span><span style="color:#998;font-style:italic"></span><span style="color:#000;font-weight:bold">func</span> <span style="color:#900;font-weight:bold">WithLabel</span>(key, value <span style="color:#458;font-weight:bold">string</span>) Opt
</code></pre></div><h4 id="meter-type">Meter Type</h4>
<h5 id="counter">Counter</h5>
<p>Counter is a cumulative metric that represents a single monotonically increasing counter whose value can only increase.</p>
<div class="highlight"><pre style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-go" data-lang="go"><span style="color:#000;font-weight:bold">type</span> Counter <span style="color:#000;font-weight:bold">interface</span> {
	<span style="color:#998;font-style:italic">// Get returns the current value of the counter.
</span><span style="color:#998;font-style:italic"></span>	<span style="color:#900;font-weight:bold">Get</span>() <span style="color:#458;font-weight:bold">float64</span>
	<span style="color:#998;font-style:italic">// Inc increments the counter with value.
</span><span style="color:#998;font-style:italic"></span>	<span style="color:#900;font-weight:bold">Inc</span>(val <span style="color:#458;font-weight:bold">float64</span>)
}
</code></pre></div><h5 id="gauge">Gauge</h5>
<p>Gauge is a metric that represents a single numerical value that can arbitrarily go up and down.</p>
<div class="highlight"><pre style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-go" data-lang="go"><span style="color:#000;font-weight:bold">type</span> Gauge <span style="color:#000;font-weight:bold">interface</span> {
    <span style="color:#998;font-style:italic">// Get returns the current value of the gauge.
</span><span style="color:#998;font-style:italic"></span>    <span style="color:#900;font-weight:bold">Get</span>() <span style="color:#458;font-weight:bold">float64</span>
}
</code></pre></div><h5 id="histogram">Histogram</h5>
<p>Histogram is a metric that represents the distribution of a set of values.</p>
<div class="highlight"><pre style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-go" data-lang="go"><span style="color:#000;font-weight:bold">type</span> Histogram <span style="color:#000;font-weight:bold">interface</span> {
	<span style="color:#998;font-style:italic">// Observe find the value associate bucket and add 1.
</span><span style="color:#998;font-style:italic"></span>	<span style="color:#900;font-weight:bold">Observe</span>(val <span style="color:#458;font-weight:bold">float64</span>)
	<span style="color:#998;font-style:italic">// ObserveWithCount find the value associate bucket and add specific count.
</span><span style="color:#998;font-style:italic"></span>	<span style="color:#900;font-weight:bold">ObserveWithCount</span>(val <span style="color:#458;font-weight:bold">float64</span>, count <span style="color:#458;font-weight:bold">int64</span>)
}
</code></pre></div><h2 id="import-plugin">Import Plugin</h2>
<p>Once you have finished developing the plugin, you need to import the completed module into the Agent program and <a href="https://github.com/apache/skywalking-go/tree/316433e71808ec6a130e81c287caa8b2a98f45a5/tools/go-agent/instrument/plugins/register.go">define it in the corresponding file</a>.</p>
<p>At this point, your plugin development process is complete. When the Agent performs hybrid compilation on the target program, your plugin will be executed as expected.</p>




</div>


            </main>
          <div id="toc" class="d-none d-xl-block col-xl-2 td-toc d-print-none">
            




<div class="td-page-meta ml-2 pb-1 pt-2 mb-0">











</div>






<nav id="TableOfContents">
  <ul>
    <li><a href="#plugin-development-guide">Plugin Development Guide</a>
      <ul>
        <li><a href="#create-a-new-plugin-module">Create a new plugin module</a></li>
        <li><a href="#define-the-enhancement-object">Define the enhancement object</a>
          <ul>
            <li><a href="#manage-instrument-and-interceptor-codes-in-hierarchy-structure">Manage Instrument and Interceptor codes in hierarchy structure</a></li>
            <li><a href="#instrument-point">Instrument Point</a></li>
            <li><a href="#plugin-configuration">Plugin Configuration</a></li>
          </ul>
        </li>
        <li><a href="#agent-api">Agent API</a>
          <ul>
            <li><a href="#tracing-api">Tracing API</a></li>
            <li><a href="#meter-api">Meter API</a></li>
          </ul>
        </li>
        <li><a href="#import-plugin">Import Plugin</a></li>
      </ul>
    </li>
  </ul>
</nav>




<script>
  $(function () {
    var $toc = $("#TableOfContents");
    if (!$toc || !$toc.length) {
      return;
    }
    var top = $toc.offset().top;
    $(window).on("scroll", debounce(setTop, 100))
    $(window).on("scroll", debounce(addActive, 30))

    function addActive() {
      var scrollValue = $(window).scrollTop();
      var topEle = null;
      $.each($('main h1, main h2, main h3'), function (index, item) {
        if ($(item).offset().top - 70 > scrollValue) {
          return
        }
        if (!topEle) {
          topEle = item
        } else if ($(item).offset().top >= $(topEle).offset().top) {
          topEle = item
        }
        if (topEle) {
          var id = $(item).attr('id');
          $toc.find('a').removeClass("active").end().find('a[href="' + '#' + id + '"]').addClass("active")
        }
      })
    }

    function setTop() {
      var scrollValue = $(window).scrollTop();
      if (scrollValue >= top - 70) {
        $toc.addClass('fixed')
      } else {
        $toc.removeClass('fixed')
      }
    }

    function debounce(fn, wait) {
      var timeout = null;
      return function () {
        clearTimeout(timeout);
        timeout = setTimeout(() => {
          fn.apply(this, arguments);
        }, wait);
      };
    }
  })

</script>

          </div>

        </div>
      </div>

      
<footer class="py-5 sky-row">
  <div class="container-fluid text-center">
    <div class="">
        
        
        
<ul class="list-inline mb-0">
  
  <li class="list-inline-item mx-2 h3" data-toggle="tooltip" data-placement="top" title="Twitter" aria-label="Twitter">
    <a class="text-color" target="_blank" href="https://twitter.com/asfskywalking">
      <i class="iconfont icon-twitter"></i>
    </a>
  </li>
  
  <li class="list-inline-item mx-2 h3" data-toggle="tooltip" data-placement="top" title="Slack" aria-label="Slack">
    <a class="text-color" target="_blank" href="http://s.apache.org/slack-invite">
      <i class="iconfont icon-slack"></i>
    </a>
  </li>
  
  <li class="list-inline-item mx-2 h3" data-toggle="tooltip" data-placement="top" title="Mailing list" aria-label="Mailing list">
    <a class="text-color" target="_blank" href="https://lists.apache.org/list.html?dev@skywalking.apache.org">
      <i class="iconfont icon-email"></i>
    </a>
  </li>
  
  <li class="list-inline-item mx-2 h3" data-toggle="tooltip" data-placement="top" title="GitHub" aria-label="GitHub">
    <a class="text-color" target="_blank" href="https://github.com/apache/skywalking">
      <i class="iconfont icon-github"></i>
    </a>
  </li>
  
</ul>

        
        
    </div>
    <div class="">

        <small class="text-color">&copy; 2017 - 2024 The Apache Software Foundation All Rights Reserved</small>
        
	
    </div>
    <div class="">
      <small class="text-color mt-4">Apache SkyWalking, SkyWalking, Apache, the Apache feather logo, and the Apache SkyWalking project logo are either registered trademarks or trademarks of the Apache Software Foundation.</small>
    </div>
  </div>
</footer>


    </div>
    





























































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































    
<div id="popup">
    <div class="mask">
        <img src=""/>
    </div>
</div>

    <div class="sidebar-mask"></div>
<div class="sidebar">
    <nav class="nav-links">
        <div class="nav-item"><a href="/docs/" class="nav-link">Projects and Documentation</a></div>
        <div class="nav-item"><a href="/events/" class="nav-link">Events</a></div>
        <div class="nav-item"><a href="/blog/" class="nav-link router-link-exact-active router-link-active">Blog</a>
        </div>
        <div class="nav-item"><a href="/downloads/" class="nav-link">Downloads</a></div>
        <div class="nav-item"><a href="/team/" class="nav-link">Team</a></div>
        <div class="nav-item"><a href="/users/" class="nav-link">Users</a></div>
        <div class="nav-item">
            <div class="dropdown-wrapper open">
                <a class="dropdown-title"><span>中文资料</span>
                    <span class="arrow down"></span>
                </a>
                <ul class="nav-dropdown">
                    <li class="dropdown-item">
                        <a href="/zh/" class="nav-link external">博客</a>
                    </li>
                    <li class="dropdown-item">
                        <a href="https://space.bilibili.com/390683219" target="_blank"
                           rel="noopener noreferrer" class="nav-link external">B站</a>
                    </li>
                    <li class="dropdown-item">
                        <a href="https://juejin.cn/user/13673577331607" target="_blank"
                           rel="noopener noreferrer" class="nav-link external">掘金</a>
                    </li>
                </ul>
            </div>
        </div>
        <div class="nav-item">
            <div class="dropdown-wrapper open">
                <a class="dropdown-title">
                    <span>Links</span>
                    <span class="arrow down"></span>
                </a>
                <ul class="nav-dropdown">
                    <li class="dropdown-item">
                        <a href="http://www.apache.org/" target="_blank"
                           rel="noopener noreferrer" class="nav-link external">
                            Apache Software Foundation
                        </a>
                    </li>
                    <li class="dropdown-item">
                        <a href="https://github.com/apache/skywalking/issues"
                           target="_blank" rel="noopener noreferrer"
                           class="nav-link external">
                            GitHub Issue Tracker
                        </a>
                    </li>
                    <li class="dropdown-item">
                        <a href="https://lists.apache.org/list.html?dev@skywalking.apache.org" target="_blank"
                           rel="noopener noreferrer" class="nav-link external">
                            Dev Mailing List
                        </a>
                    </li>
                    <li class="dropdown-item">
                        <a href="http://www.apache.org/licenses/" target="_blank"
                           rel="noopener noreferrer" class="nav-link external">
                            License
                        </a>
                    </li>
                    <li class="dropdown-item">
                        <a href="http://www.apache.org/events/current-event"
                           target="_blank" rel="noopener noreferrer"
                           class="nav-link external">
                            Apache Events
                        </a>
                    </li>
                    <li class="dropdown-item">
                        <a href="http://www.apache.org/security/" target="_blank"
                           rel="noopener noreferrer" class="nav-link external">
                            Security
                        </a>
                    </li>
                    <li class="dropdown-item">
                        <a href="http://www.apache.org/foundation/sponsorship.html"
                           target="_blank" rel="noopener noreferrer"
                           class="nav-link external">
                            Sponsorship and Donate
                        </a>
                    </li>
                    <li class="dropdown-item">
                        <a href="http://www.apache.org/foundation/thanks.html"
                           target="_blank" rel="noopener noreferrer"
                           class="nav-link external">
                            Thanks
                        </a>
                    </li>
                </ul>
            </div>
        </div>
    </nav>
</div>

    <script src="/js/bootstrap.bundle.min.js"></script>

<script src="https://cdn.jsdelivr.net/npm/@docsearch/js@3"></script>









<script src="/js/main.min.dc00f5ca911ee5aa105ea6de6b3b7e8d8169ba5a3bf156b1fcfe23dfe3e62b0a.js" integrity="sha256-3AD1ypEe5aoQXqbeazt&#43;jYFpulo78Vax/P4j3&#43;PmKwo=" crossorigin="anonymous"></script>


<script src="/js/mermaid.min.js"></script>
<script>
    window.onload = () => mermaid.init(undefined, ".language-mermaid");
</script>


<script defer
src="https://widget.kapa.ai/kapa-widget.bundle.js"
data-website-id="8a08392b-9c4d-4816-8bc4-f93e0ecdd2a7"
data-project-name="SkyWalking"
data-project-color="#2B74B8"
data-button-text="Ask AI"
data-search-mode-enabled="true"
data-modal-open-on-command-k="true"
data-modal-disclaimer="The AI supports multiple languages, but it may not be accessible in China, a proxy is required."
data-project-logo="https://miro.medium.com/v2/resize:fit:2400/0*kmS-5BQ8ShAhZ_F4.jpg"
data-modal-example-questions="What is Apache SkyWalking?,How to deploy SkyWalking?,How to inject agents non-intrusively?,How to setup trace sampling?"
data-button-position-top=""
data-button-position-right="20px"
data-button-position-bottom="200px"
data-button-position-left=""
></script>




  </body>
  <script>
    $(function (){
      $('.doc-menu-button').on('click',function (){
        $('.td-sidebar').toggleClass('active')
      })
      $('.version-select').on('change', function (){
        var selectVersion = $(this).val().toLowerCase();
        var prefix = '';
        var url = location.href.replace(/(\/docs\/[a-zA-Z\-]+\/)([\w|\.]+)(\/.*)/, function (match, p1, p2, p3){
          prefix = p1 + selectVersion;
          return p1 + selectVersion + p3
        })
        go2SelectVersion(url, prefix)

      })
      function go2SelectVersion(url, prefix){
        $.ajax({
          url: url,
          type: "get",
          success:function(){
            location.href = url;
          },
          statusCode: {
            404:function(){
              location.href = prefix + '/readme/';
            }
          }
        });
      }
    })
  </script>
</html>
