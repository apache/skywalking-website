<!doctype html>
<html lang="en" class="no-js">
  <head>
    <meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<meta name="twitter:site" content="skywalking.apache.org">
<meta name="twitter:image:src" content="https://skywalking.apache.org/images/skywalking_400x400.png">
<meta property="og:image" content="https://skywalking.apache.org/images/skywalking_400x400.png">

<meta name="generator" content="Hugo 0.80.0" />


<script async src="https://www.googletagmanager.com/gtag/js?id=G-GR8N6PGRJ3"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);};
  gtag('js', new Date());gtag('config', 'G-GR8N6PGRJ3');
</script>
<META NAME="ROBOTS" CONTENT="INDEX, FOLLOW">
<link rel="stylesheet" href="//at.alicdn.com/t/c/font_3007530_pvozs1rz2wn.css">



<link rel="apple-touch-icon" sizes="180x180" href="/favicons/apple-touch-icon.png">
<link rel="icon" type="image/png" sizes="32x32" href="/favicons/favicon-32x32.png">
<link rel="icon" type="image/png" sizes="16x16" href="/favicons/favicon-16x16.png">
<link rel="manifest" href="/favicons/site.webmanifest">
<link rel="mask-icon" href="/favicons/safari-pinned-tab.svg" color="#5bbad5">
<meta name="msapplication-TileColor" content="#da532c">
<meta name="theme-color" content="#ffffff">

<title>Trace Data Protocol v3 | Apache SkyWalking</title><meta property="og:title" content="Trace Data Protocol v3" />
<meta property="og:description" content="Trace Data Protocol v3 Trace Data Protocol describes the data format between SkyWalking agent/sniffer and backend.
Overview Trace data protocol is defined and provided in gRPC format, and implemented in HTTP 1.1.
Report service instance status   Service Instance Properties Service instance contains more information than just a name. In order for the agent to report service instance status, use ManagementService#reportInstanceProperties service to provide a string-key/string-value pair list as the parameter." />
<meta property="og:type" content="article" />
<meta property="og:url" content="/docs/main/v9.1.0/en/protocols/trace-data-protocol-v3/" />

<meta itemprop="name" content="Trace Data Protocol v3">
<meta itemprop="description" content="Trace Data Protocol v3 Trace Data Protocol describes the data format between SkyWalking agent/sniffer and backend.
Overview Trace data protocol is defined and provided in gRPC format, and implemented in HTTP 1.1.
Report service instance status   Service Instance Properties Service instance contains more information than just a name. In order for the agent to report service instance status, use ManagementService#reportInstanceProperties service to provide a string-key/string-value pair list as the parameter.">

<meta itemprop="wordCount" content="1822">



<meta itemprop="keywords" content="" />
<meta name="twitter:card" content="summary"/>
<meta name="twitter:title" content="Trace Data Protocol v3"/>
<meta name="twitter:description" content="Trace Data Protocol v3 Trace Data Protocol describes the data format between SkyWalking agent/sniffer and backend.
Overview Trace data protocol is defined and provided in gRPC format, and implemented in HTTP 1.1.
Report service instance status   Service Instance Properties Service instance contains more information than just a name. In order for the agent to report service instance status, use ManagementService#reportInstanceProperties service to provide a string-key/string-value pair list as the parameter."/>



<link rel="preload" href="/scss/main.min.592235942cb3c9f3dd697382a4e7a1fad8e1c182dad2841bdce6b43b4a346ae8.css" as="style">
<link href="/scss/main.min.592235942cb3c9f3dd697382a4e7a1fad8e1c182dad2841bdce6b43b4a346ae8.css" rel="stylesheet" integrity="">



<link rel="stylesheet" href="/css/docSearch.css" />


<script src="/js/jquery-3.6.0.min.js"></script>





    <title>Trace Data Protocol v3 | Apache SkyWalking</title>
  </head>
  <body class="td-page  project-doc">
    <header>
      
<nav class="js-navbar-scroll navbar navbar-expand  flex-column flex-md-row td-navbar">
    <div class="sidebar-button">
      <i class="iconfont icon-menu"></i>
    </div>
    <a class="navbar-brand" href="/">
        <span class="navbar-logo"><img width="130" src="/images/logo.svg" alt="SkyWalking"></span> 
    </a>
    <div class="td-navbar-nav-scroll navbar-nav-wrapper" id="navigation">
        <ul class="navbar-nav mt-lg-0">
             
            
            
            <li class="nav-item mr-3 mb-lg-0">
				
				
				
				
				<a class="nav-link" href="/docs" ><span>Projects and Docs</span></a>
			</li>
            
            
            
            
            <li class="nav-item mr-3 mb-lg-0">
				
				
				
				
				<a class="nav-link" href="/events" ><span>Events</span></a>
			</li>
            
            
            
            
            <li class="nav-item mr-3 mb-lg-0">
				
				
				
				
				<a class="nav-link" href="/blog" ><span>Blogs</span></a>
			</li>
            
            
            
            
            <li class="nav-item mr-3 mb-lg-0">
				
				
				
				
				<a class="nav-link" href="/downloads" ><span>Downloads</span></a>
			</li>
            
            
            
            
            <li class="nav-item mr-3 mb-lg-0">
				
				
				
				
				<a class="nav-link" href="/team" ><span>Team</span></a>
			</li>
            
            
            
            
            <li class="nav-item mr-3 mb-lg-0">
				
				
				
				
				<a class="nav-link" href="/users" ><span>Users</span></a>
			</li>
            
            
            
            
            
            <li class="nav-item mr-3 mb-lg-0">
                <span class="link dropdown blog">
                    <a class="link-name nav-link dropdown-toggle" href="#" role="button" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">中文资料</a>
                    <div class="dropdown-menu">
                        <a class="dropdown-item" href="/zh/">博客</a>
                        <a class="dropdown-item" href="https://space.bilibili.com/390683219" target="_blank" rel="noopener noreferrer">
                            B站
                        </a>
                        <a class="dropdown-item" href="https://juejin.cn/user/13673577331607" target="_blank" rel="noopener noreferrer">
                            掘金
                        </a>
                    </div>
                </span>
            </li>

            
			
        </ul>
    </div>
    <div class="navbar-nav d-none d-lg-block search-input-box">
         
            
        
            
        
            
        
            
        
            
        
            
        
            
            <span class="link dropdown">
                <a class="link-name dropdown-toggle" href="#" role="button" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
                    Links
                </a>
                <div class="dropdown-menu">
                    
                    <a class="dropdown-item" href="http://www.apache.org/">Apache Software Foundation</a> 
                    <a class="dropdown-item" href="https://github.com/apache/skywalking/issues">GitHub Issue Tracker</a> 
                    <a class="dropdown-item" href="https://github.com/apache/skywalking/discussions">Discussion</a> 
                    <a class="dropdown-item" href="https://lists.apache.org/list.html?dev@skywalking.apache.org">Dev Mailing List</a> 
                    <a class="dropdown-item" href="https://cwiki.apache.org/confluence/display/SKYWALKING/Home">WIKI</a> 
                    <a class="dropdown-item" href="http://www.apache.org/licenses/">License</a> 
                    <a class="dropdown-item" href="http://www.apache.org/events/current-event">Apache Events</a> 
                    <a class="dropdown-item" href="http://www.apache.org/security/">Security</a> 
                    <a class="dropdown-item" href="http://www.apache.org/foundation/sponsorship.html">Sponsor and Donate</a> 
                    <a class="dropdown-item" href="http://www.apache.org/foundation/thanks.html">Thanks</a> 
                    <a class="dropdown-item" href="https://apache.org/foundation/policies/privacy.html">Privacy</a> 
                </div>
            </span>
            
        
        
<div id="docsearch"></div>


    </div>
</nav>

    </header>
    <div class="container-fluid td-outer">

      <div class="td-main">
        <div class="row flex-xl-nowrap">
          <div class="col-12 col-md-3 col-xl-2 d-print-none scroll-bar td-sidebar">










                  <div class="description-wrapper">
                    <h5>
                    <img width="26" height="26" src="/images/project/skywalking.svg">
                    SkyWalking
                    </h5>
                    <p>SkyWalking primary repository and docs.</p>
                  </div>
                  
                  <div class="version-wrapper">Version: 
                  <select class="version-select">
                  
                    
                    
                    <option ZgotmplZ value="next">
                    
                      next
                    
                    </option>
                  
                    
                    
                    <option ZgotmplZ value="latest">
                    
                      latest
                    
                    </option>
                  
                    
                    
                    <option ZgotmplZ value="v9.7.0">
                    
                      v9.7.0
                    
                    </option>
                  
                    
                    
                    <option ZgotmplZ value="v9.6.0">
                    
                      v9.6.0
                    
                    </option>
                  
                    
                    
                    <option ZgotmplZ value="v9.5.0">
                    
                      v9.5.0
                    
                    </option>
                  
                    
                    
                    <option ZgotmplZ value="v9.4.0">
                    
                      v9.4.0
                    
                    </option>
                  
                    
                    
                    <option ZgotmplZ value="v9.3.0">
                    
                      v9.3.0
                    
                    </option>
                  
                    
                    
                    <option ZgotmplZ value="v9.2.0">
                    
                      v9.2.0
                    
                    </option>
                  
                    
                    
                    <option selected value="v9.1.0">
                    
                      v9.1.0
                    
                    </option>
                  
                    
                    
                    <option ZgotmplZ value="v9.0.0">
                    
                      v9.0.0
                    
                    </option>
                  
                  </select>
                  </div>
                  
                  <ul class="sidebar-menu">
    
    <li>
        
            <a href="/docs/main/v9.1.0/readme">Welcome</a>
        
    </li>
    
    <li>
        
            
            <a href="#">Concepts and Designs<i class="iconfont icon-arrow-right pull-right"></i></a>
            

            
<ul class="sidebar-submenu">
    

    <li>
        

            
            <a href="#">What is SkyWalking?<i class="iconfont icon-arrow-right pull-right"></i></a>
            

            
<ul class="sidebar-submenu">
    

    <li>
        
            <a href="/docs/main/v9.1.0/en/concepts-and-designs/overview">Overview and Core concepts</a>
        
    </li>

    

    <li>
        
            <a href="/docs/main/v9.1.0/en/concepts-and-designs/project-goals">Project Goals</a>
        
    </li>

    

</ul>

        
    </li>

    

    <li>
        

            
            <a href="#">Agents<i class="iconfont icon-arrow-right pull-right"></i></a>
            

            
<ul class="sidebar-submenu">
    

    <li>
        
            <a href="/docs/main/v9.1.0/en/concepts-and-designs/probe-introduction">Introduction</a>
        
    </li>

    

    <li>
        
            <a href="/docs/main/v9.1.0/en/concepts-and-designs/service-agent">Service Auto Instrument Agent</a>
        
    </li>

    

    <li>
        
            <a href="/docs/main/v9.1.0/en/concepts-and-designs/manual-sdk">Manual Instrument SDK</a>
        
    </li>

    

    <li>
        
            <a href="/docs/main/v9.1.0/en/papers/stam">STAM Paper, Streaming Topology Analysis Method</a>
        
    </li>

    

    <li>
        
            <a href="/docs/main/v9.1.0/en/concepts-and-designs/sdk-profiling">SDK Profiling to Fix the Blind Spot</a>
        
    </li>

    

</ul>

        
    </li>

    

    <li>
        

            
            <a href="#">Backend<i class="iconfont icon-arrow-right pull-right"></i></a>
            

            
<ul class="sidebar-submenu">
    

    <li>
        
            <a href="/docs/main/v9.1.0/en/concepts-and-designs/backend-overview">Overview</a>
        
    </li>

    

    <li>
        
            <a href="/docs/main/v9.1.0/en/concepts-and-designs/oal">Observability Analysis Language</a>
        
    </li>

    

    <li>
        
            <a href="/docs/main/v9.1.0/en/concepts-and-designs/mal">Meter Analysis Language</a>
        
    </li>

    

    <li>
        
            <a href="/docs/main/v9.1.0/en/concepts-and-designs/lal">Log Analysis Language</a>
        
    </li>

    

    <li>
        
            <a href="/docs/main/v9.1.0/en/protocols/readme#query-protocol">Query in OAP</a>
        
    </li>

    

</ul>

        
    </li>

    

    <li>
        
            <a href="https://github.com/apache/skywalking-cli">CLI</a>
        
    </li>

    

    <li>
        
            <a href="/docs/main/v9.1.0/en/concepts-and-designs/event/">Event</a>
        
    </li>

    

</ul>

        
    </li>
    
    <li>
        
            
            <a href="#">Setup<i class="iconfont icon-arrow-right pull-right"></i></a>
            

            
<ul class="sidebar-submenu">
    

    <li>
        

            
            <a href="#">Backend<i class="iconfont icon-arrow-right pull-right"></i></a>
            

            
<ul class="sidebar-submenu">
    

    <li>
        

            
            <a href="#">Quick Start<i class="iconfont icon-arrow-right pull-right"></i></a>
            

            
<ul class="sidebar-submenu">
    

    <li>
        
            <a href="/docs/main/v9.1.0/en/setup/backend/backend-setup">Introduction</a>
        
    </li>

    

    <li>
        
            <a href="/docs/main/v9.1.0/en/setup/backend/backend-docker">Run with Docker</a>
        
    </li>

    

    <li>
        
            <a href="/docs/main/v9.1.0/en/setup/backend/backend-k8s">Run with Kubernetes</a>
        
    </li>

    

</ul>

        
    </li>

    

    <li>
        
            <a href="/docs/main/v9.1.0/en/setup/backend/configuration-vocabulary">Configuration Vocabulary</a>
        
    </li>

    

    <li>
        

            
            <a href="#">Advanced Setup<i class="iconfont icon-arrow-right pull-right"></i></a>
            

            
<ul class="sidebar-submenu">
    

    <li>
        
            <a href="/docs/main/v9.1.0/en/setup/backend/service-auto-grouping">Service Grouping</a>
        
    </li>

    

    <li>
        
            <a href="/docs/main/v9.1.0/en/setup/backend/backend-setting-override">Overriding Settings</a>
        
    </li>

    

    <li>
        
            <a href="/docs/main/v9.1.0/en/setup/backend/backend-ip-port">IP And Port Setting</a>
        
    </li>

    

    <li>
        
            <a href="/docs/main/v9.1.0/en/setup/backend/backend-init-mode">Backend Init Mode Startup</a>
        
    </li>

    

    <li>
        
            <a href="/docs/main/v9.1.0/en/setup/backend/backend-cluster">Cluster Management</a>
        
    </li>

    

    <li>
        
            <a href="/docs/main/v9.1.0/en/setup/backend/backend-storage">Choose Storage</a>
        
    </li>

    

    <li>
        
            <a href="/docs/main/v9.1.0/en/setup/backend/backend-expose">Setup External Communication Channels</a>
        
    </li>

    

    <li>
        
            <a href="/docs/main/v9.1.0/en/setup/backend/kafka-fetcher">Kafka Fetcher</a>
        
    </li>

    

    <li>
        
            <a href="/docs/main/v9.1.0/en/setup/backend/advanced-deployment">Advanced Deployment Options</a>
        
    </li>

    

    <li>
        
            <a href="/docs/main/v9.1.0/en/setup/backend/ttl">Data Lifecycle. Time To Live (TTL)</a>
        
    </li>

    

    <li>
        
            <a href="/docs/main/v9.1.0/en/setup/backend/endpoint-grouping-rules">Group Parameterized Endpoints</a>
        
    </li>

    

    <li>
        
            <a href="/docs/main/v9.1.0/en/setup/backend/dynamical-logging">Dynamical Logging</a>
        
    </li>

    

    <li>
        
            <a href="/docs/main/v9.1.0/en/setup/backend/grpc-security">Security(SSL/TLS/mTLS)</a>
        
    </li>

    

    <li>
        
            <a href="/docs/main/v9.1.0/en/setup/backend/backend-load-balancer">Setup Native Load Balancer</a>
        
    </li>

    

</ul>

        
    </li>

    

    <li>
        

            
            <a href="#">Tracing<i class="iconfont icon-arrow-right pull-right"></i></a>
            

            
<ul class="sidebar-submenu">
    

    <li>
        
            <a href="/docs/main/v9.1.0/en/setup/backend/trace-sampling">Trace Sampling</a>
        
    </li>

    

    <li>
        
            <a href="/docs/main/v9.1.0/en/setup/backend/slow-db-statement">Detect Slow Database Statement</a>
        
    </li>

    

    <li>
        
            <a href="/docs/main/v9.1.0/en/setup/backend/mq">Message Queue Performance</a>
        
    </li>

    

    <li>
        
            <a href="/docs/main/v9.1.0/en/setup/backend/uninstrumented-gateways">Uninstrumented Gateways</a>
        
    </li>

    

    <li>
        
            <a href="/docs/main/v9.1.0/en/setup/backend/zipkin-trace">Zipkin Trace</a>
        
    </li>

    

</ul>

        
    </li>

    

    <li>
        

            
            <a href="#">Metrics<i class="iconfont icon-arrow-right pull-right"></i></a>
            

            
<ul class="sidebar-submenu">
    

    <li>
        
            <a href="/docs/main/v9.1.0/en/guides/backend-oal-scripts">OAL Scripts</a>
        
    </li>

    

    <li>
        
            <a href="/docs/main/v9.1.0/en/setup/backend/opentelemetry-receiver">OpenTelemetry Metrics</a>
        
    </li>

    

    <li>
        
            <a href="/docs/main/v9.1.0/en/setup/backend/backend-zabbix">Zabbix Metrics</a>
        
    </li>

    

    <li>
        
            <a href="/docs/main/v9.1.0/en/setup/backend/backend-meter">Meter Analysis</a>
        
    </li>

    

    <li>
        
            <a href="/docs/main/v9.1.0/en/setup/backend/apdex-threshold">Apdex Threshold</a>
        
    </li>

    

    <li>
        
            <a href="/docs/main/v9.1.0/en/setup/backend/spring-sleuth-setup">Spring Sleuth Metrics Analysis</a>
        
    </li>

    

    <li>
        
            <a href="/docs/main/v9.1.0/en/setup/backend/prometheus-metrics">Prometheus Metrics</a>
        
    </li>

    

    <li>
        
            <a href="/docs/main/v9.1.0/en/setup/backend/backend-alarm">Alarm</a>
        
    </li>

    

</ul>

        
    </li>

    

    <li>
        

            
            <a href="#">Logging<i class="iconfont icon-arrow-right pull-right"></i></a>
            

            
<ul class="sidebar-submenu">
    

    <li>
        
            <a href="/docs/main/v9.1.0/en/setup/backend/log-analyzer">Log Collecting And Analysis</a>
        
    </li>

    

    <li>
        
            <a href="/docs/main/v9.1.0/en/setup/backend/on-demand-pod-log">On Demand Pod Logs</a>
        
    </li>

    

</ul>

        
    </li>

    

    <li>
        

            
            <a href="#">Extension<i class="iconfont icon-arrow-right pull-right"></i></a>
            

            
<ul class="sidebar-submenu">
    

    <li>
        
            <a href="/docs/main/v9.1.0/en/setup/backend/metrics-exporter">Metrics Exporter</a>
        
    </li>

    

    <li>
        
            <a href="/docs/main/v9.1.0/en/setup/backend/dynamic-config">Dynamic Configuration</a>
        
    </li>

    

</ul>

        
    </li>

    

</ul>

        
    </li>

    

    <li>
        
            <a href="/docs/main/v9.1.0/en/setup/backend/ui-setup">UI Setup</a>
        
    </li>

    

    <li>
        

            
            <a href="#">Official Dashboards<i class="iconfont icon-arrow-right pull-right"></i></a>
            

            
<ul class="sidebar-submenu">
    

    <li>
        
            <a href="/docs/main/v9.1.0/en/ui/readme">Overview</a>
        
    </li>

    

    <li>
        

            
            <a href="#">General Service<i class="iconfont icon-arrow-right pull-right"></i></a>
            

            
<ul class="sidebar-submenu">
    

    <li>
        
            <a href="/docs/main/v9.1.0/en/setup/service-agent/server-agents">Server Agents</a>
        
    </li>

    

    <li>
        
            <a href="/docs/main/v9.1.0/en/setup/service-agent/agent-compatibility">Compatibility</a>
        
    </li>

    

</ul>

        
    </li>

    

    <li>
        

            
            <a href="#">Service Mesh<i class="iconfont icon-arrow-right pull-right"></i></a>
            

            
<ul class="sidebar-submenu">
    

    <li>
        
            <a href="/docs/main/v9.1.0/en/setup/envoy/als_setting">Observe Service Mesh</a>
        
    </li>

    

    <li>
        
            <a href="/docs/main/v9.1.0/en/setup/istio/readme">Observe Control Plane (Istio)</a>
        
    </li>

    

    <li>
        
            <a href="/docs/main/v9.1.0/en/setup/envoy/metrics_service_setting">Observe Data Plane (Envoy)</a>
        
    </li>

    

</ul>

        
    </li>

    

    <li>
        
            <a href="/docs/main/v9.1.0/en/setup/backend/backend-k8s-monitoring">Kubernetes Monitoring</a>
        
    </li>

    

    <li>
        

            
            <a href="#">Infrastructure Monitoring<i class="iconfont icon-arrow-right pull-right"></i></a>
            

            
<ul class="sidebar-submenu">
    

    <li>
        
            <a href="/docs/main/v9.1.0/en/setup/backend/backend-vm-monitoring">Linux Monitoring</a>
        
    </li>

    

</ul>

        
    </li>

    

    <li>
        
            <a href="/docs/main/v9.1.0/en/setup/service-agent/browser-agent">Browser Monitoring</a>
        
    </li>

    

    <li>
        

            
            <a href="#">Database Monitoring<i class="iconfont icon-arrow-right pull-right"></i></a>
            

            
<ul class="sidebar-submenu">
    

    <li>
        
            <a href="/docs/main/v9.1.0/en/setup/service-agent/virtual-database">Virtual Database</a>
        
    </li>

    

</ul>

        
    </li>

    

    <li>
        

            
            <a href="#">Self Observability<i class="iconfont icon-arrow-right pull-right"></i></a>
            

            
<ul class="sidebar-submenu">
    

    <li>
        
            <a href="/docs/main/v9.1.0/en/setup/backend/backend-telemetry">OAP Telemetry</a>
        
    </li>

    

    <li>
        
            <a href="/docs/main/v9.1.0/en/setup/backend/backend-health-check">Health Check</a>
        
    </li>

    

</ul>

        
    </li>

    

</ul>

        
    </li>

    

    <li>
        
            <a href="https://github.com/apache/skywalking-cli">CLI Setup</a>
        
    </li>

    

    <li>
        
            <a href="/docs/main/v9.1.0/en/setup/backend/backend-data-generator">Mock Data Generator Setup</a>
        
    </li>

    

</ul>

        
    </li>
    
    <li>
        
            
            <a href="#">Contributing Guides<i class="iconfont icon-arrow-right pull-right"></i></a>
            

            
<ul class="sidebar-submenu">
    

    <li>
        
            <a href="/docs/main/v9.1.0/en/guides/readme">Contribute</a>
        
    </li>

    

    <li>
        
            <a href="/docs/main/v9.1.0/en/guides/asf/committer">Become A Committer</a>
        
    </li>

    

    <li>
        
            <a href="/docs/main/v9.1.0/en/guides/how-to-release/">Release Guide</a>
        
    </li>

    

    <li>
        
            <a href="/docs/main/v9.1.0/en/guides/how-to-build">Compiling Guide</a>
        
    </li>

    

</ul>

        
    </li>
    
    <li>
        
            
            <a href="#">Protocols<i class="iconfont icon-arrow-right pull-right"></i></a>
            

            
<ul class="sidebar-submenu">
    

    <li>
        
            <a href="/docs/main/v9.1.0/en/protocols/readme">Data Report(Probe/Agent) Protocol</a>
        
    </li>

    

    <li>
        
            <a href="/docs/main/v9.1.0/en/protocols/query-protocol">Query Protocol (GraphQL)</a>
        
    </li>

    

</ul>

        
    </li>
    
    <li>
        
            <a href="/docs/main/v9.1.0/en/academy/list">Academy</a>
        
    </li>
    
    <li>
        
            <a href="/docs/main/v9.1.0/en/faq/readme">FAQs</a>
        
    </li>
    
    <li>
        
            
            <a href="#">Changelog<i class="iconfont icon-arrow-right pull-right"></i></a>
            

            
<ul class="sidebar-submenu">
    

    <li>
        
            <a href="/docs/main/v9.1.0/en/changes/changes">Current Version</a>
        
    </li>

    

    <li>
        
            <a href="/docs/main/v9.1.0/en/changes/changes-9.0.0">9.0.0</a>
        
    </li>

    

    <li>
        
            <a href="/docs/main/v9.1.0/en/changes/changes-8.9.1">8.9.1</a>
        
    </li>

    

    <li>
        
            <a href="/docs/main/v9.1.0/en/changes/changes-8.9.0">8.9.0</a>
        
    </li>

    

    <li>
        
            <a href="/docs/main/v9.1.0/en/changes/changes-8.8.1">8.8.1</a>
        
    </li>

    

    <li>
        
            <a href="/docs/main/v9.1.0/en/changes/changes-8.8.0">8.8.0</a>
        
    </li>

    

    <li>
        
            <a href="/docs/main/v9.1.0/en/changes/changes-8.7.0">8.7.0</a>
        
    </li>

    

    <li>
        
            <a href="/docs/main/v9.1.0/en/changes/changes-8.6.0">8.6.0</a>
        
    </li>

    

    <li>
        
            <a href="/docs/main/v9.1.0/en/changes/changes-8.5.0">8.5.0</a>
        
    </li>

    

    <li>
        
            <a href="/docs/main/v9.1.0/en/changes/changes-8.4.0">8.4.0</a>
        
    </li>

    

    <li>
        
            <a href="/docs/main/v9.1.0/en/changes/changes-8.3.0">8.3.0</a>
        
    </li>

    

    <li>
        
            <a href="/docs/main/v9.1.0/en/changes/changes-8.2.0">8.2.0</a>
        
    </li>

    

    <li>
        
            <a href="/docs/main/v9.1.0/en/changes/changes-8.1.0">8.1.0</a>
        
    </li>

    

    <li>
        
            <a href="/docs/main/v9.1.0/en/changes/changes-8.0.1">8.0.1</a>
        
    </li>

    

    <li>
        
            <a href="/docs/main/v9.1.0/en/changes/changes-8.0.0">8.0.0</a>
        
    </li>

    

    <li>
        
            <a href="/docs/main/v9.1.0/en/changes/changes-7.0.0">7.0.0</a>
        
    </li>

    

    <li>
        
            <a href="/docs/main/v9.1.0/en/changes/changes-6.x">6.x</a>
        
    </li>

    

    <li>
        
            <a href="/docs/main/v9.1.0/en/changes/changes-5.x">5.x</a>
        
    </li>

    

</ul>

        
    </li>
    
</ul>
<script src="/js/sidebar-menu.js"></script>
<script>
  (function (){
    $.sidebarMenu($('.sidebar-menu'))
    var path = window.location.pathname;
    var hash = window.location.hash;
    var $a = $('.sidebar-menu a')
    $a.each(function (e){
      if($(this).attr('href')+'/' === path || $(this).attr('href').replace('#','/#') === path+hash){
        $(this).parents('li').addClass('active').show()
      }
    })
    $a.on('click',function (){
      var url = $(this).attr('href')
      if(url!=='#'){
        window.location.href = url
      }
    })
  })()
</script>

                  <div class="commit-id">Commit Id: 33402ce</div>
                

































</div>
            <main class="col-12 col-md-9 col-xl-8 pl-md-5 pr-md-4" role="main">
              <i class="iconfont icon-menu-doc doc-menu-button"></i>
              
<div class="td-content">











	<h1 id="trace-data-protocol-v3">Trace Data Protocol v3</h1>
<p>Trace Data Protocol describes the data format between SkyWalking agent/sniffer and backend.</p>
<h2 id="overview">Overview</h2>
<p>Trace data protocol is defined and provided in <a href="https://github.com/apache/skywalking-data-collect-protocol">gRPC format</a>, and implemented in <a href="../http-api-protocol">HTTP 1.1</a>.</p>
<h3 id="report-service-instance-status">Report service instance status</h3>
<ol>
<li>
<p>Service Instance Properties
Service instance contains more information than just a name. In order for the agent to report service instance status, use <code>ManagementService#reportInstanceProperties</code> service to provide a string-key/string-value pair list as the parameter. The <code>language</code> of target instance must be provided as the minimum requirement.</p>
</li>
<li>
<p>Service Ping
Service instance should keep alive with the backend. The agent should set a scheduler using <code>ManagementService#keepAlive</code> service every minute.</p>
</li>
</ol>
<h3 id="send-trace-and-metrics">Send trace and metrics</h3>
<p>After you have the service ID and service instance ID ready, you could send traces and metrics. Now we
have</p>
<ol>
<li><code>TraceSegmentReportService#collect</code> for the SkyWalking native trace format</li>
<li><code>JVMMetricReportService#collect</code> for the SkyWalking native JVM format</li>
</ol>
<p>For trace format, note that:</p>
<ol>
<li>The segment is a unique concept in SkyWalking. It should include all spans for each request in a single OS process, which is usually a single language-based thread.</li>
<li>There are three types of spans.</li>
</ol>
<ul>
<li>
<p>EntrySpan
EntrySpan represents a service provider, which is also the endpoint on the server end. As an APM system, SkyWalking targets the
application servers. Therefore, almost all the services and MQ-consumers are EntrySpans.</p>
</li>
<li>
<p>LocalSpan
LocalSpan represents a typical Java method which is not related to remote services. It is neither a MQ producer/consumer
nor a provider/consumer of a service (e.g. HTTP service).</p>
</li>
<li>
<p>ExitSpan
ExitSpan represents a client of service or MQ-producer. It is known as the <code>LeafSpan</code> in the early stages of SkyWalking.
For example, accessing DB by JDBC, and reading Redis/Memcached are classified as ExitSpans.</p>
</li>
</ul>
<ol start="3">
<li>
<p>Cross-thread/process span parent information is called &ldquo;reference&rdquo;. Reference carries the trace ID,
segment ID, span ID, service name, service instance name, endpoint name, and target address used on the client end (note: this is not required in cross-thread operations)
of this request in the parent.
See <a href="../skywalking-cross-process-propagation-headers-protocol-v3">Cross Process Propagation Headers Protocol v3</a> for more details.</p>
</li>
<li>
<p><code>Span#skipAnalysis</code> may be TRUE, if this span doesn&rsquo;t require backend analysis.</p>
</li>
</ol>
<h3 id="protocol-definition">Protocol Definition</h3>
<div class="highlight"><pre style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-protobuf" data-lang="protobuf"><span style="color:#998;font-style:italic">// The segment is a collection of spans. It includes all collected spans in a simple one request context, such as a HTTP request process.
</span><span style="color:#998;font-style:italic">//
</span><span style="color:#998;font-style:italic">// We recommend the agent/SDK report all tracked data of one request once for all, such as,
</span><span style="color:#998;font-style:italic">// typically, such as in Java, one segment represent all tracked operations(spans) of one request context in the same thread.
</span><span style="color:#998;font-style:italic">// At the same time, in some language there is not a clear concept like golang, it could represent all tracked operations of one request context.
</span><span style="color:#998;font-style:italic"></span><span style="color:#000;font-weight:bold">message</span> <span style="color:#458;font-weight:bold">SegmentObject</span> {<span style="color:#a61717;background-color:#e3d2d2">
</span><span style="color:#a61717;background-color:#e3d2d2"></span>    <span style="color:#998;font-style:italic">// A string id represents the whole trace.
</span><span style="color:#998;font-style:italic"></span>    <span style="color:#458;font-weight:bold">string</span> traceId <span style="color:#000;font-weight:bold">=</span> <span style="color:#099">1</span>;<span style="color:#a61717;background-color:#e3d2d2">
</span><span style="color:#a61717;background-color:#e3d2d2"></span>    <span style="color:#998;font-style:italic">// A unique id represents this segment. Other segments could use this id to reference as a child segment.
</span><span style="color:#998;font-style:italic"></span>    <span style="color:#458;font-weight:bold">string</span> traceSegmentId <span style="color:#000;font-weight:bold">=</span> <span style="color:#099">2</span>;<span style="color:#a61717;background-color:#e3d2d2">
</span><span style="color:#a61717;background-color:#e3d2d2"></span>    <span style="color:#998;font-style:italic">// Span collections included in this segment.
</span><span style="color:#998;font-style:italic"></span>    <span style="color:#000;font-weight:bold">repeated</span> SpanObject spans <span style="color:#000;font-weight:bold">=</span> <span style="color:#099">3</span>;<span style="color:#a61717;background-color:#e3d2d2">
</span><span style="color:#a61717;background-color:#e3d2d2"></span>    <span style="color:#998;font-style:italic">// **Service**. Represents a set/group of workloads which provide the same behaviours for incoming requests.
</span><span style="color:#998;font-style:italic"></span>    <span style="color:#998;font-style:italic">//
</span><span style="color:#998;font-style:italic"></span>    <span style="color:#998;font-style:italic">// The logic name represents the service. This would show as a separate node in the topology.
</span><span style="color:#998;font-style:italic"></span>    <span style="color:#998;font-style:italic">// The metrics analyzed from the spans, would be aggregated for this entity as the service level.
</span><span style="color:#998;font-style:italic"></span>    <span style="color:#458;font-weight:bold">string</span> <span style="color:#000;font-weight:bold">service</span> <span style="color:#000;font-weight:bold">=</span> <span style="color:#099">4</span>;<span style="color:#a61717;background-color:#e3d2d2">
</span><span style="color:#a61717;background-color:#e3d2d2"></span>    <span style="color:#998;font-style:italic">// **Service Instance**. Each individual workload in the Service group is known as an instance. Like `pods` in Kubernetes, it
</span><span style="color:#998;font-style:italic"></span>    <span style="color:#998;font-style:italic">// doesn&#39;t need to be a single OS process, however, if you are using instrument agents, an instance is actually a real OS process.
</span><span style="color:#998;font-style:italic"></span>    <span style="color:#998;font-style:italic">//
</span><span style="color:#998;font-style:italic"></span>    <span style="color:#998;font-style:italic">// The logic name represents the service instance. This would show as a separate node in the instance relationship.
</span><span style="color:#998;font-style:italic"></span>    <span style="color:#998;font-style:italic">// The metrics analyzed from the spans, would be aggregated for this entity as the service instance level.
</span><span style="color:#998;font-style:italic"></span>    <span style="color:#458;font-weight:bold">string</span> serviceInstance <span style="color:#000;font-weight:bold">=</span> <span style="color:#099">5</span>;<span style="color:#a61717;background-color:#e3d2d2">
</span><span style="color:#a61717;background-color:#e3d2d2"></span>    <span style="color:#998;font-style:italic">// Whether the segment includes all tracked spans.
</span><span style="color:#998;font-style:italic"></span>    <span style="color:#998;font-style:italic">// In the production environment tracked, some tasks could include too many spans for one request context, such as a batch update for a cache, or an async job.
</span><span style="color:#998;font-style:italic"></span>    <span style="color:#998;font-style:italic">// The agent/SDK could optimize or ignore some tracked spans for better performance.
</span><span style="color:#998;font-style:italic"></span>    <span style="color:#998;font-style:italic">// In this case, the value should be flagged as TRUE.
</span><span style="color:#998;font-style:italic"></span>    <span style="color:#458;font-weight:bold">bool</span> isSizeLimited <span style="color:#000;font-weight:bold">=</span> <span style="color:#099">6</span>;<span style="color:#a61717;background-color:#e3d2d2">
</span><span style="color:#a61717;background-color:#e3d2d2"></span>}<span style="color:#a61717;background-color:#e3d2d2">
</span><span style="color:#a61717;background-color:#e3d2d2">
</span><span style="color:#a61717;background-color:#e3d2d2"></span><span style="color:#998;font-style:italic">// Segment reference represents the link between two existing segment.
</span><span style="color:#998;font-style:italic"></span><span style="color:#000;font-weight:bold">message</span> <span style="color:#458;font-weight:bold">SegmentReference</span> {<span style="color:#a61717;background-color:#e3d2d2">
</span><span style="color:#a61717;background-color:#e3d2d2"></span>    <span style="color:#998;font-style:italic">// Represent the reference type. It could be across thread or across process.
</span><span style="color:#998;font-style:italic"></span>    <span style="color:#998;font-style:italic">// Across process means there is a downstream RPC call for this.
</span><span style="color:#998;font-style:italic"></span>    <span style="color:#998;font-style:italic">// Typically, refType == CrossProcess means SpanObject#spanType = entry.
</span><span style="color:#998;font-style:italic"></span>    RefType refType <span style="color:#000;font-weight:bold">=</span> <span style="color:#099">1</span>;<span style="color:#a61717;background-color:#e3d2d2">
</span><span style="color:#a61717;background-color:#e3d2d2"></span>    <span style="color:#998;font-style:italic">// A string id represents the whole trace.
</span><span style="color:#998;font-style:italic"></span>    <span style="color:#458;font-weight:bold">string</span> traceId <span style="color:#000;font-weight:bold">=</span> <span style="color:#099">2</span>;<span style="color:#a61717;background-color:#e3d2d2">
</span><span style="color:#a61717;background-color:#e3d2d2"></span>    <span style="color:#998;font-style:italic">// Another segment id as the parent.
</span><span style="color:#998;font-style:italic"></span>    <span style="color:#458;font-weight:bold">string</span> parentTraceSegmentId <span style="color:#000;font-weight:bold">=</span> <span style="color:#099">3</span>;<span style="color:#a61717;background-color:#e3d2d2">
</span><span style="color:#a61717;background-color:#e3d2d2"></span>    <span style="color:#998;font-style:italic">// The span id in the parent trace segment.
</span><span style="color:#998;font-style:italic"></span>    <span style="color:#458;font-weight:bold">int32</span> parentSpanId <span style="color:#000;font-weight:bold">=</span> <span style="color:#099">4</span>;<span style="color:#a61717;background-color:#e3d2d2">
</span><span style="color:#a61717;background-color:#e3d2d2"></span>    <span style="color:#998;font-style:italic">// The service logic name of the parent segment.
</span><span style="color:#998;font-style:italic"></span>    <span style="color:#998;font-style:italic">// If refType == CrossThread, this name is as same as the trace segment.
</span><span style="color:#998;font-style:italic"></span>    <span style="color:#458;font-weight:bold">string</span> parentService <span style="color:#000;font-weight:bold">=</span> <span style="color:#099">5</span>;<span style="color:#a61717;background-color:#e3d2d2">
</span><span style="color:#a61717;background-color:#e3d2d2"></span>    <span style="color:#998;font-style:italic">// The service logic name instance of the parent segment.
</span><span style="color:#998;font-style:italic"></span>    <span style="color:#998;font-style:italic">// If refType == CrossThread, this name is as same as the trace segment.
</span><span style="color:#998;font-style:italic"></span>    <span style="color:#458;font-weight:bold">string</span> parentServiceInstance <span style="color:#000;font-weight:bold">=</span> <span style="color:#099">6</span>;<span style="color:#a61717;background-color:#e3d2d2">
</span><span style="color:#a61717;background-color:#e3d2d2"></span>    <span style="color:#998;font-style:italic">// The endpoint name of the parent segment.
</span><span style="color:#998;font-style:italic"></span>    <span style="color:#998;font-style:italic">// **Endpoint**. A path in a service for incoming requests, such as an HTTP URI path or a gRPC service class + method signature.
</span><span style="color:#998;font-style:italic"></span>    <span style="color:#998;font-style:italic">// In a trace segment, the endpoint name is the name of first entry span.
</span><span style="color:#998;font-style:italic"></span>    <span style="color:#458;font-weight:bold">string</span> parentEndpoint <span style="color:#000;font-weight:bold">=</span> <span style="color:#099">7</span>;<span style="color:#a61717;background-color:#e3d2d2">
</span><span style="color:#a61717;background-color:#e3d2d2"></span>    <span style="color:#998;font-style:italic">// The network address, including ip/hostname and port, which is used in the client side.
</span><span style="color:#998;font-style:italic"></span>    <span style="color:#998;font-style:italic">// Such as Client --&gt; use 127.0.11.8:913 -&gt; Server
</span><span style="color:#998;font-style:italic"></span>    <span style="color:#998;font-style:italic">// then, in the reference of entry span reported by Server, the value of this field is 127.0.11.8:913.
</span><span style="color:#998;font-style:italic"></span>    <span style="color:#998;font-style:italic">// This plays the important role in the SkyWalking STAM(Streaming Topology Analysis Method)
</span><span style="color:#998;font-style:italic"></span>    <span style="color:#998;font-style:italic">// For more details, read https://wu-sheng.github.io/STAM/
</span><span style="color:#998;font-style:italic"></span>    <span style="color:#458;font-weight:bold">string</span> networkAddressUsedAtPeer <span style="color:#000;font-weight:bold">=</span> <span style="color:#099">8</span>;<span style="color:#a61717;background-color:#e3d2d2">
</span><span style="color:#a61717;background-color:#e3d2d2"></span>}<span style="color:#a61717;background-color:#e3d2d2">
</span><span style="color:#a61717;background-color:#e3d2d2">
</span><span style="color:#a61717;background-color:#e3d2d2"></span><span style="color:#998;font-style:italic">// Span represents a execution unit in the system, with duration and many other attributes.
</span><span style="color:#998;font-style:italic">// Span could be a method, a RPC, MQ message produce or consume.
</span><span style="color:#998;font-style:italic">// In the practice, the span should be added when it is really necessary, to avoid payload overhead.
</span><span style="color:#998;font-style:italic">// We recommend to creating spans in across process(client/server of RPC/MQ) and across thread cases only.
</span><span style="color:#998;font-style:italic"></span><span style="color:#000;font-weight:bold">message</span> <span style="color:#458;font-weight:bold">SpanObject</span> {<span style="color:#a61717;background-color:#e3d2d2">
</span><span style="color:#a61717;background-color:#e3d2d2"></span>    <span style="color:#998;font-style:italic">// The number id of the span. Should be unique in the whole segment.
</span><span style="color:#998;font-style:italic"></span>    <span style="color:#998;font-style:italic">// Starting at 0.
</span><span style="color:#998;font-style:italic"></span>    <span style="color:#458;font-weight:bold">int32</span> spanId <span style="color:#000;font-weight:bold">=</span> <span style="color:#099">1</span>;<span style="color:#a61717;background-color:#e3d2d2">
</span><span style="color:#a61717;background-color:#e3d2d2"></span>    <span style="color:#998;font-style:italic">// The number id of the parent span in the whole segment.
</span><span style="color:#998;font-style:italic"></span>    <span style="color:#998;font-style:italic">// -1 represents no parent span.
</span><span style="color:#998;font-style:italic"></span>    <span style="color:#998;font-style:italic">// Also, be known as the root/first span of the segment.
</span><span style="color:#998;font-style:italic"></span>    <span style="color:#458;font-weight:bold">int32</span> parentSpanId <span style="color:#000;font-weight:bold">=</span> <span style="color:#099">2</span>;<span style="color:#a61717;background-color:#e3d2d2">
</span><span style="color:#a61717;background-color:#e3d2d2"></span>    <span style="color:#998;font-style:italic">// Start timestamp in milliseconds of this span,
</span><span style="color:#998;font-style:italic"></span>    <span style="color:#998;font-style:italic">// measured between the current time and midnight, January 1, 1970 UTC.
</span><span style="color:#998;font-style:italic"></span>    <span style="color:#458;font-weight:bold">int64</span> startTime <span style="color:#000;font-weight:bold">=</span> <span style="color:#099">3</span>;<span style="color:#a61717;background-color:#e3d2d2">
</span><span style="color:#a61717;background-color:#e3d2d2"></span>    <span style="color:#998;font-style:italic">// End timestamp in milliseconds of this span,
</span><span style="color:#998;font-style:italic"></span>    <span style="color:#998;font-style:italic">// measured between the current time and midnight, January 1, 1970 UTC.
</span><span style="color:#998;font-style:italic"></span>    <span style="color:#458;font-weight:bold">int64</span> endTime <span style="color:#000;font-weight:bold">=</span> <span style="color:#099">4</span>;<span style="color:#a61717;background-color:#e3d2d2">
</span><span style="color:#a61717;background-color:#e3d2d2"></span>    <span style="color:#998;font-style:italic">// &lt;Optional&gt;
</span><span style="color:#998;font-style:italic"></span>    <span style="color:#998;font-style:italic">// In the across thread and across process, these references targeting the parent segments.
</span><span style="color:#998;font-style:italic"></span>    <span style="color:#998;font-style:italic">// The references usually have only one element, but in batch consumer case, such as in MQ or async batch process, it could be multiple.
</span><span style="color:#998;font-style:italic"></span>    <span style="color:#000;font-weight:bold">repeated</span> SegmentReference refs <span style="color:#000;font-weight:bold">=</span> <span style="color:#099">5</span>;<span style="color:#a61717;background-color:#e3d2d2">
</span><span style="color:#a61717;background-color:#e3d2d2"></span>    <span style="color:#998;font-style:italic">// A logic name represents this span.
</span><span style="color:#998;font-style:italic"></span>    <span style="color:#998;font-style:italic">//
</span><span style="color:#998;font-style:italic"></span>    <span style="color:#998;font-style:italic">// We don&#39;t recommend to include the parameter, such as HTTP request parameters, as a part of the operation, especially this is the name of the entry span.
</span><span style="color:#998;font-style:italic"></span>    <span style="color:#998;font-style:italic">// All statistic for the endpoints are aggregated base on this name. Those parameters should be added in the tags if necessary.
</span><span style="color:#998;font-style:italic"></span>    <span style="color:#998;font-style:italic">// If in some cases, it have to be a part of the operation name,
</span><span style="color:#998;font-style:italic"></span>    <span style="color:#998;font-style:italic">// users should use the Group Parameterized Endpoints capability at the backend to get the meaningful metrics.
</span><span style="color:#998;font-style:italic"></span>    <span style="color:#998;font-style:italic">// Read https://github.com/apache/skywalking/blob/master/docs/en/setup/backend/endpoint-grouping-rules.md
</span><span style="color:#998;font-style:italic"></span>    <span style="color:#458;font-weight:bold">string</span> operationName <span style="color:#000;font-weight:bold">=</span> <span style="color:#099">6</span>;<span style="color:#a61717;background-color:#e3d2d2">
</span><span style="color:#a61717;background-color:#e3d2d2"></span>    <span style="color:#998;font-style:italic">// Remote address of the peer in RPC/MQ case.
</span><span style="color:#998;font-style:italic"></span>    <span style="color:#998;font-style:italic">// This is required when spanType = Exit, as it is a part of the SkyWalking STAM(Streaming Topology Analysis Method).
</span><span style="color:#998;font-style:italic"></span>    <span style="color:#998;font-style:italic">// For more details, read https://wu-sheng.github.io/STAM/
</span><span style="color:#998;font-style:italic"></span>    <span style="color:#458;font-weight:bold">string</span> peer <span style="color:#000;font-weight:bold">=</span> <span style="color:#099">7</span>;<span style="color:#a61717;background-color:#e3d2d2">
</span><span style="color:#a61717;background-color:#e3d2d2"></span>    <span style="color:#998;font-style:italic">// Span type represents the role in the RPC context.
</span><span style="color:#998;font-style:italic"></span>    SpanType spanType <span style="color:#000;font-weight:bold">=</span> <span style="color:#099">8</span>;<span style="color:#a61717;background-color:#e3d2d2">
</span><span style="color:#a61717;background-color:#e3d2d2"></span>    <span style="color:#998;font-style:italic">// Span layer represent the component tech stack, related to the network tech.
</span><span style="color:#998;font-style:italic"></span>    SpanLayer spanLayer <span style="color:#000;font-weight:bold">=</span> <span style="color:#099">9</span>;<span style="color:#a61717;background-color:#e3d2d2">
</span><span style="color:#a61717;background-color:#e3d2d2"></span>    <span style="color:#998;font-style:italic">// Component id is a predefinited number id in the SkyWalking.
</span><span style="color:#998;font-style:italic"></span>    <span style="color:#998;font-style:italic">// It represents the framework, tech stack used by this tracked span, such as Spring.
</span><span style="color:#998;font-style:italic"></span>    <span style="color:#998;font-style:italic">// All IDs are defined in the https://github.com/apache/skywalking/blob/master/oap-server/server-bootstrap/src/main/resources/component-libraries.yml
</span><span style="color:#998;font-style:italic"></span>    <span style="color:#998;font-style:italic">// Send a pull request if you want to add languages, components or mapping defintions,
</span><span style="color:#998;font-style:italic"></span>    <span style="color:#998;font-style:italic">// all public components could be accepted.
</span><span style="color:#998;font-style:italic"></span>    <span style="color:#998;font-style:italic">// Follow this doc for more details, https://github.com/apache/skywalking/blob/master/docs/en/guides/Component-library-settings.md
</span><span style="color:#998;font-style:italic"></span>    <span style="color:#458;font-weight:bold">int32</span> componentId <span style="color:#000;font-weight:bold">=</span> <span style="color:#099">10</span>;<span style="color:#a61717;background-color:#e3d2d2">
</span><span style="color:#a61717;background-color:#e3d2d2"></span>    <span style="color:#998;font-style:italic">// The status of the span. False means the tracked execution ends in the unexpected status.
</span><span style="color:#998;font-style:italic"></span>    <span style="color:#998;font-style:italic">// This affects the successful rate statistic in the backend.
</span><span style="color:#998;font-style:italic"></span>    <span style="color:#998;font-style:italic">// Exception or error code happened in the tracked process doesn&#39;t mean isError == true, the implementations of agent plugin and tracing SDK make the final decision.
</span><span style="color:#998;font-style:italic"></span>    <span style="color:#458;font-weight:bold">bool</span> isError <span style="color:#000;font-weight:bold">=</span> <span style="color:#099">11</span>;<span style="color:#a61717;background-color:#e3d2d2">
</span><span style="color:#a61717;background-color:#e3d2d2"></span>    <span style="color:#998;font-style:italic">// String key, String value pair.
</span><span style="color:#998;font-style:italic"></span>    <span style="color:#998;font-style:italic">// Tags provides more informance, includes parameters.
</span><span style="color:#998;font-style:italic"></span>    <span style="color:#998;font-style:italic">//
</span><span style="color:#998;font-style:italic"></span>    <span style="color:#998;font-style:italic">// In the OAP backend analysis, some special tag or tag combination could provide other advanced features.
</span><span style="color:#998;font-style:italic"></span>    <span style="color:#998;font-style:italic">// https://github.com/apache/skywalking/blob/master/docs/en/guides/Java-Plugin-Development-Guide.md#special-span-tags
</span><span style="color:#998;font-style:italic"></span>    <span style="color:#000;font-weight:bold">repeated</span> KeyStringValuePair tags <span style="color:#000;font-weight:bold">=</span> <span style="color:#099">12</span>;<span style="color:#a61717;background-color:#e3d2d2">
</span><span style="color:#a61717;background-color:#e3d2d2"></span>    <span style="color:#998;font-style:italic">// String key, String value pair with an accurate timestamp.
</span><span style="color:#998;font-style:italic"></span>    <span style="color:#998;font-style:italic">// Logging some events happening in the context of the span duration.
</span><span style="color:#998;font-style:italic"></span>    <span style="color:#000;font-weight:bold">repeated</span> Log logs <span style="color:#000;font-weight:bold">=</span> <span style="color:#099">13</span>;<span style="color:#a61717;background-color:#e3d2d2">
</span><span style="color:#a61717;background-color:#e3d2d2"></span>    <span style="color:#998;font-style:italic">// Force the backend don&#39;t do analysis, if the value is TRUE.
</span><span style="color:#998;font-style:italic"></span>    <span style="color:#998;font-style:italic">// The backend has its own configurations to follow or override this.
</span><span style="color:#998;font-style:italic"></span>    <span style="color:#998;font-style:italic">//
</span><span style="color:#998;font-style:italic"></span>    <span style="color:#998;font-style:italic">// Use this mostly because the agent/SDK could know more context of the service role.
</span><span style="color:#998;font-style:italic"></span>    <span style="color:#458;font-weight:bold">bool</span> skipAnalysis <span style="color:#000;font-weight:bold">=</span> <span style="color:#099">14</span>;<span style="color:#a61717;background-color:#e3d2d2">
</span><span style="color:#a61717;background-color:#e3d2d2"></span>}<span style="color:#a61717;background-color:#e3d2d2">
</span><span style="color:#a61717;background-color:#e3d2d2">
</span><span style="color:#a61717;background-color:#e3d2d2"></span><span style="color:#000;font-weight:bold">message</span> <span style="color:#458;font-weight:bold">Log</span> {<span style="color:#a61717;background-color:#e3d2d2">
</span><span style="color:#a61717;background-color:#e3d2d2"></span>    <span style="color:#998;font-style:italic">// The timestamp in milliseconds of this event.,
</span><span style="color:#998;font-style:italic"></span>    <span style="color:#998;font-style:italic">// measured between the current time and midnight, January 1, 1970 UTC.
</span><span style="color:#998;font-style:italic"></span>    <span style="color:#458;font-weight:bold">int64</span> time <span style="color:#000;font-weight:bold">=</span> <span style="color:#099">1</span>;<span style="color:#a61717;background-color:#e3d2d2">
</span><span style="color:#a61717;background-color:#e3d2d2"></span>    <span style="color:#998;font-style:italic">// String key, String value pair.
</span><span style="color:#998;font-style:italic"></span>    <span style="color:#000;font-weight:bold">repeated</span> KeyStringValuePair data <span style="color:#000;font-weight:bold">=</span> <span style="color:#099">2</span>;<span style="color:#a61717;background-color:#e3d2d2">
</span><span style="color:#a61717;background-color:#e3d2d2"></span>}<span style="color:#a61717;background-color:#e3d2d2">
</span><span style="color:#a61717;background-color:#e3d2d2">
</span><span style="color:#a61717;background-color:#e3d2d2"></span><span style="color:#998;font-style:italic">// Map to the type of span
</span><span style="color:#998;font-style:italic"></span><span style="color:#000;font-weight:bold">enum</span> SpanType {<span style="color:#a61717;background-color:#e3d2d2">
</span><span style="color:#a61717;background-color:#e3d2d2"></span>    <span style="color:#998;font-style:italic">// Server side of RPC. Consumer side of MQ.
</span><span style="color:#998;font-style:italic"></span>    Entry <span style="color:#000;font-weight:bold">=</span> <span style="color:#099">0</span>;<span style="color:#a61717;background-color:#e3d2d2">
</span><span style="color:#a61717;background-color:#e3d2d2"></span>    <span style="color:#998;font-style:italic">// Client side of RPC. Producer side of MQ.
</span><span style="color:#998;font-style:italic"></span>    Exit <span style="color:#000;font-weight:bold">=</span> <span style="color:#099">1</span>;<span style="color:#a61717;background-color:#e3d2d2">
</span><span style="color:#a61717;background-color:#e3d2d2"></span>    <span style="color:#998;font-style:italic">// A common local code execution.
</span><span style="color:#998;font-style:italic"></span>    Local <span style="color:#000;font-weight:bold">=</span> <span style="color:#099">2</span>;<span style="color:#a61717;background-color:#e3d2d2">
</span><span style="color:#a61717;background-color:#e3d2d2"></span>}<span style="color:#a61717;background-color:#e3d2d2">
</span><span style="color:#a61717;background-color:#e3d2d2">
</span><span style="color:#a61717;background-color:#e3d2d2"></span><span style="color:#998;font-style:italic">// A ID could be represented by multiple string sections.
</span><span style="color:#998;font-style:italic"></span><span style="color:#000;font-weight:bold">message</span> <span style="color:#458;font-weight:bold">ID</span> {<span style="color:#a61717;background-color:#e3d2d2">
</span><span style="color:#a61717;background-color:#e3d2d2"></span>    <span style="color:#000;font-weight:bold">repeated</span> <span style="color:#458;font-weight:bold">string</span> id <span style="color:#000;font-weight:bold">=</span> <span style="color:#099">1</span>;<span style="color:#a61717;background-color:#e3d2d2">
</span><span style="color:#a61717;background-color:#e3d2d2"></span>}<span style="color:#a61717;background-color:#e3d2d2">
</span><span style="color:#a61717;background-color:#e3d2d2">
</span><span style="color:#a61717;background-color:#e3d2d2"></span><span style="color:#998;font-style:italic">// Type of the reference
</span><span style="color:#998;font-style:italic"></span><span style="color:#000;font-weight:bold">enum</span> RefType {<span style="color:#a61717;background-color:#e3d2d2">
</span><span style="color:#a61717;background-color:#e3d2d2"></span>    <span style="color:#998;font-style:italic">// Map to the reference targeting the segment in another OS process.
</span><span style="color:#998;font-style:italic"></span>    CrossProcess <span style="color:#000;font-weight:bold">=</span> <span style="color:#099">0</span>;<span style="color:#a61717;background-color:#e3d2d2">
</span><span style="color:#a61717;background-color:#e3d2d2"></span>    <span style="color:#998;font-style:italic">// Map to the reference targeting the segment in the same process of the current one, just across thread.
</span><span style="color:#998;font-style:italic"></span>    <span style="color:#998;font-style:italic">// This is only used when the coding language has the thread concept.
</span><span style="color:#998;font-style:italic"></span>    CrossThread <span style="color:#000;font-weight:bold">=</span> <span style="color:#099">1</span>;<span style="color:#a61717;background-color:#e3d2d2">
</span><span style="color:#a61717;background-color:#e3d2d2"></span>}<span style="color:#a61717;background-color:#e3d2d2">
</span><span style="color:#a61717;background-color:#e3d2d2">
</span><span style="color:#a61717;background-color:#e3d2d2"></span><span style="color:#998;font-style:italic">// Map to the layer of span
</span><span style="color:#998;font-style:italic"></span><span style="color:#000;font-weight:bold">enum</span> SpanLayer {<span style="color:#a61717;background-color:#e3d2d2">
</span><span style="color:#a61717;background-color:#e3d2d2"></span>    <span style="color:#998;font-style:italic">// Unknown layer. Could be anything.
</span><span style="color:#998;font-style:italic"></span>    Unknown <span style="color:#000;font-weight:bold">=</span> <span style="color:#099">0</span>;<span style="color:#a61717;background-color:#e3d2d2">
</span><span style="color:#a61717;background-color:#e3d2d2"></span>    <span style="color:#998;font-style:italic">// A database layer, used in tracing the database client component.
</span><span style="color:#998;font-style:italic"></span>    Database <span style="color:#000;font-weight:bold">=</span> <span style="color:#099">1</span>;<span style="color:#a61717;background-color:#e3d2d2">
</span><span style="color:#a61717;background-color:#e3d2d2"></span>    <span style="color:#998;font-style:italic">// A RPC layer, used in both client and server sides of RPC component.
</span><span style="color:#998;font-style:italic"></span>    RPCFramework <span style="color:#000;font-weight:bold">=</span> <span style="color:#099">2</span>;<span style="color:#a61717;background-color:#e3d2d2">
</span><span style="color:#a61717;background-color:#e3d2d2"></span>    <span style="color:#998;font-style:italic">// HTTP is a more specific RPCFramework.
</span><span style="color:#998;font-style:italic"></span>    Http <span style="color:#000;font-weight:bold">=</span> <span style="color:#099">3</span>;<span style="color:#a61717;background-color:#e3d2d2">
</span><span style="color:#a61717;background-color:#e3d2d2"></span>    <span style="color:#998;font-style:italic">// A MQ layer, used in both producer and consuer sides of the MQ component.
</span><span style="color:#998;font-style:italic"></span>    MQ <span style="color:#000;font-weight:bold">=</span> <span style="color:#099">4</span>;<span style="color:#a61717;background-color:#e3d2d2">
</span><span style="color:#a61717;background-color:#e3d2d2"></span>    <span style="color:#998;font-style:italic">// A cache layer, used in tracing the cache client component.
</span><span style="color:#998;font-style:italic"></span>    Cache <span style="color:#000;font-weight:bold">=</span> <span style="color:#099">5</span>;<span style="color:#a61717;background-color:#e3d2d2">
</span><span style="color:#a61717;background-color:#e3d2d2"></span>}<span style="color:#a61717;background-color:#e3d2d2">
</span><span style="color:#a61717;background-color:#e3d2d2">
</span><span style="color:#a61717;background-color:#e3d2d2"></span><span style="color:#998;font-style:italic">// The segment collections for trace report in batch and sync mode.
</span><span style="color:#998;font-style:italic"></span><span style="color:#000;font-weight:bold">message</span> <span style="color:#458;font-weight:bold">SegmentCollection</span> {<span style="color:#a61717;background-color:#e3d2d2">
</span><span style="color:#a61717;background-color:#e3d2d2"></span>    <span style="color:#000;font-weight:bold">repeated</span> SegmentObject segments <span style="color:#000;font-weight:bold">=</span> <span style="color:#099">1</span>;<span style="color:#a61717;background-color:#e3d2d2">
</span><span style="color:#a61717;background-color:#e3d2d2"></span>}<span style="color:#a61717;background-color:#e3d2d2">
</span></code></pre></div>



</div>


            </main>
          <div id="toc" class="d-none d-xl-block col-xl-2 td-toc d-print-none">
            




<div class="td-page-meta ml-2 pb-1 pt-2 mb-0">











</div>






<nav id="TableOfContents">
  <ul>
    <li><a href="#trace-data-protocol-v3">Trace Data Protocol v3</a>
      <ul>
        <li><a href="#overview">Overview</a>
          <ul>
            <li><a href="#report-service-instance-status">Report service instance status</a></li>
            <li><a href="#send-trace-and-metrics">Send trace and metrics</a></li>
            <li><a href="#protocol-definition">Protocol Definition</a></li>
          </ul>
        </li>
      </ul>
    </li>
  </ul>
</nav>




<script>
  $(function () {
    var $toc = $("#TableOfContents");
    if (!$toc || !$toc.length) {
      return;
    }
    var top = $toc.offset().top;
    $(window).on("scroll", debounce(setTop, 100))
    $(window).on("scroll", debounce(addActive, 30))

    function addActive() {
      var scrollValue = $(window).scrollTop();
      var topEle = null;
      $.each($('main h1, main h2, main h3'), function (index, item) {
        if ($(item).offset().top - 70 > scrollValue) {
          return
        }
        if (!topEle) {
          topEle = item
        } else if ($(item).offset().top >= $(topEle).offset().top) {
          topEle = item
        }
        if (topEle) {
          var id = $(item).attr('id');
          $toc.find('a').removeClass("active").end().find('a[href="' + '#' + id + '"]').addClass("active")
        }
      })
    }

    function setTop() {
      var scrollValue = $(window).scrollTop();
      if (scrollValue >= top - 70) {
        $toc.addClass('fixed')
      } else {
        $toc.removeClass('fixed')
      }
    }

    function debounce(fn, wait) {
      var timeout = null;
      return function () {
        clearTimeout(timeout);
        timeout = setTimeout(() => {
          fn.apply(this, arguments);
        }, wait);
      };
    }
  })

</script>

          </div>

        </div>
      </div>

      
<footer class="py-5 sky-row">
  <div class="container-fluid text-center">
    <div class="">
        
        
        
<ul class="list-inline mb-0">
  
  <li class="list-inline-item mx-2 h3" data-toggle="tooltip" data-placement="top" title="Twitter" aria-label="Twitter">
    <a class="text-color" target="_blank" href="https://twitter.com/asfskywalking">
      <i class="iconfont icon-twitter"></i>
    </a>
  </li>
  
  <li class="list-inline-item mx-2 h3" data-toggle="tooltip" data-placement="top" title="Slack" aria-label="Slack">
    <a class="text-color" target="_blank" href="http://s.apache.org/slack-invite">
      <i class="iconfont icon-slack"></i>
    </a>
  </li>
  
  <li class="list-inline-item mx-2 h3" data-toggle="tooltip" data-placement="top" title="Mailing list" aria-label="Mailing list">
    <a class="text-color" target="_blank" href="https://lists.apache.org/list.html?dev@skywalking.apache.org">
      <i class="iconfont icon-email"></i>
    </a>
  </li>
  
  <li class="list-inline-item mx-2 h3" data-toggle="tooltip" data-placement="top" title="GitHub" aria-label="GitHub">
    <a class="text-color" target="_blank" href="https://github.com/apache/skywalking">
      <i class="iconfont icon-github"></i>
    </a>
  </li>
  
</ul>

        
        
    </div>
    <div class="">

        <small class="text-color">&copy; 2017 - 2024 The Apache Software Foundation All Rights Reserved</small>
        
	
    </div>
    <div class="">
      <small class="text-color mt-4">Apache SkyWalking, SkyWalking, Apache, the Apache feather logo, and the Apache SkyWalking project logo are either registered trademarks or trademarks of the Apache Software Foundation.</small>
    </div>
  </div>
</footer>


    </div>
    



















































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































    
<div id="popup">
    <div class="mask">
        <img src=""/>
    </div>
</div>

    <div class="sidebar-mask"></div>
<div class="sidebar">
    <nav class="nav-links">
        <div class="nav-item"><a href="/docs/" class="nav-link">Projects and Documentation</a></div>
        <div class="nav-item"><a href="/events/" class="nav-link">Events</a></div>
        <div class="nav-item"><a href="/blog/" class="nav-link router-link-exact-active router-link-active">Blog</a>
        </div>
        <div class="nav-item"><a href="/downloads/" class="nav-link">Downloads</a></div>
        <div class="nav-item"><a href="/team/" class="nav-link">Team</a></div>
        <div class="nav-item"><a href="/users/" class="nav-link">Users</a></div>
        <div class="nav-item">
            <div class="dropdown-wrapper open">
                <a class="dropdown-title"><span>中文资料</span>
                    <span class="arrow down"></span>
                </a>
                <ul class="nav-dropdown">
                    <li class="dropdown-item">
                        <a href="/zh/" class="nav-link external">博客</a>
                    </li>
                    <li class="dropdown-item">
                        <a href="https://space.bilibili.com/390683219" target="_blank"
                           rel="noopener noreferrer" class="nav-link external">B站</a>
                    </li>
                    <li class="dropdown-item">
                        <a href="https://juejin.cn/user/13673577331607" target="_blank"
                           rel="noopener noreferrer" class="nav-link external">掘金</a>
                    </li>
                </ul>
            </div>
        </div>
        <div class="nav-item">
            <div class="dropdown-wrapper open">
                <a class="dropdown-title">
                    <span>Links</span>
                    <span class="arrow down"></span>
                </a>
                <ul class="nav-dropdown">
                    <li class="dropdown-item">
                        <a href="http://www.apache.org/" target="_blank"
                           rel="noopener noreferrer" class="nav-link external">
                            Apache Software Foundation
                        </a>
                    </li>
                    <li class="dropdown-item">
                        <a href="https://github.com/apache/skywalking/issues"
                           target="_blank" rel="noopener noreferrer"
                           class="nav-link external">
                            GitHub Issue Tracker
                        </a>
                    </li>
                    <li class="dropdown-item">
                        <a href="https://lists.apache.org/list.html?dev@skywalking.apache.org" target="_blank"
                           rel="noopener noreferrer" class="nav-link external">
                            Dev Mailing List
                        </a>
                    </li>
                    <li class="dropdown-item">
                        <a href="http://www.apache.org/licenses/" target="_blank"
                           rel="noopener noreferrer" class="nav-link external">
                            License
                        </a>
                    </li>
                    <li class="dropdown-item">
                        <a href="http://www.apache.org/events/current-event"
                           target="_blank" rel="noopener noreferrer"
                           class="nav-link external">
                            Apache Events
                        </a>
                    </li>
                    <li class="dropdown-item">
                        <a href="http://www.apache.org/security/" target="_blank"
                           rel="noopener noreferrer" class="nav-link external">
                            Security
                        </a>
                    </li>
                    <li class="dropdown-item">
                        <a href="http://www.apache.org/foundation/sponsorship.html"
                           target="_blank" rel="noopener noreferrer"
                           class="nav-link external">
                            Sponsorship and Donate
                        </a>
                    </li>
                    <li class="dropdown-item">
                        <a href="http://www.apache.org/foundation/thanks.html"
                           target="_blank" rel="noopener noreferrer"
                           class="nav-link external">
                            Thanks
                        </a>
                    </li>
                </ul>
            </div>
        </div>
    </nav>
</div>

    <script src="/js/bootstrap.bundle.min.js"></script>

<script src="https://cdn.jsdelivr.net/npm/@docsearch/js@3"></script>









<script src="/js/main.min.dc00f5ca911ee5aa105ea6de6b3b7e8d8169ba5a3bf156b1fcfe23dfe3e62b0a.js" integrity="sha256-3AD1ypEe5aoQXqbeazt&#43;jYFpulo78Vax/P4j3&#43;PmKwo=" crossorigin="anonymous"></script>


<script src="/js/mermaid.min.js"></script>
<script>
    window.onload = () => mermaid.init(undefined, ".language-mermaid");
</script>


<script defer
src="https://widget.kapa.ai/kapa-widget.bundle.js"
data-website-id="8a08392b-9c4d-4816-8bc4-f93e0ecdd2a7"
data-project-name="SkyWalking"
data-project-color="#2B74B8"
data-button-text="Ask AI"
data-search-mode-enabled="true"
data-modal-open-on-command-k="true"
data-modal-disclaimer="The AI supports multiple languages, but it may not be accessible in China, a proxy is required."
data-project-logo="https://miro.medium.com/v2/resize:fit:2400/0*kmS-5BQ8ShAhZ_F4.jpg"
data-modal-example-questions="What is Apache SkyWalking?,How to deploy SkyWalking?,How to inject agents non-intrusively?,How to setup trace sampling?"
data-button-position-top=""
data-button-position-right="20px"
data-button-position-bottom="200px"
data-button-position-left=""
></script>




  </body>
  <script>
    $(function (){
      $('.doc-menu-button').on('click',function (){
        $('.td-sidebar').toggleClass('active')
      })
      $('.version-select').on('change', function (){
        var selectVersion = $(this).val().toLowerCase();
        var prefix = '';
        var url = location.href.replace(/(\/docs\/[a-zA-Z\-]+\/)([\w|\.]+)(\/.*)/, function (match, p1, p2, p3){
          prefix = p1 + selectVersion;
          return p1 + selectVersion + p3
        })
        go2SelectVersion(url, prefix)

      })
      function go2SelectVersion(url, prefix){
        $.ajax({
          url: url,
          type: "get",
          success:function(){
            location.href = url;
          },
          statusCode: {
            404:function(){
              location.href = prefix + '/readme/';
            }
          }
        });
      }
    })
  </script>
</html>
