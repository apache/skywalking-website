<!doctype html>
<html lang="en" class="no-js">
  <head>
    <meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<meta name="twitter:site" content="skywalking.apache.org">
<meta name="twitter:image:src" content="https://skywalking.apache.org/images/skywalking_400x400.png">
<meta property="og:image" content="https://skywalking.apache.org/images/skywalking_400x400.png">
<meta name="generator" content="Hugo 0.80.0" />
<META NAME="ROBOTS" CONTENT="INDEX, FOLLOW">



<link rel="apple-touch-icon" sizes="180x180" href="/favicons/apple-touch-icon.png">
<link rel="icon" type="image/png" sizes="32x32" href="/favicons/favicon-32x32.png">
<link rel="icon" type="image/png" sizes="16x16" href="/favicons/favicon-16x16.png">
<link rel="manifest" href="/favicons/site.webmanifest">
<link rel="mask-icon" href="/favicons/safari-pinned-tab.svg" color="#5bbad5">
<meta name="msapplication-TileColor" content="#da532c">
<meta name="theme-color" content="#ffffff">

<title>Send Envoy metrics to SkyWalking with / without Istio | Apache SkyWalking</title><meta property="og:title" content="Send Envoy metrics to SkyWalking with / without Istio" />
<meta property="og:description" content="Send Envoy metrics to SkyWalking with / without Istio Envoy defines a gRPC service to emit the metrics, whatever implements this protocol can be used to receive the metrics. SkyWalking has a built-in receiver that implements this protocol so that you can configure Envoy to emit its metrics to SkyWalking.
As an APM system, SkyWalking does not only receive and store the metrics emitted by Envoy, it also analyzes the topology of services and service instances." />
<meta property="og:type" content="article" />
<meta property="og:url" content="/docs/main/latest/en/setup/envoy/metrics_service_setting/" />
<meta property="article:published_time" content="2021-03-09T15:01:03+00:00" />
<meta property="article:modified_time" content="2021-03-09T15:01:03+00:00" />
<meta itemprop="name" content="Send Envoy metrics to SkyWalking with / without Istio">
<meta itemprop="description" content="Send Envoy metrics to SkyWalking with / without Istio Envoy defines a gRPC service to emit the metrics, whatever implements this protocol can be used to receive the metrics. SkyWalking has a built-in receiver that implements this protocol so that you can configure Envoy to emit its metrics to SkyWalking.
As an APM system, SkyWalking does not only receive and store the metrics emitted by Envoy, it also analyzes the topology of services and service instances.">
<meta itemprop="datePublished" content="2021-03-09T15:01:03+00:00" />
<meta itemprop="dateModified" content="2021-03-09T15:01:03+00:00" />
<meta itemprop="wordCount" content="486">



<meta itemprop="keywords" content="" />
<meta name="twitter:card" content="summary"/>
<meta name="twitter:title" content="Send Envoy metrics to SkyWalking with / without Istio"/>
<meta name="twitter:description" content="Send Envoy metrics to SkyWalking with / without Istio Envoy defines a gRPC service to emit the metrics, whatever implements this protocol can be used to receive the metrics. SkyWalking has a built-in receiver that implements this protocol so that you can configure Envoy to emit its metrics to SkyWalking.
As an APM system, SkyWalking does not only receive and store the metrics emitted by Envoy, it also analyzes the topology of services and service instances."/>

<script type="application/javascript">
var doNotTrack = false;
if (!doNotTrack) {
	window.ga=window.ga||function(){(ga.q=ga.q||[]).push(arguments)};ga.l=+new Date;
	ga('create', 'UA-178891182-1', 'auto');
	
	ga('send', 'pageview');
}
</script>
<script async src='https://www.google-analytics.com/analytics.js'></script>




<link rel="preload" href="/scss/main.min.47fb3abdc4acc7f634ea3832299986022ed5251b9bdb53a1c86cb11b43d390a4.css" as="style">
<link href="/scss/main.min.47fb3abdc4acc7f634ea3832299986022ed5251b9bdb53a1c86cb11b43d390a4.css" rel="stylesheet" integrity="">


<script
        src="https://cdn.bootcdn.net/ajax/libs/jquery/3.3.1/jquery.min.js"
  integrity="sha256-FgpCb/KJQlLNfOu91ta32o/NMZxltwRo8QtmkMRdAu8="
  crossorigin="anonymous"></script>





    <title>Send Envoy metrics to SkyWalking with / without Istio | Apache SkyWalking</title>
  </head>
  <body class="td-page  project-doc">
    <header>
      
<nav class="js-navbar-scroll navbar navbar-expand navbar-dark flex-column flex-md-row td-navbar">
    <div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div>
    <a class="navbar-brand" href="/">
        <span class="navbar-logo"><img src="/images/logo.png"></span> 
    </a>
    <div class="td-navbar-nav-scroll ml-md-auto" id="navigation">
        <ul class="navbar-nav mt-lg-0">
              
            
            <li class="nav-item mr-3 mb-2 mb-lg-0">
				
				
				
				
				<a class="nav-link" href="/docs" ><span>Projects and Documentations</span></a>
			</li>
              
            
            <li class="nav-item mr-3 mb-2 mb-lg-0">
				
				
				
				
				<a class="nav-link" href="/events" ><span>Events</span></a>
			</li>
              
            
            <li class="nav-item mr-3 mb-2 mb-lg-0">
				
				
				
				
				<a class="nav-link" href="/blog" ><span>Blogs</span></a>
			</li>
              
            
            <li class="nav-item mr-3 mb-2 mb-lg-0">
				
				
				
				
				<a class="nav-link" href="/downloads" ><span>Downloads</span></a>
			</li>
              
            
            <li class="nav-item mr-3 mb-2 mb-lg-0">
				
				
				
				
				<a class="nav-link" href="/team" ><span>Team</span></a>
			</li>
              
            
            <li class="nav-item mr-3 mb-2 mb-lg-0">
				
				
				
				
				<a class="nav-link" href="/zh" ><span>中文博客</span></a>
			</li>
              
            <li class="nav-item dropdown">
                <a class="nav-link dropdown-toggle" href="#" role="button" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
                Links
              </a>
                <div class="dropdown-menu">
                    
                    <a class="dropdown-item" href="http://www.apache.org/">Apache Software Foundation</a> 
                    <a class="dropdown-item" href="https://github.com/apache/skywalking/issues">GitHub Issue Tracker</a> 
                    <a class="dropdown-item" href="https://lists.apache.org/list.html?dev@skywalking.apache.org">Dev Mailing List</a> 
                    <a class="dropdown-item" href="http://www.apache.org/licenses/">License</a> 
                    <a class="dropdown-item" href="http://www.apache.org/events/current-event">Apache Events</a> 
                    <a class="dropdown-item" href="http://www.apache.org/security/">Security</a> 
                    <a class="dropdown-item" href="http://www.apache.org/foundation/sponsorship.html">Sponsor and Donate</a> 
                    <a class="dropdown-item" href="http://www.apache.org/foundation/thanks.html">Thanks</a> 
                </div>
            </li>
             
            
			
        </ul>
    </div>
    <div class="navbar-nav d-none d-lg-block search-input-box">
<input type="search" class="form-control td-search-input" placeholder="&#xf002 Search this site…" aria-label="Search this site…" autocomplete="off">
</div>
</nav>

    </header>
    <div class="container-fluid td-outer">

      <div class="td-main">
        <div class="row flex-xl-nowrap">
          <div class="col-12 col-md-3 col-xl-2 d-print-none td-sidebar">

                    <h5>Documentation: latest</h5>
                    
<ul class="sidebar-menu">
    

    <li>
        
            <a href="/docs/main/latest/readme">Welcome</a>
        
    </li>

    

    <li>
        

            
            <a href="#">Concepts and Designs<i class="fa fa-angle-left pull-right"></i></a>
            

            
<ul class="sidebar-submenu" >
    

    <li>
        

            
            <a href="#">What is SkyWalking?<i class="fa fa-angle-left pull-right"></i></a>
            

            
<ul class="sidebar-submenu" >
    

    <li>
        
            <a href="/docs/main/latest/en/concepts-and-designs/overview">Overview and Core concepts</a>
        
    </li>

    

    <li>
        
            <a href="/docs/main/latest/en/concepts-and-designs/project-goals">Project Goals</a>
        
    </li>

    

</ul>

        
    </li>

    

    <li>
        

            
            <a href="#">Probe<i class="fa fa-angle-left pull-right"></i></a>
            

            
<ul class="sidebar-submenu" >
    

    <li>
        
            <a href="/docs/main/latest/en/concepts-and-designs/probe-introduction">Introduction</a>
        
    </li>

    

    <li>
        
            <a href="/docs/main/latest/en/concepts-and-designs/service-agent">Service auto instrument agent</a>
        
    </li>

    

    <li>
        
            <a href="/docs/main/latest/en/concepts-and-designs/manual-sdk">Manual instrument SDK</a>
        
    </li>

    

    <li>
        
            <a href="/docs/main/latest/en/concepts-and-designs/service-mesh-probe">Service Mesh probe</a>
        
    </li>

    

</ul>

        
    </li>

    

    <li>
        

            
            <a href="#">Backend<i class="fa fa-angle-left pull-right"></i></a>
            

            
<ul class="sidebar-submenu" >
    

    <li>
        
            <a href="/docs/main/latest/en/concepts-and-designs/backend-overview">Overview</a>
        
    </li>

    

    <li>
        
            <a href="/docs/main/latest/en/concepts-and-designs/oal">Observability Analysis Language</a>
        
    </li>

    

    <li>
        
            <a href="/docs/main/latest/en/concepts-and-designs/mal">Meter Analysis Language</a>
        
    </li>

    

    <li>
        
            <a href="/docs/main/latest/en/concepts-and-designs/lal">Log Analysis Language</a>
        
    </li>

    

    <li>
        
            <a href="/docs/main/latest/en/protocols/readme#query-protocol">Query in OAP</a>
        
    </li>

    

</ul>

        
    </li>

    

    <li>
        
            <a href="/docs/main/latest/en/concepts-and-designs/ui-overview">UI</a>
        
    </li>

    

    <li>
        
            <a href="https://github.com/apache/skywalking-cli">CLI</a>
        
    </li>

    

    <li>
        
            <a href="/docs/main/latest/en/concepts-and-designs/event/">Event</a>
        
    </li>

    

</ul>

        
    </li>

    

    <li>
        

            
            <a href="#">Setup<i class="fa fa-angle-left pull-right"></i></a>
            

            
<ul class="sidebar-submenu" >
    

    <li>
        

            
            <a href="#">Java agent<i class="fa fa-angle-left pull-right"></i></a>
            

            
<ul class="sidebar-submenu" >
    

    <li>
        
            <a href="/docs/main/latest/en/setup/service-agent/java-agent/readme">Setup</a>
        
    </li>

    

    <li>
        
            <a href="/docs/main/latest/en/setup/service-agent/java-agent/supported-list">Supported middleware, framework and library</a>
        
    </li>

    

    <li>
        
            <a href="/docs/main/latest/en/setup/service-agent/java-agent/readme#table-of-agent-configuration-properties">Agent Configuration Properties</a>
        
    </li>

    

    <li>
        
            <a href="/docs/main/latest/en/setup/service-agent/java-agent/readme#optional-plugins">Optional plugins</a>
        
    </li>

    

    <li>
        
            <a href="/docs/main/latest/en/setup/service-agent/java-agent/readme#bootstrap-class-plugins">Bootstrap/JVM class plugin</a>
        
    </li>

    

    <li>
        
            <a href="/docs/main/latest/en/setup/service-agent/java-agent/readme#advanced-reporters">Advanced reporters</a>
        
    </li>

    

    <li>
        
            <a href="/docs/main/latest/en/guides/java-plugin-development-guide/">Plugin development guide</a>
        
    </li>

    

    <li>
        
            <a href="https://skyapmtest.github.io/Agent-Benchmarks/">Java Agent Performance Test</a>
        
    </li>

    

</ul>

        
    </li>

    

    <li>
        
            <a href="/docs/main/latest/en/setup/service-agent/server-agents">All available server agents</a>
        
    </li>

    

    <li>
        
            <a href="/docs/main/latest/en/setup/service-agent/browser-agent">Browser agent</a>
        
    </li>

    

    <li>
        

            
            <a href="#">Service Mesh<i class="fa fa-angle-left pull-right"></i></a>
            

            
<ul class="sidebar-submenu" >
    

    <li>
        
            <a href="/docs/main/latest/en/setup/istio/readme">Observe Istio Control Plane</a>
        
    </li>

    

    <li>
        
            <a href="/docs/main/latest/en/setup/envoy/als_setting">Observe Service Mesh</a>
        
    </li>

    

    <li>
        
            <a href="/docs/main/latest/en/setup/envoy/metrics_service_setting">Send Envoy metrics to SkyWalking with / without Istio</a>
        
    </li>

    

</ul>

        
    </li>

    

    <li>
        

            
            <a href="#">Backend<i class="fa fa-angle-left pull-right"></i></a>
            

            
<ul class="sidebar-submenu" >
    

    <li>
        
            <a href="/docs/main/latest/en/setup/backend/backend-setup">Setup</a>
        
    </li>

    

    <li>
        
            <a href="/docs/main/latest/en/setup/backend/configuration-vocabulary">Configuration Vocabulary</a>
        
    </li>

    

    <li>
        
            <a href="/docs/main/latest/en/setup/backend/backend-setting-override">Overriding settings</a>
        
    </li>

    

    <li>
        
            <a href="/docs/main/latest/en/setup/backend/backend-ip-port">IP and port setting</a>
        
    </li>

    

    <li>
        
            <a href="/docs/main/latest/en/setup/backend/backend-init-mode">Backend init mode startup</a>
        
    </li>

    

    <li>
        
            <a href="/docs/main/latest/en/setup/backend/backend-cluster">Cluster management</a>
        
    </li>

    

    <li>
        
            <a href="/docs/main/latest/en/setup/backend/backend-k8s">Deploy in kubernetes</a>
        
    </li>

    

    <li>
        
            <a href="/docs/main/latest/en/setup/backend/backend-storage">Choose storage</a>
        
    </li>

    

    <li>
        
            <a href="/docs/main/latest/en/setup/backend/backend-receivers">Set receivers</a>
        
    </li>

    

    <li>
        
            <a href="/docs/main/latest/en/setup/backend/backend-fetcher">Open fetchers</a>
        
    </li>

    

    <li>
        
            <a href="/docs/main/latest/en/setup/backend/trace-sampling">Trace sampling</a>
        
    </li>

    

    <li>
        
            <a href="/docs/main/latest/en/setup/backend/slow-db-statement">Slow DB statement threshold</a>
        
    </li>

    

    <li>
        
            <a href="/docs/main/latest/en/guides/backend-oal-scripts">OAL scripts</a>
        
    </li>

    

    <li>
        
            <a href="/docs/main/latest/en/setup/backend/backend-alarm">Alarm</a>
        
    </li>

    

    <li>
        
            <a href="/docs/main/latest/en/setup/backend/advanced-deployment">Advanced deployment options</a>
        
    </li>

    

    <li>
        
            <a href="/docs/main/latest/en/setup/backend/metrics-exporter">Metrics exporter</a>
        
    </li>

    

    <li>
        
            <a href="/docs/main/latest/en/setup/backend/ttl">Time To Live (TTL)</a>
        
    </li>

    

    <li>
        
            <a href="/docs/main/latest/en/setup/backend/dynamic-config">Dynamic Configuration</a>
        
    </li>

    

    <li>
        
            <a href="/docs/main/latest/en/setup/backend/uninstrumented-gateways">Uninstrumented Gateways</a>
        
    </li>

    

    <li>
        
            <a href="/docs/main/latest/en/setup/backend/apdex-threshold">Apdex threshold</a>
        
    </li>

    

    <li>
        
            <a href="/docs/main/latest/en/setup/backend/service-auto-grouping">Service Grouping</a>
        
    </li>

    

    <li>
        
            <a href="/docs/main/latest/en/setup/backend/endpoint-grouping-rules">Group Parameterized Endpoints</a>
        
    </li>

    

    <li>
        
            <a href="/docs/main/latest/en/backend-receivers#opentelemetry-receiver">OpenTelemetry Metrics Analysis</a>
        
    </li>

    

    <li>
        
            <a href="/docs/main/latest/en/setup/backend/backend-meter">Meter Analysis</a>
        
    </li>

    

    <li>
        
            <a href="/docs/main/latest/en/setup/backend/spring-sleuth-setup">Spring Sleuth Metrics Analysis</a>
        
    </li>

    

    <li>
        
            <a href="/docs/main/latest/en/setup/backend/log-analyzer">Log Analyzer</a>
        
    </li>

    

</ul>

        
    </li>

    

    <li>
        
            <a href="/docs/main/latest/en/setup/backend/ui-setup">UI Setup</a>
        
    </li>

    

    <li>
        
            <a href="https://github.com/apache/skywalking-cli">CLI Setup</a>
        
    </li>

    

</ul>

        
    </li>

    

    <li>
        
            <a href="/docs/main/latest/en/ui/readme">UI Introduction</a>
        
    </li>

    

    <li>
        

            
            <a href="#">Contributing Guides<i class="fa fa-angle-left pull-right"></i></a>
            

            
<ul class="sidebar-submenu" >
    

    <li>
        
            <a href="/docs/main/latest/en/guides/readme">Contribute</a>
        
    </li>

    

    <li>
        
            <a href="/docs/main/latest/en/guides/asf/committer">Become a committer</a>
        
    </li>

    

    <li>
        
            <a href="/docs/main/latest/en/guides/how-to-build">Compiling Guide</a>
        
    </li>

    

    <li>
        
            <a href="/docs/main/latest/en/guides/java-plugin-development-guide">Agent plugin development guide</a>
        
    </li>

    

</ul>

        
    </li>

    

    <li>
        
            <a href="/docs/main/latest/en/protocols/readme">Protocols</a>
        
    </li>

    

    <li>
        
            <a href="/docs/main/latest/en/faq/readme">FAQs</a>
        
    </li>

    

    <li>
        
            <a href="https://github.com/apache/skywalking/tree/master/changes">Changelog</a>
        
    </li>

    

</ul>
<script src="/js/sidebar-menu.js"></script>
<script>
  (function (){
    $.sidebarMenu($('.sidebar-menu'))
    var path = window.location.pathname;
    var hash = window.location.hash;
    var $a = $('.sidebar-menu a')
    $a.each(function (e){
      if($(this).attr('href')+'/' === path || $(this).attr('href').replace('#','/#') === path+hash){
        $(this).parents('li').addClass('active').show()
      }
    })
    $a.on('click',function (){
      var url = $(this).attr('href')
      if(url!=='#'){
        window.location.href = url
      }
    })
  })()
</script>
                    <div class="commit-id">Commit Id: a202144</div>
                    






</div>
          <div id="toc" class="d-none d-xl-block col-xl-2 td-toc d-print-none">
            




<div class="td-page-meta ml-2 pb-1 pt-2 mb-0">











</div>






<nav id="TableOfContents">
  <ul>
    <li><a href="#configure-envoy-to-send-metrics-to-skywalking-without-istio">Configure Envoy to send metrics to SkyWalking without Istio</a></li>
    <li><a href="#configure-envoy-to-send-metrics-to-skywalking-with-istio">Configure Envoy to send metrics to SkyWalking with Istio</a></li>
  </ul>
</nav>




<script>
  $(function () {
    var $toc = $("#TableOfContents");
    if (!$toc || !$toc.length) {
      return;
    }
    var top = $toc.offset().top;

    window.onscroll = debounce(setTop)

    function setTop() {
      var scrollValue = $(window).scrollTop();
      if (scrollValue >= top - 70) {
        $toc.addClass('fix')
      } else {
        $toc.removeClass('fix')
      }
    }

    function debounce(fn, wait = 200) {
      var timeout = null;
      return function () {
        clearTimeout(timeout);
        timeout = setTimeout(() => {
          fn.apply(this, arguments);
        }, wait);
      };
    }
  })

</script>

          </div>
          <main class="col-12 col-md-9 col-xl-8 pl-md-5 pr-md-4" role="main">
              <i class="fa fa-bars doc-menu-button"></i>
              
<div class="td-content">











	<h1 id="send-envoy-metrics-to-skywalking-with--without-istio">Send Envoy metrics to SkyWalking with / without Istio</h1>
<p>Envoy defines a gRPC service to emit the metrics, whatever implements this protocol can be used to receive the metrics.
SkyWalking has a built-in receiver that implements this protocol so that you can configure Envoy to emit its metrics to SkyWalking.</p>
<p>As an APM system, SkyWalking does not only receive and store the metrics emitted by Envoy, it also analyzes the topology of services and service instances.</p>
<p><strong>Attention:</strong> There are two versions of Envoy metrics service protocol up to date,
<a href="https://www.envoyproxy.io/docs/envoy/latest/api-v2/api/v2/core/grpc_service.proto#envoy-api-msg-core-grpcservice">v2</a> and
<a href="https://www.envoyproxy.io/docs/envoy/latest/api-v3/config/metrics/v3/metrics_service.proto">v3</a>, SkyWalking (8.3.0+) supports both of them.</p>
<h2 id="configure-envoy-to-send-metrics-to-skywalking-without-istio">Configure Envoy to send metrics to SkyWalking without Istio</h2>
<p>Envoy can be used with / without Istio&rsquo;s control. This section introduces how to configure the standalone Envoy to send the metrics to SkyWalking.</p>
<p>In order to let Envoy send metrics to SkyWalking, we need to feed Envoy with a configuration which contains <code>stats_sinks</code> that includes <code>envoy.metrics_service</code>.
This <code>envoy.metrics_service</code> should be configured as a <a href="https://www.envoyproxy.io/docs/envoy/latest/api-v2/api/v2/core/grpc_service.proto#envoy-api-msg-core-grpcservice"><code>config.grpc_service</code></a> entry.</p>
<p>The interesting parts of the config is shown in the config below:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-yaml" data-lang="yaml"><span style="color:#f92672">stats_sinks</span>:
  - <span style="color:#f92672">name</span>: <span style="color:#ae81ff">envoy.metrics_service</span>
    <span style="color:#f92672">config</span>:
      <span style="color:#f92672">grpc_service</span>:
        <span style="color:#75715e"># Note: we can use google_grpc implementation as well.</span>
        <span style="color:#f92672">envoy_grpc</span>:
          <span style="color:#f92672">cluster_name</span>: <span style="color:#ae81ff">service_skywalking</span>

<span style="color:#f92672">static_resources</span>:
  <span style="color:#ae81ff">...</span>
  <span style="color:#f92672">clusters</span>:
  - <span style="color:#f92672">name</span>: <span style="color:#ae81ff">service_skywalking</span>
    <span style="color:#f92672">connect_timeout</span>: <span style="color:#ae81ff">5s</span>
    <span style="color:#f92672">type</span>: <span style="color:#ae81ff">LOGICAL_DNS</span>
    <span style="color:#f92672">http2_protocol_options</span>: {}
    <span style="color:#f92672">dns_lookup_family</span>: <span style="color:#ae81ff">V4_ONLY</span>
    <span style="color:#f92672">lb_policy</span>: <span style="color:#ae81ff">ROUND_ROBIN</span>
    <span style="color:#f92672">load_assignment</span>:
      <span style="color:#f92672">cluster_name</span>: <span style="color:#ae81ff">service_skywalking</span>
      <span style="color:#f92672">endpoints</span>:
      - <span style="color:#f92672">lb_endpoints</span>:
        - <span style="color:#f92672">endpoint</span>:
            <span style="color:#f92672">address</span>:
              <span style="color:#f92672">socket_address</span>:
                <span style="color:#f92672">address</span>: <span style="color:#ae81ff">skywalking</span>
                <span style="color:#75715e"># This is the port where SkyWalking serving the Envoy Metrics Service gRPC stream.</span>
                <span style="color:#f92672">port_value</span>: <span style="color:#ae81ff">11800</span>
</code></pre></div><p>A more complete static configuration, can be observed <a href="../config.yaml">here</a>.</p>
<p>Note that Envoy can also be configured dynamically through <a href="https://github.com/envoyproxy/data-plane-api/blob/main/xds_protocol.rst">xDS Protocol</a>.</p>
<p>As mentioned above, SkyWalking also builds the topology of services from the metrics, this is because Envoy also carries the service metadata along with the metrics, to feed the Envoy such metadata, another configuration part is as follows:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-yaml" data-lang="yaml"><span style="color:#f92672">node</span>:
  <span style="color:#75715e"># ... other configs</span>
  <span style="color:#f92672">metadata</span>:
    <span style="color:#f92672">LABELS</span>:
      <span style="color:#f92672">app</span>: <span style="color:#ae81ff">test-app</span>
    <span style="color:#f92672">NAME</span>: <span style="color:#ae81ff">service-instance-name</span>
</code></pre></div><h2 id="configure-envoy-to-send-metrics-to-skywalking-with-istio">Configure Envoy to send metrics to SkyWalking with Istio</h2>
<p>Typically, Envoy can be also used under Istio&rsquo;s control, where the configurations are much more simple because Istio composes the configurations for you and sends them to Envoy via <a href="https://github.com/envoyproxy/data-plane-api/blob/master/xds_protocol.rst">xDS Protocol</a>.
Istio also automatically injects the metadata such as service name and instance name into the bootstrap configurations.</p>
<p>Under this circumstance, emitting the metrics to SyWalking is as simple as adding the option <code>--set meshConfig.defaultConfig.envoyMetricsService.address=&lt;skywalking.address.port.11800&gt;</code> to Istio install command, for example:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-shell" data-lang="shell">istioctl install -y <span style="color:#ae81ff">\
</span><span style="color:#ae81ff"></span>  --set profile<span style="color:#f92672">=</span>demo <span style="color:#e6db74">`</span><span style="color:#75715e"># replace the profile as per your need` \</span>
  --set meshConfig.defaultConfig.envoyMetricsService.address<span style="color:#f92672">=</span>&lt;skywalking.address.port.11800&gt; <span style="color:#75715e"># replace &lt;skywalking.address.port.11800&gt; with your actual SkyWalking OAP address</span>
</code></pre></div><p>If you already have Istio installed, you can use the following command to apply the config without re-installing Istio:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-shell" data-lang="shell">istioctl manifest install -y <span style="color:#ae81ff">\
</span><span style="color:#ae81ff"></span>  --set profile<span style="color:#f92672">=</span>demo <span style="color:#e6db74">`</span><span style="color:#75715e"># replace the profile as per your need` \</span>
  --set meshConfig.defaultConfig.envoyMetricsService.address<span style="color:#f92672">=</span>&lt;skywalking.address.port.11800&gt; <span style="color:#75715e"># replace &lt;skywalking.address.port.11800&gt; with your actual SkyWalking OAP address</span>
</code></pre></div><h1 id="metrics-data">Metrics data</h1>
<p>Some Envoy statistics are listed in this <a href="https://www.envoyproxy.io/docs/envoy/v1.17.0/configuration/upstream/cluster_manager/cluster_stats#config-cluster-manager-cluster-stats">list</a>. A sample data that contains identifier can be found <a href="../identify.json">here</a>, while the metrics only can be observed <a href="../metrics.json">here</a>.</p>




</div>


          </main>
        </div>
      </div>

      
<footer class="bg-dark py-5 sky-row">
  <div class="container-fluid text-center">
    <div class="">
        
        
        
<ul class="list-inline mb-0">
  
  <li class="list-inline-item mx-2 h3" data-toggle="tooltip" data-placement="top" title="Twitter" aria-label="Twitter">
    <a class="text-white" target="_blank" href="https://twitter.com/asfskywalking">
      <i class="fab fa-twitter"></i>
    </a>
  </li>
  
  <li class="list-inline-item mx-2 h3" data-toggle="tooltip" data-placement="top" title="Slack" aria-label="Slack">
    <a class="text-white" target="_blank" href="http://s.apache.org/slack-invite">
      <i class="fab fa-slack"></i>
    </a>
  </li>
  
  <li class="list-inline-item mx-2 h3" data-toggle="tooltip" data-placement="top" title="Mailing list" aria-label="Mailing list">
    <a class="text-white" target="_blank" href="https://lists.apache.org/list.html?dev@skywalking.apache.org">
      <i class="fa fa-envelope"></i>
    </a>
  </li>
  
  <li class="list-inline-item mx-2 h3" data-toggle="tooltip" data-placement="top" title="GitHub" aria-label="GitHub">
    <a class="text-white" target="_blank" href="https://github.com/apache/skywalking">
      <i class="fab fa-github"></i>
    </a>
  </li>
  
</ul>

        
        
    </div>
    <div class="">

        <small class="text-white">&copy; 2017 - 2021 The Apache Software Foundation All Rights Reserved</small>
        
	
    </div>
    <div class="">
      <small class="text-white   mt-4">Apache SkyWalking, SkyWalking, Apache, the Apache feather logo, and the Apache SkyWalking project logo are either registered trademarks or trademarks of the Apache Software Foundation.</small>
    </div>
  </div>
</footer>


    </div>
    
<div id="popup">
    <div class="mask">
        <img src=""/>
    </div>
</div>

    <div class="sidebar-mask"></div>
<div class="sidebar">
    <nav class="nav-links">
        <div class="nav-item"><a href="/docs/" class="nav-link">Projects and Documentation</a></div>
        <div class="nav-item"><a href="/events/" class="nav-link">Events</a></div>
        <div class="nav-item"><a href="/blog/" class="nav-link router-link-exact-active router-link-active">Blog</a>
        </div>
        <div class="nav-item"><a href="/downloads/" class="nav-link">Downloads</a></div>
        <div class="nav-item"><a href="/team/" class="nav-link">Team</a></div>
        <div class="nav-item"><a href="/zh/" class="nav-link">中文博客</a></div>
        <div class="nav-item">
            <div class="dropdown-wrapper open"><a class="dropdown-title"><span class="title">Links</span> <span
                    class="arrow down"></span></a>
                <ul class="nav-dropdown" style="">
                    <li class="dropdown-item">
                        <a href="http://www.apache.org/" target="_blank"
                           rel="noopener noreferrer" class="nav-link external">
                            Apache Software Foundation
                        </a>
                    </li>
                    <li class="dropdown-item">
                        <a href="https://github.com/apache/skywalking/issues"
                           target="_blank" rel="noopener noreferrer"
                           class="nav-link external">
                            GitHub Issue Tracker
                        </a>
                    </li>
                    <li class="dropdown-item">
                        <a href="https://lists.apache.org/list.html?dev@skywalking.apache.org" target="_blank"
                           rel="noopener noreferrer" class="nav-link external">
                            Dev Mailing List
                        </a>
                    </li>
                    <li class="dropdown-item">
                        <a href="http://www.apache.org/licenses/" target="_blank"
                           rel="noopener noreferrer" class="nav-link external">
                            License
                        </a>
                    </li>
                    <li class="dropdown-item">
                        <a href="http://www.apache.org/events/current-event"
                           target="_blank" rel="noopener noreferrer"
                           class="nav-link external">
                            Apache Events
                        </a>
                    </li>
                    <li class="dropdown-item">
                        <a href="http://www.apache.org/security/" target="_blank"
                           rel="noopener noreferrer" class="nav-link external">
                            Security
                        </a>
                    </li>
                    <li class="dropdown-item">
                        <a href="http://www.apache.org/foundation/sponsorship.html"
                           target="_blank" rel="noopener noreferrer"
                           class="nav-link external">
                            Sponsorship and Donate
                        </a>
                    </li>
                    <li class="dropdown-item">
                        <a href="http://www.apache.org/foundation/thanks.html"
                           target="_blank" rel="noopener noreferrer"
                           class="nav-link external">
                            Thanks
                        </a>
                    </li>
                </ul>
            </div>
        </div>
    </nav>
</div>

    
<script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.3/umd/popper.min.js" integrity="sha384-ZMP7rVo3mIykV+2+9J3UJ46jBk0WLaUAdn689aCwoqbBJiSnjAK/l8WvCWPIPm49" crossorigin="anonymous"></script>
<script src="https://cdn.jsdelivr.net/npm/bootstrap@4.1.3/dist/js/bootstrap.bundle.min.js"></script>








<script src="/js/main.min.d1db5f048cae0266dd8434e5c9f97e7ea03718c3a0a74730f35bcc33fa2f4993.js" integrity="sha256-0dtfBIyuAmbdhDTlyfl&#43;fqA3GMOgp0cw81vMM/ovSZM=" crossorigin="anonymous"></script>





  </body>
  <script>
    $('.doc-menu-button').on('click',function (){
      $('.td-sidebar').toggleClass('active')
    })
  </script>
</html>
