<!doctype html>
<html lang="en" class="no-js">
  <head>
    <meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<meta name="twitter:site" content="skywalking.apache.org">
<meta name="twitter:image:src" content="https://skywalking.apache.org/images/skywalking_400x400.png">
<meta property="og:image" content="https://skywalking.apache.org/images/skywalking_400x400.png">

<meta name="generator" content="Hugo 0.80.0" />


<script async src="https://www.googletagmanager.com/gtag/js?id=G-GR8N6PGRJ3"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);};
  gtag('js', new Date());gtag('config', 'G-GR8N6PGRJ3');
</script>
<META NAME="ROBOTS" CONTENT="INDEX, FOLLOW">
<link rel="stylesheet" href="//at.alicdn.com/t/c/font_3007530_pvozs1rz2wn.css">



<link rel="apple-touch-icon" sizes="180x180" href="/favicons/apple-touch-icon.png">
<link rel="icon" type="image/png" sizes="32x32" href="/favicons/favicon-32x32.png">
<link rel="icon" type="image/png" sizes="16x16" href="/favicons/favicon-16x16.png">
<link rel="manifest" href="/favicons/site.webmanifest">
<link rel="mask-icon" href="/favicons/safari-pinned-tab.svg" color="#5bbad5">
<meta name="msapplication-TileColor" content="#da532c">
<meta name="theme-color" content="#ffffff">

<title>Java agent injector Manual | Apache SkyWalking</title><meta property="og:title" content="Java agent injector Manual" />
<meta property="og:description" content="Java agent injector Manual To use the java agent more natively, we propose the java agent injector to inject the agent sidecar into a pod.
When enabled in a pod&rsquo;s namespace, the injector injects the java agent container at pod creation time using a mutating webhook admission controller. By rendering the java agent to a shared volume, containers within the pod can use the java agent.
The following sections describe how to configure the agent, if you want to try it directly, please see Usage for more details." />
<meta property="og:type" content="article" />
<meta property="og:url" content="/docs/skywalking-swck/next/java-agent-injector/" />

<meta itemprop="name" content="Java agent injector Manual">
<meta itemprop="description" content="Java agent injector Manual To use the java agent more natively, we propose the java agent injector to inject the agent sidecar into a pod.
When enabled in a pod&rsquo;s namespace, the injector injects the java agent container at pod creation time using a mutating webhook admission controller. By rendering the java agent to a shared volume, containers within the pod can use the java agent.
The following sections describe how to configure the agent, if you want to try it directly, please see Usage for more details.">

<meta itemprop="wordCount" content="1280">



<meta itemprop="keywords" content="" />
<meta name="twitter:card" content="summary"/>
<meta name="twitter:title" content="Java agent injector Manual"/>
<meta name="twitter:description" content="Java agent injector Manual To use the java agent more natively, we propose the java agent injector to inject the agent sidecar into a pod.
When enabled in a pod&rsquo;s namespace, the injector injects the java agent container at pod creation time using a mutating webhook admission controller. By rendering the java agent to a shared volume, containers within the pod can use the java agent.
The following sections describe how to configure the agent, if you want to try it directly, please see Usage for more details."/>



<link rel="preload" href="/scss/main.min.592235942cb3c9f3dd697382a4e7a1fad8e1c182dad2841bdce6b43b4a346ae8.css" as="style">
<link href="/scss/main.min.592235942cb3c9f3dd697382a4e7a1fad8e1c182dad2841bdce6b43b4a346ae8.css" rel="stylesheet" integrity="">



<link rel="stylesheet" href="/css/docSearch.css" />


<script src="/js/jquery-3.6.0.min.js"></script>





    <title>Java agent injector Manual | Apache SkyWalking</title>
  </head>
  <body class="td-page  project-doc">
    <header>
      
<nav class="js-navbar-scroll navbar navbar-expand  flex-column flex-md-row td-navbar">
    <div class="sidebar-button">
      <i class="iconfont icon-menu"></i>
    </div>
    <a class="navbar-brand" href="/">
        <span class="navbar-logo"><img width="130" src="/images/logo.svg" alt="SkyWalking"></span> 
    </a>
    <div class="td-navbar-nav-scroll navbar-nav-wrapper" id="navigation">
        <ul class="navbar-nav mt-lg-0">
             
            
            
            <li class="nav-item mr-3 mb-lg-0">
				
				
				
				
				<a class="nav-link" href="/docs" ><span>Projects and Docs</span></a>
			</li>
            
            
            
            
            <li class="nav-item mr-3 mb-lg-0">
				
				
				
				
				<a class="nav-link" href="/events" ><span>Events</span></a>
			</li>
            
            
            
            
            <li class="nav-item mr-3 mb-lg-0">
				
				
				
				
				<a class="nav-link" href="/blog" ><span>Blogs</span></a>
			</li>
            
            
            
            
            <li class="nav-item mr-3 mb-lg-0">
				
				
				
				
				<a class="nav-link" href="/downloads" ><span>Downloads</span></a>
			</li>
            
            
            
            
            <li class="nav-item mr-3 mb-lg-0">
				
				
				
				
				<a class="nav-link" href="/team" ><span>Team</span></a>
			</li>
            
            
            
            
            <li class="nav-item mr-3 mb-lg-0">
				
				
				
				
				<a class="nav-link" href="/users" ><span>Users</span></a>
			</li>
            
            
            
            
            
            <li class="nav-item mr-3 mb-lg-0">
                <span class="link dropdown blog">
                    <a class="link-name nav-link dropdown-toggle" href="#" role="button" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">中文资料</a>
                    <div class="dropdown-menu">
                        <a class="dropdown-item" href="/zh/">博客</a>
                        <a class="dropdown-item" href="https://space.bilibili.com/390683219" target="_blank" rel="noopener noreferrer">
                            B站
                        </a>
                        <a class="dropdown-item" href="https://juejin.cn/user/13673577331607" target="_blank" rel="noopener noreferrer">
                            掘金
                        </a>
                    </div>
                </span>
            </li>

            
			
        </ul>
    </div>
    <div class="navbar-nav d-none d-lg-block search-input-box">
         
            
        
            
        
            
        
            
        
            
        
            
        
            
            <span class="link dropdown">
                <a class="link-name dropdown-toggle" href="#" role="button" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
                    Links
                </a>
                <div class="dropdown-menu">
                    
                    <a class="dropdown-item" href="http://www.apache.org/">Apache Software Foundation</a> 
                    <a class="dropdown-item" href="https://github.com/apache/skywalking/issues">GitHub Issue Tracker</a> 
                    <a class="dropdown-item" href="https://github.com/apache/skywalking/discussions">Discussion</a> 
                    <a class="dropdown-item" href="https://lists.apache.org/list.html?dev@skywalking.apache.org">Dev Mailing List</a> 
                    <a class="dropdown-item" href="https://cwiki.apache.org/confluence/display/SKYWALKING/Home">WIKI</a> 
                    <a class="dropdown-item" href="http://www.apache.org/licenses/">License</a> 
                    <a class="dropdown-item" href="http://www.apache.org/events/current-event">Apache Events</a> 
                    <a class="dropdown-item" href="http://www.apache.org/security/">Security</a> 
                    <a class="dropdown-item" href="http://www.apache.org/foundation/sponsorship.html">Sponsor and Donate</a> 
                    <a class="dropdown-item" href="http://www.apache.org/foundation/thanks.html">Thanks</a> 
                    <a class="dropdown-item" href="https://apache.org/foundation/policies/privacy.html">Privacy</a> 
                </div>
            </span>
            
        
        
<div id="docsearch"></div>


    </div>
</nav>

    </header>
    <div class="container-fluid td-outer">

      <div class="td-main">
        <div class="row flex-xl-nowrap">
          <div class="col-12 col-md-3 col-xl-2 d-print-none scroll-bar td-sidebar">


































                  <div class="description-wrapper">
                    <h5>
                    <img width="26" height="26" src="/images/project/kubernetes.svg">
                    SkyWalking Cloud on Kubernetes
                    </h5>
                    <p>A bridge project between Apache SkyWalking and Kubernetes.</p>
                  </div>
                  
                  <div class="version-wrapper">Version: 
                  <select class="version-select">
                  
                    
                    
                    <option selected value="next">
                    
                      next
                    
                    </option>
                  
                    
                    
                    <option ZgotmplZ value="latest">
                    
                      latest
                    
                    </option>
                  
                    
                    
                    <option ZgotmplZ value="v0.8.0">
                    
                      v0.8.0
                    
                    </option>
                  
                  </select>
                  </div>
                  
                  <ul class="sidebar-menu">
    
    <li>
        
            <a href="/docs/skywalking-swck/next/readme">Welcome</a>
        
    </li>
    
    <li>
        
            
            <a href="#">Designs<i class="iconfont icon-arrow-right pull-right"></i></a>
            

            
<ul class="sidebar-submenu">
    

    <li>
        
            <a href="/docs/skywalking-swck/next/design/proposal">Proposal</a>
        
    </li>

    

</ul>

        
    </li>
    
    <li>
        
            
            <a href="#">Setup<i class="iconfont icon-arrow-right pull-right"></i></a>
            

            
<ul class="sidebar-submenu">
    

    <li>
        
            <a href="/docs/skywalking-swck/next/java-agent-injector">Java Agent Injector</a>
        
    </li>

    

    <li>
        
            <a href="/docs/skywalking-swck/next/operator">Operator</a>
        
    </li>

    

    <li>
        
            <a href="/docs/skywalking-swck/next/custom-metrics-adapter">Adapter</a>
        
    </li>

    

</ul>

        
    </li>
    
    <li>
        
            
            <a href="#">Examples<i class="iconfont icon-arrow-right pull-right"></i></a>
            

            
<ul class="sidebar-submenu">
    

    <li>
        
            <a href="/docs/skywalking-swck/next/examples/java-agent-injector-usage">Inject Java Agent</a>
        
    </li>

    

    <li>
        
            <a href="/docs/skywalking-swck/next/examples/default-backend">Deploy OAP and UI</a>
        
    </li>

    

    <li>
        
            <a href="/docs/skywalking-swck/next/examples/storage">Deploy Storage</a>
        
    </li>

    

    <li>
        
            <a href="/docs/skywalking-swck/next/examples/istio-controlplane">Fetch metrics</a>
        
    </li>

    

    <li>
        
            <a href="/docs/skywalking-swck/next/examples/satellite">Install Satellite</a>
        
    </li>

    

</ul>

        
    </li>
    
    <li>
        
            
            <a href="#">Contributing Guides<i class="iconfont icon-arrow-right pull-right"></i></a>
            

            
<ul class="sidebar-submenu">
    

    <li>
        
            <a href="https://skywalking.apache.org/docs/main/latest/en/guides/readme/">Contribute</a>
        
    </li>

    

    <li>
        
            <a href="https://skywalking.apache.org/docs/main/latest/en/guides/asf/committer/">Become A Committer</a>
        
    </li>

    

    <li>
        
            <a href="/docs/skywalking-swck/next/release">Release Guide</a>
        
    </li>

    

</ul>

        
    </li>
    
    <li>
        
            <a href="https://github.com/apache/skywalking-swck/tree/master/changes">Changelog</a>
        
    </li>
    
</ul>
<script src="/js/sidebar-menu.js"></script>
<script>
  (function (){
    $.sidebarMenu($('.sidebar-menu'))
    var path = window.location.pathname;
    var hash = window.location.hash;
    var $a = $('.sidebar-menu a')
    $a.each(function (e){
      if($(this).attr('href')+'/' === path || $(this).attr('href').replace('#','/#') === path+hash){
        $(this).parents('li').addClass('active').show()
      }
    })
    $a.on('click',function (){
      var url = $(this).attr('href')
      if(url!=='#'){
        window.location.href = url
      }
    })
  })()
</script>

                  <div class="commit-id">Commit Id: 77a2204</div>
                









</div>
            <main class="col-12 col-md-9 col-xl-8 pl-md-5 pr-md-4" role="main">
              <i class="iconfont icon-menu-doc doc-menu-button"></i>
              
<div class="td-content">











	<h1 id="java-agent-injector-manual">Java agent injector Manual</h1>
<p>To use the java agent more natively, we propose the java agent injector to inject the agent sidecar into a pod.</p>
<p>When enabled in a pod&rsquo;s namespace, the injector injects the java agent container at pod creation time using a mutating webhook admission controller. By rendering the java agent to a shared volume, containers within the pod can use the java agent.</p>
<p>The following sections describe how to configure the agent, if you want to try it directly, please see <a href="../examples/java-agent-injector-usage">Usage</a> for more details.</p>
<h2 id="install-injector">Install Injector</h2>
<p>The java agent injector is a component of the operator, so you need to follow <a href="https://github.com/apache/skywalking-swck/tree/77a22047a37e974b7a12535f9d3b7667261c3a7a/README.md#operator">Operator installation instrument</a> to install the operator firstly.</p>
<h2 id="active-the-java-agent-injection">Active the java agent injection</h2>
<p>We have two granularities here: namespace and pod.</p>
<table>
<thead>
<tr>
<th>Resource</th>
<th>Label</th>
<th>Enabled value</th>
<th>Disabled value</th>
</tr>
</thead>
<tbody>
<tr>
<td>Namespace</td>
<td>swck-injection</td>
<td>enabled</td>
<td>disabled</td>
</tr>
<tr>
<td>Pod</td>
<td>swck-java-agent-injected</td>
<td>&ldquo;true&rdquo;</td>
<td>&ldquo;false&rdquo;</td>
</tr>
</tbody>
</table>
<p>The injector is configured with the following logic:</p>
<ol>
<li>If either label is disabled, the pod is not injected.</li>
<li>If two labels are enabled, the pod is injected.</li>
</ol>
<p>Follow the next steps to active java agent injection.</p>
<ul>
<li>Label the namespace with <code>swck-injection=enabled</code></li>
</ul>
<div class="highlight"><pre style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-shell" data-lang="shell">$ kubectl label namespace default<span style="color:#000;font-weight:bold">(</span>your namespace<span style="color:#000;font-weight:bold">)</span> swck-injection<span style="color:#000;font-weight:bold">=</span>enabled
</code></pre></div><ul>
<li>Add label <code>swck-java-agent-injected: &quot;true&quot;</code> to the pod, and get the result as below.</li>
</ul>
<div class="highlight"><pre style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-shell" data-lang="shell">$ kubectl get pod -l swck-java-agent-injected<span style="color:#000;font-weight:bold">=</span><span style="color:#0086b3">true</span>
NAME          READY   STATUS    RESTARTS   AGE
inject-demo   1/1     Running   <span style="color:#099">0</span>          2d2h
</code></pre></div><h2 id="the-ways-to-configure-the-agent">The ways to configure the agent</h2>
<p>The java agent injector supports a precedence order to configure the agent:</p>
<p><code> Annotations &gt; SwAgent &gt; Configmap (Deprecated) &gt; Default Configmap (Deprecated)</code></p>
<h3 id="annotations">Annotations</h3>
<p>Annotations are described in <a href="https://kubernetes.io/docs/concepts/overview/working-with-objects/annotations/">kubernetes annotations doc</a>.</p>
<p>We support annotations in <a href="#use-annotations-to-overlay-default-agent-configuration">agent annotations</a> and <a href="#configure-sidecar">sidecar annotations</a>.</p>
<h3 id="swagent">SwAgent</h3>
<p>SwAgent is a <a href="https://kubernetes.io/docs/concepts/extend-kubernetes/api-extension/custom-resources/">Customer Resource</a> defined by SWCK.</p>
<p>We support SwAgent in <a href="#use-swagent-to-overlay-default-agent-configuration">SwAgent usage guide</a></p>
<h3 id="configmap-deprecated">Configmap (Deprecated)</h3>
<p>Configmap is described in <a href="https://kubernetes.io/docs/concepts/configuration/configmap/">kubernetes configmap doc</a>.</p>
<p>We need to use configmap to set <a href="https://skywalking.apache.org/docs/skywalking-java/latest/en/setup/service-agent/java-agent/configurations/#table-of-agent-configuration-properties">agent.config</a> so that we can modify the agent configuration without entering the container.</p>
<p>If there are different configmap in the namepsace, you can choose a configmap by setting <a href="#configure-sidecar">sidecar annotations</a>; If there is no configmap, the injector will create a default configmap.</p>
<h3 id="default-configmap-deprecated">Default configmap (Deprecated)</h3>
<p>The injector will create the default configmap to overlay the <code>agent.config</code> in the agent container.</p>
<p>The default configmap is shown as below, one is <code>agent.service_name</code> and the string can&rsquo;t be empty; the other is <code>collector.backend_service</code> and it needs to be a legal IP address and port, the other fields need to be guaranteed by users themselves. Users can change it as their default configmap.</p>
<pre><code>data:
  agent.config: |
    # The service name in UI
    agent.service_name=${SW_AGENT_NAME:Your_ApplicationName}

    # Backend service addresses.
    collector.backend_service=${SW_AGENT_COLLECTOR_BACKEND_SERVICES:127.0.0.1:11800}

    # Please refer to https://skywalking.apache.org/docs/skywalking-java/latest/en/setup/service-agent/java-agent/configurations/#table-of-agent-configuration-properties to get more details.
</code></pre><p>To avoid the default configmap deleting by mistake, we use a configmap controller to watch the default configmap. In addition, if the user applies an invalid configuration, such as a malformed <code>backend_service</code>, the controller will use the default configmap.</p>
<h2 id="configure-the-agent">Configure the agent</h2>
<p>The injector supports two methods to configure agent:</p>
<ul>
<li>Only use the default configuration.</li>
<li>Use annotations to overlay the default configuration.</li>
</ul>
<h3 id="use-the-default-agent-configuration">Use the default agent configuration</h3>
<p>After activating the java agent injection, if not set the annotations, the injector will use the default agent configuration directly as below.</p>
<pre><code>initContainers:
  - args:
    - -c
    - mkdir -p /sky/agent &amp;&amp; cp -r /skywalking/agent/* /sky/agent
    command:
    - sh
    image: apache/skywalking-java-agent:8.16.0-java8
    name: inject-skywalking-agent
    volumeMounts:
    - mountPath: /sky/agent
      name: sky-agent
volumes:
  - emptyDir: {}
    name: sky-agent
  - configMap:
      name: skywalking-swck-java-agent-configmap
    name: java-agent-configmap-volume
</code></pre><h3 id="use-swagent-to-overlay-default-agent-configuration">Use SwAgent to overlay default agent configuration</h3>
<p>The injector will read the SwAgent CR when pods creating.</p>
<p>SwAgent CRD basic structure is like:</p>
<div class="highlight"><pre style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-yaml" data-lang="yaml"><span style="color:#000080">apiVersion</span>:<span style="color:#bbb"> </span>operator.skywalking.apache.org/v1alpha1<span style="color:#bbb">
</span><span style="color:#bbb"></span><span style="color:#000080">kind</span>:<span style="color:#bbb"> </span>SwAgent<span style="color:#bbb">
</span><span style="color:#bbb"></span><span style="color:#000080">metadata</span>:<span style="color:#bbb">
</span><span style="color:#bbb">  </span><span style="color:#000080">name</span>:<span style="color:#bbb"> </span>swagent-demo<span style="color:#bbb">
</span><span style="color:#bbb">  </span><span style="color:#000080">namespace</span>:<span style="color:#bbb"> </span>default<span style="color:#bbb">
</span><span style="color:#bbb"></span><span style="color:#000080">spec</span>:<span style="color:#bbb">
</span><span style="color:#bbb">  </span><span style="color:#000080">containerMatcher</span>:<span style="color:#bbb"> </span><span style="color:#d14">&#39;&#39;</span><span style="color:#bbb">
</span><span style="color:#bbb">  </span><span style="color:#000080">selector</span>:<span style="color:#bbb">
</span><span style="color:#bbb">  </span><span style="color:#000080">javaSidecar</span>:<span style="color:#bbb">
</span><span style="color:#bbb">    </span><span style="color:#000080">name</span>:<span style="color:#bbb"> </span>swagent-demo<span style="color:#bbb">
</span><span style="color:#bbb">    </span><span style="color:#000080">image</span>:<span style="color:#bbb"> </span>apache/skywalking-java-agent:8.16.0-java8<span style="color:#bbb">
</span><span style="color:#bbb">    </span><span style="color:#000080">env</span>:<span style="color:#bbb">
</span><span style="color:#bbb">      </span>- <span style="color:#000080">name</span>:<span style="color:#bbb"> </span><span style="color:#d14">&#34;SW_LOGGING_LEVEL&#34;</span><span style="color:#bbb">
</span><span style="color:#bbb">        </span><span style="color:#000080">value</span>:<span style="color:#bbb"> </span><span style="color:#d14">&#34;DEBUG&#34;</span><span style="color:#bbb">
</span><span style="color:#bbb">      </span>- <span style="color:#000080">name</span>:<span style="color:#bbb"> </span><span style="color:#d14">&#34;SW_AGENT_COLLECTOR_BACKEND_SERVICES&#34;</span><span style="color:#bbb">
</span><span style="color:#bbb">        </span><span style="color:#000080">value</span>:<span style="color:#bbb"> </span><span style="color:#d14">&#34;skywalking-system-oap:11800&#34;</span><span style="color:#bbb">
</span><span style="color:#bbb">  </span><span style="color:#000080">sharedVolumeName</span>:<span style="color:#bbb"> </span><span style="color:#d14">&#34;sky-agent-demo&#34;</span><span style="color:#bbb">
</span><span style="color:#bbb">  </span><span style="color:#000080">optionalPlugins</span>:<span style="color:#bbb">
</span><span style="color:#bbb">    </span>- <span style="color:#d14">&#34;webflux&#34;</span><span style="color:#bbb">
</span><span style="color:#bbb">    </span>- <span style="color:#d14">&#34;cloud-gateway-2.1.x&#34;</span><span style="color:#bbb">
</span><span style="color:#bbb">  </span><span style="color:#000080">bootstrapPlugins</span>:<span style="color:#bbb">
</span><span style="color:#bbb">    </span>- <span style="color:#d14">&#34;jdk-threading&#34;</span><span style="color:#bbb">
</span></code></pre></div><p>There are three kind of configs in SwAgent CR.</p>
<h4 id="1-label-selector-and-container-matcher">1. label selector and container matcher</h4>
<p>label selector and container matcher decides which pod and container should be injected.</p>
<table>
<thead>
<tr>
<th>key path</th>
<th>description</th>
<th>default value</th>
</tr>
</thead>
<tbody>
<tr>
<td>spec.selector</td>
<td>label selector for pods which should be effected during injection. if no label selector was set, SwAgent CR config will affect every pod during injection.</td>
<td>no default value</td>
</tr>
<tr>
<td>spec.containerMatcher</td>
<td>container matcher is used to decide which container to be inject during injection. regular expression is supported. default value &lsquo;.*&rsquo; would match any container name.</td>
<td>.*</td>
</tr>
</tbody>
</table>
<h4 id="2-injection-configuration">2. injection configuration</h4>
<p>injection configuration will affect on agent injection behaviour</p>
<table>
<thead>
<tr>
<th>key path</th>
<th>description</th>
<th>default value</th>
</tr>
</thead>
<tbody>
<tr>
<td>javaSidecar</td>
<td>javaSidecar is the configs for init container, which holds agent sdk and take agent sdk to the target containers.</td>
<td></td>
</tr>
<tr>
<td>javaSidecar.name</td>
<td>the name of the init container.</td>
<td>inject-skywalking-agent</td>
</tr>
<tr>
<td>javaSidecar.image</td>
<td>the image of the init container.</td>
<td>apache/skywalking-java-agent:8.16.0-java8</td>
</tr>
<tr>
<td>SharedVolumeName</td>
<td>SharedVolume is the name of an empty volume which shared by initContainer and target containers.</td>
<td>sky-agent</td>
</tr>
<tr>
<td>OptionalPlugins</td>
<td>Select the optional plugin which needs to be moved to the directory(/plugins). Such as <code>trace</code>,<code>webflux</code>,<code>cloud-gateway-2.1.x</code>.</td>
<td>no default value</td>
</tr>
<tr>
<td>OptionalReporterPlugins</td>
<td>Select the optional reporter plugin which needs to be moved to the directory(/plugins). such as <code>kafka</code>.</td>
<td>no default value</td>
</tr>
<tr>
<td>BootstrapPlugins</td>
<td>Select the bootstrap plugin which needs to be moved to the directory(/plugins). such as <code>jdk-threading</code>.</td>
<td>no default value</td>
</tr>
</tbody>
</table>
<h4 id="3-skywalking-agent-configuration">3. skywalking agent configuration</h4>
<p>skywalking agent configuration is for agent SDK.</p>
<table>
<thead>
<tr>
<th>key path</th>
<th>description</th>
<th>default value</th>
</tr>
</thead>
<tbody>
<tr>
<td>javaSidecar.env</td>
<td>the env list to be appended to target containers. usually we can use it to setup <a href="https://skywalking.apache.org/docs/skywalking-java/latest/en/setup/service-agent/java-agent/configurations/">agent configuration</a> at container level.</td>
<td>no default value.</td>
</tr>
</tbody>
</table>
<h3 id="use-annotations-to-overlay-default-agent-configuration">Use annotations to overlay default agent configuration</h3>
<p>The injector can recognize five kinds of annotations to configure the agent as below.</p>
<h4 id="1-strategy-configuration">1. strategy configuration</h4>
<p>The strategy configuration is the annotation as below.</p>
<table>
<thead>
<tr>
<th>Annotation key</th>
<th>Description</th>
<th>Annotation Default value</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>strategy.skywalking.apache.org/inject.Container</code></td>
<td>Select the injected container, if not set, inject all containers.</td>
<td>not set</td>
</tr>
</tbody>
</table>
<h4 id="2-agent-configuration">2. agent configuration</h4>
<p>The agent configuration is the annotation like <code>agent.skywalking.apache.org/{option}: {value}</code>, and the option support  <code>agent.xxx 、osinfo.xxx 、collector.xxx 、 logging.xxx 、statuscheck.xxx 、correlation.xxx 、jvm.xxx 、buffer.xxx 、 profile.xxx 、 meter.xxx 、 log.xxx</code> in <a href="https://skywalking.apache.org/docs/skywalking-java/latest/en/setup/service-agent/java-agent/configurations/#table-of-agent-configuration-properties">agent.config</a>, such as <code>agent.skywalking.apache.org/agent.namespace</code>, <code>agent.skywalking.apache.org/meter.max_meter_size</code>, etc.</p>
<h4 id="3-plugins-configuration">3. plugins configuration</h4>
<p>The plugins configuration is the annotation like <code>plugins.skywalking.apache.org/{option}: {value}</code>, and the option only support <code>plugin.xxx</code> in the <a href="https://skywalking.apache.org/docs/skywalking-java/latest/en/setup/service-agent/java-agent/configurations/#table-of-agent-configuration-properties">agent.config</a>, such as <code>plugins.skywalking.apache.org/plugin.mount</code>, <code>plugins.skywalking.apache.org/plugin.mongodb.trace_param</code>, etc.</p>
<h4 id="4-optional-plugin-configuration">4. optional plugin configuration</h4>
<p>The optional plugin configuration is the annotation as below.</p>
<table>
<thead>
<tr>
<th>Annotation key</th>
<th>Description</th>
<th>Annotation value</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>optional.skywalking.apache.org</code></td>
<td>Select the optional plugin which needs to be moved to the directory(/plugins). Users can select several optional plugins by separating from <code>｜</code>, such as <code>trace｜webflux｜cloud-gateway-2.1.x</code>.</td>
<td>not set</td>
</tr>
</tbody>
</table>
<h4 id="5-optional-reporter-plugin-configuration">5. optional reporter plugin configuration</h4>
<p>The optional reporter plugin configuration is the annotation as below.</p>
<table>
<thead>
<tr>
<th>Annotation key</th>
<th>Description</th>
<th>Annotation value</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>optional-reporter.skywalking.apache.org</code></td>
<td>Select the optional reporter plugin which needs to be moved to the directory(/plugins). Users can select several optional reporter plugins by separating from <code>｜</code>, such as <code>kafka</code>.</td>
<td>not set</td>
</tr>
</tbody>
</table>
<h4 id="6-bootstrap-plugin-configuration">6. bootstrap plugin configuration</h4>
<p>The bootstrap plugin configuration is the annotation as below.</p>
<table>
<thead>
<tr>
<th>Annotation key</th>
<th>Description</th>
<th>Annotation value</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>bootstrap.skywalking.apache.org</code></td>
<td>Select the bootstrap plugin which needs to be moved to the directory(/plugins). Users can select several bootstrap plugins by separating from <code>｜</code>, such as <code>jdk-threading</code>.</td>
<td>not set</td>
</tr>
</tbody>
</table>
<h2 id="configure-sidecar">Configure sidecar</h2>
<p>The injector can recognize the following annotations to configure the sidecar:</p>
<table>
<thead>
<tr>
<th>Annotation key</th>
<th>Description</th>
<th>Annotation Default value</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>sidecar.skywalking.apache.org/initcontainer.Name</code></td>
<td>The name of the injected java agent container.</td>
<td><code>inject-skywalking-agent</code></td>
</tr>
<tr>
<td><code>sidecar.skywalking.apache.org/initcontainer.Image</code></td>
<td>The container image of the injected java agent container.</td>
<td><code>apache/skywalking-java-agent:8.16.0-java8</code></td>
</tr>
<tr>
<td><code>sidecar.skywalking.apache.org/initcontainer.Command</code></td>
<td>The command of the injected java agent container.</td>
<td><code>sh</code></td>
</tr>
<tr>
<td><code>sidecar.skywalking.apache.org/initcontainer.args.Option</code></td>
<td>The args option of the injected java agent container.</td>
<td><code>-c</code></td>
</tr>
<tr>
<td><code>sidecar.skywalking.apache.org/initcontainer.args.Command</code></td>
<td>The args command of the injected java agent container.</td>
<td><code>mkdir -p /sky/agent &amp;&amp; cp -r /skywalking/agent/* /sky/agent</code></td>
</tr>
<tr>
<td><code>sidecar.skywalking.apache.org/initcontainer.resources.limits</code></td>
<td>The resources limits of the injected java agent container. You should use json type to define it such as <code>{&quot;memory&quot;: &quot;100Mi&quot;,&quot;cpu&quot;: &quot;100m&quot;}</code></td>
<td><code>nil</code></td>
</tr>
<tr>
<td><code>sidecar.skywalking.apache.org/initcontainer.resources.requests</code></td>
<td>The resources requests of  the injected java agent container. You should use json type to define it such as <code>{&quot;memory&quot;: &quot;100Mi&quot;,&quot;cpu&quot;: &quot;100m&quot;}</code></td>
<td><code>nil</code></td>
</tr>
<tr>
<td><code>sidecar.skywalking.apache.org/sidecarVolume.Name</code></td>
<td>The name of sidecar Volume.</td>
<td><code>sky-agent</code></td>
</tr>
<tr>
<td><code>sidecar.skywalking.apache.org/sidecarVolumeMount.MountPath</code></td>
<td>Mount path of the agent directory in the injected container.</td>
<td><code>/sky/agent</code></td>
</tr>
<tr>
<td><code>sidecar.skywalking.apache.org/env.Name</code></td>
<td>Environment Name used by the injected container (application container).</td>
<td><code>JAVA_TOOL_OPTIONS</code></td>
</tr>
<tr>
<td><code>sidecar.skywalking.apache.org/env.Value</code></td>
<td>Environment variables used by the injected container (application container).</td>
<td><code>-javaagent:/sky/agent/skywalking-agent.jar</code></td>
</tr>
</tbody>
</table>
<h2 id="the-ways-to-get-the-final-injected-agents-configuration">The ways to get the final injected agent&rsquo;s configuration</h2>
<p>Please see <a href="../javaagent">javaagent introduction</a> for details.</p>




</div>


            </main>
          <div id="toc" class="d-none d-xl-block col-xl-2 td-toc d-print-none">
            




<div class="td-page-meta ml-2 pb-1 pt-2 mb-0">











</div>






<nav id="TableOfContents">
  <ul>
    <li><a href="#java-agent-injector-manual">Java agent injector Manual</a>
      <ul>
        <li><a href="#install-injector">Install Injector</a></li>
        <li><a href="#active-the-java-agent-injection">Active the java agent injection</a></li>
        <li><a href="#the-ways-to-configure-the-agent">The ways to configure the agent</a>
          <ul>
            <li><a href="#annotations">Annotations</a></li>
            <li><a href="#swagent">SwAgent</a></li>
            <li><a href="#configmap-deprecated">Configmap (Deprecated)</a></li>
            <li><a href="#default-configmap-deprecated">Default configmap (Deprecated)</a></li>
          </ul>
        </li>
        <li><a href="#configure-the-agent">Configure the agent</a>
          <ul>
            <li><a href="#use-the-default-agent-configuration">Use the default agent configuration</a></li>
            <li><a href="#use-swagent-to-overlay-default-agent-configuration">Use SwAgent to overlay default agent configuration</a></li>
            <li><a href="#use-annotations-to-overlay-default-agent-configuration">Use annotations to overlay default agent configuration</a></li>
          </ul>
        </li>
        <li><a href="#configure-sidecar">Configure sidecar</a></li>
        <li><a href="#the-ways-to-get-the-final-injected-agents-configuration">The ways to get the final injected agent&rsquo;s configuration</a></li>
      </ul>
    </li>
  </ul>
</nav>




<script>
  $(function () {
    var $toc = $("#TableOfContents");
    if (!$toc || !$toc.length) {
      return;
    }
    var top = $toc.offset().top;
    $(window).on("scroll", debounce(setTop, 100))
    $(window).on("scroll", debounce(addActive, 30))

    function addActive() {
      var scrollValue = $(window).scrollTop();
      var topEle = null;
      $.each($('main h1, main h2, main h3'), function (index, item) {
        if ($(item).offset().top - 70 > scrollValue) {
          return
        }
        if (!topEle) {
          topEle = item
        } else if ($(item).offset().top >= $(topEle).offset().top) {
          topEle = item
        }
        if (topEle) {
          var id = $(item).attr('id');
          $toc.find('a').removeClass("active").end().find('a[href="' + '#' + id + '"]').addClass("active")
        }
      })
    }

    function setTop() {
      var scrollValue = $(window).scrollTop();
      if (scrollValue >= top - 70) {
        $toc.addClass('fixed')
      } else {
        $toc.removeClass('fixed')
      }
    }

    function debounce(fn, wait) {
      var timeout = null;
      return function () {
        clearTimeout(timeout);
        timeout = setTimeout(() => {
          fn.apply(this, arguments);
        }, wait);
      };
    }
  })

</script>

          </div>

        </div>
      </div>

      
<footer class="py-5 sky-row">
  <div class="container-fluid text-center">
    <div class="">
        
        
        
<ul class="list-inline mb-0">
  
  <li class="list-inline-item mx-2 h3" data-toggle="tooltip" data-placement="top" title="Twitter" aria-label="Twitter">
    <a class="text-color" target="_blank" href="https://twitter.com/asfskywalking">
      <i class="iconfont icon-twitter"></i>
    </a>
  </li>
  
  <li class="list-inline-item mx-2 h3" data-toggle="tooltip" data-placement="top" title="Slack" aria-label="Slack">
    <a class="text-color" target="_blank" href="http://s.apache.org/slack-invite">
      <i class="iconfont icon-slack"></i>
    </a>
  </li>
  
  <li class="list-inline-item mx-2 h3" data-toggle="tooltip" data-placement="top" title="Mailing list" aria-label="Mailing list">
    <a class="text-color" target="_blank" href="https://lists.apache.org/list.html?dev@skywalking.apache.org">
      <i class="iconfont icon-email"></i>
    </a>
  </li>
  
  <li class="list-inline-item mx-2 h3" data-toggle="tooltip" data-placement="top" title="GitHub" aria-label="GitHub">
    <a class="text-color" target="_blank" href="https://github.com/apache/skywalking">
      <i class="iconfont icon-github"></i>
    </a>
  </li>
  
</ul>

        
        
    </div>
    <div class="">

        <small class="text-color">&copy; 2017 - 2024 The Apache Software Foundation All Rights Reserved</small>
        
	
    </div>
    <div class="">
      <small class="text-color mt-4">Apache SkyWalking, SkyWalking, Apache, the Apache feather logo, and the Apache SkyWalking project logo are either registered trademarks or trademarks of the Apache Software Foundation.</small>
    </div>
  </div>
</footer>


    </div>
    















































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































    
<div id="popup">
    <div class="mask">
        <img src=""/>
    </div>
</div>

    <div class="sidebar-mask"></div>
<div class="sidebar">
    <nav class="nav-links">
        <div class="nav-item"><a href="/docs/" class="nav-link">Projects and Documentation</a></div>
        <div class="nav-item"><a href="/events/" class="nav-link">Events</a></div>
        <div class="nav-item"><a href="/blog/" class="nav-link router-link-exact-active router-link-active">Blog</a>
        </div>
        <div class="nav-item"><a href="/downloads/" class="nav-link">Downloads</a></div>
        <div class="nav-item"><a href="/team/" class="nav-link">Team</a></div>
        <div class="nav-item"><a href="/users/" class="nav-link">Users</a></div>
        <div class="nav-item">
            <div class="dropdown-wrapper open">
                <a class="dropdown-title"><span>中文资料</span>
                    <span class="arrow down"></span>
                </a>
                <ul class="nav-dropdown">
                    <li class="dropdown-item">
                        <a href="/zh/" class="nav-link external">博客</a>
                    </li>
                    <li class="dropdown-item">
                        <a href="https://space.bilibili.com/390683219" target="_blank"
                           rel="noopener noreferrer" class="nav-link external">B站</a>
                    </li>
                    <li class="dropdown-item">
                        <a href="https://juejin.cn/user/13673577331607" target="_blank"
                           rel="noopener noreferrer" class="nav-link external">掘金</a>
                    </li>
                </ul>
            </div>
        </div>
        <div class="nav-item">
            <div class="dropdown-wrapper open">
                <a class="dropdown-title">
                    <span>Links</span>
                    <span class="arrow down"></span>
                </a>
                <ul class="nav-dropdown">
                    <li class="dropdown-item">
                        <a href="http://www.apache.org/" target="_blank"
                           rel="noopener noreferrer" class="nav-link external">
                            Apache Software Foundation
                        </a>
                    </li>
                    <li class="dropdown-item">
                        <a href="https://github.com/apache/skywalking/issues"
                           target="_blank" rel="noopener noreferrer"
                           class="nav-link external">
                            GitHub Issue Tracker
                        </a>
                    </li>
                    <li class="dropdown-item">
                        <a href="https://lists.apache.org/list.html?dev@skywalking.apache.org" target="_blank"
                           rel="noopener noreferrer" class="nav-link external">
                            Dev Mailing List
                        </a>
                    </li>
                    <li class="dropdown-item">
                        <a href="http://www.apache.org/licenses/" target="_blank"
                           rel="noopener noreferrer" class="nav-link external">
                            License
                        </a>
                    </li>
                    <li class="dropdown-item">
                        <a href="http://www.apache.org/events/current-event"
                           target="_blank" rel="noopener noreferrer"
                           class="nav-link external">
                            Apache Events
                        </a>
                    </li>
                    <li class="dropdown-item">
                        <a href="http://www.apache.org/security/" target="_blank"
                           rel="noopener noreferrer" class="nav-link external">
                            Security
                        </a>
                    </li>
                    <li class="dropdown-item">
                        <a href="http://www.apache.org/foundation/sponsorship.html"
                           target="_blank" rel="noopener noreferrer"
                           class="nav-link external">
                            Sponsorship and Donate
                        </a>
                    </li>
                    <li class="dropdown-item">
                        <a href="http://www.apache.org/foundation/thanks.html"
                           target="_blank" rel="noopener noreferrer"
                           class="nav-link external">
                            Thanks
                        </a>
                    </li>
                </ul>
            </div>
        </div>
    </nav>
</div>

    <script src="/js/bootstrap.bundle.min.js"></script>

<script src="https://cdn.jsdelivr.net/npm/@docsearch/js@3"></script>









<script src="/js/main.min.dc00f5ca911ee5aa105ea6de6b3b7e8d8169ba5a3bf156b1fcfe23dfe3e62b0a.js" integrity="sha256-3AD1ypEe5aoQXqbeazt&#43;jYFpulo78Vax/P4j3&#43;PmKwo=" crossorigin="anonymous"></script>


<script src="/js/mermaid.min.js"></script>
<script>
    window.onload = () => mermaid.init(undefined, ".language-mermaid");
</script>


<script defer
src="https://widget.kapa.ai/kapa-widget.bundle.js"
data-website-id="8a08392b-9c4d-4816-8bc4-f93e0ecdd2a7"
data-project-name="SkyWalking"
data-project-color="#2B74B8"
data-button-text="Ask AI"
data-search-mode-enabled="true"
data-modal-open-on-command-k="true"
data-modal-disclaimer="The AI supports multiple languages, but it may not be accessible in China, a proxy is required."
data-project-logo="https://miro.medium.com/v2/resize:fit:2400/0*kmS-5BQ8ShAhZ_F4.jpg"
data-modal-example-questions="What is Apache SkyWalking?,How to deploy SkyWalking?,How to inject agents non-intrusively?,How to setup trace sampling?"
data-button-position-top=""
data-button-position-right="20px"
data-button-position-bottom="200px"
data-button-position-left=""
></script>




  </body>
  <script>
    $(function (){
      $('.doc-menu-button').on('click',function (){
        $('.td-sidebar').toggleClass('active')
      })
      $('.version-select').on('change', function (){
        var selectVersion = $(this).val().toLowerCase();
        var prefix = '';
        var url = location.href.replace(/(\/docs\/[a-zA-Z\-]+\/)([\w|\.]+)(\/.*)/, function (match, p1, p2, p3){
          prefix = p1 + selectVersion;
          return p1 + selectVersion + p3
        })
        go2SelectVersion(url, prefix)

      })
      function go2SelectVersion(url, prefix){
        $.ajax({
          url: url,
          type: "get",
          success:function(){
            location.href = url;
          },
          statusCode: {
            404:function(){
              location.href = prefix + '/readme/';
            }
          }
        });
      }
    })
  </script>
</html>
