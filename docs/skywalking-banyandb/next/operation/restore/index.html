<!doctype html>
<html lang="en" class="no-js">
  <head>
    <meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<meta name="twitter:site" content="skywalking.apache.org">
<meta name="twitter:image:src" content="https://skywalking.apache.org/images/skywalking_400x400.png">
<meta property="og:image" content="https://skywalking.apache.org/images/skywalking_400x400.png">

<meta name="generator" content="Hugo 0.80.0" />

<META NAME="ROBOTS" CONTENT="INDEX, FOLLOW">
<link rel="stylesheet" href="//at.alicdn.com/t/c/font_3007530_pvozs1rz2wn.css">



<link rel="apple-touch-icon" sizes="180x180" href="/favicons/apple-touch-icon.png">
<link rel="icon" type="image/png" sizes="32x32" href="/favicons/favicon-32x32.png">
<link rel="icon" type="image/png" sizes="16x16" href="/favicons/favicon-16x16.png">
<link rel="manifest" href="/favicons/site.webmanifest">
<link rel="mask-icon" href="/favicons/safari-pinned-tab.svg" color="#5bbad5">
<meta name="msapplication-TileColor" content="#da532c">
<meta name="theme-color" content="#ffffff">

<title>Restore BanyanDB Data Using the Restore Tool | Apache SkyWalking</title><meta property="og:title" content="Restore BanyanDB Data Using the Restore Tool" />
<meta property="og:description" content="Restore BanyanDB Data Using the Restore Tool This document explains how to use the backup and restore command line tools for BanyanDB.
Overview   Backup Tool:
Backs up snapshot data from the BanyanDB data node to a remote storage destination. Files are organized under a time-based directory (e.g., daily or hourly) computed via a configurable time style.
  Restore Tool:
Reads the timedir files from local catalog directories and uses the timestamp within to determine which remote backup snapshot should be applied." />
<meta property="og:type" content="article" />
<meta property="og:url" content="/docs/skywalking-banyandb/next/operation/restore/" />

<meta itemprop="name" content="Restore BanyanDB Data Using the Restore Tool">
<meta itemprop="description" content="Restore BanyanDB Data Using the Restore Tool This document explains how to use the backup and restore command line tools for BanyanDB.
Overview   Backup Tool:
Backs up snapshot data from the BanyanDB data node to a remote storage destination. Files are organized under a time-based directory (e.g., daily or hourly) computed via a configurable time style.
  Restore Tool:
Reads the timedir files from local catalog directories and uses the timestamp within to determine which remote backup snapshot should be applied.">

<meta itemprop="wordCount" content="908">



<meta itemprop="keywords" content="" />
<meta name="twitter:card" content="summary"/>
<meta name="twitter:title" content="Restore BanyanDB Data Using the Restore Tool"/>
<meta name="twitter:description" content="Restore BanyanDB Data Using the Restore Tool This document explains how to use the backup and restore command line tools for BanyanDB.
Overview   Backup Tool:
Backs up snapshot data from the BanyanDB data node to a remote storage destination. Files are organized under a time-based directory (e.g., daily or hourly) computed via a configurable time style.
  Restore Tool:
Reads the timedir files from local catalog directories and uses the timestamp within to determine which remote backup snapshot should be applied."/>



<link rel="preload" href="/scss/main.min.0c770159917a7e9107bd3454069daa2bf26932350638329b3c9419597d4e6e80.css" as="style">
<link href="/scss/main.min.0c770159917a7e9107bd3454069daa2bf26932350638329b3c9419597d4e6e80.css" rel="stylesheet" integrity="">



<link rel="stylesheet" href="/css/docSearch.css" />
<link rel="stylesheet" href="/css/highlight-github.css" />


<script src="/js/jquery-3.6.0.min.js"></script>





    <title>Restore BanyanDB Data Using the Restore Tool | Apache SkyWalking</title>
  </head>
  <body class="td-page  project-doc">
    <header>
      
<nav class="js-navbar-scroll navbar navbar-expand  flex-column flex-md-row td-navbar">
    <div class="sidebar-button">
      <i class="iconfont icon-menu"></i>
    </div>
    <a class="navbar-brand" href="/">
        <span class="navbar-logo"><img width="130" src="/images/logo.svg" alt="SkyWalking"></span> 
    </a>
    <div class="td-navbar-nav-scroll navbar-nav-wrapper" id="navigation">
        <ul class="navbar-nav mt-lg-0">
             
            
            
            <li class="nav-item mr-3 mb-lg-0">
				
				
				
				
				<a class="nav-link" href="/docs" ><span>Projects and Docs</span></a>
			</li>
            
            
            
            
            <li class="nav-item mr-3 mb-lg-0">
				
				
				
				
				<a class="nav-link" href="/events" ><span>Events</span></a>
			</li>
            
            
            
            
            <li class="nav-item mr-3 mb-lg-0">
				
				
				
				
				<a class="nav-link" href="/blog" ><span>Blogs</span></a>
			</li>
            
            
            
            
            <li class="nav-item mr-3 mb-lg-0">
				
				
				
				
				<a class="nav-link" href="/downloads" ><span>Downloads</span></a>
			</li>
            
            
            
            
            <li class="nav-item mr-3 mb-lg-0">
				
				
				
				
				<a class="nav-link" href="/team" ><span>Team</span></a>
			</li>
            
            
            
            
            <li class="nav-item mr-3 mb-lg-0">
				
				
				
				
				<a class="nav-link" href="/users" ><span>Users</span></a>
			</li>
            
            
            
            
            
            <li class="nav-item mr-3 mb-lg-0">
                <span class="link dropdown blog">
                    <a class="link-name nav-link dropdown-toggle" href="#" role="button" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">中文资料</a>
                    <div class="dropdown-menu">
                        <a class="dropdown-item" href="/zh/">博客</a>
                        <a class="dropdown-item" href="https://space.bilibili.com/390683219" target="_blank" rel="noopener noreferrer">
                            B站
                        </a>
                        <a class="dropdown-item" href="https://juejin.cn/user/13673577331607" target="_blank" rel="noopener noreferrer">
                            掘金
                        </a>
                    </div>
                </span>
            </li>

            
			
        </ul>
    </div>
    <div class="navbar-nav d-none d-lg-block search-input-box">
         
            
        
            
        
            
        
            
        
            
        
            
        
            
            <span class="link dropdown">
                <a class="link-name dropdown-toggle" href="#" role="button" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
                    Links
                </a>
                <div class="dropdown-menu">
                    
                    <a class="dropdown-item" href="http://www.apache.org/">Apache Software Foundation</a> 
                    <a class="dropdown-item" href="https://github.com/apache/skywalking/issues">GitHub Issue Tracker</a> 
                    <a class="dropdown-item" href="https://github.com/apache/skywalking/discussions">Discussion</a> 
                    <a class="dropdown-item" href="https://lists.apache.org/list.html?dev@skywalking.apache.org">Dev Mailing List</a> 
                    <a class="dropdown-item" href="https://cwiki.apache.org/confluence/display/SKYWALKING/Home">WIKI</a> 
                    <a class="dropdown-item" href="http://www.apache.org/licenses/">License</a> 
                    <a class="dropdown-item" href="http://www.apache.org/events/current-event">Apache Events</a> 
                    <a class="dropdown-item" href="http://www.apache.org/security/">Security</a> 
                    <a class="dropdown-item" href="http://www.apache.org/foundation/sponsorship.html">Sponsor and Donate</a> 
                    <a class="dropdown-item" href="http://www.apache.org/foundation/thanks.html">Thanks</a> 
                    <a class="dropdown-item" href="https://apache.org/foundation/policies/privacy.html">Privacy</a> 
                </div>
            </span>
            
        
        
<div id="docsearch"></div>


    </div>
</nav>

    </header>
    <div class="container-fluid td-outer">

      <div class="td-main">
        <div class="row flex-xl-nowrap">
          <div class="col-12 col-md-3 col-xl-2 d-print-none scroll-bar td-sidebar">









































                  <div class="description-wrapper">
                    <h5>
                    <img width="26" height="26" src="/images/project/banyan-db.svg">
                    BanyanDB
                    </h5>
                    <p>An observability database aims to ingest, analyze and store Metrics, Tracing and Logging data.</p>
                  </div>
                  
                  <div class="version-wrapper">Version: 
                  <select class="version-select">
                  
                    
                    
                    <option selected value="next">
                    
                      next
                    
                    </option>
                  
                    
                    
                    <option ZgotmplZ value="latest">
                    
                      latest
                    
                    </option>
                  
                    
                    
                    <option ZgotmplZ value="v0.8.0">
                    
                      v0.8.0
                    
                    </option>
                  
                  </select>
                  </div>
                  
                  <ul class="sidebar-menu">
    
    <li>
        
            <a href="/docs/skywalking-banyandb/next/readme">Welcome</a>
        
    </li>
    
    <li>
        
            
            <a href="#">User Guide<i class="iconfont icon-arrow-right pull-right"></i></a>
            

            
<ul class="sidebar-submenu">
    

    <li>
        

            
            <a href="#">Installation<i class="iconfont icon-arrow-right pull-right"></i></a>
            

            
<ul class="sidebar-submenu">
    

    <li>
        
            <a href="/docs/skywalking-banyandb/next/installation/binaries">Get Binaries</a>
        
    </li>

    

    <li>
        
            <a href="/docs/skywalking-banyandb/next/installation/standalone">Standalone Mode</a>
        
    </li>

    

    <li>
        
            <a href="/docs/skywalking-banyandb/next/installation/cluster">Cluster Mode</a>
        
    </li>

    

    <li>
        
            <a href="/docs/skywalking-banyandb/next/installation/docker">Installation On Docker</a>
        
    </li>

    

    <li>
        
            <a href="/docs/skywalking-banyandb/next/installation/kubernetes">Installation On Kubernetes</a>
        
    </li>

    

</ul>

        
    </li>

    

    <li>
        

            
            <a href="#">Basic Concepts and Terminology<i class="iconfont icon-arrow-right pull-right"></i></a>
            

            
<ul class="sidebar-submenu">
    

    <li>
        
            <a href="/docs/skywalking-banyandb/next/concept/data-model">Data Model</a>
        
    </li>

    

</ul>

        
    </li>

    

    <li>
        
            <a href="/docs/skywalking-banyandb/next/guides/quick-start/quick-start">Quick Start Tutorial</a>
        
    </li>

    

    <li>
        
            <a href="/docs/skywalking-banyandb/next/installation/versions">Versions and Compatibility</a>
        
    </li>

    

</ul>

        
    </li>
    
    <li>
        
            
            <a href="#">Interacting<i class="iconfont icon-arrow-right pull-right"></i></a>
            

            
<ul class="sidebar-submenu">
    

    <li>
        

            
            <a href="#">CLI<i class="iconfont icon-arrow-right pull-right"></i></a>
            

            
<ul class="sidebar-submenu">
    

    <li>
        
            <a href="/docs/skywalking-banyandb/next/interacting/bydbctl/bydbctl">bydbctl</a>
        
    </li>

    

    <li>
        

            
            <a href="#">CRUD Schema<i class="iconfont icon-arrow-right pull-right"></i></a>
            

            
<ul class="sidebar-submenu">
    

    <li>
        
            <a href="/docs/skywalking-banyandb/next/interacting/bydbctl/schema/group">Group</a>
        
    </li>

    

    <li>
        
            <a href="/docs/skywalking-banyandb/next/interacting/bydbctl/schema/measure">Measure</a>
        
    </li>

    

    <li>
        
            <a href="/docs/skywalking-banyandb/next/interacting/bydbctl/schema/stream">Stream</a>
        
    </li>

    

    <li>
        
            <a href="/docs/skywalking-banyandb/next/interacting/bydbctl/schema/index-rule">IndexRule</a>
        
    </li>

    

    <li>
        
            <a href="/docs/skywalking-banyandb/next/interacting/bydbctl/schema/index-rule-binding">IndexRuleBinding</a>
        
    </li>

    

    <li>
        
            <a href="/docs/skywalking-banyandb/next/interacting/bydbctl/schema/top-n-aggregation">Top N Aggregation</a>
        
    </li>

    

</ul>

        
    </li>

    

    <li>
        

            
            <a href="#">Querying Data<i class="iconfont icon-arrow-right pull-right"></i></a>
            

            
<ul class="sidebar-submenu">
    

    <li>
        
            <a href="/docs/skywalking-banyandb/next/interacting/bydbctl/query/measure">Measure</a>
        
    </li>

    

    <li>
        
            <a href="/docs/skywalking-banyandb/next/interacting/bydbctl/query/stream">Stream</a>
        
    </li>

    

    <li>
        
            <a href="/docs/skywalking-banyandb/next/interacting/bydbctl/query/filter-operation">Filter Operation</a>
        
    </li>

    

    <li>
        
            <a href="/docs/skywalking-banyandb/next/interacting/bydbctl/query/top-n-aggregation">Top N Aggregation</a>
        
    </li>

    

</ul>

        
    </li>

    

    <li>
        
            <a href="/docs/skywalking-banyandb/next/interacting/bydbctl/property">CRUD Property</a>
        
    </li>

    

    <li>
        
            <a href="/docs/skywalking-banyandb/next/interacting/bydbctl/analyze">Analyzing Data</a>
        
    </li>

    

</ul>

        
    </li>

    

    <li>
        

            
            <a href="#">Web UI<i class="iconfont icon-arrow-right pull-right"></i></a>
            

            
<ul class="sidebar-submenu">
    

    <li>
        
            <a href="/docs/skywalking-banyandb/next/interacting/web-ui/dashboard">Dashboard</a>
        
    </li>

    

    <li>
        

            
            <a href="#">CRUD Schema<i class="iconfont icon-arrow-right pull-right"></i></a>
            

            
<ul class="sidebar-submenu">
    

    <li>
        
            <a href="/docs/skywalking-banyandb/next/interacting/web-ui/schema/group">Group</a>
        
    </li>

    

    <li>
        
            <a href="/docs/skywalking-banyandb/next/interacting/web-ui/schema/measure">Measure</a>
        
    </li>

    

    <li>
        
            <a href="/docs/skywalking-banyandb/next/interacting/web-ui/schema/stream">Stream</a>
        
    </li>

    

    <li>
        
            <a href="/docs/skywalking-banyandb/next/interacting/web-ui/schema/index-rule">IndexRule</a>
        
    </li>

    

    <li>
        
            <a href="/docs/skywalking-banyandb/next/interacting/web-ui/schema/index-rule-binding">IndexRuleBinding</a>
        
    </li>

    

    <li>
        
            <a href="/docs/skywalking-banyandb/next/interacting/web-ui/schema/top-n-aggregation">Top N Aggregation</a>
        
    </li>

    

</ul>

        
    </li>

    

    <li>
        

            
            <a href="#">Querying Data<i class="iconfont icon-arrow-right pull-right"></i></a>
            

            
<ul class="sidebar-submenu">
    

    <li>
        
            <a href="/docs/skywalking-banyandb/next/interacting/web-ui/query/measure">Measure</a>
        
    </li>

    

    <li>
        
            <a href="/docs/skywalking-banyandb/next/interacting/web-ui/query/stream">Stream</a>
        
    </li>

    

</ul>

        
    </li>

    

    <li>
        
            <a href="/docs/skywalking-banyandb/next/interacting/web-ui/property">CRUD Property</a>
        
    </li>

    

</ul>

        
    </li>

    

    <li>
        
            <a href="/docs/skywalking-banyandb/next/interacting/java-client">Java Client</a>
        
    </li>

    

    <li>
        
            <a href="/docs/skywalking-banyandb/next/interacting/data-lifecycle">Data Lifecycle</a>
        
    </li>

    

</ul>

        
    </li>
    
    <li>
        
            
            <a href="#">Operation and Maintenance<i class="iconfont icon-arrow-right pull-right"></i></a>
            

            
<ul class="sidebar-submenu">
    

    <li>
        
            <a href="/docs/skywalking-banyandb/next/operation/configuration">Configure BanyanDB</a>
        
    </li>

    

    <li>
        
            <a href="/docs/skywalking-banyandb/next/operation/system">System Configuration</a>
        
    </li>

    

    <li>
        
            <a href="/docs/skywalking-banyandb/next/operation/upgrade">Upgrade</a>
        
    </li>

    

    <li>
        
            <a href="/docs/skywalking-banyandb/next/operation/observability">Observability</a>
        
    </li>

    

    <li>
        
            <a href="/docs/skywalking-banyandb/next/operation/cluster">Cluster Management</a>
        
    </li>

    

    <li>
        

            
            <a href="#">Troubleshooting<i class="iconfont icon-arrow-right pull-right"></i></a>
            

            
<ul class="sidebar-submenu">
    

    <li>
        
            <a href="/docs/skywalking-banyandb/next/operation/troubleshooting/error-checklist">Error Checklist</a>
        
    </li>

    

    <li>
        
            <a href="/docs/skywalking-banyandb/next/operation/troubleshooting/install">Troubleshooting Installation</a>
        
    </li>

    

    <li>
        
            <a href="/docs/skywalking-banyandb/next/operation/troubleshooting/crash">Troubleshooting Crash</a>
        
    </li>

    

    <li>
        
            <a href="/docs/skywalking-banyandb/next/operation/troubleshooting/no-data">Troubleshooting No Data</a>
        
    </li>

    

    <li>
        
            <a href="/docs/skywalking-banyandb/next/operation/troubleshooting/overhead">Troubleshooting Overhead</a>
        
    </li>

    

    <li>
        
            <a href="/docs/skywalking-banyandb/next/operation/troubleshooting/query">Troubleshooting Query</a>
        
    </li>

    

</ul>

        
    </li>

    

    <li>
        
            <a href="/docs/skywalking-banyandb/next/operation/security">Security</a>
        
    </li>

    

    <li>
        
            <a href="/docs/skywalking-banyandb/next/operation/backup">Backup</a>
        
    </li>

    

    <li>
        
            <a href="/docs/skywalking-banyandb/next/operation/restore">Restore</a>
        
    </li>

    

    <li>
        
            <a href="/docs/skywalking-banyandb/next/operation/lifecycle">Lifecycle Management</a>
        
    </li>

    

    <li>
        
            <a href="/docs/skywalking-banyandb/next/concept/property-repair">Property Background Repair</a>
        
    </li>

    

</ul>

        
    </li>
    
    <li>
        
            
            <a href="#">File Format<i class="iconfont icon-arrow-right pull-right"></i></a>
            

            
<ul class="sidebar-submenu">
    

    <li>
        
            <a href="/docs/skywalking-banyandb/next/concept/tsdb">v1.3.0</a>
        
    </li>

    

</ul>

        
    </li>
    
    <li>
        
            
            <a href="#">Concepts<i class="iconfont icon-arrow-right pull-right"></i></a>
            

            
<ul class="sidebar-submenu">
    

    <li>
        
            <a href="/docs/skywalking-banyandb/next/concept/clustering">Clustering</a>
        
    </li>

    

    <li>
        
            <a href="/docs/skywalking-banyandb/next/concept/tsdb">TSDB</a>
        
    </li>

    

    <li>
        
            <a href="/docs/skywalking-banyandb/next/concept/rotation">Data Rotation</a>
        
    </li>

    

    <li>
        
            <a href="/docs/skywalking-banyandb/next/concept/property-repair">Property Background Repair</a>
        
    </li>

    

</ul>

        
    </li>
    
    <li>
        
            
            <a href="#">Contribute<i class="iconfont icon-arrow-right pull-right"></i></a>
            

            
<ul class="sidebar-submenu">
    

    <li>
        
            <a href="/docs/skywalking-banyandb/next/contribute/debugging">Debugging</a>
        
    </li>

    

</ul>

        
    </li>
    
</ul>
<script src="/js/sidebar-menu.js"></script>
<script>
  (function (){
    $.sidebarMenu($('.sidebar-menu'))
    var path = window.location.pathname;
    var hash = window.location.hash;
    var $a = $('.sidebar-menu a')
    $a.each(function (e){
      if($(this).attr('href')+'/' === path || $(this).attr('href').replace('#','/#') === path+hash){
        $(this).parents('li').addClass('active').show()
      }
    })
    $a.on('click',function (){
      var url = $(this).attr('href')
      if(url!=='#'){
        window.location.href = url
      }
    })
  })()
</script>

                  <div class="commit-id">Commit Id: 0169651</div>
                






</div>
            <main class="col-12 col-md-9 col-xl-8 pl-md-5 pr-md-4" role="main">
              <i class="iconfont icon-menu-doc doc-menu-button"></i>
              
<div class="td-content">
	<h1 id="restore-banyandb-data-using-the-restore-tool">Restore BanyanDB Data Using the Restore Tool</h1>
<p>This document explains how to use the backup and restore command line tools for BanyanDB.</p>
<h2 id="overview">Overview</h2>
<ul>
<li>
<p><strong>Backup Tool:</strong><br>
Backs up snapshot data from the BanyanDB data node to a remote storage destination. Files are organized under a time-based directory (e.g., daily or hourly) computed via a configurable time style.</p>
</li>
<li>
<p><strong>Restore Tool:</strong><br>
Reads the <em>timedir</em> files from local catalog directories and uses the timestamp within to determine which remote backup snapshot should be applied. Once restoration is successful, it removes all <em>timedir</em> files to avoid repeated restore operations, especially during unexpected scenarios.</p>
</li>
<li>
<p><strong>Timedir Utility:</strong><br>
Provides commands to create, list, read, and delete <em>time-dir</em> marker files for each catalog (e.g., <em>stream</em>, <em>measure</em>, and <em>property</em>).</p>
</li>
</ul>
<h2 id="restore-workflow">Restore Workflow</h2>
<p>In an on-prem deployment, the BanyanDB data node runs on a dedicated server (or virtual machine), and backup/restore operations are performed using the provided command line tool binaries. This mode is ideal for traditional environments where the tools are run manually or scheduled via system cron jobs.</p>
<h3 id="backup-tool">Backup Tool</h3>
<p>The <code>backup</code> binary is used to create backups of BanyanDB snapshots. It connects to the gRPC endpoint of the data node to obtain snapshots and then uploads the backed-up data (organized by timestamp) to remote storage.</p>
<h4 id="example-backup-command">Example Backup Command</h4>
<div class="highlight"><pre style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-sh" data-lang="sh">backup run <span style="color:#d14">\
</span><span style="color:#d14"></span>  --grpc-addr 127.0.0.1:17912 <span style="color:#d14">\
</span><span style="color:#d14"></span>  --stream-root-path /data <span style="color:#d14">\
</span><span style="color:#d14"></span>  --measure-root-path /data <span style="color:#d14">\
</span><span style="color:#d14"></span>  --property-root-path /data <span style="color:#d14">\
</span><span style="color:#d14"></span>  --dest file:///backups <span style="color:#d14">\
</span><span style="color:#d14"></span>  --time-style daily
</code></pre></div><p><strong>Notes:</strong></p>
<ul>
<li><code>--grpc-addr</code>: gRPC address for the data node.</li>
<li><code>--stream-root-path</code>, <code>--measure-root-path</code>, <code>--property-root-path</code>: Local directories for the respective catalogs.</li>
<li><code>--dest</code>: Remote destination URL where backups will be stored (e.g., local filesystem path with the <code>file://</code> scheme).</li>
<li><code>--time-style</code>: Defines the time directory style, such as <code>daily</code> or <code>hourly</code>.</li>
</ul>
<h3 id="timedir-utilities">Timedir Utilities</h3>
<p>The <code>timedir</code> tool provides commands to create, read, list, and delete marker files (time directories) that indicate the backup snapshot’s timestamp. These marker files are used by the restore process to identify which snapshot to restore.</p>
<h4 id="list-remote-timedir-files">List Remote Timedir Files</h4>
<p>Before creating a new local timedir file for restoration, use the timedir list command to inspect the remote backup destination. This lets you view all available timedir names and select the expected one.</p>
<div class="highlight"><pre style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-sh" data-lang="sh">restore timedir list <span style="color:#d14">\
</span><span style="color:#d14"></span>  --dest file:///backups
</code></pre></div><p>Example output:</p>
<div class="highlight"><pre style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-sh" data-lang="sh">Remote <span style="color:#0086b3">time</span> directories:
2025-02-12
2025-02-13
2025-02-14
</code></pre></div><p>Examine the list and choose the appropriate timedir (for example, 2025-02-12).</p>
<h4 id="creating-timedir-files">Creating Timedir Files</h4>
<p>Before undertaking a pod or service restart, an administrator may create timedir marker files to capture the current backup state:</p>
<div class="highlight"><pre style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-sh" data-lang="sh">restore timedir create 2025-02-12 <span style="color:#d14">\
</span><span style="color:#d14"></span>  --stream-root /data <span style="color:#d14">\
</span><span style="color:#d14"></span>  --measure-root /data <span style="color:#d14">\
</span><span style="color:#d14"></span>  --property-root /data
</code></pre></div><p>This command writes the specified timestamp (e.g., 2025-02-12) into files named <code>/data/stream/time-dir</code>, <code>/data/measure/time-dir</code>, and <code>/data/property/time-dir</code> in the designated root directories.</p>
<h4 id="verifying-timedir-files">Verifying Timedir Files</h4>
<p>Ensure that the timedir files have been created with the correct content by reading them:</p>
<div class="highlight"><pre style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-sh" data-lang="sh">restore timedir <span style="color:#0086b3">read</span> <span style="color:#d14">\
</span><span style="color:#d14"></span>  --stream-root /data <span style="color:#d14">\
</span><span style="color:#d14"></span>  --measure-root /data <span style="color:#d14">\
</span><span style="color:#d14"></span>  --property-root /data
</code></pre></div><p>The output should display the timedir content for each catalog.</p>
<h3 id="restore-tool">Restore Tool</h3>
<p><strong>Important</strong>: Before triggering a restore, ensure the BanyanDB data node is completely stopped.</p>
<p>The <code>restore</code> binary restores data from the remote backup storage onto the local machine. It examines the timedir marker files to determine which backup snapshot to apply, then synchronizes the local data directories accordingly. After a successful restore, the tool removes the timedir files to prevent unintended repeated restores.</p>
<h4 id="example-restore-command">Example Restore Command</h4>
<div class="highlight"><pre style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-sh" data-lang="sh">restore run <span style="color:#d14">\
</span><span style="color:#d14"></span>  --source file:///backups <span style="color:#d14">\
</span><span style="color:#d14"></span>  --stream-root-path /data <span style="color:#d14">\
</span><span style="color:#d14"></span>  --measure-root-path /data <span style="color:#d14">\
</span><span style="color:#d14"></span>  --property-root-path /data
</code></pre></div><p><strong>Key Points:</strong></p>
<ul>
<li>The tool reads the timedir files (e.g., <code>/data/stream/time-dir</code>) to fetch the appropriate timestamp.</li>
<li>Local data is compared with the remote backup snapshot; orphaned files in local directories are removed.</li>
<li>Upon success, the timedir marker files are deleted to ensure a clean recovery state.</li>
</ul>
<h4 id="cloud-storage-examples">Cloud Storage Examples</h4>
<p>Restore from common cloud object stores using the same flag set:</p>
<div class="highlight"><pre style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash"><span style="color:#998;font-style:italic"># AWS S3 (using credential file)</span>
restore run <span style="color:#d14">\
</span><span style="color:#d14"></span>  --source <span style="color:#d14">&#34;s3://my-bucket/backups&#34;</span> <span style="color:#d14">\
</span><span style="color:#d14"></span>  --s3-credential-file <span style="color:#d14">&#34;/path/to/credentials&#34;</span> <span style="color:#d14">\
</span><span style="color:#d14"></span>  --s3-profile <span style="color:#d14">&#34;my-profile&#34;</span> <span style="color:#d14">\
</span><span style="color:#d14"></span>  --stream-root-path /data <span style="color:#d14">\
</span><span style="color:#d14"></span>  --measure-root-path /data <span style="color:#d14">\
</span><span style="color:#d14"></span>  --property-root-path /data

<span style="color:#998;font-style:italic"># Google Cloud Storage</span>
restore run <span style="color:#d14">\
</span><span style="color:#d14"></span>  --source <span style="color:#d14">&#34;gs://my-bucket/backups&#34;</span> <span style="color:#d14">\
</span><span style="color:#d14"></span>  --gcp-service-account-file <span style="color:#d14">&#34;/path/to/service-account.json&#34;</span> <span style="color:#d14">\
</span><span style="color:#d14"></span>  --stream-root-path /data <span style="color:#d14">\
</span><span style="color:#d14"></span>  --measure-root-path /data <span style="color:#d14">\
</span><span style="color:#d14"></span>  --property-root-path /data

<span style="color:#998;font-style:italic"># Azure Blob Storage (using SAS token)</span>
restore run <span style="color:#d14">\
</span><span style="color:#d14"></span>  --source <span style="color:#d14">&#34;azure://mycontainer/backups&#34;</span> <span style="color:#d14">\
</span><span style="color:#d14"></span>  --azure-account-name <span style="color:#d14">&#34;myaccount&#34;</span> <span style="color:#d14">\
</span><span style="color:#d14"></span>  --azure-sas-token <span style="color:#d14">&#34;mysastoken&#34;</span> <span style="color:#d14">\
</span><span style="color:#d14"></span>  --stream-root-path /data <span style="color:#d14">\
</span><span style="color:#d14"></span>  --measure-root-path /data <span style="color:#d14">\
</span><span style="color:#d14"></span>  --property-root-path /data
</code></pre></div><h2 id="kubernetes-deployment">Kubernetes Deployment</h2>
<p>For environments running BanyanDB in Kubernetes, the backup and restore tools can be integrated as sidecar containers. A common pattern is to use an init container for restoring data and a sidecar to manage backup and timedir operations.</p>
<h3 id="kubernetes-sidecar-deployment-model">Kubernetes Sidecar Deployment Model</h3>
<ol>
<li>
<p><strong>Sidecar Container:</strong></p>
<ul>
<li>The sidecar runs the backup and timedir command binaries alongside the main BanyanDB container.</li>
<li>Administrators can attach to the sidecar (using <code>kubectl exec</code>) to execute timedir operations.</li>
<li>The sidecar is responsible for backing up snapshot data and maintaining timedir files.</li>
</ul>
</li>
<li>
<p><strong>Init Container for Restore:</strong></p>
<ul>
<li>When a pod is (re)created, an init container runs before the main container starts.</li>
<li>The init container uses the <code>restore</code> binary to read the timedir files from shared volumes (mounted from a persistent volume or hostPath).</li>
<li>It restores the data from the remote backup store by processing the timedir markers, and then deletes the marker files to avoid accidental re-triggering.</li>
</ul>
</li>
<li>
<p><strong>Shared Volumes:</strong></p>
<ul>
<li>The timedir files and data directories are shared between the init container, sidecar, and main container (data node) via Kubernetes volumes.</li>
<li>This shared setup ensures that the restore process can correctly synchronize the data state before the server starts.</li>
</ul>
</li>
</ol>
<p>By following the guidelines and examples provided in this document, administrators can choose the approach that best fits their deployment environment—whether on-prem or in Kubernetes—to ensure reliable data backup and restoration for BanyanDB.</p>

</div>
<div>
  
  
  
  <div id="edit-github">
    <svg
      fill="currentColor"
      height="20"
      width="20"
      viewBox="0 0 40 40"
      aria-hidden="true"
      style="margin-right: 0.1em;vertical-align: sub; color: #3176d9">
      <g>
        <path d="m34.5 11.7l-3 3.1-6.3-6.3 3.1-3q0.5-0.5 1.2-0.5t1.1 0.5l3.9 3.9q0.5 0.4 0.5 1.1t-0.5 1.2z m-29.5 17.1l18.4-18.5 6.3 6.3-18.4 18.4h-6.3v-6.2z" />
      </g>
    </svg>
    <a class="github-link" title="Edit this page" href="" target="_blank">
      <span id="edit-github-text">Edit this page</span>
    </a>
  </div>
  
</div>
<script>
  let reg = /\/docs\/[a-zA-Z\-]+\/([\w|\.]+)\//;
  let res = reg.exec(location.href);
  let version = res && res[1];
  let editGithub = document.getElementById("edit-github");
  if (editGithub) {
    editGithub.style.display = version === "next" ? "block" : "none";
  }
  
  if (version === "next") {
    reg = /\/docs\/(.+?)\//;
    let repoRes = reg.exec(location.href);
    let repo = repoRes && repoRes[1];
    if (repo === "main") {
      repo = "skywalking"
    }
    reg = /\/next\/(.+)/;
    let docs = reg.exec(location.href);
    let docsUrl = docs && docs[1];
    if (docsUrl) {
      docsUrl = docsUrl.replace(/readme/i, 'README');
    }
    let prefixUrl = "https://github.com/apache/" + repo + "/blob/master/docs/";
    let editGithubLink = document.querySelector("#edit-github a");
    if (editGithubLink) {
      editGithubLink.href = prefixUrl + docsUrl.replace(/\/$/, ".md");
    }
  }
</script>

            </main>
          <div id="toc" class="d-none d-xl-block col-xl-2 td-toc d-print-none">
            




<div class="td-page-meta ml-2 pb-1 pt-2 mb-0">











</div>






<nav id="TableOfContents">
  <ul>
    <li><a href="#restore-banyandb-data-using-the-restore-tool">Restore BanyanDB Data Using the Restore Tool</a>
      <ul>
        <li><a href="#overview">Overview</a></li>
        <li><a href="#restore-workflow">Restore Workflow</a>
          <ul>
            <li><a href="#backup-tool">Backup Tool</a></li>
            <li><a href="#timedir-utilities">Timedir Utilities</a></li>
            <li><a href="#restore-tool">Restore Tool</a></li>
          </ul>
        </li>
        <li><a href="#kubernetes-deployment">Kubernetes Deployment</a>
          <ul>
            <li><a href="#kubernetes-sidecar-deployment-model">Kubernetes Sidecar Deployment Model</a></li>
          </ul>
        </li>
      </ul>
    </li>
  </ul>
</nav>




<script>
  $(function () {
    var $toc = $("#TableOfContents");
    if (!$toc || !$toc.length) {
      return;
    }
    var top = $toc.offset().top;
    $(window).on("scroll", debounce(setTop, 100))
    $(window).on("scroll", debounce(addActive, 30))

    function addActive() {
      var scrollValue = $(window).scrollTop();
      var topEle = null;
      $.each($('main h1, main h2, main h3'), function (index, item) {
        if ($(item).offset().top - 70 > scrollValue) {
          return
        }
        if (!topEle) {
          topEle = item
        } else if ($(item).offset().top >= $(topEle).offset().top) {
          topEle = item
        }
        if (topEle) {
          var id = $(item).attr('id');
          $toc.find('a').removeClass("active").end().find('a[href="' + '#' + id + '"]').addClass("active")
        }
      })
    }

    function setTop() {
      var scrollValue = $(window).scrollTop();
      if (scrollValue >= top - 70) {
        $toc.addClass('fixed')
      } else {
        $toc.removeClass('fixed')
      }
    }

    function debounce(fn, wait) {
      var timeout = null;
      return function () {
        clearTimeout(timeout);
        timeout = setTimeout(() => {
          fn.apply(this, arguments);
        }, wait);
      };
    }
  })

</script>

          </div>

        </div>
      </div>

      
<footer class="py-5 sky-row">
  <div class="container-fluid text-center">
    <div class="">
        
        
        
<ul class="list-inline mb-0">
  
  <li class="list-inline-item mx-2 h3" data-toggle="tooltip" data-placement="top" title="Twitter" aria-label="Twitter">
    <a class="text-color" target="_blank" href="https://twitter.com/asfskywalking">
      <i class="iconfont icon-twitter"></i>
    </a>
  </li>
  
  <li class="list-inline-item mx-2 h3" data-toggle="tooltip" data-placement="top" title="Slack" aria-label="Slack">
    <a class="text-color" target="_blank" href="http://s.apache.org/slack-invite">
      <i class="iconfont icon-slack"></i>
    </a>
  </li>
  
  <li class="list-inline-item mx-2 h3" data-toggle="tooltip" data-placement="top" title="Mailing list" aria-label="Mailing list">
    <a class="text-color" target="_blank" href="https://lists.apache.org/list.html?dev@skywalking.apache.org">
      <i class="iconfont icon-email"></i>
    </a>
  </li>
  
  <li class="list-inline-item mx-2 h3" data-toggle="tooltip" data-placement="top" title="GitHub" aria-label="GitHub">
    <a class="text-color" target="_blank" href="https://github.com/apache/skywalking">
      <i class="iconfont icon-github"></i>
    </a>
  </li>
  
</ul>

        
        
    </div>
    <div class="">

        <small class="text-color">&copy; 2017 - 2025 The Apache Software Foundation All Rights Reserved</small>
        
	
    </div>
    <div class="">
      <small class="text-color mt-4">Apache SkyWalking, SkyWalking, Apache, the Apache feather logo, and the Apache SkyWalking project logo are either registered trademarks or trademarks of the Apache Software Foundation.</small>
    </div>
  </div>
</footer>


    </div>
    













































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































    
<div id="popup">
    <div class="mask">
        <img src=""/>
    </div>
</div>

    <div class="sidebar-mask"></div>
<div class="sidebar">
    <nav class="nav-links">
        <div class="nav-item"><a href="/docs/" class="nav-link">Projects and Documentation</a></div>
        <div class="nav-item"><a href="/events/" class="nav-link">Events</a></div>
        <div class="nav-item"><a href="/blog/" class="nav-link router-link-exact-active router-link-active">Blog</a>
        </div>
        <div class="nav-item"><a href="/downloads/" class="nav-link">Downloads</a></div>
        <div class="nav-item"><a href="/team/" class="nav-link">Team</a></div>
        <div class="nav-item"><a href="/users/" class="nav-link">Users</a></div>
        <div class="nav-item">
            <div class="dropdown-wrapper open">
                <a class="dropdown-title"><span>中文资料</span>
                    <span class="arrow down"></span>
                </a>
                <ul class="nav-dropdown">
                    <li class="dropdown-item">
                        <a href="/zh/" class="nav-link external">博客</a>
                    </li>
                    <li class="dropdown-item">
                        <a href="https://space.bilibili.com/390683219" target="_blank"
                           rel="noopener noreferrer" class="nav-link external">B站</a>
                    </li>
                    <li class="dropdown-item">
                        <a href="https://juejin.cn/user/13673577331607" target="_blank"
                           rel="noopener noreferrer" class="nav-link external">掘金</a>
                    </li>
                </ul>
            </div>
        </div>
        <div class="nav-item">
            <div class="dropdown-wrapper open">
                <a class="dropdown-title">
                    <span>Links</span>
                    <span class="arrow down"></span>
                </a>
                <ul class="nav-dropdown">
                    <li class="dropdown-item">
                        <a href="http://www.apache.org/" target="_blank"
                           rel="noopener noreferrer" class="nav-link external">
                            Apache Software Foundation
                        </a>
                    </li>
                    <li class="dropdown-item">
                        <a href="https://github.com/apache/skywalking/issues"
                           target="_blank" rel="noopener noreferrer"
                           class="nav-link external">
                            GitHub Issue Tracker
                        </a>
                    </li>
                    <li class="dropdown-item">
                        <a href="https://lists.apache.org/list.html?dev@skywalking.apache.org" target="_blank"
                           rel="noopener noreferrer" class="nav-link external">
                            Dev Mailing List
                        </a>
                    </li>
                    <li class="dropdown-item">
                        <a href="http://www.apache.org/licenses/" target="_blank"
                           rel="noopener noreferrer" class="nav-link external">
                            License
                        </a>
                    </li>
                    <li class="dropdown-item">
                        <a href="http://www.apache.org/events/current-event"
                           target="_blank" rel="noopener noreferrer"
                           class="nav-link external">
                            Apache Events
                        </a>
                    </li>
                    <li class="dropdown-item">
                        <a href="http://www.apache.org/security/" target="_blank"
                           rel="noopener noreferrer" class="nav-link external">
                            Security
                        </a>
                    </li>
                    <li class="dropdown-item">
                        <a href="http://www.apache.org/foundation/sponsorship.html"
                           target="_blank" rel="noopener noreferrer"
                           class="nav-link external">
                            Sponsorship and Donate
                        </a>
                    </li>
                    <li class="dropdown-item">
                        <a href="http://www.apache.org/foundation/thanks.html"
                           target="_blank" rel="noopener noreferrer"
                           class="nav-link external">
                            Thanks
                        </a>
                    </li>
                </ul>
            </div>
        </div>
    </nav>
</div>

    <script src="/js/bootstrap.bundle.min.js"></script>

<script src="https://cdn.jsdelivr.net/npm/@docsearch/js@3"></script>









<script src="/js/main.min.d00d7a99f9e61382b1db35fac38e0e7bdd97f8d3c663a4c4b8d02c3f1d78d894.js" integrity="sha256-0A16mfnmE4Kx2zX6w44Oe92X&#43;NPGY6TEuNAsPx142JQ=" crossorigin="anonymous"></script>


<script src="/js/highlight.min.js"></script>
<script src="/js/mermaid.min.js"></script>
<script>
    window.onload = () => mermaid.init(undefined, ".language-mermaid");
</script>
<script>
  document.addEventListener('DOMContentLoaded', () => {
    document.querySelectorAll('pre code.language-json5').forEach((block) => {
      if (block.classList.contains('language-json5')) {
        try {
          hljs.registerLanguage('json5', function(hljs) {
            return hljs.getLanguage('json');
          });
          hljs.highlightElement(block);
        } catch (error) {
          console.error("Error parsing JSON5:", error);
        }
      }
    });
  });
</script>


<script defer
src="https://widget.kapa.ai/kapa-widget.bundle.js"
data-website-id="8a08392b-9c4d-4816-8bc4-f93e0ecdd2a7"
data-project-name="SkyWalking"
data-project-color="#2B74B8"
data-button-text="Ask AI"
data-search-mode-enabled="true"
data-modal-open-on-command-k="true"
data-modal-disclaimer="The AI supports multiple languages, but it may not be accessible in China, a proxy is required."
data-project-logo="https://miro.medium.com/v2/resize:fit:2400/0*kmS-5BQ8ShAhZ_F4.jpg"
data-modal-example-questions="What is Apache SkyWalking?,How to deploy SkyWalking?,How to inject agents non-intrusively?,How to setup trace sampling?"
data-button-position-top=""
data-button-position-right="20px"
data-button-position-bottom="200px"
data-button-position-left=""
data-consent-required="true"  
data-user-analytics-cookie-enabled="true"  
data-consent-screen-title="Help us improve our AI assistant"  
data-consent-screen-disclaimer="By clicking 'Allow tracking', you consent to anonymous user tracking which helps us improve our service. We don't collect any personally identifiable information."  
data-consent-screen-accept-button-text="Allow tracking"  
data-consent-screen-reject-button-text="No, thanks"
></script>




  </body>
  <script>
    $(function (){
      $('.doc-menu-button').on('click',function (){
        $('.td-sidebar').toggleClass('active')
      })
      $('.version-select').on('change', function (){
        var selectVersion = $(this).val().toLowerCase();
        var prefix = '';
        var url = location.href.replace(/(\/docs\/[a-zA-Z\-]+\/)([\w|\.]+)(\/.*)/, function (match, p1, p2, p3){
          prefix = p1 + selectVersion;
          return p1 + selectVersion + p3
        })
        go2SelectVersion(url, prefix)

      })
      function go2SelectVersion(url, prefix){
        $.ajax({
          url: url,
          type: "get",
          success:function(){
            location.href = url;
          },
          statusCode: {
            404:function(){
              location.href = prefix + '/readme/';
            }
          }
        });
      }
    })
  </script>
</html>
