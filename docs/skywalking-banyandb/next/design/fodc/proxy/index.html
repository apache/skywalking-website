<!doctype html>
<html lang="en" class="no-js">
  <head>
    <meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<meta name="twitter:site" content="skywalking.apache.org">
<meta name="twitter:image:src" content="https://skywalking.apache.org/images/skywalking_400x400.png">
<meta property="og:image" content="https://skywalking.apache.org/images/skywalking_400x400.png">

<meta name="generator" content="Hugo 0.80.0" />

<META NAME="ROBOTS" CONTENT="INDEX, FOLLOW">
<link rel="stylesheet" href="/css/iconfont/iconfont.css">



<link rel="apple-touch-icon" sizes="180x180" href="/favicons/apple-touch-icon.png">
<link rel="icon" type="image/png" sizes="32x32" href="/favicons/favicon-32x32.png">
<link rel="icon" type="image/png" sizes="16x16" href="/favicons/favicon-16x16.png">
<link rel="manifest" href="/favicons/site.webmanifest">
<link rel="mask-icon" href="/favicons/safari-pinned-tab.svg" color="#5bbad5">
<meta name="msapplication-TileColor" content="#da532c">
<meta name="theme-color" content="#ffffff">

<title>FODC Proxy Development Design | Apache SkyWalking</title><meta property="og:title" content="FODC Proxy Development Design" />
<meta property="og:description" content="FODC Proxy Development Design Overview The FODC Proxy is the central control plane and data aggregator for the First Occurrence Data Collection (FODC) infrastructure. It acts as a unified gateway that aggregates observability data from multiple FODC Agents (each co-located with a BanyanDB node) and exposes ecosystem-friendly interfaces to external systems such as Prometheus and other observability platforms.
The Proxy provides:
 Agent Management: Registration, health monitoring, and lifecycle management of FODC Agents Metrics Aggregation: Collects and aggregates metrics from all agents with enriched metadata Cluster Topology: Maintains an up-to-date view of cluster topology, roles, and node states Configuration Collection: Aggregates and exposes node configurations for consistency verification  Responsibilities FODC Proxy Core Responsibilities" />
<meta property="og:type" content="article" />
<meta property="og:url" content="/docs/skywalking-banyandb/next/design/fodc/proxy/" />

<meta itemprop="name" content="FODC Proxy Development Design">
<meta itemprop="description" content="FODC Proxy Development Design Overview The FODC Proxy is the central control plane and data aggregator for the First Occurrence Data Collection (FODC) infrastructure. It acts as a unified gateway that aggregates observability data from multiple FODC Agents (each co-located with a BanyanDB node) and exposes ecosystem-friendly interfaces to external systems such as Prometheus and other observability platforms.
The Proxy provides:
 Agent Management: Registration, health monitoring, and lifecycle management of FODC Agents Metrics Aggregation: Collects and aggregates metrics from all agents with enriched metadata Cluster Topology: Maintains an up-to-date view of cluster topology, roles, and node states Configuration Collection: Aggregates and exposes node configurations for consistency verification  Responsibilities FODC Proxy Core Responsibilities">

<meta itemprop="wordCount" content="4219">



<meta itemprop="keywords" content="" />
<meta name="twitter:card" content="summary"/>
<meta name="twitter:title" content="FODC Proxy Development Design"/>
<meta name="twitter:description" content="FODC Proxy Development Design Overview The FODC Proxy is the central control plane and data aggregator for the First Occurrence Data Collection (FODC) infrastructure. It acts as a unified gateway that aggregates observability data from multiple FODC Agents (each co-located with a BanyanDB node) and exposes ecosystem-friendly interfaces to external systems such as Prometheus and other observability platforms.
The Proxy provides:
 Agent Management: Registration, health monitoring, and lifecycle management of FODC Agents Metrics Aggregation: Collects and aggregates metrics from all agents with enriched metadata Cluster Topology: Maintains an up-to-date view of cluster topology, roles, and node states Configuration Collection: Aggregates and exposes node configurations for consistency verification  Responsibilities FODC Proxy Core Responsibilities"/>



<link rel="preload" href="/scss/main.min.87646025889dabea717b27775dce3ff0338fa9fca8fd9c6b316d56f659f4142c.css" as="style">
<link href="/scss/main.min.87646025889dabea717b27775dce3ff0338fa9fca8fd9c6b316d56f659f4142c.css" rel="stylesheet" integrity="">



<link rel="stylesheet" href="/css/docSearch.css" />
<link rel="stylesheet" href="/css/highlight-github.css" />


<script src="/js/jquery-3.6.0.min.js"></script>





    <title>FODC Proxy Development Design | Apache SkyWalking</title>
  </head>
  <body class="td-page  project-doc">
    <header>
      
<nav class="js-navbar-scroll navbar navbar-expand  flex-column flex-md-row td-navbar">
    <div class="sidebar-button">
      <i class="iconfont icon-menu"></i>
    </div>
    <a class="navbar-brand" href="/">
        <span class="navbar-logo"><img width="130" src="/images/logo.svg" alt="SkyWalking"></span> 
    </a>
    <div class="td-navbar-nav-scroll navbar-nav-wrapper" id="navigation">
        <ul class="navbar-nav mt-lg-0">
             
            
            
            <li class="nav-item mr-3 mb-lg-0">
				
				
				
				
				<a class="nav-link" href="/docs" ><span>Projects and Docs</span></a>
			</li>
            
            
            
            
            <li class="nav-item mr-3 mb-lg-0">
				
				
				
				
				<a class="nav-link" href="/events" ><span>Events</span></a>
			</li>
            
            
            
            
            <li class="nav-item mr-3 mb-lg-0">
				
				
				
				
				<a class="nav-link" href="/blog" ><span>Blogs</span></a>
			</li>
            
            
            
            
            <li class="nav-item mr-3 mb-lg-0">
				
				
				
				
				<a class="nav-link" href="/downloads" ><span>Downloads</span></a>
			</li>
            
            
            
            
            <li class="nav-item mr-3 mb-lg-0">
				
				
				
				
				<a class="nav-link" href="/team" ><span>Team</span></a>
			</li>
            
            
            
            
            <li class="nav-item mr-3 mb-lg-0">
				
				
				
				
				<a class="nav-link" href="/users" ><span>Users</span></a>
			</li>
            
            
            
            
            
            <li class="nav-item mr-3 mb-lg-0">
                <span class="link dropdown blog">
                    <a class="link-name nav-link dropdown-toggle" href="#" role="button" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">中文资料</a>
                    <div class="dropdown-menu">
                        <a class="dropdown-item" href="/zh/">博客</a>
                        <a class="dropdown-item" href="https://space.bilibili.com/390683219" target="_blank" rel="noopener noreferrer">
                            B站
                        </a>
                        <a class="dropdown-item" href="https://juejin.cn/user/13673577331607" target="_blank" rel="noopener noreferrer">
                            掘金
                        </a>
                    </div>
                </span>
            </li>

            
			
        </ul>
    </div>
    <div class="navbar-nav d-none d-lg-block search-input-box">
         
            
        
            
        
            
        
            
        
            
        
            
        
            
            <span class="link dropdown">
                <a class="link-name dropdown-toggle" href="#" role="button" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
                    Links
                </a>
                <div class="dropdown-menu">
                    
                    <a class="dropdown-item" href="http://www.apache.org/">Apache Software Foundation</a> 
                    <a class="dropdown-item" href="https://github.com/apache/skywalking/issues">GitHub Issue Tracker</a> 
                    <a class="dropdown-item" href="https://github.com/apache/skywalking/discussions">Discussion</a> 
                    <a class="dropdown-item" href="https://lists.apache.org/list.html?dev@skywalking.apache.org">Dev Mailing List</a> 
                    <a class="dropdown-item" href="https://cwiki.apache.org/confluence/display/SKYWALKING/Home">WIKI</a> 
                    <a class="dropdown-item" href="http://www.apache.org/licenses/">License</a> 
                    <a class="dropdown-item" href="http://www.apache.org/events/current-event">Apache Events</a> 
                    <a class="dropdown-item" href="http://www.apache.org/security/">Security</a> 
                    <a class="dropdown-item" href="http://www.apache.org/foundation/sponsorship.html">Sponsor and Donate</a> 
                    <a class="dropdown-item" href="http://www.apache.org/foundation/thanks.html">Thanks</a> 
                    <a class="dropdown-item" href="https://apache.org/foundation/policies/privacy.html">Privacy</a> 
                </div>
            </span>
            
        
        
<div id="docsearch"></div>


    </div>
</nav>

    </header>
    <div class="container-fluid td-outer">

      <div class="td-main">
        <div class="row flex-xl-nowrap">
          <div class="col-12 col-md-3 col-xl-2 d-print-none scroll-bar td-sidebar">










































                  <div class="description-wrapper">
                    <h5>
                    <img width="26" height="26" src="/images/project/banyan-db.svg">
                    BanyanDB
                    </h5>
                    <p>An observability database aims to ingest, analyze and store Metrics, Tracing and Logging data.</p>
                  </div>
                  
                  <div class="version-wrapper">Version: 
                  <select class="version-select">
                  
                    
                    
                    <option selected value="next">
                    
                      next
                    
                    </option>
                  
                    
                    
                    <option ZgotmplZ value="latest">
                    
                      latest
                    
                    </option>
                  
                    
                    
                    <option ZgotmplZ value="v0.9.0">
                    
                      v0.9.0
                    
                    </option>
                  
                  </select>
                  </div>
                  
                  <ul class="sidebar-menu">
    
    <li>
        
            <a href="/docs/skywalking-banyandb/next/readme">Welcome</a>
        
    </li>
    
    <li>
        
            
            <a href="#">User Guide<i class="iconfont icon-arrow-right pull-right"></i></a>
            

            
<ul class="sidebar-submenu">
    

    <li>
        

            
            <a href="#">Installation<i class="iconfont icon-arrow-right pull-right"></i></a>
            

            
<ul class="sidebar-submenu">
    

    <li>
        
            <a href="/docs/skywalking-banyandb/next/installation/binaries">Get Binaries</a>
        
    </li>

    

    <li>
        
            <a href="/docs/skywalking-banyandb/next/installation/standalone">Standalone Mode</a>
        
    </li>

    

    <li>
        
            <a href="/docs/skywalking-banyandb/next/installation/cluster">Cluster Mode</a>
        
    </li>

    

    <li>
        
            <a href="/docs/skywalking-banyandb/next/installation/docker">Installation On Docker</a>
        
    </li>

    

    <li>
        
            <a href="/docs/skywalking-banyandb/next/installation/kubernetes">Installation On Kubernetes</a>
        
    </li>

    

</ul>

        
    </li>

    

    <li>
        

            
            <a href="#">Basic Concepts and Terminology<i class="iconfont icon-arrow-right pull-right"></i></a>
            

            
<ul class="sidebar-submenu">
    

    <li>
        
            <a href="/docs/skywalking-banyandb/next/concept/data-model">Data Model</a>
        
    </li>

    

</ul>

        
    </li>

    

    <li>
        
            <a href="/docs/skywalking-banyandb/next/guides/quick-start/quick-start">Quick Start Tutorial</a>
        
    </li>

    

    <li>
        
            <a href="/docs/skywalking-banyandb/next/installation/versions">Versions and Compatibility</a>
        
    </li>

    

</ul>

        
    </li>
    
    <li>
        
            
            <a href="#">Interacting<i class="iconfont icon-arrow-right pull-right"></i></a>
            

            
<ul class="sidebar-submenu">
    

    <li>
        

            
            <a href="#">CLI<i class="iconfont icon-arrow-right pull-right"></i></a>
            

            
<ul class="sidebar-submenu">
    

    <li>
        
            <a href="/docs/skywalking-banyandb/next/interacting/bydbctl/bydbctl">bydbctl</a>
        
    </li>

    

    <li>
        

            
            <a href="#">CRUD Schema<i class="iconfont icon-arrow-right pull-right"></i></a>
            

            
<ul class="sidebar-submenu">
    

    <li>
        
            <a href="/docs/skywalking-banyandb/next/interacting/bydbctl/schema/group">Group</a>
        
    </li>

    

    <li>
        
            <a href="/docs/skywalking-banyandb/next/interacting/bydbctl/schema/measure">Measure</a>
        
    </li>

    

    <li>
        
            <a href="/docs/skywalking-banyandb/next/interacting/bydbctl/schema/stream">Stream</a>
        
    </li>

    

    <li>
        
            <a href="/docs/skywalking-banyandb/next/interacting/bydbctl/schema/index-rule">IndexRule</a>
        
    </li>

    

    <li>
        
            <a href="/docs/skywalking-banyandb/next/interacting/bydbctl/schema/index-rule-binding">IndexRuleBinding</a>
        
    </li>

    

    <li>
        
            <a href="/docs/skywalking-banyandb/next/interacting/bydbctl/schema/top-n-aggregation">Top N Aggregation</a>
        
    </li>

    

</ul>

        
    </li>

    

    <li>
        

            
            <a href="#">Querying Data<i class="iconfont icon-arrow-right pull-right"></i></a>
            

            
<ul class="sidebar-submenu">
    

    <li>
        
            <a href="/docs/skywalking-banyandb/next/interacting/bydbctl/query/measure">Measure</a>
        
    </li>

    

    <li>
        
            <a href="/docs/skywalking-banyandb/next/interacting/bydbctl/query/stream">Stream</a>
        
    </li>

    

    <li>
        
            <a href="/docs/skywalking-banyandb/next/interacting/bydbctl/query/filter-operation">Filter Operation</a>
        
    </li>

    

    <li>
        
            <a href="/docs/skywalking-banyandb/next/interacting/bydbctl/query/top-n-aggregation">Top N Aggregation</a>
        
    </li>

    

</ul>

        
    </li>

    

    <li>
        
            <a href="/docs/skywalking-banyandb/next/interacting/bydbctl/property">CRUD Property</a>
        
    </li>

    

    <li>
        
            <a href="/docs/skywalking-banyandb/next/interacting/bydbctl/analyze">Analyzing Data</a>
        
    </li>

    

</ul>

        
    </li>

    

    <li>
        

            
            <a href="#">Web UI<i class="iconfont icon-arrow-right pull-right"></i></a>
            

            
<ul class="sidebar-submenu">
    

    <li>
        
            <a href="/docs/skywalking-banyandb/next/interacting/web-ui/dashboard">Dashboard</a>
        
    </li>

    

    <li>
        

            
            <a href="#">CRUD Schema<i class="iconfont icon-arrow-right pull-right"></i></a>
            

            
<ul class="sidebar-submenu">
    

    <li>
        
            <a href="/docs/skywalking-banyandb/next/interacting/web-ui/schema/group">Group</a>
        
    </li>

    

    <li>
        
            <a href="/docs/skywalking-banyandb/next/interacting/web-ui/schema/measure">Measure</a>
        
    </li>

    

    <li>
        
            <a href="/docs/skywalking-banyandb/next/interacting/web-ui/schema/stream">Stream</a>
        
    </li>

    

    <li>
        
            <a href="/docs/skywalking-banyandb/next/interacting/web-ui/schema/index-rule">IndexRule</a>
        
    </li>

    

    <li>
        
            <a href="/docs/skywalking-banyandb/next/interacting/web-ui/schema/index-rule-binding">IndexRuleBinding</a>
        
    </li>

    

    <li>
        
            <a href="/docs/skywalking-banyandb/next/interacting/web-ui/schema/top-n-aggregation">Top N Aggregation</a>
        
    </li>

    

</ul>

        
    </li>

    

    <li>
        

            
            <a href="#">Querying Data<i class="iconfont icon-arrow-right pull-right"></i></a>
            

            
<ul class="sidebar-submenu">
    

    <li>
        
            <a href="/docs/skywalking-banyandb/next/interacting/web-ui/query/measure">Measure</a>
        
    </li>

    

    <li>
        
            <a href="/docs/skywalking-banyandb/next/interacting/web-ui/query/stream">Stream</a>
        
    </li>

    

</ul>

        
    </li>

    

    <li>
        
            <a href="/docs/skywalking-banyandb/next/interacting/web-ui/property">CRUD Property</a>
        
    </li>

    

</ul>

        
    </li>

    

    <li>
        
            <a href="/docs/skywalking-banyandb/next/interacting/client">Client APIs</a>
        
    </li>

    

    <li>
        
            <a href="/docs/skywalking-banyandb/next/interacting/data-lifecycle">Data Lifecycle</a>
        
    </li>

    

    <li>
        
            <a href="/docs/skywalking-banyandb/next/interacting/bydbql">BydbQL</a>
        
    </li>

    

</ul>

        
    </li>
    
    <li>
        
            
            <a href="#">Operation and Maintenance<i class="iconfont icon-arrow-right pull-right"></i></a>
            

            
<ul class="sidebar-submenu">
    

    <li>
        
            <a href="/docs/skywalking-banyandb/next/operation/configuration">Configure BanyanDB</a>
        
    </li>

    

    <li>
        
            <a href="/docs/skywalking-banyandb/next/operation/disk-management">Disk Management</a>
        
    </li>

    

    <li>
        
            <a href="/docs/skywalking-banyandb/next/operation/system">System Configuration</a>
        
    </li>

    

    <li>
        
            <a href="/docs/skywalking-banyandb/next/operation/upgrade">Upgrade</a>
        
    </li>

    

    <li>
        
            <a href="/docs/skywalking-banyandb/next/operation/observability">Observability</a>
        
    </li>

    

    <li>
        
            <a href="/docs/skywalking-banyandb/next/operation/cluster">Cluster Management</a>
        
    </li>

    

    <li>
        

            
            <a href="#">Troubleshooting<i class="iconfont icon-arrow-right pull-right"></i></a>
            

            
<ul class="sidebar-submenu">
    

    <li>
        
            <a href="/docs/skywalking-banyandb/next/operation/troubleshooting/error-checklist">Error Checklist</a>
        
    </li>

    

    <li>
        
            <a href="/docs/skywalking-banyandb/next/operation/troubleshooting/install">Troubleshooting Installation</a>
        
    </li>

    

    <li>
        
            <a href="/docs/skywalking-banyandb/next/operation/troubleshooting/crash">Troubleshooting Crash</a>
        
    </li>

    

    <li>
        
            <a href="/docs/skywalking-banyandb/next/operation/troubleshooting/no-data">Troubleshooting No Data</a>
        
    </li>

    

    <li>
        
            <a href="/docs/skywalking-banyandb/next/operation/troubleshooting/overhead">Troubleshooting Overhead</a>
        
    </li>

    

    <li>
        
            <a href="/docs/skywalking-banyandb/next/operation/troubleshooting/query">Troubleshooting Query</a>
        
    </li>

    

</ul>

        
    </li>

    

    <li>
        
            <a href="/docs/skywalking-banyandb/next/operation/security">Security</a>
        
    </li>

    

    <li>
        
            <a href="/docs/skywalking-banyandb/next/operation/backup">Backup</a>
        
    </li>

    

    <li>
        
            <a href="/docs/skywalking-banyandb/next/operation/restore">Restore</a>
        
    </li>

    

    <li>
        
            <a href="/docs/skywalking-banyandb/next/operation/lifecycle">Lifecycle Management</a>
        
    </li>

    

    <li>
        

            
            <a href="#">MCP Server<i class="iconfont icon-arrow-right pull-right"></i></a>
            

            
<ul class="sidebar-submenu">
    

    <li>
        
            <a href="/docs/skywalking-banyandb/next/operation/mcp/setup">Setup MCP</a>
        
    </li>

    

    <li>
        
            <a href="/docs/skywalking-banyandb/next/operation/mcp/inspector">Test via Inspector</a>
        
    </li>

    

    <li>
        
            <a href="/docs/skywalking-banyandb/next/operation/mcp/build">Build and Package</a>
        
    </li>

    

</ul>

        
    </li>

    

    <li>
        

            
            <a href="#">First Occurrence Data Collection (FODC)<i class="iconfont icon-arrow-right pull-right"></i></a>
            

            
<ul class="sidebar-submenu">
    

    <li>
        
            <a href="/docs/skywalking-banyandb/next/operation/fodc/overview">Overview</a>
        
    </li>

    

    <li>
        
            <a href="/docs/skywalking-banyandb/next/operation/fodc/ktm_metrics">KTM Metrics</a>
        
    </li>

    

</ul>

        
    </li>

    

    <li>
        
            <a href="/docs/skywalking-banyandb/next/concept/property-repair">Property Background Repair</a>
        
    </li>

    

    <li>
        

            
            <a href="#">Benchmark<i class="iconfont icon-arrow-right pull-right"></i></a>
            

            
<ul class="sidebar-submenu">
    

    <li>
        
            <a href="/docs/skywalking-banyandb/next/operation/benchmark/benchmark-single-model">Single‑Model Benchmark (Trace / Log / Measure / Property)</a>
        
    </li>

    

    <li>
        
            <a href="/docs/skywalking-banyandb/next/operation/benchmark/benchmark-hybrid">Hybrid Scenario Benchmark</a>
        
    </li>

    

</ul>

        
    </li>

    

</ul>

        
    </li>
    
    <li>
        
            
            <a href="#">File Format<i class="iconfont icon-arrow-right pull-right"></i></a>
            

            
<ul class="sidebar-submenu">
    

    <li>
        
            <a href="/docs/skywalking-banyandb/next/concept/tsdb">v1.3.0</a>
        
    </li>

    

</ul>

        
    </li>
    
    <li>
        
            
            <a href="#">Concepts<i class="iconfont icon-arrow-right pull-right"></i></a>
            

            
<ul class="sidebar-submenu">
    

    <li>
        
            <a href="/docs/skywalking-banyandb/next/concept/clustering">Clustering</a>
        
    </li>

    

    <li>
        
            <a href="/docs/skywalking-banyandb/next/concept/tsdb">TSDB</a>
        
    </li>

    

    <li>
        
            <a href="/docs/skywalking-banyandb/next/concept/rotation">Data Rotation</a>
        
    </li>

    

    <li>
        
            <a href="/docs/skywalking-banyandb/next/concept/property-repair">Property Background Repair</a>
        
    </li>

    

</ul>

        
    </li>
    
    <li>
        
            
            <a href="#">Contribute<i class="iconfont icon-arrow-right pull-right"></i></a>
            

            
<ul class="sidebar-submenu">
    

    <li>
        
            <a href="/docs/skywalking-banyandb/next/contribute/debugging">Debugging</a>
        
    </li>

    

</ul>

        
    </li>
    
</ul>
<script src="/js/sidebar-menu.js"></script>
<script>
  (function (){
    $.sidebarMenu($('.sidebar-menu'))
    var path = window.location.pathname;
    var hash = window.location.hash;
    var $a = $('.sidebar-menu a')
    $a.each(function (e){
      if($(this).attr('href')+'/' === path || $(this).attr('href').replace('#','/#') === path+hash){
        $(this).parents('li').addClass('active').show()
      }
    })
    $a.on('click',function (){
      var url = $(this).attr('href')
      if(url!=='#'){
        window.location.href = url
      }
    })
  })()
</script>

                  <div class="commit-id">Commit Id: ff23851</div>
                






</div>
            <main class="col-12 col-md-9 col-xl-8 pl-md-5 pr-md-4" role="main">
              <i class="iconfont icon-menu-doc doc-menu-button"></i>
              
<div class="td-content">
	<h1 id="fodc-proxy-development-design">FODC Proxy Development Design</h1>
<h2 id="overview">Overview</h2>
<p>The FODC Proxy is the central control plane and data aggregator for the First Occurrence Data Collection (FODC) infrastructure. It acts as a unified gateway that aggregates observability data from multiple FODC Agents (each co-located with a BanyanDB node) and exposes ecosystem-friendly interfaces to external systems such as Prometheus and other observability platforms.</p>
<p>The Proxy provides:</p>
<ol>
<li><strong>Agent Management</strong>: Registration, health monitoring, and lifecycle management of FODC Agents</li>
<li><strong>Metrics Aggregation</strong>: Collects and aggregates metrics from all agents with enriched metadata</li>
<li><strong>Cluster Topology</strong>: Maintains an up-to-date view of cluster topology, roles, and node states</li>
<li><strong>Configuration Collection</strong>: Aggregates and exposes node configurations for consistency verification</li>
</ol>
<h3 id="responsibilities">Responsibilities</h3>
<p><strong>FODC Proxy Core Responsibilities</strong></p>
<ul>
<li>Accept bi-directional gRPC connections from FODC Agents</li>
<li>Register and track agent lifecycle (online/offline, heartbeat monitoring)</li>
<li>Aggregate metrics from all agents with node metadata enrichment</li>
<li>Maintain cluster topology view based on agent registrations</li>
<li>Collect and expose node configurations for audit and consistency checks</li>
<li>Expose unified REST/Prometheus-style interfaces for external consumption</li>
<li>Provide proxy-level metrics (health, agent count, RPC latency, etc.)</li>
</ul>
<h2 id="component-design">Component Design</h2>
<h3 id="1-proxy-components">1. Proxy Components</h3>
<h4 id="11-agent-registry-component">1.1 Agent Registry Component</h4>
<p><strong>Purpose</strong>: Manages the lifecycle and state of all connected FODC Agents</p>
<h5 id="core-responsibilities">Core Responsibilities</h5>
<ul>
<li><strong>Agent Registration</strong>: Accepts agent registration requests via gRPC</li>
<li><strong>Health Monitoring</strong>: Tracks agent heartbeat and connection status</li>
<li><strong>State Management</strong>: Maintains agent state (online/offline, last heartbeat time)</li>
<li><strong>Topology Building</strong>: Aggregates agent registrations into cluster topology view</li>
<li><strong>Connection Management</strong>: Handles connection failures, reconnections, and cleanup</li>
</ul>
<h5 id="core-types">Core Types</h5>
<p><strong><code>AgentInfo</code></strong></p>
<div class="highlight"><pre style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-go" data-lang="go"><span style="color:#000;font-weight:bold">type</span> AgentInfo <span style="color:#000;font-weight:bold">struct</span> {
	AgentID           <span style="color:#458;font-weight:bold">string</span>                    <span style="color:#998;font-style:italic">// Unique agent identifier (UUID, used as registry key)
</span><span style="color:#998;font-style:italic"></span>	AgentIdentity     AgentIdentity              <span style="color:#998;font-style:italic">// Agent identity (IP+port+role+labels)
</span><span style="color:#998;font-style:italic"></span>	NodeRole          databasev1.Role          <span style="color:#998;font-style:italic">// Node role (liaison, datanode-hot, etc.)
</span><span style="color:#998;font-style:italic"></span>	PrimaryAddress    Address                  <span style="color:#998;font-style:italic">// Primary agent gRPC address
</span><span style="color:#998;font-style:italic"></span>	SecondaryAddresses <span style="color:#000;font-weight:bold">map</span>[<span style="color:#458;font-weight:bold">string</span>]Address      <span style="color:#998;font-style:italic">// Secondary addresses with names (e.g., &#34;metrics&#34;: Address, &#34;gossip&#34;: Address)
</span><span style="color:#998;font-style:italic"></span>	Labels            <span style="color:#000;font-weight:bold">map</span>[<span style="color:#458;font-weight:bold">string</span>]<span style="color:#458;font-weight:bold">string</span>        <span style="color:#998;font-style:italic">// Node labels/metadata
</span><span style="color:#998;font-style:italic"></span>	RegisteredAt      time.Time                <span style="color:#998;font-style:italic">// Registration timestamp
</span><span style="color:#998;font-style:italic"></span>	LastHeartbeat     time.Time               <span style="color:#998;font-style:italic">// Last heartbeat timestamp
</span><span style="color:#998;font-style:italic"></span>	Status            AgentStatus               <span style="color:#998;font-style:italic">// Current agent status
</span><span style="color:#998;font-style:italic"></span>}

<span style="color:#000;font-weight:bold">type</span> Address <span style="color:#000;font-weight:bold">struct</span> {
	IP   <span style="color:#458;font-weight:bold">string</span>
	Port <span style="color:#458;font-weight:bold">int</span>
}

<span style="color:#000;font-weight:bold">type</span> AgentStatus <span style="color:#458;font-weight:bold">string</span>

<span style="color:#000;font-weight:bold">const</span> (
	AgentStatusOnline  AgentStatus = <span style="color:#d14">&#34;online&#34;</span>
	AgentStatusOffline AgentStatus = <span style="color:#d14">&#34;unconnected&#34;</span>
)
</code></pre></div><p><strong><code>AgentRegistry</code></strong></p>
<div class="highlight"><pre style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-go" data-lang="go"><span style="color:#000;font-weight:bold">type</span> AgentRegistry <span style="color:#000;font-weight:bold">struct</span> {
	agents    <span style="color:#000;font-weight:bold">map</span>[<span style="color:#458;font-weight:bold">string</span>]<span style="color:#000;font-weight:bold">*</span>AgentInfo      <span style="color:#998;font-style:italic">// Map from unique agent ID to agent info
</span><span style="color:#998;font-style:italic"></span>	mu        sync.RWMutex               <span style="color:#998;font-style:italic">// Protects agents map
</span><span style="color:#998;font-style:italic"></span>	logger    <span style="color:#000;font-weight:bold">*</span>logger.Logger
	heartbeatTimeout time.Duration       <span style="color:#998;font-style:italic">// Timeout for considering agent offline
</span><span style="color:#998;font-style:italic"></span>}

<span style="color:#000;font-weight:bold">type</span> AgentIdentity <span style="color:#000;font-weight:bold">struct</span> {
	IP     <span style="color:#458;font-weight:bold">string</span>                 <span style="color:#998;font-style:italic">// Primary IP address
</span><span style="color:#998;font-style:italic"></span>	Port   <span style="color:#458;font-weight:bold">int</span>                    <span style="color:#998;font-style:italic">// Primary port
</span><span style="color:#998;font-style:italic"></span>	Role   databasev1.Role       <span style="color:#998;font-style:italic">// Node role
</span><span style="color:#998;font-style:italic"></span>	Labels <span style="color:#000;font-weight:bold">map</span>[<span style="color:#458;font-weight:bold">string</span>]<span style="color:#458;font-weight:bold">string</span>      <span style="color:#998;font-style:italic">// Node labels (used for lookup and identification)
</span><span style="color:#998;font-style:italic"></span>}
</code></pre></div><h5 id="key-functions">Key Functions</h5>
<p><strong><code>RegisterAgent(ctx context.Context, info *AgentInfo) (string, error)</code></strong></p>
<ul>
<li>Registers a new agent or updates existing agent information</li>
<li>Generates unique agent ID (UUID) for the agent</li>
<li>Creates AgentIdentity from primary IP + port + role + labels and stores in AgentInfo</li>
<li>Uses unique agent ID as the map key</li>
<li>Validates primary address and role</li>
<li>Updates topology view</li>
<li>Returns agent ID and error if registration fails</li>
</ul>
<p><strong><code>UnregisterAgent(agentID string) error</code></strong></p>
<ul>
<li>Removes agent from registry using unique agent ID</li>
<li>Cleans up associated resources</li>
<li>Updates topology view</li>
<li>Called in the following scenarios:
<ul>
<li>When agent&rsquo;s registration stream closes (connection lost)</li>
<li>When agent&rsquo;s all streams are closed and connection is terminated</li>
<li>When agent has been offline longer than <code>--agent-cleanup-timeout</code> (detected by heartbeat health check)</li>
<li>During graceful shutdown or manual agent removal</li>
<li>When agent explicitly requests unregistration via stream</li>
</ul>
</li>
</ul>
<p><strong><code>UpdateHeartbeat(agentID string) error</code></strong></p>
<ul>
<li>Updates last heartbeat timestamp for agent using unique agent ID</li>
<li>Marks agent as online if it was offline</li>
<li>Returns error if agent not found</li>
</ul>
<p><strong><code>GetAgent(ip string, port int, role databasev1.Role, labels map[string]string) (*AgentInfo, error)</code></strong></p>
<ul>
<li>Retrieves agent information by primary IP + port + role + labels</li>
<li>Creates AgentIdentity from the provided parameters</li>
<li>Searches through agents map to find matching AgentIdentity</li>
<li>Returns error if agent not found</li>
</ul>
<p><strong><code>GetAgentByID(agentID string) (*AgentInfo, error)</code></strong></p>
<ul>
<li>Retrieves agent information by unique agent ID</li>
<li>Direct lookup in agents map</li>
<li>Returns error if agent not found</li>
</ul>
<p><strong><code>ListAgents() []*AgentInfo</code></strong></p>
<ul>
<li>Returns list of all registered agents</li>
<li>Thread-safe read operation</li>
</ul>
<p><strong><code>ListAgentsByRole(role databasev1.Role) []*AgentInfo</code></strong></p>
<ul>
<li>Returns agents filtered by role</li>
<li>Useful for role-specific operations</li>
</ul>
<p><strong><code>CheckAgentHealth() error</code></strong></p>
<ul>
<li>Periodically checks agent health based on heartbeat timeout</li>
<li>Marks agents as offline if heartbeat timeout exceeded</li>
<li>Continuously runs heartbeat health checks regardless of cleanup timeout</li>
<li>Unregisters agents that have been offline longer than <code>--agent-cleanup-timeout</code></li>
<li>Agents that cannot maintain connection will be removed after the cleanup timeout period</li>
<li>Returns aggregated health status</li>
</ul>
<h5 id="configuration-flags">Configuration Flags</h5>
<p><strong><code>--agent-heartbeat-timeout</code></strong></p>
<ul>
<li><strong>Type</strong>: <code>duration</code></li>
<li><strong>Default</strong>: <code>30s</code></li>
<li><strong>Description</strong>: Timeout for considering an agent offline if no heartbeat received</li>
</ul>
<p><strong><code>--max-agents</code></strong></p>
<ul>
<li><strong>Type</strong>: <code>int</code></li>
<li><strong>Default</strong>: <code>1000</code></li>
<li><strong>Description</strong>: Maximum number of agents that can be registered</li>
</ul>
<p><strong><code>--agent-cleanup-timeout</code></strong></p>
<ul>
<li><strong>Type</strong>: <code>duration</code></li>
<li><strong>Default</strong>: <code>5m</code></li>
<li><strong>Minimum</strong>: Must be greater than <code>--agent-heartbeat-timeout</code></li>
<li><strong>Description</strong>: Timeout for automatically unregistering agents that have been offline. Agents that cannot maintain connection will be removed after being offline longer than this timeout. The heartbeat health check continues running regardless of this timeout. This timeout must be greater than <code>--agent-heartbeat-timeout</code> to allow for proper health checking.</li>
</ul>
<h4 id="12-grpc-server-component">1.2 gRPC Server Component</h4>
<p><strong>Purpose</strong>: Handles bi-directional gRPC communication with FODC Agents</p>
<h5 id="core-responsibilities-1">Core Responsibilities</h5>
<ul>
<li><strong>Agent Connection Handling</strong>: Accepts and manages gRPC connections from agents</li>
<li><strong>Streaming Support</strong>: Supports bi-directional streaming for metrics</li>
<li><strong>Protocol Implementation</strong>: Implements FODC gRPC service protocol</li>
<li><strong>Connection Lifecycle</strong>: Manages connection establishment, maintenance, and cleanup</li>
</ul>
<h5 id="core-types-1">Core Types</h5>
<p><strong><code>FODCService</code></strong> (gRPC Service Implementation)</p>
<div class="highlight"><pre style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-go" data-lang="go"><span style="color:#000;font-weight:bold">type</span> FODCService <span style="color:#000;font-weight:bold">struct</span> {
	registry        <span style="color:#000;font-weight:bold">*</span>AgentRegistry
	metricsAggregator <span style="color:#000;font-weight:bold">*</span>MetricsAggregator
	logger          <span style="color:#000;font-weight:bold">*</span>logger.Logger
}

<span style="color:#998;font-style:italic">// Example gRPC service methods (to be defined in proto)
</span><span style="color:#998;font-style:italic">// RegisterAgent(stream RegisterAgentRequest) (stream RegisterAgentResponse) error
</span><span style="color:#998;font-style:italic">// StreamMetrics(stream StreamMetricsRequest) (stream StreamMetricsResponse) error
</span></code></pre></div><p><strong><code>AgentConnection</code></strong></p>
<div class="highlight"><pre style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-go" data-lang="go"><span style="color:#000;font-weight:bold">type</span> AgentConnection <span style="color:#000;font-weight:bold">struct</span> {
	AgentID     <span style="color:#458;font-weight:bold">string</span>                <span style="color:#998;font-style:italic">// Unique agent ID for registry lookup
</span><span style="color:#998;font-style:italic"></span>	Identity    AgentIdentity         <span style="color:#998;font-style:italic">// Agent identity (IP+port+role+labels)
</span><span style="color:#998;font-style:italic"></span>	Stream      grpc.ServerStream
	Context     context.Context
	Cancel      context.CancelFunc
	LastActivity time.Time
}
</code></pre></div><h5 id="key-functions-1">Key Functions</h5>
<p><strong><code>RegisterAgent(stream FODCService_RegisterAgentServer) error</code></strong></p>
<ul>
<li>Handles bi-directional agent registration stream</li>
<li>Receives registration requests from agent (includes primary address, role, labels)</li>
<li>Creates AgentIdentity from primary IP + port + role + labels</li>
<li>Validates registration information</li>
<li>Registers agent with AgentRegistry (generates unique agent ID)</li>
<li>Stores AgentIdentity in AgentInfo for lookup and identification purposes</li>
<li>Sends registration responses</li>
<li>Maintains stream for heartbeat and re-registration</li>
</ul>
<p><strong><code>StreamMetrics(stream FODCService_StreamMetricsServer) error</code></strong></p>
<ul>
<li>Handles bi-directional metrics streaming</li>
<li>Sends metrics requests from Proxy to agent (on-demand collection)</li>
<li>Receives metrics from agent at Proxy in response to requests</li>
<li>Proxy initiates by sending a metrics request via StreamMetricsResponse when an external client queries metrics</li>
<li>Agent responds with StreamMetricsRequest containing the collected metrics</li>
<li>Manages stream lifecycle</li>
</ul>
<h5 id="connection-lifecycle-management">Connection Lifecycle Management</h5>
<p><strong>Stream Closure Handling</strong></p>
<ul>
<li>When a stream closes (due to network error, agent shutdown, or timeout), the gRPC server should:
<ol>
<li>Detect stream closure via context cancellation or stream error</li>
<li>Extract unique agent ID from the connection</li>
<li>Check if this is the last active stream for the agent</li>
<li>If all streams are closed, call <code>AgentRegistry.UnregisterAgent(agentID)</code> to clean up</li>
<li>Update topology to reflect agent offline status</li>
</ol>
</li>
</ul>
<p><strong>Graceful vs. Ungraceful Disconnection</strong></p>
<ul>
<li><strong>Graceful</strong>: Agent sends explicit disconnect message before closing stream → immediate unregistration</li>
<li><strong>Ungraceful</strong>: Stream closes unexpectedly → unregistration happens after detecting all streams closed</li>
<li><strong>Heartbeat Timeout</strong>: Agent marked offline by <code>CheckAgentHealth()</code> → unregistration occurs after being offline longer than <code>--agent-cleanup-timeout</code>. Heartbeat health checks continue running regardless.</li>
</ul>
<h5 id="configuration-flags-1">Configuration Flags</h5>
<p><strong><code>--grpc-listen-addr</code></strong></p>
<ul>
<li><strong>Type</strong>: <code>string</code></li>
<li><strong>Default</strong>: <code>:17900</code></li>
<li><strong>Description</strong>: gRPC server address where the Proxy listens for agent connections</li>
</ul>
<p><strong><code>--grpc-max-msg-size</code></strong></p>
<ul>
<li><strong>Type</strong>: <code>int</code></li>
<li><strong>Default</strong>: <code>4194304</code> (4MB)</li>
<li><strong>Description</strong>: Maximum message size for gRPC messages</li>
</ul>
<h4 id="13-metrics-aggregator-component">1.3 Metrics Aggregator Component</h4>
<p><strong>Purpose</strong>: Aggregates and enriches metrics from all agents</p>
<h5 id="core-responsibilities-2">Core Responsibilities</h5>
<ul>
<li><strong>On-Demand Metrics Collection</strong>: Requests metrics from agents via gRPC streams when external clients query metrics</li>
<li><strong>Metrics Request Coordination</strong>: Coordinates metrics requests to multiple agents concurrently</li>
<li><strong>Metadata Enrichment</strong>: Adds node metadata (role, agent ID, labels) to metrics</li>
<li><strong>Normalization</strong>: Normalizes metric formats and labels across agents</li>
<li><strong>Time Window Filtering</strong>: Filters metrics by time window when requested by external clients (agents filter based on Flight Recorder data)</li>
</ul>
<h5 id="core-types-2">Core Types</h5>
<p><strong><code>AggregatedMetric</code></strong></p>
<div class="highlight"><pre style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-go" data-lang="go"><span style="color:#000;font-weight:bold">type</span> AggregatedMetric <span style="color:#000;font-weight:bold">struct</span> {
	Name        <span style="color:#458;font-weight:bold">string</span>                 <span style="color:#998;font-style:italic">// Metric name
</span><span style="color:#998;font-style:italic"></span>	Labels      <span style="color:#000;font-weight:bold">map</span>[<span style="color:#458;font-weight:bold">string</span>]<span style="color:#458;font-weight:bold">string</span>      <span style="color:#998;font-style:italic">// Metric labels (including node metadata)
</span><span style="color:#998;font-style:italic"></span>	Value       <span style="color:#458;font-weight:bold">float64</span>                <span style="color:#998;font-style:italic">// Metric value
</span><span style="color:#998;font-style:italic"></span>	Timestamp   time.Time              <span style="color:#998;font-style:italic">// Metric timestamp
</span><span style="color:#998;font-style:italic"></span>	AgentID     <span style="color:#458;font-weight:bold">string</span>                 <span style="color:#998;font-style:italic">// Source agent ID
</span><span style="color:#998;font-style:italic"></span>	NodeRole    databasev1.Role       <span style="color:#998;font-style:italic">// Source node role
</span><span style="color:#998;font-style:italic"></span>	Description <span style="color:#458;font-weight:bold">string</span>                 <span style="color:#998;font-style:italic">// Metric description/HELP text
</span><span style="color:#998;font-style:italic"></span>}
</code></pre></div><p><strong><code>MetricsAggregator</code></strong></p>
<div class="highlight"><pre style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-go" data-lang="go"><span style="color:#000;font-weight:bold">type</span> MetricsAggregator <span style="color:#000;font-weight:bold">struct</span> {
	registry      <span style="color:#000;font-weight:bold">*</span>AgentRegistry
	grpcService   <span style="color:#000;font-weight:bold">*</span>FODCService        <span style="color:#998;font-style:italic">// For requesting metrics from agents
</span><span style="color:#998;font-style:italic"></span>	mu            sync.RWMutex
	logger        <span style="color:#000;font-weight:bold">*</span>logger.Logger
}

<span style="color:#000;font-weight:bold">type</span> MetricsFilter <span style="color:#000;font-weight:bold">struct</span> {
	AgentIDs []<span style="color:#458;font-weight:bold">string</span>              <span style="color:#998;font-style:italic">// Filter by specific agent IDs (empty = all agents)
</span><span style="color:#998;font-style:italic"></span>	Role    databasev1.Role       <span style="color:#998;font-style:italic">// Filter by node role (optional)
</span><span style="color:#998;font-style:italic"></span>	StartTime <span style="color:#000;font-weight:bold">*</span>time.Time          <span style="color:#998;font-style:italic">// Start time for time window (optional)
</span><span style="color:#998;font-style:italic"></span>	EndTime   <span style="color:#000;font-weight:bold">*</span>time.Time          <span style="color:#998;font-style:italic">// End time for time window (optional)
</span><span style="color:#998;font-style:italic"></span>}
</code></pre></div><h5 id="key-functions-2">Key Functions</h5>
<p><strong><code>CollectMetricsFromAgents(ctx context.Context, filter *MetricsFilter) ([]*AggregatedMetric, error)</code></strong></p>
<ul>
<li>Requests metrics from all agents (or filtered agents) when external client queries</li>
<li>Sends metrics request via StreamMetrics() to each agent with time window filter (if specified)</li>
<li>Agents retrieve metrics from Flight Recorder (in-memory storage) filtered by time window and respond</li>
<li>Waits for StreamMetricsRequest responses from agents (with timeout)</li>
<li>Identifies agent connection from stream context and looks up unique agent ID</li>
<li>Retrieves AgentInfo using agent ID</li>
<li>Enriches metrics with node metadata (IP, port, role, labels) from AgentInfo</li>
<li>Combines metrics from all agents into a single list</li>
<li>Returns aggregated metrics (not stored, only returned)</li>
<li>Returns error if collection fails</li>
</ul>
<p><strong><code>GetLatestMetrics(ctx context.Context) ([]*AggregatedMetric, error)</code></strong></p>
<ul>
<li>Triggers on-demand collection from all agents</li>
<li>Calls CollectMetricsFromAgents() with no time filter to get current metrics</li>
<li>Returns latest metrics from all agents</li>
<li>Used for <code>/metrics-windows</code> endpoint without time parameters</li>
<li>Returns error if collection fails</li>
</ul>
<p><strong><code>GetMetricsWindow(ctx context.Context, startTime, endTime time.Time, filter *MetricsFilter) ([]*AggregatedMetric, error)</code></strong></p>
<ul>
<li>Triggers on-demand collection from all agents</li>
<li>Calls CollectMetricsFromAgents() with time window filter</li>
<li>Agents filter metrics from Flight Recorder by the specified time range</li>
<li>Returns metrics within specified time range</li>
<li>Used for <code>/metrics-windows</code> endpoint with time parameters</li>
<li>Returns error if collection fails</li>
</ul>
<h5 id="configuration-flags-2">Configuration Flags</h5>
<p><em>Note: No configuration flags needed for MetricsAggregator since metrics are collected on-demand and not stored.</em></p>
<h4 id="14-httprest-api-server-component">1.4 HTTP/REST API Server Component</h4>
<p><strong>Purpose</strong>: Exposes REST and Prometheus-style endpoints for external consumption</p>
<h5 id="core-responsibilities-3">Core Responsibilities</h5>
<ul>
<li><strong>REST API</strong>: Implements REST endpoints for cluster topology and configuration</li>
<li><strong>Prometheus Integration</strong>: Exposes Prometheus-compatible metrics endpoints</li>
<li><strong>Request Handling</strong>: Handles HTTP requests and routes to appropriate handlers</li>
<li><strong>Response Formatting</strong>: Formats responses in appropriate formats (JSON, Prometheus text)</li>
</ul>
<h5 id="api-endpoints">API Endpoints</h5>
<p><strong><code>GET /metrics</code></strong></p>
<ul>
<li>Returns latest metrics from all agents (on-demand collection, not stored in Proxy)</li>
<li>Includes node metadata (role, agent ID, labels)</li>
<li>Format: Prometheus text format</li>
<li>Query parameters:
<ul>
<li><code>role</code> (optional): Filter by role (liaison, datanode-hot, etc.)</li>
<li><code>address</code> (optional): Filter by ip or ip:port</li>
</ul>
</li>
<li>Used by: Prometheus scrapers, monitoring systems</li>
</ul>
<p><strong><code>GET /metrics-windows</code></strong></p>
<ul>
<li>Returns metrics from all agents (on-demand collection, not stored in Proxy)</li>
<li>Includes node metadata (role, agent ID, labels)</li>
<li>Format: JSON</li>
<li>Query parameters:
<ul>
<li><code>start_time</code>: Start time for time window (optional) - filters metrics by start time (agents filter from Flight Recorder)</li>
<li><code>end_time</code>: End time for time window (optional) - filters metrics by end time (agents filter from Flight Recorder)</li>
<li><code>role</code>: Filter by node role (optional)</li>
<li><code>address</code> (optional): Filter by ip or ip:port</li>
</ul>
</li>
</ul>
<p><strong><code>GET /cluster</code></strong></p>
<ul>
<li>Returns cluster topology and node status</li>
<li>Format: JSON</li>
<li>Response includes:
<ul>
<li>List of all registered nodes</li>
<li>Agent identity (agent ID, address)</li>
<li>Node role</li>
<li>Node labels</li>
<li>Agent status (online/offline, last heartbeat)</li>
<li>Node relationships</li>
</ul>
</li>
<li>Note: Node information is obtained from agent registration data stored in AgentRegistry</li>
</ul>
<p><strong><code>GET /cluster/config</code></strong></p>
<ul>
<li>Returns node configurations</li>
<li>Format: JSON</li>
<li>Query parameters:
<ul>
<li><code>agent_id</code>: Filter by agent ID (optional)</li>
<li><code>role</code>: Filter by node role (optional)</li>
</ul>
</li>
</ul>
<p><strong><code>GET /health</code></strong></p>
<ul>
<li>Health check endpoint</li>
<li>Format: JSON</li>
<li>Returns proxy health status</li>
</ul>
<h5 id="core-types-3">Core Types</h5>
<p><strong><code>APIServer</code></strong></p>
<div class="highlight"><pre style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-go" data-lang="go"><span style="color:#000;font-weight:bold">type</span> APIServer <span style="color:#000;font-weight:bold">struct</span> {
	metricsAggregator   <span style="color:#000;font-weight:bold">*</span>MetricsAggregator
	server              <span style="color:#000;font-weight:bold">*</span>http.Server
	logger              <span style="color:#000;font-weight:bold">*</span>logger.Logger
}
</code></pre></div><h5 id="key-functions-3">Key Functions</h5>
<p><strong><code>Start(listenAddr string) error</code></strong></p>
<ul>
<li>Starts HTTP server</li>
<li>Registers all API endpoints</li>
<li>Returns error if start fails</li>
</ul>
<p><strong><code>Stop() error</code></strong></p>
<ul>
<li>Gracefully stops HTTP server</li>
<li>Waits for in-flight requests</li>
<li>Returns error if stop fails</li>
</ul>
<h5 id="configuration-flags-3">Configuration Flags</h5>
<p><strong><code>--http-listen-addr</code></strong></p>
<ul>
<li><strong>Type</strong>: <code>string</code></li>
<li><strong>Default</strong>: <code>:17901</code></li>
<li><strong>Description</strong>: HTTP server listen address</li>
</ul>
<p><strong><code>--http-read-timeout</code></strong></p>
<ul>
<li><strong>Type</strong>: <code>duration</code></li>
<li><strong>Default</strong>: <code>10s</code></li>
<li><strong>Description</strong>: HTTP read timeout</li>
</ul>
<p><strong><code>--http-write-timeout</code></strong></p>
<ul>
<li><strong>Type</strong>: <code>duration</code></li>
<li><strong>Default</strong>: <code>10s</code></li>
<li><strong>Description</strong>: HTTP write timeout</li>
</ul>
<h3 id="2-agent-components">2. Agent Components</h3>
<p><strong>Purpose</strong>: Components that run within FODC Agents to communicate with the Proxy</p>
<h4 id="21-proxy-client-component">2.1 Proxy Client Component</h4>
<p><strong>Purpose</strong>: Manages connection and communication with the FODC Proxy</p>
<h5 id="core-responsibilities-4">Core Responsibilities</h5>
<ul>
<li><strong>Connection Management</strong>: Establishes and maintains gRPC connection to Proxy</li>
<li><strong>Registration</strong>: Registers agent with Proxy on startup</li>
<li><strong>Heartbeat Management</strong>: Sends periodic heartbeats to maintain connection</li>
<li><strong>Stream Management</strong>: Manages bi-directional streams for metrics</li>
<li><strong>Reconnection Logic</strong>: Handles connection failures and automatic reconnection</li>
</ul>
<h5 id="core-types-4">Core Types</h5>
<p><strong><code>ProxyClient</code></strong></p>
<div class="highlight"><pre style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-go" data-lang="go"><span style="color:#000;font-weight:bold">type</span> ProxyClient <span style="color:#000;font-weight:bold">struct</span> {
	proxyAddr       <span style="color:#458;font-weight:bold">string</span>
	nodeIP          <span style="color:#458;font-weight:bold">string</span>
	nodePort        <span style="color:#458;font-weight:bold">int</span>
	nodeRole        databasev1.Role
	labels          <span style="color:#000;font-weight:bold">map</span>[<span style="color:#458;font-weight:bold">string</span>]<span style="color:#458;font-weight:bold">string</span>
	conn            <span style="color:#000;font-weight:bold">*</span>grpc.ClientConn
	client          fodcv1.FODCServiceClient
	heartbeatTicker <span style="color:#000;font-weight:bold">*</span>time.Ticker
	mu              sync.RWMutex
	logger          <span style="color:#000;font-weight:bold">*</span>logger.Logger
}

<span style="color:#000;font-weight:bold">type</span> MetricsRequestFilter <span style="color:#000;font-weight:bold">struct</span> {
	StartTime <span style="color:#000;font-weight:bold">*</span>time.Time  <span style="color:#998;font-style:italic">// Start time for time window (optional)
</span><span style="color:#998;font-style:italic"></span>	EndTime   <span style="color:#000;font-weight:bold">*</span>time.Time  <span style="color:#998;font-style:italic">// End time for time window (optional)
</span><span style="color:#998;font-style:italic"></span>}
</code></pre></div><p><strong>Note</strong>: The ProxyClient integrates with Flight Recorder, which continuously collects and stores metrics in-memory. When the Proxy requests metrics, the agent retrieves them from Flight Recorder rather than collecting them on-demand.</p>
<h5 id="key-functions-4">Key Functions</h5>
<p><strong><code>Connect(ctx context.Context) error</code></strong></p>
<ul>
<li>Establishes gRPC connection to Proxy</li>
<li>Returns error if connection fails</li>
</ul>
<p><strong><code>StartRegistrationStream(ctx context.Context) error</code></strong></p>
<ul>
<li>Establishes bi-directional registration stream with Proxy</li>
<li>Sends initial RegisterAgentRequest with primary address (IP + port), role, and labels</li>
<li>Receives RegisterAgentResponse with heartbeat interval</li>
<li>Maintains stream for periodic heartbeat and re-registration</li>
<li>Returns error if stream establishment fails</li>
</ul>
<p><strong><code>StartMetricsStream(ctx context.Context) error</code></strong></p>
<ul>
<li>Establishes bi-directional metrics stream with Proxy</li>
<li>Maintains stream for on-demand metrics requests</li>
<li>Listens for metrics request commands from Proxy</li>
<li>When request received, retrieves metrics from Flight Recorder and sends response</li>
<li>Returns error if stream fails</li>
</ul>
<p><strong><code>RetrieveAndSendMetrics(ctx context.Context, filter *MetricsRequestFilter) error</code></strong></p>
<ul>
<li>Retrieves metrics from Flight Recorder when requested by Proxy</li>
<li>Queries Flight Recorder (in-memory storage) for metrics</li>
<li>Flight Recorder contains continuously collected metrics from:
<ul>
<li>BanyanDB /metrics endpoint scraping</li>
<li>KTM/OS telemetry collection</li>
<li>Other observability sources</li>
</ul>
</li>
<li>Filters metrics by time window if specified in request</li>
<li>Packages metrics in StreamMetricsRequest (includes metrics and timestamp)</li>
<li>Sends metrics to Proxy via StreamMetrics() stream</li>
<li>Returns error if retrieval or send fails</li>
</ul>
<p><strong><code>SendHeartbeat(ctx context.Context) error</code></strong></p>
<ul>
<li>Sends heartbeat to Proxy</li>
<li>Updates connection status</li>
<li>Returns error if heartbeat fails</li>
</ul>
<p><strong><code>Disconnect() error</code></strong></p>
<ul>
<li>Closes connection to Proxy</li>
<li>Cleans up resources</li>
<li>Returns error if disconnect fails</li>
</ul>
<h5 id="configuration-flags-4">Configuration Flags</h5>
<p><strong><code>--proxy-addr</code></strong></p>
<ul>
<li><strong>Type</strong>: <code>string</code></li>
<li><strong>Default</strong>: <code>localhost:17900</code></li>
<li><strong>Description</strong>: FODC Proxy gRPC address</li>
</ul>
<p><strong><code>--node-ip</code></strong></p>
<ul>
<li><strong>Type</strong>: <code>string</code></li>
<li><strong>Default</strong>: (required, no default)</li>
<li><strong>Description</strong>: IP address for this BanyanDB node&rsquo;s primary gRPC address. Used as part of AgentIdentity for agent identification.</li>
</ul>
<p><strong><code>--node-port</code></strong></p>
<ul>
<li><strong>Type</strong>: <code>int</code></li>
<li><strong>Default</strong>: (required, no default)</li>
<li><strong>Description</strong>: Port number for this BanyanDB node&rsquo;s primary gRPC address. Used as part of AgentIdentity for agent identification.</li>
</ul>
<p><strong><code>--node-role</code></strong></p>
<ul>
<li><strong>Type</strong>: <code>string</code></li>
<li><strong>Default</strong>: (required, no default)</li>
<li><strong>Description</strong>: Role of this BanyanDB node. Valid values: <code>liaison</code>, <code>datanode-hot</code>, <code>datanode-warm</code>, <code>datanode-cold</code>, etc. Must match the node&rsquo;s actual role in the cluster.</li>
</ul>
<p><strong><code>--node-labels</code></strong></p>
<ul>
<li><strong>Type</strong>: <code>string</code> (comma-separated key=value pairs)</li>
<li><strong>Default</strong>: (optional)</li>
<li><strong>Description</strong>: Labels/metadata for this node. Format: <code>key1=value1,key2=value2</code>. Examples: <code>zone=us-west-1,env=production</code>. Used for filtering and grouping nodes in the Proxy.</li>
</ul>
<p><strong><code>--heartbeat-interval</code></strong></p>
<ul>
<li><strong>Type</strong>: <code>duration</code></li>
<li><strong>Default</strong>: <code>10s</code></li>
<li><strong>Description</strong>: Interval for sending heartbeats to Proxy. Note: The Proxy may override this value in RegisterAgentResponse.</li>
</ul>
<p><strong><code>--reconnect-interval</code></strong></p>
<ul>
<li><strong>Type</strong>: <code>duration</code></li>
<li><strong>Default</strong>: <code>5s</code></li>
<li><strong>Description</strong>: Interval for reconnection attempts when connection to Proxy is lost</li>
</ul>
<h2 id="api-design">API Design</h2>
<h3 id="grpc-api">gRPC API</h3>
<h4 id="service-definition">Service Definition</h4>
<div class="highlight"><pre style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-protobuf" data-lang="protobuf"><span style="color:#a61717;background-color:#e3d2d2">
</span><span style="color:#a61717;background-color:#e3d2d2"></span>syntax <span style="color:#000;font-weight:bold">=</span> <span style="color:#d14">&#34;proto3&#34;</span>;<span style="color:#a61717;background-color:#e3d2d2">
</span><span style="color:#a61717;background-color:#e3d2d2">
</span><span style="color:#a61717;background-color:#e3d2d2"></span><span style="color:#000;font-weight:bold">package</span> <span style="color:#555">banyandb</span><span style="color:#000;font-weight:bold">.</span>fodc.v1;<span style="color:#a61717;background-color:#e3d2d2">
</span><span style="color:#a61717;background-color:#e3d2d2">
</span><span style="color:#a61717;background-color:#e3d2d2"></span><span style="color:#000;font-weight:bold">import</span> <span style="color:#d14">&#34;google/protobuf/timestamp.proto&#34;</span>;<span style="color:#a61717;background-color:#e3d2d2">
</span><span style="color:#a61717;background-color:#e3d2d2">
</span><span style="color:#a61717;background-color:#e3d2d2"></span><span style="color:#000;font-weight:bold">option</span> go_package <span style="color:#000;font-weight:bold">=</span> <span style="color:#d14">&#34;github.com/apache/skywalking-banyandb/api/proto/banyandb/fodc/v1&#34;</span>;<span style="color:#a61717;background-color:#e3d2d2">
</span><span style="color:#a61717;background-color:#e3d2d2">
</span><span style="color:#a61717;background-color:#e3d2d2"></span><span style="color:#000;font-weight:bold">service</span> FODCService {<span style="color:#a61717;background-color:#e3d2d2">
</span><span style="color:#a61717;background-color:#e3d2d2"></span>  <span style="color:#998;font-style:italic">// Bi-directional stream for agent registration and heartbeat
</span><span style="color:#998;font-style:italic"></span>  <span style="color:#000;font-weight:bold">rpc</span> RegisterAgent(stream RegisterAgentRequest) <span style="color:#000;font-weight:bold">returns</span> (stream RegisterAgentResponse);<span style="color:#a61717;background-color:#e3d2d2">
</span><span style="color:#a61717;background-color:#e3d2d2"></span>  <span style="color:#a61717;background-color:#e3d2d2">
</span><span style="color:#a61717;background-color:#e3d2d2"></span>  <span style="color:#998;font-style:italic">// Bi-directional stream for metrics
</span><span style="color:#998;font-style:italic"></span>  <span style="color:#998;font-style:italic">// Agent sends StreamMetricsRequest (metrics data), Proxy sends StreamMetricsResponse (metrics requests)
</span><span style="color:#998;font-style:italic"></span>  <span style="color:#000;font-weight:bold">rpc</span> StreamMetrics(stream StreamMetricsRequest) <span style="color:#000;font-weight:bold">returns</span> (stream StreamMetricsResponse);<span style="color:#a61717;background-color:#e3d2d2">
</span><span style="color:#a61717;background-color:#e3d2d2"></span>}<span style="color:#a61717;background-color:#e3d2d2">
</span><span style="color:#a61717;background-color:#e3d2d2">
</span><span style="color:#a61717;background-color:#e3d2d2"></span><span style="color:#000;font-weight:bold">message</span> <span style="color:#458;font-weight:bold">RegisterAgentRequest</span> {<span style="color:#a61717;background-color:#e3d2d2">
</span><span style="color:#a61717;background-color:#e3d2d2"></span>  <span style="color:#458;font-weight:bold">string</span> node_role <span style="color:#000;font-weight:bold">=</span> <span style="color:#099">1</span>;<span style="color:#a61717;background-color:#e3d2d2">
</span><span style="color:#a61717;background-color:#e3d2d2"></span>  map&lt;<span style="color:#458;font-weight:bold">string</span>, <span style="color:#458;font-weight:bold">string</span>&gt; labels <span style="color:#000;font-weight:bold">=</span> <span style="color:#099">2</span>;<span style="color:#a61717;background-color:#e3d2d2">
</span><span style="color:#a61717;background-color:#e3d2d2"></span>  Address primary_address <span style="color:#000;font-weight:bold">=</span> <span style="color:#099">3</span>;<span style="color:#a61717;background-color:#e3d2d2">
</span><span style="color:#a61717;background-color:#e3d2d2"></span>  map&lt;<span style="color:#458;font-weight:bold">string</span>, Address&gt; secondary_addresses <span style="color:#000;font-weight:bold">=</span> <span style="color:#099">4</span>;<span style="color:#a61717;background-color:#e3d2d2">
</span><span style="color:#a61717;background-color:#e3d2d2"></span>}<span style="color:#a61717;background-color:#e3d2d2">
</span><span style="color:#a61717;background-color:#e3d2d2">
</span><span style="color:#a61717;background-color:#e3d2d2"></span><span style="color:#000;font-weight:bold">message</span> <span style="color:#458;font-weight:bold">Address</span> {<span style="color:#a61717;background-color:#e3d2d2">
</span><span style="color:#a61717;background-color:#e3d2d2"></span>  <span style="color:#458;font-weight:bold">string</span> ip <span style="color:#000;font-weight:bold">=</span> <span style="color:#099">1</span>;<span style="color:#a61717;background-color:#e3d2d2">
</span><span style="color:#a61717;background-color:#e3d2d2"></span>  <span style="color:#458;font-weight:bold">int32</span> port <span style="color:#000;font-weight:bold">=</span> <span style="color:#099">2</span>;<span style="color:#a61717;background-color:#e3d2d2">
</span><span style="color:#a61717;background-color:#e3d2d2"></span>}<span style="color:#a61717;background-color:#e3d2d2">
</span><span style="color:#a61717;background-color:#e3d2d2">
</span><span style="color:#a61717;background-color:#e3d2d2"></span><span style="color:#000;font-weight:bold">message</span> <span style="color:#458;font-weight:bold">RegisterAgentResponse</span> {<span style="color:#a61717;background-color:#e3d2d2">
</span><span style="color:#a61717;background-color:#e3d2d2"></span>  <span style="color:#458;font-weight:bold">bool</span> success <span style="color:#000;font-weight:bold">=</span> <span style="color:#099">1</span>;<span style="color:#a61717;background-color:#e3d2d2">
</span><span style="color:#a61717;background-color:#e3d2d2"></span>  <span style="color:#458;font-weight:bold">string</span> <span style="color:#000;font-weight:bold">message</span> <span style="color:#000;font-weight:bold">=</span> <span style="color:#099">2</span>;<span style="color:#a61717;background-color:#e3d2d2">
</span><span style="color:#a61717;background-color:#e3d2d2"></span>  <span style="color:#458;font-weight:bold">int64</span> heartbeat_interval_seconds <span style="color:#000;font-weight:bold">=</span> <span style="color:#099">3</span>;<span style="color:#a61717;background-color:#e3d2d2">
</span><span style="color:#a61717;background-color:#e3d2d2"></span>}<span style="color:#a61717;background-color:#e3d2d2">
</span><span style="color:#a61717;background-color:#e3d2d2">
</span><span style="color:#a61717;background-color:#e3d2d2"></span><span style="color:#000;font-weight:bold">message</span> <span style="color:#458;font-weight:bold">StreamMetricsRequest</span> {<span style="color:#a61717;background-color:#e3d2d2">
</span><span style="color:#a61717;background-color:#e3d2d2"></span>  <span style="color:#000;font-weight:bold">repeated</span> Metric metrics <span style="color:#000;font-weight:bold">=</span> <span style="color:#099">1</span>;<span style="color:#a61717;background-color:#e3d2d2">
</span><span style="color:#a61717;background-color:#e3d2d2"></span>  google.protobuf.Timestamp timestamp <span style="color:#000;font-weight:bold">=</span> <span style="color:#099">2</span>;<span style="color:#a61717;background-color:#e3d2d2">
</span><span style="color:#a61717;background-color:#e3d2d2"></span>}<span style="color:#a61717;background-color:#e3d2d2">
</span><span style="color:#a61717;background-color:#e3d2d2">
</span><span style="color:#a61717;background-color:#e3d2d2"></span><span style="color:#000;font-weight:bold">message</span> <span style="color:#458;font-weight:bold">Metric</span> {<span style="color:#a61717;background-color:#e3d2d2">
</span><span style="color:#a61717;background-color:#e3d2d2"></span>  <span style="color:#458;font-weight:bold">string</span> name <span style="color:#000;font-weight:bold">=</span> <span style="color:#099">1</span>;<span style="color:#a61717;background-color:#e3d2d2">
</span><span style="color:#a61717;background-color:#e3d2d2"></span>  map&lt;<span style="color:#458;font-weight:bold">string</span>, <span style="color:#458;font-weight:bold">string</span>&gt; labels <span style="color:#000;font-weight:bold">=</span> <span style="color:#099">2</span>;<span style="color:#a61717;background-color:#e3d2d2">
</span><span style="color:#a61717;background-color:#e3d2d2"></span>  <span style="color:#458;font-weight:bold">double</span> value <span style="color:#000;font-weight:bold">=</span> <span style="color:#099">3</span>;<span style="color:#a61717;background-color:#e3d2d2">
</span><span style="color:#a61717;background-color:#e3d2d2"></span>  <span style="color:#458;font-weight:bold">string</span> description <span style="color:#000;font-weight:bold">=</span> <span style="color:#099">4</span>;<span style="color:#a61717;background-color:#e3d2d2">
</span><span style="color:#a61717;background-color:#e3d2d2"></span>}<span style="color:#a61717;background-color:#e3d2d2">
</span><span style="color:#a61717;background-color:#e3d2d2">
</span><span style="color:#a61717;background-color:#e3d2d2"></span><span style="color:#000;font-weight:bold">message</span> <span style="color:#458;font-weight:bold">StreamMetricsResponse</span> {<span style="color:#a61717;background-color:#e3d2d2">
</span><span style="color:#a61717;background-color:#e3d2d2"></span>  google.protobuf.Timestamp start_time <span style="color:#000;font-weight:bold">=</span> <span style="color:#099">1</span>;  <span style="color:#998;font-style:italic">// Optional start time for time window
</span><span style="color:#998;font-style:italic"></span>  google.protobuf.Timestamp end_time <span style="color:#000;font-weight:bold">=</span> <span style="color:#099">2</span>;    <span style="color:#998;font-style:italic">// Optional end time for time window
</span><span style="color:#998;font-style:italic"></span>}<span style="color:#a61717;background-color:#e3d2d2">
</span></code></pre></div><h3 id="rest-api">REST API</h3>
<h4 id="endpoints">Endpoints</h4>
<p><strong><code>GET /metrics</code></strong></p>
<ul>
<li><strong>Description</strong>: Returns latest metrics from all agents (on-demand collection, not stored in Proxy)</li>
<li><strong>Query Parameters</strong>:
<ul>
<li><code>address</code> (optional): Filter by ip or ip:port</li>
<li><code>role</code> (optional): Filter by role (liaison, datanode-hot, etc.)</li>
</ul>
</li>
<li><strong>Response</strong>: Prometheus text format with node metadata labels</li>
<li><strong>Note</strong>: Metrics are collected on-demand from agents' Flight Recorder. No metrics are stored in the Proxy.</li>
<li><strong>Example</strong>:</li>
</ul>
<pre><code># HELP banyandb_stream_tst_inverted_index_total_doc_count Total document count
# TYPE banyandb_stream_tst_inverted_index_total_doc_count gauge
banyandb_stream_tst_inverted_index_total_doc_count{index=&quot;test&quot;,agent_id=&quot;agent-uuid-123&quot;,node_role=&quot;datanode-hot&quot;} 12345
</code></pre><p><strong><code>GET /metrics-windows</code></strong></p>
<ul>
<li><strong>Description</strong>: Returns metrics from all agents (on-demand collection, not stored in Proxy)</li>
<li><strong>Query Parameters</strong>:
<ul>
<li><code>start_time</code> (optional): RFC3339 timestamp - filters metrics by start time (agents filter from Flight Recorder)</li>
<li><code>end_time</code> (optional): RFC3339 timestamp - filters metrics by end time (agents filter from Flight Recorder)</li>
<li><code>address</code> (optional): Filter by ip or ip:port</li>
<li><code>role</code> (optional): Filter by role (liaison, datanode-hot, etc.)</li>
</ul>
</li>
<li><strong>Response</strong>: JSON array of metrics, each with time series data for line charts</li>
<li><strong>Note</strong>: Metrics are collected on-demand from agents' Flight Recorder. No metrics are stored in the Proxy.</li>
<li><strong>Format</strong>: Each metric is grouped by name and labels, with a <code>data</code> array containing timestamp-value pairs for charting</li>
<li><strong>Example</strong>:</li>
</ul>
<div class="highlight"><pre style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-json" data-lang="json">[
  {
    <span style="color:#000080">&#34;name&#34;</span>: <span style="color:#d14">&#34;banyandb_stream_tst_inverted_index_total_doc_count&#34;</span>,
    <span style="color:#000080">&#34;description&#34;</span>: <span style="color:#d14">&#34;Total document count&#34;</span>,
    <span style="color:#000080">&#34;labels&#34;</span>: {
      <span style="color:#000080">&#34;index&#34;</span>: <span style="color:#d14">&#34;test&#34;</span>,
      <span style="color:#000080">&#34;node_role&#34;</span>: <span style="color:#d14">&#34;datanode-hot&#34;</span>
    },
    <span style="color:#000080">&#34;agent_id&#34;</span>: <span style="color:#d14">&#34;agent-uuid-123&#34;</span>,
    <span style="color:#000080">&#34;ip&#34;</span>: <span style="color:#d14">&#34;192.168.1.1&#34;</span>,
    <span style="color:#000080">&#34;port&#34;</span>: <span style="color:#099">17900</span>,
    <span style="color:#000080">&#34;data&#34;</span>: [
      {
        <span style="color:#000080">&#34;timestamp&#34;</span>: <span style="color:#d14">&#34;2024-01-01T11:00:00Z&#34;</span>,
        <span style="color:#000080">&#34;value&#34;</span>: <span style="color:#099">12345</span>
      },
      {
        <span style="color:#000080">&#34;timestamp&#34;</span>: <span style="color:#d14">&#34;2024-01-01T11:05:00Z&#34;</span>,
        <span style="color:#000080">&#34;value&#34;</span>: <span style="color:#099">12350</span>
      },
      {
        <span style="color:#000080">&#34;timestamp&#34;</span>: <span style="color:#d14">&#34;2024-01-01T12:00:00Z&#34;</span>,
        <span style="color:#000080">&#34;value&#34;</span>: <span style="color:#099">12355</span>
      }
    ]
  },
  {
    <span style="color:#000080">&#34;name&#34;</span>: <span style="color:#d14">&#34;http_requests_total&#34;</span>,
    <span style="color:#000080">&#34;description&#34;</span>: <span style="color:#d14">&#34;Total requests&#34;</span>,
    <span style="color:#000080">&#34;labels&#34;</span>: {
      <span style="color:#000080">&#34;index&#34;</span>: <span style="color:#d14">&#34;test&#34;</span>,
      <span style="color:#000080">&#34;node_role&#34;</span>: <span style="color:#d14">&#34;datanode-hot&#34;</span>
    },
    <span style="color:#000080">&#34;agent_id&#34;</span>: <span style="color:#d14">&#34;agent-uuid-123&#34;</span>,
    <span style="color:#000080">&#34;ip&#34;</span>: <span style="color:#d14">&#34;192.168.1.1&#34;</span>,
    <span style="color:#000080">&#34;port&#34;</span>: <span style="color:#099">17900</span>,
    <span style="color:#000080">&#34;data&#34;</span>: [
      {
        <span style="color:#000080">&#34;timestamp&#34;</span>: <span style="color:#d14">&#34;2024-01-01T11:00:00Z&#34;</span>,
        <span style="color:#000080">&#34;value&#34;</span>: <span style="color:#099">300</span>
      },
      {
        <span style="color:#000080">&#34;timestamp&#34;</span>: <span style="color:#d14">&#34;2024-01-01T11:05:00Z&#34;</span>,
        <span style="color:#000080">&#34;value&#34;</span>: <span style="color:#099">200</span>
      },
      {
        <span style="color:#000080">&#34;timestamp&#34;</span>: <span style="color:#d14">&#34;2024-01-01T12:00:00Z&#34;</span>,
        <span style="color:#000080">&#34;value&#34;</span>: <span style="color:#099">250</span>
      }
    ]
  },
  {
    <span style="color:#000080">&#34;name&#34;</span>: <span style="color:#d14">&#34;banyandb_stream_tst_inverted_index_total_doc_count&#34;</span>,
    <span style="color:#000080">&#34;description&#34;</span>: <span style="color:#d14">&#34;Total document count&#34;</span>,
    <span style="color:#000080">&#34;labels&#34;</span>: {
      <span style="color:#000080">&#34;index&#34;</span>: <span style="color:#d14">&#34;test&#34;</span>,
      <span style="color:#000080">&#34;node_role&#34;</span>: <span style="color:#d14">&#34;liaison&#34;</span>
    },
    <span style="color:#000080">&#34;agent_id&#34;</span>: <span style="color:#d14">&#34;agent-uuid-456&#34;</span>,
    <span style="color:#000080">&#34;ip&#34;</span>: <span style="color:#d14">&#34;192.168.1.2&#34;</span>,
    <span style="color:#000080">&#34;port&#34;</span>: <span style="color:#099">17900</span>,
    <span style="color:#000080">&#34;data&#34;</span>: [
      {
        <span style="color:#000080">&#34;timestamp&#34;</span>: <span style="color:#d14">&#34;2024-01-01T11:00:00Z&#34;</span>,
        <span style="color:#000080">&#34;value&#34;</span>: <span style="color:#099">54321</span>
      },
      {
        <span style="color:#000080">&#34;timestamp&#34;</span>: <span style="color:#d14">&#34;2024-01-01T11:05:00Z&#34;</span>,
        <span style="color:#000080">&#34;value&#34;</span>: <span style="color:#099">54330</span>
      },
      {
        <span style="color:#000080">&#34;timestamp&#34;</span>: <span style="color:#d14">&#34;2024-01-01T12:00:00Z&#34;</span>,
        <span style="color:#000080">&#34;value&#34;</span>: <span style="color:#099">54340</span>
      }
    ]
  }
]
</code></pre></div><p><strong><code>GET /cluster</code></strong></p>
<ul>
<li><strong>Description</strong>: Returns cluster topology and node information</li>
<li><strong>Response</strong>: JSON</li>
<li><strong>Example</strong>:</li>
</ul>
<div class="highlight"><pre style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-json" data-lang="json">{
  <span style="color:#000080">&#34;nodes&#34;</span>: [
    {
      <span style="color:#000080">&#34;node_id&#34;</span>: <span style="color:#d14">&#34;node1&#34;</span>,
      <span style="color:#000080">&#34;node_role&#34;</span>: <span style="color:#d14">&#34;liaison&#34;</span>,
      <span style="color:#000080">&#34;primary_address&#34;</span>: {
        <span style="color:#000080">&#34;ip&#34;</span>: <span style="color:#d14">&#34;192.168.1.1&#34;</span>,
        <span style="color:#000080">&#34;port&#34;</span>: <span style="color:#099">17900</span>
      },
      <span style="color:#000080">&#34;secondary_addresses&#34;</span>: {
        <span style="color:#000080">&#34;metrics&#34;</span>: {
          <span style="color:#000080">&#34;ip&#34;</span>: <span style="color:#d14">&#34;192.168.1.1&#34;</span>,
          <span style="color:#000080">&#34;port&#34;</span>: <span style="color:#099">17901</span>
        },
        <span style="color:#000080">&#34;admin&#34;</span>: {
          <span style="color:#000080">&#34;ip&#34;</span>: <span style="color:#d14">&#34;192.168.1.1&#34;</span>,
          <span style="color:#000080">&#34;port&#34;</span>: <span style="color:#099">17902</span>
        }
      },
      <span style="color:#000080">&#34;labels&#34;</span>: {
        <span style="color:#000080">&#34;zone&#34;</span>: <span style="color:#d14">&#34;us-west-1&#34;</span>
      },
      <span style="color:#000080">&#34;status&#34;</span>: <span style="color:#d14">&#34;online&#34;</span>,
      <span style="color:#000080">&#34;last_heartbeat&#34;</span>: <span style="color:#d14">&#34;2024-01-01T12:00:00Z&#34;</span>,
    },
    {
      <span style="color:#000080">&#34;node_id&#34;</span>: <span style="color:#d14">&#34;node2&#34;</span>,
      <span style="color:#000080">&#34;node_role&#34;</span>: <span style="color:#d14">&#34;data-hot&#34;</span>,
      <span style="color:#000080">&#34;primary_address&#34;</span>: {
        <span style="color:#000080">&#34;ip&#34;</span>: <span style="color:#d14">&#34;192.168.1.1&#34;</span>,
        <span style="color:#000080">&#34;port&#34;</span>: <span style="color:#099">17903</span>
      },
      <span style="color:#000080">&#34;secondary_addresses&#34;</span>: {
        <span style="color:#000080">&#34;metrics&#34;</span>: {
          <span style="color:#000080">&#34;ip&#34;</span>: <span style="color:#d14">&#34;192.168.1.1&#34;</span>,
          <span style="color:#000080">&#34;port&#34;</span>: <span style="color:#099">17904</span>
        },
        <span style="color:#000080">&#34;admin&#34;</span>: {
          <span style="color:#000080">&#34;ip&#34;</span>: <span style="color:#d14">&#34;192.168.1.1&#34;</span>,
          <span style="color:#000080">&#34;port&#34;</span>: <span style="color:#099">17905</span>
        }
      },
      <span style="color:#000080">&#34;labels&#34;</span>: {
        <span style="color:#000080">&#34;zone&#34;</span>: <span style="color:#d14">&#34;us-west-1&#34;</span>
      },
      <span style="color:#000080">&#34;status&#34;</span>: <span style="color:#d14">&#34;online&#34;</span>,
      <span style="color:#000080">&#34;last_heartbeat&#34;</span>: <span style="color:#d14">&#34;2024-01-01T12:00:00Z&#34;</span>,
    }
  ],
  <span style="color:#000080">&#34;calls&#34;</span>: [
    {
      <span style="color:#000080">&#34;id&#34;</span>: <span style="color:#d14">&#34;call1&#34;</span>,
      <span style="color:#000080">&#34;source&#34;</span>: <span style="color:#d14">&#34;node1&#34;</span>,
      <span style="color:#000080">&#34;target&#34;</span>: <span style="color:#d14">&#34;node2&#34;</span>,
    },
  ]
  <span style="color:#d14">&#34;updated_at&#34;</span>: <span style="color:#d14">&#34;2024-01-01T12:00:00Z&#34;</span>
}
</code></pre></div><p><strong><code>GET /cluster/config</code></strong></p>
<ul>
<li><strong>Description</strong>: Returns node configurations</li>
<li><strong>Query Parameters</strong>:
<ul>
<li><code>address</code> (optional): Filter by ip or ip:port</li>
<li><code>role</code> (optional): Filter by role</li>
</ul>
</li>
<li><strong>Response</strong>: JSON</li>
<li><strong>Example</strong>:</li>
</ul>
<div class="highlight"><pre style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-json" data-lang="json">{
  <span style="color:#000080">&#34;configurations&#34;</span>: [
    {
      <span style="color:#000080">&#34;agent_id&#34;</span>: <span style="color:#d14">&#34;agent-uuid-123&#34;</span>,
      <span style="color:#000080">&#34;node_role&#34;</span>: <span style="color:#d14">&#34;liaison&#34;</span>,
      <span style="color:#000080">&#34;startup_params&#34;</span>: {
        <span style="color:#000080">&#34;--listen-addr&#34;</span>: <span style="color:#d14">&#34;:17900&#34;</span>,
        <span style="color:#000080">&#34;--data-path&#34;</span>: <span style="color:#d14">&#34;/data&#34;</span>
      },
      <span style="color:#000080">&#34;runtime_config&#34;</span>: {
        <span style="color:#000080">&#34;max_connections&#34;</span>: <span style="color:#099">1000</span>
      },
      <span style="color:#000080">&#34;collected_at&#34;</span>: <span style="color:#d14">&#34;2024-01-01T12:00:00Z&#34;</span>
    }
  ]
}
</code></pre></div><p><strong><code>GET /health</code></strong></p>
<ul>
<li><strong>Description</strong>: Health check endpoint</li>
<li><strong>Response</strong>: JSON</li>
<li><strong>Example</strong>:</li>
</ul>
<div class="highlight"><pre style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-json" data-lang="json">{
  <span style="color:#000080">&#34;status&#34;</span>: <span style="color:#d14">&#34;healthy&#34;</span>,
  <span style="color:#000080">&#34;agents_online&#34;</span>: <span style="color:#099">5</span>,
  <span style="color:#000080">&#34;agents_total&#34;</span>: <span style="color:#099">5</span>,
  <span style="color:#000080">&#34;uptime_seconds&#34;</span>: <span style="color:#099">3600</span>
}
</code></pre></div><h2 id="data-flow">Data Flow</h2>
<h3 id="agent-registration-flow">Agent Registration Flow</h3>
<pre><code>1. FODC Agent Starts
   - Reads node information from configuration flags:
     * --node-ip: Node IP
     * --node-port: Node port
     * --node-role: Node role (liaison, datanode-hot, etc.)
     * --node-labels: Optional node labels/metadata
   ↓
2. Agent Connects to Proxy via gRPC
   - Uses --proxy-addr flag to determine Proxy address
   ↓
3. Agent Establishes RegisterAgent() Bi-directional Stream
   - Opens stream to Proxy
   ↓
4. Agent Sends RegisterAgentRequest
   - Sends primary address (IP + port), role, and labels from configuration flags
   ↓
5. Proxy Validates Registration
   - Creates AgentIdentity from primary IP + port + role + labels
   - Generates unique agent ID (UUID) for the agent
   - Validates role and primary address
   - Note: AgentIdentity may be repetitious, so unique agent ID is used as registry key
   ↓
6. Proxy Registers Agent
   - Creates AgentInfo in AgentRegistry
   - Updates ClusterTopology
   ↓
7. Proxy Sends RegisterAgentResponse via Stream
   - Heartbeat interval
   ↓
8. Agent Maintains Registration Stream
   - Sends periodic heartbeats via RegisterAgentRequest
   - Receives RegisterAgentResponse updates
   - Stream remains open for re-registration if needed
   ↓
9. Agent Establishes Metrics Stream
   - StreamMetrics() for metrics collection
</code></pre><h3 id="metrics-collection-flow">Metrics Collection Flow</h3>
<pre><code>1. External Client Requests Metrics
   - GET /metrics (latest metrics from all agents)
   - GET /metrics-windows (agent metrics with time window)
   ↓
2. APIServer Receives Request
   - Routes to metrics handler
   - Extracts query parameters (start_time, end_time, agent_id, role)
   ↓
3. Proxy Requests Metrics from All Agents
   - For each registered agent, sends metrics request via StreamMetrics()
   - For `/metrics`: requests latest metrics (no time window filter)
   - For `/metrics-windows`: includes time window filter (start_time, end_time) if specified
   - Uses bi-directional stream to request current metrics
   - May filter by agent_id or role if specified in query
   ↓
4. Agents Retrieve Metrics from Flight Recorder
   - Each agent receives metrics request via StreamMetrics() with time window filter (if specified)
   - Agent retrieves metrics from Flight Recorder (in-memory storage)
   - Flight Recorder continuously collects and stores metrics from:
     * BanyanDB /metrics endpoint scraping
     * KTM/OS telemetry collection
   - Agent filters metrics by time window if specified in StreamMetricsResponse
   - Packages filtered metrics in StreamMetricsRequest
   ↓
5. Agents Send Metrics to Proxy
   - Each agent sends StreamMetricsRequest via StreamMetrics()
   - Includes metrics and timestamp
   ↓
6. Proxy Receives Metrics from All Agents
   - Collects StreamMetricsRequest from each agent
   - Waits for responses from all requested agents (with timeout)
   ↓
7. Proxy Enriches Metrics
   - Identifies agent connection from stream context
   - Looks up unique agent ID from agent connection
   - Retrieves AgentInfo using agent ID
   - Adds node metadata (IP, port, role, labels) from AgentInfo to each metric
   - Normalizes metric format across agents
   ↓
8. MetricsAggregator Aggregates Metrics
   - Combines metrics from all agents into a single list
   - Filters by time window if specified (agents already filtered by time window from Flight Recorder)
   - Associates metrics with agent using unique agent ID from stream context
   - Does not store metrics (on-demand collection only)
   ↓
9. Proxy Formats and Returns Response
   - Converts aggregated metrics to Prometheus text format
   - Includes node metadata labels
   - Returns HTTP 200 response to external client
</code></pre><h3 id="metrics-query-flow">Metrics Query Flow</h3>
<p><strong>Note</strong>: This flow is integrated with Metrics Collection Flow. When an external request comes in, the Proxy requests metrics from all agents. Agents retrieve metrics from Flight Recorder (in-memory storage) which continuously collects metrics.</p>
<p><strong>For <code>/metrics</code> endpoint (Latest metrics from all agents)</strong>:</p>
<pre><code>1. External Client Requests Latest Metrics
   - GET /metrics?role=Y (optional filters)
   ↓
2. Triggers Metrics Collection Flow
   - Proxy requests latest metrics from all agents (or filtered agents)
   - No time window filter (returns latest metrics)
   - See &quot;Metrics Collection Flow&quot; above for detailed steps
   ↓
3. Response Sent to Client
   - HTTP 200 with Prometheus text format
   - Includes aggregated latest metrics from all agents with node metadata
</code></pre><p><strong>For <code>/metrics-windows</code> endpoint (Agent metrics)</strong>:</p>
<pre><code>1. External Client Requests Agent Metrics
   - GET /metrics-windows?start_time=X&amp;end_time=Y&amp;role=W
   ↓
2. Triggers Metrics Collection Flow
   - Proxy requests metrics from all agents (or filtered agents)
   - See &quot;Metrics Collection Flow&quot; above for detailed steps
   ↓
3. Response Sent to Client
   - HTTP 200 with Prometheus text format
   - Includes aggregated metrics from all agents with node metadata
</code></pre><h2 id="testing-strategy">Testing Strategy</h2>
<h3 id="unit-testing">Unit Testing</h3>
<p><strong>Agent Registry Package</strong></p>
<ul>
<li>Test <code>RegisterAgent()</code> with valid and invalid inputs</li>
<li>Test <code>UnregisterAgent()</code> cleanup behavior</li>
<li>Test <code>UpdateHeartbeat()</code> timestamp updates</li>
<li>Test <code>GetAgent()</code> and <code>ListAgents()</code> retrieval</li>
<li>Test <code>ListAgentsByRole()</code> filtering</li>
<li>Test <code>CheckAgentHealth()</code> timeout detection</li>
<li>Test concurrent registration/unregistration</li>
<li>Test error handling for duplicate registrations</li>
</ul>
<p><strong>gRPC Service Package</strong></p>
<ul>
<li>Test <code>RegisterAgent()</code> bi-directional streaming</li>
<li>Test <code>StreamMetrics()</code> bi-directional streaming</li>
<li>Test connection lifecycle management</li>
<li>Test error handling for invalid requests</li>
<li>Test stream reconnection behavior</li>
<li>Test concurrent stream handling</li>
</ul>
<p><strong>Metrics Aggregator Package</strong></p>
<ul>
<li>Test <code>CollectMetricsFromAgents()</code> on-demand collection</li>
<li>Test <code>GetLatestMetrics()</code> without time filter</li>
<li>Test <code>GetMetricsWindow()</code> with time filter</li>
<li>Test metrics enrichment with node metadata</li>
<li>Test concurrent metrics collection from multiple agents</li>
<li>Test time window filtering (agents filter from Flight Recorder)</li>
<li>Test node and role filtering</li>
</ul>
<p><strong>HTTP/REST API Package</strong></p>
<ul>
<li>Test all REST endpoints (GET/POST handlers)</li>
<li>Test request validation</li>
<li>Test response formatting (JSON, Prometheus text)</li>
<li>Test query parameter parsing</li>
<li>Test error handling and status codes</li>
<li>Test concurrent request handling</li>
<li>Test rate limiting (if implemented)</li>
</ul>
<h3 id="integration-testing">Integration Testing</h3>
<p><strong>Test Case 1: Agent Registration and Metrics Flow</strong></p>
<ul>
<li>Start Proxy server</li>
<li>Start mock Agent</li>
<li>Agent registers with Proxy</li>
<li>Query <code>/metrics-windows</code> endpoint (triggers metrics request)</li>
<li>Verify Proxy requests metrics from agent via StreamMetrics()</li>
<li>Verify agent retrieves metrics from Flight Recorder and sends response</li>
<li>Verify metrics appear in <code>/metrics-windows</code> endpoint response</li>
<li>Verify agent appears in <code>/cluster</code> endpoint</li>
<li>Stop agent and verify offline status</li>
</ul>
<p><strong>Test Case 2: Metrics Time Window</strong></p>
<ul>
<li>Start Proxy and multiple Agents</li>
<li>Query <code>/metrics-windows</code> with time range (triggers metrics request)</li>
<li>Verify Proxy requests metrics from all agents</li>
<li>Verify agents retrieve metrics from Flight Recorder and send responses</li>
<li>Verify metrics are filtered by time window if specified</li>
<li>Test edge cases (empty window, full window)</li>
</ul>
<p><strong>Test Case 3: Agent Reconnection</strong></p>
<ul>
<li>Start Proxy and Agent</li>
<li>Agent registers with Proxy</li>
<li>Query <code>/metrics-windows</code> endpoint (triggers metrics collection)</li>
<li>Simulate agent disconnection</li>
<li>Verify agent marked as offline</li>
<li>Query <code>/metrics-windows</code> endpoint again</li>
<li>Verify Proxy handles missing agent gracefully</li>
<li>Agent reconnects and re-registers</li>
<li>Verify agent marked as online</li>
<li>Query <code>/metrics-windows</code> endpoint again</li>
<li>Verify metrics collection resumes successfully</li>
</ul>
<p><strong>Test Case 4: Multiple Agents and Roles</strong></p>
<ul>
<li>Start Proxy</li>
<li>Start multiple Agents with different roles</li>
<li>Verify topology shows all nodes correctly</li>
<li>Verify metrics aggregation includes all nodes</li>
<li>Test role-based filtering in APIs</li>
</ul>
<h3 id="e2e-testing">E2E Testing</h3>
<p><strong>Test Case 1: Full FODC Proxy Workflow</strong></p>
<ul>
<li>Deploy Proxy in test environment</li>
<li>Deploy multiple Agents (liaison, datanode-hot, datanode-warm)</li>
<li>Agents register with Proxy</li>
<li>External Prometheus scraper queries <code>/metrics-windows</code> endpoint</li>
<li>Verify Proxy requests metrics from all agents</li>
<li>Verify agents retrieve metrics from Flight Recorder and respond</li>
<li>Verify metrics include node metadata</li>
<li>Verify cluster topology API</li>
</ul>
<p><strong>Test Case 2: High Availability and Scalability</strong></p>
<ul>
<li>Deploy Proxy with multiple agent connections (100+)</li>
<li>Verify Proxy handles concurrent connections</li>
<li>Verify on-demand metrics collection performance</li>
<li>Verify Proxy does not store metrics (memory efficient)</li>
<li>Test agent reconnection under load</li>
</ul>
<p><strong>Test Case 3: Failure Scenarios</strong></p>
<ul>
<li>Test Proxy behavior when agents disconnect</li>
<li>Test Proxy behavior with invalid agent data</li>
<li>Test Proxy behavior with network partitions</li>
<li>Test Proxy recovery after failures</li>
<li>Verify data consistency</li>
</ul>
<p><strong>Test Case 4: Prometheus Integration</strong></p>
<ul>
<li>Deploy Proxy with Prometheus</li>
<li>Configure Prometheus to scrape <code>/metrics</code> and <code>/metrics-windows</code></li>
<li>Verify metrics appear in Prometheus</li>
<li>Verify metric labels and metadata</li>
<li>Test Prometheus query performance</li>
</ul>

</div>
<div>
  
  
  
  <div id="edit-github">
    <svg
      fill="currentColor"
      height="20"
      width="20"
      viewBox="0 0 40 40"
      aria-hidden="true"
      style="margin-right: 0.1em;vertical-align: sub; color: #3176d9">
      <g>
        <path d="m34.5 11.7l-3 3.1-6.3-6.3 3.1-3q0.5-0.5 1.2-0.5t1.1 0.5l3.9 3.9q0.5 0.4 0.5 1.1t-0.5 1.2z m-29.5 17.1l18.4-18.5 6.3 6.3-18.4 18.4h-6.3v-6.2z" />
      </g>
    </svg>
    <a class="github-link" title="Edit this page" href="" target="_blank">
      <span id="edit-github-text">Edit this page</span>
    </a>
  </div>
  
</div>
<script>
  let reg = /\/docs\/[a-zA-Z\-]+\/([\w|\.]+)\//;
  let res = reg.exec(location.href);
  let version = res && res[1];
  let editGithub = document.getElementById("edit-github");
  if (editGithub) {
    editGithub.style.display = version === "next" ? "block" : "none";
  }
  
  if (version === "next") {
    reg = /\/docs\/(.+?)\//;
    let repoRes = reg.exec(location.href);
    let repo = repoRes && repoRes[1];
    if (repo === "main") {
      repo = "skywalking"
    }
    reg = /\/next\/(.+)/;
    let docs = reg.exec(location.href);
    let docsUrl = docs && docs[1];
    if (docsUrl) {
      docsUrl = docsUrl.replace(/readme/i, 'README');
    }
    let prefixUrl = "https://github.com/apache/" + repo + "/blob/master/docs/";
    let editGithubLink = document.querySelector("#edit-github a");
    if (editGithubLink) {
      editGithubLink.href = prefixUrl + docsUrl.replace(/\/$/, ".md");
    }
  }
</script>

            </main>
          <div id="toc" class="d-none d-xl-block col-xl-2 td-toc d-print-none">
            




<div class="td-page-meta ml-2 pb-1 pt-2 mb-0">











</div>






<nav id="TableOfContents">
  <ul>
    <li><a href="#fodc-proxy-development-design">FODC Proxy Development Design</a>
      <ul>
        <li><a href="#overview">Overview</a>
          <ul>
            <li><a href="#responsibilities">Responsibilities</a></li>
          </ul>
        </li>
        <li><a href="#component-design">Component Design</a>
          <ul>
            <li><a href="#1-proxy-components">1. Proxy Components</a></li>
            <li><a href="#2-agent-components">2. Agent Components</a></li>
          </ul>
        </li>
        <li><a href="#api-design">API Design</a>
          <ul>
            <li><a href="#grpc-api">gRPC API</a></li>
            <li><a href="#rest-api">REST API</a></li>
          </ul>
        </li>
        <li><a href="#data-flow">Data Flow</a>
          <ul>
            <li><a href="#agent-registration-flow">Agent Registration Flow</a></li>
            <li><a href="#metrics-collection-flow">Metrics Collection Flow</a></li>
            <li><a href="#metrics-query-flow">Metrics Query Flow</a></li>
          </ul>
        </li>
        <li><a href="#testing-strategy">Testing Strategy</a>
          <ul>
            <li><a href="#unit-testing">Unit Testing</a></li>
            <li><a href="#integration-testing">Integration Testing</a></li>
            <li><a href="#e2e-testing">E2E Testing</a></li>
          </ul>
        </li>
      </ul>
    </li>
  </ul>
</nav>




<script>
  $(function () {
    var $toc = $("#TableOfContents");
    if (!$toc || !$toc.length) {
      return;
    }
    var top = $toc.offset().top;
    $(window).on("scroll", debounce(setTop, 100))
    $(window).on("scroll", debounce(addActive, 30))

    function addActive() {
      var scrollValue = $(window).scrollTop();
      var topEle = null;
      $.each($('main h1, main h2, main h3'), function (index, item) {
        if ($(item).offset().top - 70 > scrollValue) {
          return
        }
        if (!topEle) {
          topEle = item
        } else if ($(item).offset().top >= $(topEle).offset().top) {
          topEle = item
        }
        if (topEle) {
          var id = $(item).attr('id');
          $toc.find('a').removeClass("active").end().find('a[href="' + '#' + id + '"]').addClass("active")
        }
      })
    }

    function setTop() {
      var scrollValue = $(window).scrollTop();
      if (scrollValue >= top - 70) {
        $toc.addClass('fixed')
      } else {
        $toc.removeClass('fixed')
      }
    }

    function debounce(fn, wait) {
      var timeout = null;
      return function () {
        clearTimeout(timeout);
        timeout = setTimeout(() => {
          fn.apply(this, arguments);
        }, wait);
      };
    }
  })

</script>

          </div>

        </div>
      </div>

      
<footer class="py-5 sky-row">
  <div class="container-fluid text-center">
    <div class="">
        
        
        
<ul class="list-inline mb-0">
  
  <li class="list-inline-item mx-2 h3" data-toggle="tooltip" data-placement="top" title="Twitter" aria-label="Twitter">
    <a class="text-color" target="_blank" href="https://twitter.com/asfskywalking">
      <i class="iconfont icon-twitter"></i>
    </a>
  </li>
  
  <li class="list-inline-item mx-2 h3" data-toggle="tooltip" data-placement="top" title="Slack" aria-label="Slack">
    <a class="text-color" target="_blank" href="http://s.apache.org/slack-invite">
      <i class="iconfont icon-slack"></i>
    </a>
  </li>
  
  <li class="list-inline-item mx-2 h3" data-toggle="tooltip" data-placement="top" title="Mailing list" aria-label="Mailing list">
    <a class="text-color" target="_blank" href="https://lists.apache.org/list.html?dev@skywalking.apache.org">
      <i class="iconfont icon-email"></i>
    </a>
  </li>
  
  <li class="list-inline-item mx-2 h3" data-toggle="tooltip" data-placement="top" title="GitHub" aria-label="GitHub">
    <a class="text-color" target="_blank" href="https://github.com/apache/skywalking">
      <i class="iconfont icon-github"></i>
    </a>
  </li>
  
</ul>

        
        
    </div>
    <div class="">

        <small class="text-color">&copy; 2017 - 2025 The Apache Software Foundation All Rights Reserved</small>
        
	
    </div>
    <div class="">
      <small class="text-color mt-4">Apache SkyWalking, SkyWalking, Apache, the Apache feather logo, and the Apache SkyWalking project logo are either registered trademarks or trademarks of the Apache Software Foundation.</small>
    </div>
  </div>
</footer>


    </div>
    



























































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































    
<div id="popup">
    <div class="mask">
        <img src=""/>
    </div>
</div>

    <div class="sidebar-mask"></div>
<div class="sidebar">
    <nav class="nav-links">
        <div class="nav-item"><a href="/docs/" class="nav-link">Projects and Documentation</a></div>
        <div class="nav-item"><a href="/events/" class="nav-link">Events</a></div>
        <div class="nav-item"><a href="/blog/" class="nav-link router-link-exact-active router-link-active">Blog</a>
        </div>
        <div class="nav-item"><a href="/downloads/" class="nav-link">Downloads</a></div>
        <div class="nav-item"><a href="/team/" class="nav-link">Team</a></div>
        <div class="nav-item"><a href="/users/" class="nav-link">Users</a></div>
        <div class="nav-item">
            <div class="dropdown-wrapper open">
                <a class="dropdown-title"><span>中文资料</span>
                    <span class="arrow down"></span>
                </a>
                <ul class="nav-dropdown">
                    <li class="dropdown-item">
                        <a href="/zh/" class="nav-link external">博客</a>
                    </li>
                    <li class="dropdown-item">
                        <a href="https://space.bilibili.com/390683219" target="_blank"
                           rel="noopener noreferrer" class="nav-link external">B站</a>
                    </li>
                    <li class="dropdown-item">
                        <a href="https://juejin.cn/user/13673577331607" target="_blank"
                           rel="noopener noreferrer" class="nav-link external">掘金</a>
                    </li>
                </ul>
            </div>
        </div>
        <div class="nav-item">
            <div class="dropdown-wrapper open">
                <a class="dropdown-title">
                    <span>Links</span>
                    <span class="arrow down"></span>
                </a>
                <ul class="nav-dropdown">
                    <li class="dropdown-item">
                        <a href="http://www.apache.org/" target="_blank"
                           rel="noopener noreferrer" class="nav-link external">
                            Apache Software Foundation
                        </a>
                    </li>
                    <li class="dropdown-item">
                        <a href="https://github.com/apache/skywalking/issues"
                           target="_blank" rel="noopener noreferrer"
                           class="nav-link external">
                            GitHub Issue Tracker
                        </a>
                    </li>
                    <li class="dropdown-item">
                        <a href="https://lists.apache.org/list.html?dev@skywalking.apache.org" target="_blank"
                           rel="noopener noreferrer" class="nav-link external">
                            Dev Mailing List
                        </a>
                    </li>
                    <li class="dropdown-item">
                        <a href="http://www.apache.org/licenses/" target="_blank"
                           rel="noopener noreferrer" class="nav-link external">
                            License
                        </a>
                    </li>
                    <li class="dropdown-item">
                        <a href="http://www.apache.org/events/current-event"
                           target="_blank" rel="noopener noreferrer"
                           class="nav-link external">
                            Apache Events
                        </a>
                    </li>
                    <li class="dropdown-item">
                        <a href="http://www.apache.org/security/" target="_blank"
                           rel="noopener noreferrer" class="nav-link external">
                            Security
                        </a>
                    </li>
                    <li class="dropdown-item">
                        <a href="http://www.apache.org/foundation/sponsorship.html"
                           target="_blank" rel="noopener noreferrer"
                           class="nav-link external">
                            Sponsorship and Donate
                        </a>
                    </li>
                    <li class="dropdown-item">
                        <a href="http://www.apache.org/foundation/thanks.html"
                           target="_blank" rel="noopener noreferrer"
                           class="nav-link external">
                            Thanks
                        </a>
                    </li>
                </ul>
            </div>
        </div>
    </nav>
</div>

    <script src="/js/bootstrap.bundle.min.js"></script>

<script src="/js/docsearch-3.9.0.js"></script>









<script src="/js/main.min.d00d7a99f9e61382b1db35fac38e0e7bdd97f8d3c663a4c4b8d02c3f1d78d894.js" integrity="sha256-0A16mfnmE4Kx2zX6w44Oe92X&#43;NPGY6TEuNAsPx142JQ=" crossorigin="anonymous"></script>


<script src="/js/highlight.min.js"></script>
<script src="/js/mermaid.min.js"></script>
<script>
    window.onload = () => mermaid.init(undefined, ".language-mermaid");
</script>
<script>
  document.addEventListener('DOMContentLoaded', () => {
    document.querySelectorAll('pre code.language-json5').forEach((block) => {
      if (block.classList.contains('language-json5')) {
        try {
          hljs.registerLanguage('json5', function(hljs) {
            return hljs.getLanguage('json');
          });
          hljs.highlightElement(block);
        } catch (error) {
          console.error("Error parsing JSON5:", error);
        }
      }
    });
  });
</script>


<script defer
src="/js/kapa-widget.bundle.js"
data-website-id="8a08392b-9c4d-4816-8bc4-f93e0ecdd2a7"
data-project-name="SkyWalking"
data-project-color="#2B74B8"
data-button-text="Ask AI"
data-search-mode-enabled="true"
data-modal-open-on-command-k="true"
data-modal-disclaimer="The AI supports multiple languages, but it may not be accessible in China, a proxy is required."
data-project-logo="/images/widget-logo.jpg"
data-modal-example-questions="What is Apache SkyWalking?,How to deploy SkyWalking?,How to inject agents non-intrusively?,How to setup trace sampling?"
data-button-position-top=""
data-button-position-right="20px"
data-button-position-bottom="200px"
data-button-position-left=""
data-consent-required="true"  
data-user-analytics-cookie-enabled="true"  
data-consent-screen-title="Help us improve our AI assistant"  
data-consent-screen-disclaimer="By clicking 'Allow tracking', you consent to anonymous user tracking which helps us improve our service. We don't collect any personally identifiable information."  
data-consent-screen-accept-button-text="Allow tracking"  
data-consent-screen-reject-button-text="No, thanks"
></script>




  </body>
  <script>
    $(function (){
      $('.doc-menu-button').on('click',function (){
        $('.td-sidebar').toggleClass('active')
      })
      $('.version-select').on('change', function (){
        var selectVersion = $(this).val().toLowerCase();
        var prefix = '';
        var url = location.href.replace(/(\/docs\/[a-zA-Z\-]+\/)([\w|\.]+)(\/.*)/, function (match, p1, p2, p3){
          prefix = p1 + selectVersion;
          return p1 + selectVersion + p3
        })
        go2SelectVersion(url, prefix)

      })
      function go2SelectVersion(url, prefix){
        $.ajax({
          url: url,
          type: "get",
          success:function(){
            location.href = url;
          },
          statusCode: {
            404:function(){
              location.href = prefix + '/readme/';
            }
          }
        });
      }
    })
  </script>
</html>
