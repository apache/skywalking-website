<!doctype html>
<html lang="en" class="no-js">
  <head>
    <meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<meta name="twitter:site" content="skywalking.apache.org">
<meta name="twitter:image:src" content="https://skywalking.apache.org/images/skywalking_400x400.png">
<meta property="og:image" content="https://skywalking.apache.org/images/skywalking_400x400.png">

<meta name="generator" content="Hugo 0.80.0" />

<META NAME="ROBOTS" CONTENT="INDEX, FOLLOW">
<link rel="stylesheet" href="/css/iconfont/iconfont.css">



<link rel="apple-touch-icon" sizes="180x180" href="/favicons/apple-touch-icon.png">
<link rel="icon" type="image/png" sizes="32x32" href="/favicons/favicon-32x32.png">
<link rel="icon" type="image/png" sizes="16x16" href="/favicons/favicon-16x16.png">
<link rel="manifest" href="/favicons/site.webmanifest">
<link rel="mask-icon" href="/favicons/safari-pinned-tab.svg" color="#5bbad5">
<meta name="msapplication-TileColor" content="#da532c">
<meta name="theme-color" content="#ffffff">

<title>Watchdog And Flight Recorder Development Design | Apache SkyWalking</title><meta property="og:title" content="Watchdog And Flight Recorder Development Design" />
<meta property="og:description" content="Watchdog And Flight Recorder Development Design Table of Contents  Overview Component Design Data Flow Testing Strategy Appendix  Overview The First Occurrence Data Collection (FODC) infrastructure consists of two main components working together to ensure metrics data survivability in BanyanDB:
Watchdog: Periodically polls metrics from the BanyanDB container and forwards them to the Flight Recorder for buffering.
Flight Recorder: Buffers metrics data using fixed-size circular buffers (RingBuffer) with in-memory storage, ensuring data persists even when the main BanyanDB process crashes." />
<meta property="og:type" content="article" />
<meta property="og:url" content="/docs/skywalking-banyandb/next/design/fodc/watchdog-and-flight-recoder/" />

<meta itemprop="name" content="Watchdog And Flight Recorder Development Design">
<meta itemprop="description" content="Watchdog And Flight Recorder Development Design Table of Contents  Overview Component Design Data Flow Testing Strategy Appendix  Overview The First Occurrence Data Collection (FODC) infrastructure consists of two main components working together to ensure metrics data survivability in BanyanDB:
Watchdog: Periodically polls metrics from the BanyanDB container and forwards them to the Flight Recorder for buffering.
Flight Recorder: Buffers metrics data using fixed-size circular buffers (RingBuffer) with in-memory storage, ensuring data persists even when the main BanyanDB process crashes.">

<meta itemprop="wordCount" content="2576">



<meta itemprop="keywords" content="" />
<meta name="twitter:card" content="summary"/>
<meta name="twitter:title" content="Watchdog And Flight Recorder Development Design"/>
<meta name="twitter:description" content="Watchdog And Flight Recorder Development Design Table of Contents  Overview Component Design Data Flow Testing Strategy Appendix  Overview The First Occurrence Data Collection (FODC) infrastructure consists of two main components working together to ensure metrics data survivability in BanyanDB:
Watchdog: Periodically polls metrics from the BanyanDB container and forwards them to the Flight Recorder for buffering.
Flight Recorder: Buffers metrics data using fixed-size circular buffers (RingBuffer) with in-memory storage, ensuring data persists even when the main BanyanDB process crashes."/>



<link rel="preload" href="/scss/main.min.87646025889dabea717b27775dce3ff0338fa9fca8fd9c6b316d56f659f4142c.css" as="style">
<link href="/scss/main.min.87646025889dabea717b27775dce3ff0338fa9fca8fd9c6b316d56f659f4142c.css" rel="stylesheet" integrity="">



<link rel="stylesheet" href="/css/docSearch.css" />
<link rel="stylesheet" href="/css/highlight-github.css" />


<script src="/js/jquery-3.6.0.min.js"></script>





    <title>Watchdog And Flight Recorder Development Design | Apache SkyWalking</title>
  </head>
  <body class="td-page  project-doc">
    <header>
      
<nav class="js-navbar-scroll navbar navbar-expand  flex-column flex-md-row td-navbar">
    <div class="sidebar-button">
      <i class="iconfont icon-menu"></i>
    </div>
    <a class="navbar-brand" href="/">
        <span class="navbar-logo"><img width="130" src="/images/logo.svg" alt="SkyWalking"></span> 
    </a>
    <div class="td-navbar-nav-scroll navbar-nav-wrapper" id="navigation">
        <ul class="navbar-nav mt-lg-0">
             
            
            
            <li class="nav-item mr-3 mb-lg-0">
				
				
				
				
				<a class="nav-link" href="/docs" ><span>Projects and Docs</span></a>
			</li>
            
            
            
            
            <li class="nav-item mr-3 mb-lg-0">
				
				
				
				
				<a class="nav-link" href="/events" ><span>Events</span></a>
			</li>
            
            
            
            
            <li class="nav-item mr-3 mb-lg-0">
				
				
				
				
				<a class="nav-link" href="/blog" ><span>Blogs</span></a>
			</li>
            
            
            
            
            <li class="nav-item mr-3 mb-lg-0">
				
				
				
				
				<a class="nav-link" href="/downloads" ><span>Downloads</span></a>
			</li>
            
            
            
            
            <li class="nav-item mr-3 mb-lg-0">
				
				
				
				
				<a class="nav-link" href="/team" ><span>Team</span></a>
			</li>
            
            
            
            
            <li class="nav-item mr-3 mb-lg-0">
				
				
				
				
				<a class="nav-link" href="/users" ><span>Users</span></a>
			</li>
            
            
            
            
            
            <li class="nav-item mr-3 mb-lg-0">
                <span class="link dropdown blog">
                    <a class="link-name nav-link dropdown-toggle" href="#" role="button" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">中文资料</a>
                    <div class="dropdown-menu">
                        <a class="dropdown-item" href="/zh/">博客</a>
                        <a class="dropdown-item" href="https://space.bilibili.com/390683219" target="_blank" rel="noopener noreferrer">
                            B站
                        </a>
                        <a class="dropdown-item" href="https://juejin.cn/user/13673577331607" target="_blank" rel="noopener noreferrer">
                            掘金
                        </a>
                    </div>
                </span>
            </li>

            
			
        </ul>
    </div>
    <div class="navbar-nav d-none d-lg-block search-input-box">
         
            
        
            
        
            
        
            
        
            
        
            
        
            
            <span class="link dropdown">
                <a class="link-name dropdown-toggle" href="#" role="button" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
                    Links
                </a>
                <div class="dropdown-menu">
                    
                    <a class="dropdown-item" href="http://www.apache.org/">Apache Software Foundation</a> 
                    <a class="dropdown-item" href="https://github.com/apache/skywalking/issues">GitHub Issue Tracker</a> 
                    <a class="dropdown-item" href="https://github.com/apache/skywalking/discussions">Discussion</a> 
                    <a class="dropdown-item" href="https://lists.apache.org/list.html?dev@skywalking.apache.org">Dev Mailing List</a> 
                    <a class="dropdown-item" href="https://cwiki.apache.org/confluence/display/SKYWALKING/Home">WIKI</a> 
                    <a class="dropdown-item" href="http://www.apache.org/licenses/">License</a> 
                    <a class="dropdown-item" href="http://www.apache.org/events/current-event">Apache Events</a> 
                    <a class="dropdown-item" href="http://www.apache.org/security/">Security</a> 
                    <a class="dropdown-item" href="http://www.apache.org/foundation/sponsorship.html">Sponsor and Donate</a> 
                    <a class="dropdown-item" href="http://www.apache.org/foundation/thanks.html">Thanks</a> 
                    <a class="dropdown-item" href="https://apache.org/foundation/policies/privacy.html">Privacy</a> 
                </div>
            </span>
            
        
        
<div id="docsearch"></div>


    </div>
</nav>

    </header>
    <div class="container-fluid td-outer">

      <div class="td-main">
        <div class="row flex-xl-nowrap">
          <div class="col-12 col-md-3 col-xl-2 d-print-none scroll-bar td-sidebar">










































                  <div class="description-wrapper">
                    <h5>
                    <img width="26" height="26" src="/images/project/banyan-db.svg">
                    BanyanDB
                    </h5>
                    <p>An observability database aims to ingest, analyze and store Metrics, Tracing and Logging data.</p>
                  </div>
                  
                  <div class="version-wrapper">Version: 
                  <select class="version-select">
                  
                    
                    
                    <option selected value="next">
                    
                      next
                    
                    </option>
                  
                    
                    
                    <option ZgotmplZ value="latest">
                    
                      latest
                    
                    </option>
                  
                    
                    
                    <option ZgotmplZ value="v0.9.0">
                    
                      v0.9.0
                    
                    </option>
                  
                  </select>
                  </div>
                  
                  <ul class="sidebar-menu">
    
    <li>
        
            <a href="/docs/skywalking-banyandb/next/readme">Welcome</a>
        
    </li>
    
    <li>
        
            
            <a href="#">User Guide<i class="iconfont icon-arrow-right pull-right"></i></a>
            

            
<ul class="sidebar-submenu">
    

    <li>
        

            
            <a href="#">Installation<i class="iconfont icon-arrow-right pull-right"></i></a>
            

            
<ul class="sidebar-submenu">
    

    <li>
        
            <a href="/docs/skywalking-banyandb/next/installation/binaries">Get Binaries</a>
        
    </li>

    

    <li>
        
            <a href="/docs/skywalking-banyandb/next/installation/standalone">Standalone Mode</a>
        
    </li>

    

    <li>
        
            <a href="/docs/skywalking-banyandb/next/installation/cluster">Cluster Mode</a>
        
    </li>

    

    <li>
        
            <a href="/docs/skywalking-banyandb/next/installation/docker">Installation On Docker</a>
        
    </li>

    

    <li>
        
            <a href="/docs/skywalking-banyandb/next/installation/kubernetes">Installation On Kubernetes</a>
        
    </li>

    

</ul>

        
    </li>

    

    <li>
        

            
            <a href="#">Basic Concepts and Terminology<i class="iconfont icon-arrow-right pull-right"></i></a>
            

            
<ul class="sidebar-submenu">
    

    <li>
        
            <a href="/docs/skywalking-banyandb/next/concept/data-model">Data Model</a>
        
    </li>

    

</ul>

        
    </li>

    

    <li>
        
            <a href="/docs/skywalking-banyandb/next/guides/quick-start/quick-start">Quick Start Tutorial</a>
        
    </li>

    

    <li>
        
            <a href="/docs/skywalking-banyandb/next/installation/versions">Versions and Compatibility</a>
        
    </li>

    

</ul>

        
    </li>
    
    <li>
        
            
            <a href="#">Interacting<i class="iconfont icon-arrow-right pull-right"></i></a>
            

            
<ul class="sidebar-submenu">
    

    <li>
        

            
            <a href="#">CLI<i class="iconfont icon-arrow-right pull-right"></i></a>
            

            
<ul class="sidebar-submenu">
    

    <li>
        
            <a href="/docs/skywalking-banyandb/next/interacting/bydbctl/bydbctl">bydbctl</a>
        
    </li>

    

    <li>
        

            
            <a href="#">CRUD Schema<i class="iconfont icon-arrow-right pull-right"></i></a>
            

            
<ul class="sidebar-submenu">
    

    <li>
        
            <a href="/docs/skywalking-banyandb/next/interacting/bydbctl/schema/group">Group</a>
        
    </li>

    

    <li>
        
            <a href="/docs/skywalking-banyandb/next/interacting/bydbctl/schema/measure">Measure</a>
        
    </li>

    

    <li>
        
            <a href="/docs/skywalking-banyandb/next/interacting/bydbctl/schema/stream">Stream</a>
        
    </li>

    

    <li>
        
            <a href="/docs/skywalking-banyandb/next/interacting/bydbctl/schema/index-rule">IndexRule</a>
        
    </li>

    

    <li>
        
            <a href="/docs/skywalking-banyandb/next/interacting/bydbctl/schema/index-rule-binding">IndexRuleBinding</a>
        
    </li>

    

    <li>
        
            <a href="/docs/skywalking-banyandb/next/interacting/bydbctl/schema/top-n-aggregation">Top N Aggregation</a>
        
    </li>

    

</ul>

        
    </li>

    

    <li>
        

            
            <a href="#">Querying Data<i class="iconfont icon-arrow-right pull-right"></i></a>
            

            
<ul class="sidebar-submenu">
    

    <li>
        
            <a href="/docs/skywalking-banyandb/next/interacting/bydbctl/query/measure">Measure</a>
        
    </li>

    

    <li>
        
            <a href="/docs/skywalking-banyandb/next/interacting/bydbctl/query/stream">Stream</a>
        
    </li>

    

    <li>
        
            <a href="/docs/skywalking-banyandb/next/interacting/bydbctl/query/filter-operation">Filter Operation</a>
        
    </li>

    

    <li>
        
            <a href="/docs/skywalking-banyandb/next/interacting/bydbctl/query/top-n-aggregation">Top N Aggregation</a>
        
    </li>

    

</ul>

        
    </li>

    

    <li>
        
            <a href="/docs/skywalking-banyandb/next/interacting/bydbctl/property">CRUD Property</a>
        
    </li>

    

    <li>
        
            <a href="/docs/skywalking-banyandb/next/interacting/bydbctl/analyze">Analyzing Data</a>
        
    </li>

    

</ul>

        
    </li>

    

    <li>
        

            
            <a href="#">Web UI<i class="iconfont icon-arrow-right pull-right"></i></a>
            

            
<ul class="sidebar-submenu">
    

    <li>
        
            <a href="/docs/skywalking-banyandb/next/interacting/web-ui/dashboard">Dashboard</a>
        
    </li>

    

    <li>
        

            
            <a href="#">CRUD Schema<i class="iconfont icon-arrow-right pull-right"></i></a>
            

            
<ul class="sidebar-submenu">
    

    <li>
        
            <a href="/docs/skywalking-banyandb/next/interacting/web-ui/schema/group">Group</a>
        
    </li>

    

    <li>
        
            <a href="/docs/skywalking-banyandb/next/interacting/web-ui/schema/measure">Measure</a>
        
    </li>

    

    <li>
        
            <a href="/docs/skywalking-banyandb/next/interacting/web-ui/schema/stream">Stream</a>
        
    </li>

    

    <li>
        
            <a href="/docs/skywalking-banyandb/next/interacting/web-ui/schema/index-rule">IndexRule</a>
        
    </li>

    

    <li>
        
            <a href="/docs/skywalking-banyandb/next/interacting/web-ui/schema/index-rule-binding">IndexRuleBinding</a>
        
    </li>

    

    <li>
        
            <a href="/docs/skywalking-banyandb/next/interacting/web-ui/schema/top-n-aggregation">Top N Aggregation</a>
        
    </li>

    

</ul>

        
    </li>

    

    <li>
        

            
            <a href="#">Querying Data<i class="iconfont icon-arrow-right pull-right"></i></a>
            

            
<ul class="sidebar-submenu">
    

    <li>
        
            <a href="/docs/skywalking-banyandb/next/interacting/web-ui/query/measure">Measure</a>
        
    </li>

    

    <li>
        
            <a href="/docs/skywalking-banyandb/next/interacting/web-ui/query/stream">Stream</a>
        
    </li>

    

</ul>

        
    </li>

    

    <li>
        
            <a href="/docs/skywalking-banyandb/next/interacting/web-ui/property">CRUD Property</a>
        
    </li>

    

</ul>

        
    </li>

    

    <li>
        
            <a href="/docs/skywalking-banyandb/next/interacting/client">Client APIs</a>
        
    </li>

    

    <li>
        
            <a href="/docs/skywalking-banyandb/next/interacting/data-lifecycle">Data Lifecycle</a>
        
    </li>

    

    <li>
        
            <a href="/docs/skywalking-banyandb/next/interacting/bydbql">BydbQL</a>
        
    </li>

    

</ul>

        
    </li>
    
    <li>
        
            
            <a href="#">Operation and Maintenance<i class="iconfont icon-arrow-right pull-right"></i></a>
            

            
<ul class="sidebar-submenu">
    

    <li>
        
            <a href="/docs/skywalking-banyandb/next/operation/configuration">Configure BanyanDB</a>
        
    </li>

    

    <li>
        
            <a href="/docs/skywalking-banyandb/next/operation/disk-management">Disk Management</a>
        
    </li>

    

    <li>
        
            <a href="/docs/skywalking-banyandb/next/operation/system">System Configuration</a>
        
    </li>

    

    <li>
        
            <a href="/docs/skywalking-banyandb/next/operation/upgrade">Upgrade</a>
        
    </li>

    

    <li>
        
            <a href="/docs/skywalking-banyandb/next/operation/observability">Observability</a>
        
    </li>

    

    <li>
        
            <a href="/docs/skywalking-banyandb/next/operation/cluster">Cluster Management</a>
        
    </li>

    

    <li>
        

            
            <a href="#">Troubleshooting<i class="iconfont icon-arrow-right pull-right"></i></a>
            

            
<ul class="sidebar-submenu">
    

    <li>
        
            <a href="/docs/skywalking-banyandb/next/operation/troubleshooting/error-checklist">Error Checklist</a>
        
    </li>

    

    <li>
        
            <a href="/docs/skywalking-banyandb/next/operation/troubleshooting/install">Troubleshooting Installation</a>
        
    </li>

    

    <li>
        
            <a href="/docs/skywalking-banyandb/next/operation/troubleshooting/crash">Troubleshooting Crash</a>
        
    </li>

    

    <li>
        
            <a href="/docs/skywalking-banyandb/next/operation/troubleshooting/no-data">Troubleshooting No Data</a>
        
    </li>

    

    <li>
        
            <a href="/docs/skywalking-banyandb/next/operation/troubleshooting/overhead">Troubleshooting Overhead</a>
        
    </li>

    

    <li>
        
            <a href="/docs/skywalking-banyandb/next/operation/troubleshooting/query">Troubleshooting Query</a>
        
    </li>

    

</ul>

        
    </li>

    

    <li>
        
            <a href="/docs/skywalking-banyandb/next/operation/security">Security</a>
        
    </li>

    

    <li>
        
            <a href="/docs/skywalking-banyandb/next/operation/backup">Backup</a>
        
    </li>

    

    <li>
        
            <a href="/docs/skywalking-banyandb/next/operation/restore">Restore</a>
        
    </li>

    

    <li>
        
            <a href="/docs/skywalking-banyandb/next/operation/lifecycle">Lifecycle Management</a>
        
    </li>

    

    <li>
        

            
            <a href="#">MCP Server<i class="iconfont icon-arrow-right pull-right"></i></a>
            

            
<ul class="sidebar-submenu">
    

    <li>
        
            <a href="/docs/skywalking-banyandb/next/operation/mcp/setup">Setup MCP</a>
        
    </li>

    

    <li>
        
            <a href="/docs/skywalking-banyandb/next/operation/mcp/inspector">Test via Inspector</a>
        
    </li>

    

    <li>
        
            <a href="/docs/skywalking-banyandb/next/operation/mcp/build">Build and Package</a>
        
    </li>

    

</ul>

        
    </li>

    

    <li>
        

            
            <a href="#">First Occurrence Data Collection (FODC)<i class="iconfont icon-arrow-right pull-right"></i></a>
            

            
<ul class="sidebar-submenu">
    

    <li>
        
            <a href="/docs/skywalking-banyandb/next/operation/fodc/overview">Overview</a>
        
    </li>

    

    <li>
        
            <a href="/docs/skywalking-banyandb/next/operation/fodc/ktm_metrics">KTM Metrics</a>
        
    </li>

    

</ul>

        
    </li>

    

    <li>
        
            <a href="/docs/skywalking-banyandb/next/concept/property-repair">Property Background Repair</a>
        
    </li>

    

    <li>
        

            
            <a href="#">Benchmark<i class="iconfont icon-arrow-right pull-right"></i></a>
            

            
<ul class="sidebar-submenu">
    

    <li>
        
            <a href="/docs/skywalking-banyandb/next/operation/benchmark/benchmark-single-model">Single‑Model Benchmark (Trace / Log / Measure / Property)</a>
        
    </li>

    

    <li>
        
            <a href="/docs/skywalking-banyandb/next/operation/benchmark/benchmark-hybrid">Hybrid Scenario Benchmark</a>
        
    </li>

    

</ul>

        
    </li>

    

</ul>

        
    </li>
    
    <li>
        
            
            <a href="#">File Format<i class="iconfont icon-arrow-right pull-right"></i></a>
            

            
<ul class="sidebar-submenu">
    

    <li>
        
            <a href="/docs/skywalking-banyandb/next/concept/tsdb">v1.3.0</a>
        
    </li>

    

</ul>

        
    </li>
    
    <li>
        
            
            <a href="#">Concepts<i class="iconfont icon-arrow-right pull-right"></i></a>
            

            
<ul class="sidebar-submenu">
    

    <li>
        
            <a href="/docs/skywalking-banyandb/next/concept/clustering">Clustering</a>
        
    </li>

    

    <li>
        
            <a href="/docs/skywalking-banyandb/next/concept/tsdb">TSDB</a>
        
    </li>

    

    <li>
        
            <a href="/docs/skywalking-banyandb/next/concept/rotation">Data Rotation</a>
        
    </li>

    

    <li>
        
            <a href="/docs/skywalking-banyandb/next/concept/property-repair">Property Background Repair</a>
        
    </li>

    

</ul>

        
    </li>
    
    <li>
        
            
            <a href="#">Contribute<i class="iconfont icon-arrow-right pull-right"></i></a>
            

            
<ul class="sidebar-submenu">
    

    <li>
        
            <a href="/docs/skywalking-banyandb/next/contribute/debugging">Debugging</a>
        
    </li>

    

</ul>

        
    </li>
    
</ul>
<script src="/js/sidebar-menu.js"></script>
<script>
  (function (){
    $.sidebarMenu($('.sidebar-menu'))
    var path = window.location.pathname;
    var hash = window.location.hash;
    var $a = $('.sidebar-menu a')
    $a.each(function (e){
      if($(this).attr('href')+'/' === path || $(this).attr('href').replace('#','/#') === path+hash){
        $(this).parents('li').addClass('active').show()
      }
    })
    $a.on('click',function (){
      var url = $(this).attr('href')
      if(url!=='#'){
        window.location.href = url
      }
    })
  })()
</script>

                  <div class="commit-id">Commit Id: a63ae2a</div>
                






</div>
            <main class="col-12 col-md-9 col-xl-8 pl-md-5 pr-md-4" role="main">
              <i class="iconfont icon-menu-doc doc-menu-button"></i>
              
<div class="td-content">
	<h1 id="watchdog-and-flight-recorder-development-design">Watchdog And Flight Recorder Development Design</h1>
<h2 id="table-of-contents">Table of Contents</h2>
<ol>
<li><a href="#overview">Overview</a></li>
<li><a href="#component-design">Component Design</a></li>
<li><a href="#data-flow">Data Flow</a></li>
<li><a href="#testing-strategy">Testing Strategy</a></li>
<li><a href="#appendix">Appendix</a></li>
</ol>
<h2 id="overview">Overview</h2>
<p>The First Occurrence Data Collection (FODC) infrastructure consists of two main components working together to ensure metrics data survivability in BanyanDB:</p>
<p><strong>Watchdog</strong>: Periodically polls metrics from the BanyanDB container and forwards them to the Flight Recorder for buffering.</p>
<p><strong>Flight Recorder</strong>: Buffers metrics data using fixed-size circular buffers (RingBuffer) with in-memory storage, ensuring data persists even when the main BanyanDB process crashes.</p>
<p>Together, these components capture and preserve metrics data to ensure that critical observability data is not lost during process crashes.</p>
<h3 id="responsibilities">Responsibilities</h3>
<p><strong>Watchdog Component</strong></p>
<ul>
<li>Polls metrics from BanyanDB at configurable intervals</li>
<li>Parses Prometheus text format metrics efficiently</li>
<li>Forwards collected metrics to Flight Recorder for buffering</li>
<li>Handles connection failures and retries gracefully</li>
<li>Monitors BanyanDB process health</li>
</ul>
<p><strong>Flight Recorder Component</strong></p>
<ul>
<li>Maintains a fixed-size circular buffer (RingBuffer) per metric in the <code>metrics</code> map</li>
<li>Uses a shared <code>timestamps</code> RingBuffer to store timestamps for each polling cycle</li>
<li>Stores metric descriptions in the <code>descriptions</code> map, keyed by metric name+labels</li>
<li>Stores metrics in-memory to ensure fast access and persistence across process crashes</li>
<li>Manages buffer capacity and handles overflow scenarios using circular overwrite behavior</li>
<li>Tracks write positions using <code>next</code>, <code>count</code>, and <code>n</code> fields for circular buffer management</li>
<li>Ensures data integrity and prevents data loss during crashes</li>
</ul>
<h3 id="component-interaction-flow">Component Interaction Flow</h3>
<pre><code>BanyanDB Metrics Endpoint
         │
         │ (HTTP GET /metrics)
         ▼
    Watchdog Component
         │
         │ (Poll at interval)
         │
         │ Parse Prometheus Format
         │
         │ Forward Metrics
         ▼
    Flight Recorder Component
         │
         │ Write to RingBuffer
         │
         │ (Per-metric buffers)
         ▼
    In-Memory Storage (Datasources)
         │
         │ (Read metrics)
         ▼
    Prometheus Metrics Exporter
         │
         │ (Collect via prometheus.Collector)
         │
         │ Convert to Prometheus Format
         ▼
    Prometheus Registry
         │
         │ (HTTP GET /metrics)
         ▼
    Prometheus Scraper
</code></pre><h2 id="component-design">Component Design</h2>
<h3 id="1-watchdog-component">1. Watchdog Component</h3>
<p><strong>Purpose</strong>: Periodically polls metrics from BanyanDB and forwards them to Flight Recorder</p>
<h4 id="core-responsibilities">Core Responsibilities</h4>
<ul>
<li><strong>Metrics Polling</strong>: Polls metrics from BanyanDB metrics endpoint at configurable intervals</li>
<li><strong>Metrics Parsing</strong>: Uses metrics package to parse Prometheus text format efficiently</li>
<li><strong>Error Handling</strong>: Implements exponential backoff for transient failures</li>
<li><strong>Health Monitoring</strong>: Tracks BanyanDB process health and reports status</li>
</ul>
<h4 id="core-types">Core Types</h4>
<p><strong><code>Watchdog</code></strong></p>
<div class="highlight"><pre style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-go" data-lang="go"><span style="color:#000;font-weight:bold">type</span> Watchdog <span style="color:#000;font-weight:bold">struct</span> {
	client       <span style="color:#000;font-weight:bold">*</span>http.Client
	url          <span style="color:#458;font-weight:bold">string</span>
	interval     time.Duration
}
</code></pre></div><h4 id="key-functions">Key Functions</h4>
<p><strong><code>Start(ctx context.Context) error</code></strong></p>
<ul>
<li>Initializes the watchdog component</li>
<li>Starts polling loop with configurable interval</li>
<li>Sets up HTTP client with connection reuse</li>
<li>Begins periodic metrics collection</li>
</ul>
<p><strong><code>Stop(ctx context.Context) error</code></strong></p>
<ul>
<li>Gracefully stops the polling loop</li>
<li>Closes HTTP connections</li>
<li>Ensures in-flight requests complete</li>
</ul>
<p><strong><code>pollMetrics(ctx context.Context) ([]metrics.RawMetric, error)</code></strong></p>
<ul>
<li>Fetches raw metrics text from endpoint</li>
<li>Uses metrics package to parse Prometheus text format</li>
<li>Returns parsed metrics or error</li>
<li>Implements retry logic with exponential backoff</li>
</ul>
<h4 id="configuration-flags">Configuration Flags</h4>
<p><strong><code>--poll-metrics-interval</code></strong></p>
<ul>
<li><strong>Type</strong>: <code>duration</code></li>
<li><strong>Default</strong>: <code>10s</code></li>
<li><strong>Description</strong>: Interval at which the Watchdog polls metrics from the BanyanDB container</li>
</ul>
<p><strong><code>--metrics-endpoint</code></strong></p>
<ul>
<li><strong>Type</strong>: <code>string</code></li>
<li><strong>Default</strong>: <code>http://localhost:2121/metrics</code></li>
<li><strong>Description</strong>: URL of the BanyanDB metrics endpoint to poll from</li>
</ul>
<p><strong><code>--max-metrics-memory-usage-percentage</code></strong></p>
<ul>
<li><strong>Type</strong>: <code>int</code></li>
<li><strong>Default</strong>: <code>10</code></li>
<li><strong>Description</strong>: Maximum percentage of available memory (based on cgroup memory limit) that can be used for storing metrics in the Flight Recorder. The memory limit is obtained from the container&rsquo;s cgroup configuration (see <code>pkg/cgroups/memory.go</code>). When metrics memory usage exceeds this percentage, the Flight Recorder will stop accepting new metrics or evict older data. Valid range: 0-100.</li>
</ul>
<h3 id="2-flight-recorder-component">2. Flight Recorder Component</h3>
<p><strong>Purpose</strong>: Buffers metrics data using fixed-size circular buffers with in-memory storage</p>
<h4 id="core-responsibilities-1">Core Responsibilities</h4>
<ul>
<li><strong>Metrics Buffering</strong>: Maintains a fixed-size RingBuffer per metric</li>
<li><strong>Data Persistence</strong>: Ensures metrics survive process crashes</li>
<li><strong>Overflow Handling</strong>: Implements circular overwrite behavior when buffers are full</li>
</ul>
<h4 id="core-types-1">Core Types</h4>
<p><strong><code>RingBuffer[T]</code></strong> (Generic Ring Buffer)</p>
<div class="highlight"><pre style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-go" data-lang="go"><span style="color:#000;font-weight:bold">type</span> RingBuffer[T any] <span style="color:#000;font-weight:bold">struct</span> {
   next   <span style="color:#458;font-weight:bold">int</span>         <span style="color:#998;font-style:italic">// Next write position in the circular buffer
</span><span style="color:#998;font-style:italic"></span>   values []T         <span style="color:#998;font-style:italic">// Fixed-size buffer for values of type T
</span><span style="color:#998;font-style:italic"></span>}

<span style="color:#998;font-style:italic">// NewRingBuffer creates a new RingBuffer.
</span><span style="color:#998;font-style:italic"></span><span style="color:#000;font-weight:bold">func</span> NewRingBuffer[T any](..<span style="color:#000;font-weight:bold">/</span>) <span style="color:#000;font-weight:bold">*</span>RingBuffer[T]

<span style="color:#998;font-style:italic">// Add adds a value to the ring buffer.
</span><span style="color:#998;font-style:italic"></span><span style="color:#000;font-weight:bold">func</span> (rb <span style="color:#000;font-weight:bold">*</span>RingBuffer[T]) <span style="color:#900;font-weight:bold">Add</span>(v T)
</code></pre></div><ul>
<li>Stores values of any type T in a circular buffer</li>
<li>Implements circular overwrite behavior when buffer is full</li>
<li>Provides type-safe operations for both float64 and int64 values</li>
</ul>
<p><strong><code>MetricRingBuffer</code></strong></p>
<div class="highlight"><pre style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-go" data-lang="go"><span style="color:#000;font-weight:bold">type</span> MetricRingBuffer = RingBuffer[<span style="color:#458;font-weight:bold">float64</span>]

<span style="color:#998;font-style:italic">// NewMetricRingBuffer creates a new MetricRingBuffer.
</span><span style="color:#998;font-style:italic"></span><span style="color:#000;font-weight:bold">func</span> <span style="color:#900;font-weight:bold">NewMetricRingBuffer</span>() <span style="color:#000;font-weight:bold">*</span>MetricRingBuffer
</code></pre></div><p><strong><code>TimestampRingBuffer</code></strong></p>
<div class="highlight"><pre style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-go" data-lang="go"><span style="color:#000;font-weight:bold">type</span> TimestampRingBuffer = RingBuffer[<span style="color:#458;font-weight:bold">int64</span>]

<span style="color:#998;font-style:italic">// NewTimestampRingBuffer creates a new TimestampRingBuffer.
</span><span style="color:#998;font-style:italic"></span><span style="color:#000;font-weight:bold">func</span> <span style="color:#900;font-weight:bold">NewTimestampRingBuffer</span>() <span style="color:#000;font-weight:bold">*</span>TimestampRingBuffer
</code></pre></div><ul>
<li>Type alias for RingBuffer[int64] for storing timestamps</li>
<li>Stores timestamps in a circular buffer</li>
<li>Implements circular overwrite behavior when buffer is full</li>
</ul>
<p><strong><code>FlightRecorder</code></strong></p>
<div class="highlight"><pre style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-go" data-lang="go"><span style="color:#000;font-weight:bold">type</span> Datasource <span style="color:#000;font-weight:bold">struct</span> {
   metrics        <span style="color:#000;font-weight:bold">map</span>[<span style="color:#458;font-weight:bold">string</span>]<span style="color:#000;font-weight:bold">*</span>MetricRingBuffer <span style="color:#998;font-style:italic">// Map from metric name+labels to RingBuffer storing metric values
</span><span style="color:#998;font-style:italic"></span>   timestamps     TimestampRingBuffer          <span style="color:#998;font-style:italic">// RingBuffer storing timestamps for each polling cycle
</span><span style="color:#998;font-style:italic"></span>   descriptions   <span style="color:#000;font-weight:bold">map</span>[<span style="color:#458;font-weight:bold">string</span>]<span style="color:#458;font-weight:bold">string</span>            <span style="color:#998;font-style:italic">// Map from metric name to HELP content descriptions
</span><span style="color:#998;font-style:italic"></span>   Capacity       <span style="color:#458;font-weight:bold">int</span>                          <span style="color:#998;font-style:italic">// Number of writable metrics length
</span><span style="color:#998;font-style:italic"></span>   TotalWritten   <span style="color:#458;font-weight:bold">uint64</span>                       <span style="color:#998;font-style:italic">// Total number of values written (wraps around)
</span><span style="color:#998;font-style:italic"></span>}
<span style="color:#000;font-weight:bold">type</span> FlightRecorder <span style="color:#000;font-weight:bold">struct</span> {
	Datasources   []<span style="color:#000;font-weight:bold">*</span>Datasource
	CapacitySize  <span style="color:#458;font-weight:bold">int</span>                           <span style="color:#998;font-style:italic">// memory limit
</span><span style="color:#998;font-style:italic"></span>}
</code></pre></div><h4 id="key-functions-1">Key Functions</h4>
<p><strong><code>RingBuffer[T].Add(v T, capacity int)</code></strong></p>
<ul>
<li>Generic method that adds a value of type T to the ring buffer</li>
<li>Implements circular overwrite behavior when buffers are full, compare the capacity with  current MetricRingBuffer capacity, and manage the buffer with FIFO based on the next write position</li>
<li>Updates the next write position</li>
<li>Works for both <code>RingBuffer[float64]</code> and <code>RingBuffer[int64]</code></li>
</ul>
<p><strong><code>MetricRingBuffer.Update(v float64, capacity int)</code></strong></p>
<ul>
<li>Adds a metric value to the metric ring buffer</li>
<li>Updates the embedded RingBuffer[float64]</li>
</ul>
<p><strong><code>TimestampRingBuffer.Update(v int64, capacity int)</code></strong></p>
<ul>
<li>Adds a timestamp value to the timestamp ring buffer</li>
<li>Uses the generic RingBuffer[int64].Add() method</li>
</ul>
<p><strong><code>Datasource.Update(m *metric.RawMetric)</code></strong></p>
<ul>
<li>Sorts labels for consistent key generation</li>
<li>Creates MetricKey string from metric name and labels (e.g., &ldquo;http_requests{method=&quot;get&quot;}&quot;)</li>
<li>Update Datasource.MetricBuffers with MetricKey. Please don&rsquo;t add any values</li>
<li>Get the total count of each RingBuffer based on the capacity of the Datasource.MetricBuffers and the memory limitation</li>
<li>Create or update the RingBuffer’s total count. Remove data using FIFO strategy if its original size exceeds the new total count</li>
<li>Uses MetricRingBuffer.Update() method to add values</li>
</ul>
<p><strong><code>Datasource.ComputeCapacity(capacitySize int) int</code></strong></p>
<ul>
<li>Computes the maximum capacity (number of entries) for ring buffers based on available memory constraints</li>
<li>Takes <code>capacitySize</code> (in bytes) as the total memory limit available for this Datasource</li>
<li>Returns the maximum number of entries that can be stored in each RingBuffer while staying within memory limits</li>
<li>Calculates capacity by accounting for all memory overheads and solving for the maximum number of entries</li>
</ul>
<p><strong>Calculation Steps:</strong></p>
<ol>
<li>
<p><strong>Fixed Overheads</strong> (independent of capacity):</p>
<ul>
<li>Metrics Map Overhead: Base map structure overhead (~48 bytes) + per-entry overhead (~16 bytes per metric key)</li>
<li>Descriptions Map Overhead: Base map structure overhead (~48 bytes) + per-entry overhead (~24 bytes per description)</li>
<li>String Storage: Sum of all metric key strings and description strings (16 bytes string header + actual string length for each)</li>
<li>RingBuffer Internal Structures: For each RingBuffer (metrics + timestamps), account for:
<ul>
<li><code>next</code> field (int = 8 bytes on 64-bit systems)</li>
<li>Slice header (24 bytes: pointer + length + capacity)</li>
</ul>
</li>
</ul>
</li>
<li>
<p><strong>Variable Costs</strong> (per capacity entry):</p>
<ul>
<li>Float64 Values: <code>numMetrics * 8 bytes</code> (one float64 per metric RingBuffer)</li>
<li>Timestamp RingBuffer: <code>8 bytes</code> (one int64 per entry)</li>
<li>Total bytes per entry: <code>(numMetrics * 8) + 8</code></li>
</ul>
</li>
<li>
<p><strong>Capacity Calculation</strong>:</p>
<pre><code>Available Memory = capacitySize - Fixed Overheads
Max Capacity = Available Memory / Bytes Per Entry
</code></pre></li>
<li>
<p><strong>Edge Cases</strong>:</p>
<ul>
<li>If <code>capacitySize &lt;= 0</code>, return 0</li>
<li>If no metrics exist yet (<code>len(metrics) == 0</code>), return a default capacity (e.g., 1000)</li>
<li>If fixed overheads exceed <code>capacitySize</code>, return 0</li>
<li>Ensure the result is non-negative</li>
</ul>
</li>
</ol>
<h3 id="3-metrics-package-fodcinternalmetrics">3. Metrics Package (<code>fodc/internal/metrics</code>)</h3>
<p><strong>Purpose</strong>: Parsing Prometheus text format metrics into structured Go types</p>
<h4 id="core-types-2">Core Types</h4>
<p><strong><code>Label</code></strong></p>
<div class="highlight"><pre style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-go" data-lang="go"><span style="color:#000;font-weight:bold">type</span> Label <span style="color:#000;font-weight:bold">struct</span> {
	Name  <span style="color:#458;font-weight:bold">string</span>
	Value <span style="color:#458;font-weight:bold">string</span>
}
</code></pre></div><p><strong><code>RawMetric</code></strong></p>
<div class="highlight"><pre style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-go" data-lang="go"><span style="color:#000;font-weight:bold">type</span> RawMetric <span style="color:#000;font-weight:bold">struct</span> {
   Name        <span style="color:#458;font-weight:bold">string</span>      <span style="color:#998;font-style:italic">// Metric name
</span><span style="color:#998;font-style:italic"></span>   Labels      []Label     <span style="color:#998;font-style:italic">// Metric labels as key-value pairs
</span><span style="color:#998;font-style:italic"></span>   Value       <span style="color:#458;font-weight:bold">float64</span>     <span style="color:#998;font-style:italic">// Metric value
</span><span style="color:#998;font-style:italic"></span>   Desc        <span style="color:#458;font-weight:bold">string</span>      <span style="color:#998;font-style:italic">// HELP text description if available
</span><span style="color:#998;font-style:italic"></span>}
</code></pre></div><p><strong><code>MetricKey</code></strong></p>
<div class="highlight"><pre style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-go" data-lang="go"><span style="color:#000;font-weight:bold">type</span> MetricKey <span style="color:#000;font-weight:bold">struct</span> {
   Name   <span style="color:#458;font-weight:bold">string</span>
   Labels []Label
}

<span style="color:#000;font-weight:bold">func</span> (mk MetricKey) <span style="color:#900;font-weight:bold">String</span>() <span style="color:#458;font-weight:bold">string</span>
</code></pre></div><ul>
<li>Used for uniquely identifying metrics in FlightRecorder</li>
<li>Labels are sorted for consistent key generation</li>
<li>String() method generates a canonical representation</li>
</ul>
<h4 id="key-functions-2">Key Functions</h4>
<p><strong><code>Parse(text string) ([]RawMetric, error)</code></strong></p>
<ul>
<li>Parses Prometheus text format metrics</li>
<li>Handles HELP and TYPE lines</li>
<li>Parses metric lines with labels and values</li>
<li>Handles comments and empty lines</li>
<li>Returns structured RawMetric objects or error</li>
</ul>
<h3 id="4-prometheus-metrics-exporter-component-fodcinternalexporter">4. Prometheus Metrics Exporter Component (<code>fodc/internal/exporter</code>)</h3>
<p><strong>Purpose</strong>: Exposes Datasource metrics from FlightRecorder to Prometheus using the <code>prometheus/client_golang</code> library</p>
<h4 id="core-responsibilities-2">Core Responsibilities</h4>
<ul>
<li><strong>Metrics Export</strong>: Implements Prometheus Collector interface to expose Datasource metrics</li>
<li><strong>Metrics Conversion</strong>: Converts internal Datasource metrics format to Prometheus metric format</li>
<li><strong>Registry Integration</strong>: Registers with Prometheus registry for metrics scraping</li>
<li><strong>Label Handling</strong>: Preserves metric labels and descriptions when exporting</li>
</ul>
<h4 id="core-types-3">Core Types</h4>
<p><strong><code>DatasourceCollector</code></strong></p>
<div class="highlight"><pre style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-go" data-lang="go"><span style="color:#000;font-weight:bold">type</span> DatasourceCollector <span style="color:#000;font-weight:bold">struct</span> {
	flightRecorder <span style="color:#000;font-weight:bold">*</span>FlightRecorder
	descs          <span style="color:#000;font-weight:bold">map</span>[<span style="color:#458;font-weight:bold">string</span>]<span style="color:#000;font-weight:bold">*</span>prometheus.Desc
	mu             sync.RWMutex
}
</code></pre></div><ul>
<li>Implements <code>prometheus.Collector</code> interface</li>
<li>Holds reference to FlightRecorder for accessing Datasource metrics</li>
<li>Caches Prometheus metric descriptors for performance</li>
<li>Thread-safe access to FlightRecorder data</li>
</ul>
<h4 id="key-functions-3">Key Functions</h4>
<p><strong><code>NewDatasourceCollector(fr *FlightRecorder) *DatasourceCollector</code></strong></p>
<ul>
<li>Creates a new DatasourceCollector instance</li>
<li>Initializes the descriptor cache map</li>
<li>Returns initialized collector ready for registration</li>
</ul>
<p><strong><code>Describe(ch chan&lt;- *prometheus.Desc)</code></strong></p>
<ul>
<li>Implements <code>prometheus.Collector</code> interface</li>
<li>Sends metric descriptors to the channel for Prometheus registry</li>
<li>Describes all metrics that will be exposed from Datasources</li>
<li>Creates descriptors dynamically based on metrics stored in Datasources</li>
<li>Uses metric name and labels to generate unique descriptor keys</li>
<li>Includes HELP text from Datasource descriptions map</li>
</ul>
<p><strong><code>Collect(ch chan&lt;- prometheus.Metric)</code></strong></p>
<ul>
<li>Implements <code>prometheus.Collector</code> interface</li>
<li>Iterates through all Datasources in FlightRecorder</li>
<li>For each Datasource:
<ul>
<li>Iterates through all metrics in the <code>metrics</code> map</li>
<li>Extracts metric values from RingBuffers</li>
<li>Creates Prometheus Gauge metrics with current values</li>
<li>Preserves original metric labels from MetricKey</li>
<li>Includes timestamps from TimestampRingBuffer when available</li>
</ul>
</li>
<li>Sends Prometheus metrics to the channel</li>
<li>Handles concurrent access safely using mutex</li>
</ul>
<p><strong><code>DatasourceCollector.registerMetricDesc(name string, labels []string, help string) *prometheus.Desc</code></strong></p>
<ul>
<li>Creates or retrieves cached Prometheus descriptor for a metric</li>
<li>Uses metric name and sorted labels as cache key</li>
<li>Returns Prometheus descriptor for metric registration</li>
<li>Reuses descriptors to minimize memory allocation</li>
</ul>
<h4 id="integration-with-observability-service">Integration with Observability Service</h4>
<p>The DatasourceCollector integrates with the existing observability service (<code>banyand/observability</code>) to expose metrics:</p>
<p><strong>Registration Flow</strong>:</p>
<pre><code>1. FlightRecorder instance created
   ↓
2. DatasourceCollector created with FlightRecorder reference
   ↓
3. Collector registered with Prometheus registry
   (promReg.MustRegister(dataSourceCollector))
   ↓
4. Metrics endpoint handler exposes metrics
   (registerMetricsEndpoint(promReg, metricsMux))
   ↓
5. Prometheus scrapes /metrics endpoint
   ↓
6. DatasourceCollector.Collect() called
   ↓
7. Metrics from Datasources exposed in Prometheus format
</code></pre><p><strong>Metric Format</strong>:</p>
<ul>
<li>Metrics are exposed as Prometheus Gauge metrics</li>
<li>Original metric names are preserved</li>
<li>Labels from MetricKey are converted to Prometheus label format</li>
<li>HELP text from descriptions map is included</li>
<li>Current values from RingBuffers are exported</li>
</ul>
<p><strong>Example Exported Metrics</strong>:</p>
<pre><code># HELP banyandb_stream_tst_inverted_index_total_doc_count Total document count
# TYPE banyandb_stream_tst_inverted_index_total_doc_count gauge
banyandb_stream_tst_inverted_index_total_doc_count{index=&quot;test&quot;} 12345
</code></pre><h4 id="dependencies">Dependencies</h4>
<ul>
<li><strong><code>github.com/prometheus/client_golang/prometheus</code></strong>: Core Prometheus client library</li>
<li><strong>FlightRecorder</strong>: Source of Datasource metrics data</li>
<li><strong>Thread Safety</strong>: Uses mutex for concurrent access protection</li>
</ul>
<h4 id="configuration">Configuration</h4>
<p>The exporter component uses the existing Prometheus configuration from the observability service:</p>
<ul>
<li><strong>Metrics Endpoint</strong>: <code>/metrics</code> (default)</li>
<li><strong>Listen Address</strong>: Configured via <code>--observability-listener-addr</code> flag</li>
<li><strong>Prometheus Mode</strong>: Enabled via <code>--observability-modes=prometheus</code> flag</li>
</ul>
<h2 id="data-flow">Data Flow</h2>
<h3 id="metrics-collection-flow">Metrics Collection Flow</h3>
<pre><code>1. Watchdog Polling Timer Triggers
   ↓
2. HTTP GET Request to Metrics Endpoint
   (http://localhost:2121/metrics)
   ↓
3. Read Response Body (Prometheus Text Format)
   ↓
4. Parse Metrics Using metrics.Parse()
   - Parse HELP lines for descriptions
   - Parse metric lines with labels and values
   ↓
5. Convert to RawMetric Structures
   ↓
6. Forward to Flight Recorder
   ↓
7. Flight Recorder.Update() Called
   ↓
8. For Each Metric:
   a. Create MetricKey from metric name and sorted labels (e.g., &quot;http_requests{method=\&quot;get\&quot;}&quot;)
   b. Ensure the RingBuffer[float64] exists in Datasource.metrics for the MetricKey
     - If it doesn't exist, create a new RingBuffer[float64] (do not add values yet)
   c. Calculate the target capacity for each RingBuffer based on:
     - The capacity of Datasource.metrics map
     - Available memory limitations
   d. Adjust RingBuffer capacity if needed:
     - If the RingBuffer's current size exceeds the new target capacity, remove oldest data using FIFO (First-In-First-Out) strategy
     - Update the RingBuffer's capacity to match the target capacity
   e. Add the metric value to the RingBuffer in Datasource.metrics
   f. Store the metric description in Datasource.descriptions map using the MetricKey
   g. Add timestamp to Datasource.timestamps RingBuffer (once per polling cycle, not per metric)
   ↓
9. Metrics Buffered in Memory via FlightRecorder
</code></pre><h3 id="metrics-export-flow">Metrics Export Flow</h3>
<pre><code>1. Prometheus Scraper Requests Metrics
   (HTTP GET /metrics endpoint)
   ↓
2. Prometheus HTTP Handler Invoked
   (promhttp.HandlerFor with registry)
   ↓
3. Prometheus Registry Calls Collectors
   ↓
4. DatasourceCollector.Collect() Called
   ↓
5. For Each Datasource in FlightRecorder:
   a. Acquire read lock on FlightRecorder
   b. Iterate through Datasource.metrics map
   c. For each MetricKey and RingBuffer:
      - Extract current metric value from RingBuffer
      - Retrieve metric description from Datasource.descriptions
      - Parse MetricKey to extract metric name and labels
      - Create Prometheus Gauge metric with:
        * Metric name (from MetricKey)
        * Labels (from MetricKey labels)
        * Current value (from RingBuffer)
        * HELP text (from descriptions map)
   d. Send Prometheus metrics to channel
   ↓
6. Prometheus Registry Aggregates Metrics
   ↓
7. Metrics Exposed in Prometheus Text Format
   ↓
8. Prometheus Scraper Receives Metrics
</code></pre><h2 id="testing-strategy">Testing Strategy</h2>
<h3 id="unit-testing">Unit Testing</h3>
<p><strong>Metrics Package</strong></p>
<ul>
<li>Test <code>Parse()</code> with various Prometheus formats</li>
<li>Test HELP line parsing</li>
<li>Test label parsing (quoted values, special characters)</li>
<li>Test edge cases (empty labels, invalid formats, comments)</li>
<li>Test performance with large metrics outputs</li>
</ul>
<p><strong>Flight Recorder Package</strong></p>
<ul>
<li>Test RingBuffer[T].Add() write operations for both float64 and int64 types</li>
<li>Test MetricRingBuffer.Update()</li>
<li>Test TimestampRingBuffer.Update() operations</li>
<li>Test FlightRecorder.Update() with new and existing metrics</li>
<li>Test circular overwrite behavior</li>
<li>Test histogram storage and retrieval</li>
<li>Test concurrent writes</li>
<li>Test error handling</li>
<li>Test generic RingBuffer[T] type safety</li>
</ul>
<p><strong>Watchdog Package</strong></p>
<ul>
<li>Test polling interval accuracy</li>
<li>Test HTTP client connection reuse</li>
<li>Test exponential backoff retry logic</li>
<li>Test error handling for connection failures</li>
<li>Test metrics forwarding to Flight Recorder</li>
</ul>
<p><strong>Prometheus Metrics Exporter Package</strong></p>
<ul>
<li>Test <code>DatasourceCollector.Describe()</code> method
<ul>
<li>Verify all metric descriptors are described correctly</li>
<li>Test descriptor caching behavior</li>
<li>Test with empty FlightRecorder</li>
<li>Test with multiple Datasources</li>
</ul>
</li>
<li>Test <code>DatasourceCollector.Collect()</code> method
<ul>
<li>Verify metrics are collected from all Datasources</li>
<li>Test label preservation from MetricKey</li>
<li>Test HELP text inclusion from descriptions map</li>
<li>Test metric value extraction from RingBuffers</li>
<li>Test concurrent access safety</li>
<li>Test with empty RingBuffers</li>
<li>Test with multiple metrics per Datasource</li>
</ul>
</li>
<li>Test Prometheus registry integration
<ul>
<li>Verify collector registration</li>
<li>Test metrics exposure via HTTP endpoint</li>
<li>Verify Prometheus text format compliance</li>
</ul>
</li>
<li>Test error handling
<ul>
<li>Test with nil FlightRecorder</li>
<li>Test with corrupted metric data</li>
<li>Test with invalid label values</li>
</ul>
</li>
</ul>
<h3 id="e2e-testing">E2E Testing</h3>
<p><strong>Test Case 1: Basic Metrics Buffering</strong></p>
<ul>
<li>Start BanyanDB</li>
<li>Generate metrics by performing operations</li>
<li>Wait for Watchdog to poll metrics</li>
<li>Verify metrics are buffered correctly through internal checks</li>
</ul>
<p><strong>Test Case 2: Buffer Overflow Handling</strong></p>
<ul>
<li>Start BanyanDB</li>
<li>Generate large number of metric values (exceeding buffer size)</li>
<li>Verify circular overwrite behavior</li>
<li>Verify newest metrics are preserved</li>
<li>Verify oldest metrics are overwritten correctly</li>
</ul>
<p><strong>Test Case 3: Metrics Export to Prometheus</strong></p>
<ul>
<li>Start BanyanDB with Prometheus mode enabled</li>
<li>Generate metrics and wait for Watchdog to collect them</li>
<li>Verify metrics are stored in FlightRecorder Datasources</li>
<li>Scrape <code>/metrics</code> endpoint using Prometheus client</li>
<li>Verify exported metrics match buffered metrics</li>
<li>Verify metric labels are preserved correctly</li>
<li>Verify HELP text is included in exported metrics</li>
<li>Verify metric values are current (from RingBuffers)</li>
<li>Test concurrent scraping while metrics are being updated</li>
</ul>
<h2 id="appendix">Appendix</h2>
<h3 id="code-organization">Code Organization</h3>
<p><strong>Package Structure</strong></p>
<pre><code>fodc/
  internal/
    metrics/      - Prometheus metrics parsing
    watchdog/     - Watchdog component
    flightrecorder/ - Flight Recorder component
banyand/
  observability/ - Integration with observability service
  liaison/
    http/        - HTTP API endpoints
</code></pre><h3 id="integration-points">Integration Points</h3>
<p><strong>Existing Components</strong></p>
<ul>
<li><strong>Observability Service</strong>: Integrates with <code>banyand/observability</code> package</li>
<li><strong>HTTP Server</strong>: Uses existing HTTP server infrastructure from <code>banyand/liaison/http</code></li>
<li><strong>Flag Management</strong>: Uses existing flag system from <code>pkg/run</code></li>
<li><strong>Logging</strong>: Uses existing logging infrastructure from <code>pkg/logger</code></li>
</ul>
<p><strong>Dependencies</strong></p>
<ul>
<li>Standard library: <code>net/http</code>, <code>context</code>, <code>time</code>, <code>fmt</code>, etc.</li>
<li>Minimal external dependencies</li>
<li>Prefer standard library when possible</li>
</ul>
<h3 id="prometheus-text-format-reference">Prometheus Text Format Reference</h3>
<p><strong>Format</strong>: <code>metric_name{label1=&quot;value1&quot;, label2=&quot;value2&quot;} value</code></p>
<p><strong>Example</strong>:</p>
<pre><code># HELP banyandb_stream_tst_inverted_index_total_doc_count Total document count
# TYPE banyandb_stream_tst_inverted_index_total_doc_count gauge
banyandb_stream_tst_inverted_index_total_doc_count{index=&quot;test&quot;} 12345
cpu_usage{host=&quot;server1&quot;} 75.5
</code></pre><p><strong>Histogram Format</strong>:</p>
<pre><code># HELP http_request_duration_seconds Request duration histogram
# TYPE http_request_duration_seconds histogram
http_request_duration_seconds_bucket{le=&quot;0.1&quot;} 100
http_request_duration_seconds_bucket{le=&quot;0.5&quot;} 200
http_request_duration_seconds_bucket{le=&quot;+Inf&quot;} 300
http_request_duration_seconds_count 300
http_request_duration_seconds_sum 45.2
</code></pre><p><strong>Summary Format</strong>:</p>
<pre><code># HELP http_request_duration_seconds Request duration summary
# TYPE http_request_duration_seconds summary
http_request_duration_seconds{quantile=&quot;0.5&quot;} 0.052
http_request_duration_seconds{quantile=&quot;0.9&quot;} 0.120
http_request_duration_seconds{quantile=&quot;0.99&quot;} 0.250
http_request_duration_seconds_sum 45.2
http_request_duration_seconds_count 300
</code></pre><p><strong>Counter Format</strong>:</p>
<pre><code># HELP http_requests_total Total number of HTTP requests
# TYPE http_requests_total counter
http_requests_total{method=&quot;GET&quot;,status=&quot;200&quot;} 1234
http_requests_total{method=&quot;POST&quot;,status=&quot;200&quot;} 567
http_requests_total{method=&quot;GET&quot;,status=&quot;404&quot;} 89
http_requests_total{method=&quot;POST&quot;,status=&quot;500&quot;} 12
</code></pre>
</div>
<div>
  
  
  
  <div id="edit-github">
    <svg
      fill="currentColor"
      height="20"
      width="20"
      viewBox="0 0 40 40"
      aria-hidden="true"
      style="margin-right: 0.1em;vertical-align: sub; color: #3176d9">
      <g>
        <path d="m34.5 11.7l-3 3.1-6.3-6.3 3.1-3q0.5-0.5 1.2-0.5t1.1 0.5l3.9 3.9q0.5 0.4 0.5 1.1t-0.5 1.2z m-29.5 17.1l18.4-18.5 6.3 6.3-18.4 18.4h-6.3v-6.2z" />
      </g>
    </svg>
    <a class="github-link" title="Edit this page" href="" target="_blank">
      <span id="edit-github-text">Edit this page</span>
    </a>
  </div>
  
</div>
<script>
  let reg = /\/docs\/[a-zA-Z\-]+\/([\w|\.]+)\//;
  let res = reg.exec(location.href);
  let version = res && res[1];
  let editGithub = document.getElementById("edit-github");
  if (editGithub) {
    editGithub.style.display = version === "next" ? "block" : "none";
  }
  
  if (version === "next") {
    reg = /\/docs\/(.+?)\//;
    let repoRes = reg.exec(location.href);
    let repo = repoRes && repoRes[1];
    if (repo === "main") {
      repo = "skywalking"
    }
    reg = /\/next\/(.+)/;
    let docs = reg.exec(location.href);
    let docsUrl = docs && docs[1];
    if (docsUrl) {
      docsUrl = docsUrl.replace(/readme/i, 'README');
    }
    let prefixUrl = "https://github.com/apache/" + repo + "/blob/master/docs/";
    let editGithubLink = document.querySelector("#edit-github a");
    if (editGithubLink) {
      editGithubLink.href = prefixUrl + docsUrl.replace(/\/$/, ".md");
    }
  }
</script>

            </main>
          <div id="toc" class="d-none d-xl-block col-xl-2 td-toc d-print-none">
            




<div class="td-page-meta ml-2 pb-1 pt-2 mb-0">











</div>






<nav id="TableOfContents">
  <ul>
    <li><a href="#watchdog-and-flight-recorder-development-design">Watchdog And Flight Recorder Development Design</a>
      <ul>
        <li><a href="#table-of-contents">Table of Contents</a></li>
        <li><a href="#overview">Overview</a>
          <ul>
            <li><a href="#responsibilities">Responsibilities</a></li>
            <li><a href="#component-interaction-flow">Component Interaction Flow</a></li>
          </ul>
        </li>
        <li><a href="#component-design">Component Design</a>
          <ul>
            <li><a href="#1-watchdog-component">1. Watchdog Component</a></li>
            <li><a href="#2-flight-recorder-component">2. Flight Recorder Component</a></li>
            <li><a href="#3-metrics-package-fodcinternalmetrics">3. Metrics Package (<code>fodc/internal/metrics</code>)</a></li>
            <li><a href="#4-prometheus-metrics-exporter-component-fodcinternalexporter">4. Prometheus Metrics Exporter Component (<code>fodc/internal/exporter</code>)</a></li>
          </ul>
        </li>
        <li><a href="#data-flow">Data Flow</a>
          <ul>
            <li><a href="#metrics-collection-flow">Metrics Collection Flow</a></li>
            <li><a href="#metrics-export-flow">Metrics Export Flow</a></li>
          </ul>
        </li>
        <li><a href="#testing-strategy">Testing Strategy</a>
          <ul>
            <li><a href="#unit-testing">Unit Testing</a></li>
            <li><a href="#e2e-testing">E2E Testing</a></li>
          </ul>
        </li>
        <li><a href="#appendix">Appendix</a>
          <ul>
            <li><a href="#code-organization">Code Organization</a></li>
            <li><a href="#integration-points">Integration Points</a></li>
            <li><a href="#prometheus-text-format-reference">Prometheus Text Format Reference</a></li>
          </ul>
        </li>
      </ul>
    </li>
  </ul>
</nav>




<script>
  $(function () {
    var $toc = $("#TableOfContents");
    if (!$toc || !$toc.length) {
      return;
    }
    var top = $toc.offset().top;
    $(window).on("scroll", debounce(setTop, 100))
    $(window).on("scroll", debounce(addActive, 30))

    function addActive() {
      var scrollValue = $(window).scrollTop();
      var topEle = null;
      $.each($('main h1, main h2, main h3'), function (index, item) {
        if ($(item).offset().top - 70 > scrollValue) {
          return
        }
        if (!topEle) {
          topEle = item
        } else if ($(item).offset().top >= $(topEle).offset().top) {
          topEle = item
        }
        if (topEle) {
          var id = $(item).attr('id');
          $toc.find('a').removeClass("active").end().find('a[href="' + '#' + id + '"]').addClass("active")
        }
      })
    }

    function setTop() {
      var scrollValue = $(window).scrollTop();
      if (scrollValue >= top - 70) {
        $toc.addClass('fixed')
      } else {
        $toc.removeClass('fixed')
      }
    }

    function debounce(fn, wait) {
      var timeout = null;
      return function () {
        clearTimeout(timeout);
        timeout = setTimeout(() => {
          fn.apply(this, arguments);
        }, wait);
      };
    }
  })

</script>

          </div>

        </div>
      </div>

      
<footer class="py-5 sky-row">
  <div class="container-fluid text-center">
    <div class="">
        
        
        
<ul class="list-inline mb-0">
  
  <li class="list-inline-item mx-2 h3" data-toggle="tooltip" data-placement="top" title="Twitter" aria-label="Twitter">
    <a class="text-color" target="_blank" href="https://twitter.com/asfskywalking">
      <i class="iconfont icon-twitter"></i>
    </a>
  </li>
  
  <li class="list-inline-item mx-2 h3" data-toggle="tooltip" data-placement="top" title="Slack" aria-label="Slack">
    <a class="text-color" target="_blank" href="http://s.apache.org/slack-invite">
      <i class="iconfont icon-slack"></i>
    </a>
  </li>
  
  <li class="list-inline-item mx-2 h3" data-toggle="tooltip" data-placement="top" title="Mailing list" aria-label="Mailing list">
    <a class="text-color" target="_blank" href="https://lists.apache.org/list.html?dev@skywalking.apache.org">
      <i class="iconfont icon-email"></i>
    </a>
  </li>
  
  <li class="list-inline-item mx-2 h3" data-toggle="tooltip" data-placement="top" title="GitHub" aria-label="GitHub">
    <a class="text-color" target="_blank" href="https://github.com/apache/skywalking">
      <i class="iconfont icon-github"></i>
    </a>
  </li>
  
</ul>

        
        
    </div>
    <div class="">

        <small class="text-color">&copy; 2017 - 2026 The Apache Software Foundation All Rights Reserved</small>
        
	
    </div>
    <div class="">
      <small class="text-color mt-4">Apache SkyWalking, SkyWalking, Apache, the Apache feather logo, and the Apache SkyWalking project logo are either registered trademarks or trademarks of the Apache Software Foundation.</small>
    </div>
  </div>
</footer>


    </div>
    





































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































<div class="sky-event-popup">

    <div class="sky-pop-modal">
        <i class="iconfont icon-guanbi fa-window-close"></i>
        <div class="pic-wrapper">
            <img
                    data-img="/images/skywalking_200x200.png"
                    class="pic"
                    alt="event"
            />
        </div>

        <div class="content-box">
            
            
            

            <div class="item"
                 data-img=""
                 data-poster=""
                 data-link="/blog/2026-01-01-skywalking-2025-year-in-review/"
                 data-starttime=""
                 data-endtime="2026-01-01T23:00:00Z">
                <a href="/blog/2026-01-01-skywalking-2025-year-in-review/">
                    <h3 class="title">Apache SkyWalking 2025 in Review: Making BanyanDB Ready for Production</h3>
                    <p class="content-text">
                        A review of Apache SkyWalking community work in 2025, with a focus on BanyanDB becoming the production-grade native storage for SkyWalking.
                    </p>
                </a>

                <a href="/blog/2026-01-01-skywalking-2025-year-in-review/" class="modal-btn">
                    
                    Read more
                    
                </a>
            </div>
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
        </div>
    </div>
</div>




    
<div id="popup">
    <div class="mask">
        <img src=""/>
    </div>
</div>

    <div class="sidebar-mask"></div>
<div class="sidebar">
    <nav class="nav-links">
        <div class="nav-item"><a href="/docs/" class="nav-link">Projects and Documentation</a></div>
        <div class="nav-item"><a href="/events/" class="nav-link">Events</a></div>
        <div class="nav-item"><a href="/blog/" class="nav-link router-link-exact-active router-link-active">Blog</a>
        </div>
        <div class="nav-item"><a href="/downloads/" class="nav-link">Downloads</a></div>
        <div class="nav-item"><a href="/team/" class="nav-link">Team</a></div>
        <div class="nav-item"><a href="/users/" class="nav-link">Users</a></div>
        <div class="nav-item">
            <div class="dropdown-wrapper open">
                <a class="dropdown-title"><span>中文资料</span>
                    <span class="arrow down"></span>
                </a>
                <ul class="nav-dropdown">
                    <li class="dropdown-item">
                        <a href="/zh/" class="nav-link external">博客</a>
                    </li>
                    <li class="dropdown-item">
                        <a href="https://space.bilibili.com/390683219" target="_blank"
                           rel="noopener noreferrer" class="nav-link external">B站</a>
                    </li>
                    <li class="dropdown-item">
                        <a href="https://juejin.cn/user/13673577331607" target="_blank"
                           rel="noopener noreferrer" class="nav-link external">掘金</a>
                    </li>
                </ul>
            </div>
        </div>
        <div class="nav-item">
            <div class="dropdown-wrapper open">
                <a class="dropdown-title">
                    <span>Links</span>
                    <span class="arrow down"></span>
                </a>
                <ul class="nav-dropdown">
                    <li class="dropdown-item">
                        <a href="http://www.apache.org/" target="_blank"
                           rel="noopener noreferrer" class="nav-link external">
                            Apache Software Foundation
                        </a>
                    </li>
                    <li class="dropdown-item">
                        <a href="https://github.com/apache/skywalking/issues"
                           target="_blank" rel="noopener noreferrer"
                           class="nav-link external">
                            GitHub Issue Tracker
                        </a>
                    </li>
                    <li class="dropdown-item">
                        <a href="https://lists.apache.org/list.html?dev@skywalking.apache.org" target="_blank"
                           rel="noopener noreferrer" class="nav-link external">
                            Dev Mailing List
                        </a>
                    </li>
                    <li class="dropdown-item">
                        <a href="http://www.apache.org/licenses/" target="_blank"
                           rel="noopener noreferrer" class="nav-link external">
                            License
                        </a>
                    </li>
                    <li class="dropdown-item">
                        <a href="http://www.apache.org/events/current-event"
                           target="_blank" rel="noopener noreferrer"
                           class="nav-link external">
                            Apache Events
                        </a>
                    </li>
                    <li class="dropdown-item">
                        <a href="http://www.apache.org/security/" target="_blank"
                           rel="noopener noreferrer" class="nav-link external">
                            Security
                        </a>
                    </li>
                    <li class="dropdown-item">
                        <a href="http://www.apache.org/foundation/sponsorship.html"
                           target="_blank" rel="noopener noreferrer"
                           class="nav-link external">
                            Sponsorship and Donate
                        </a>
                    </li>
                    <li class="dropdown-item">
                        <a href="http://www.apache.org/foundation/thanks.html"
                           target="_blank" rel="noopener noreferrer"
                           class="nav-link external">
                            Thanks
                        </a>
                    </li>
                </ul>
            </div>
        </div>
    </nav>
</div>

    <script src="/js/bootstrap.bundle.min.js"></script>

<script src="/js/docsearch-3.9.0.js"></script>









<script src="/js/main.min.d00d7a99f9e61382b1db35fac38e0e7bdd97f8d3c663a4c4b8d02c3f1d78d894.js" integrity="sha256-0A16mfnmE4Kx2zX6w44Oe92X&#43;NPGY6TEuNAsPx142JQ=" crossorigin="anonymous"></script>


<script src="/js/highlight.min.js"></script>
<script src="/js/mermaid.min.js"></script>
<script>
    window.onload = () => mermaid.init(undefined, ".language-mermaid");
</script>
<script>
  document.addEventListener('DOMContentLoaded', () => {
    document.querySelectorAll('pre code.language-json5').forEach((block) => {
      if (block.classList.contains('language-json5')) {
        try {
          hljs.registerLanguage('json5', function(hljs) {
            return hljs.getLanguage('json');
          });
          hljs.highlightElement(block);
        } catch (error) {
          console.error("Error parsing JSON5:", error);
        }
      }
    });
  });
</script>


<script defer
src="/js/kapa-widget.bundle.js"
data-website-id="8a08392b-9c4d-4816-8bc4-f93e0ecdd2a7"
data-project-name="SkyWalking"
data-project-color="#2B74B8"
data-button-text="Ask AI"
data-search-mode-enabled="true"
data-modal-open-on-command-k="true"
data-modal-disclaimer="The AI supports multiple languages, but it may not be accessible in China, a proxy is required."
data-project-logo="/images/widget-logo.jpg"
data-modal-example-questions="What is Apache SkyWalking?,How to deploy SkyWalking?,How to inject agents non-intrusively?,How to setup trace sampling?"
data-button-position-top=""
data-button-position-right="20px"
data-button-position-bottom="200px"
data-button-position-left=""
data-consent-required="true"  
data-user-analytics-cookie-enabled="true"  
data-consent-screen-title="Help us improve our AI assistant"  
data-consent-screen-disclaimer="By clicking 'Allow tracking', you consent to anonymous user tracking which helps us improve our service. We don't collect any personally identifiable information."  
data-consent-screen-accept-button-text="Allow tracking"  
data-consent-screen-reject-button-text="No, thanks"
></script>




  </body>
  <script>
    $(function (){
      $('.doc-menu-button').on('click',function (){
        $('.td-sidebar').toggleClass('active')
      })
      $('.version-select').on('change', function (){
        var selectVersion = $(this).val().toLowerCase();
        var prefix = '';
        var url = location.href.replace(/(\/docs\/[a-zA-Z\-]+\/)([\w|\.]+)(\/.*)/, function (match, p1, p2, p3){
          prefix = p1 + selectVersion;
          return p1 + selectVersion + p3
        })
        go2SelectVersion(url, prefix)

      })
      function go2SelectVersion(url, prefix){
        $.ajax({
          url: url,
          type: "get",
          success:function(){
            location.href = url;
          },
          statusCode: {
            404:function(){
              location.href = prefix + '/readme/';
            }
          }
        });
      }
    })
  </script>
</html>
